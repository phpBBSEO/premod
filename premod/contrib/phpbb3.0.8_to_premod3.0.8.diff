Index: web.config
===================================================================
--- web.config	(revision 1)
+++ web.config	(Premod 3.0.8)
@@ -24,4 +24,30 @@
 			</security>
 		</system.webServer>
 	</location>
+	<!-- www.phpBB-SEO.com SEO TOOLKIT BEGIN -->
+	<location path="phpbb_seo">
+		<system.webServer>
+			<security>
+				<requestFiltering>
+					<hiddenSegments>
+						<add segment="cache" />
+					</hiddenSegments>
+				</requestFiltering>
+			</security>
+		</system.webServer>
+	</location>
+	<!-- www.phpBB-SEO.com SEO TOOLKIT END -->
+	<!-- www.phpBB-SEO.com SEO TOOLKIT BEGIN - GYM SITEMAPS -->
+	<location path="gym_sitemaps">
+		<system.webServer>
+			<security>
+				<requestFiltering>
+					<hiddenSegments>
+						<add segment="cache" />
+					</hiddenSegments>
+				</requestFiltering>
+			</security>
+		</system.webServer>
+	</location>
+	<!-- www.phpBB-SEO.com SEO TOOLKIT END - GYM SITEMAPS -->
 </configuration>
Index: styles/subsilver2/theme/gym_google.css
===================================================================
--- styles/subsilver2/theme/gym_google.css	(phpBB 3.0.8)
+++ styles/subsilver2/theme/gym_google.css	(Premod 3.0.8)
@@ -0,0 +1,666 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		subsilver2
+	Based on style:	subSilver (the default phpBB 2 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		psoTFX and the phpBB team ( http://www.phpbb.com )
+	
+	This is an alternative style for phpBB3 for those wishing to stay with
+	the familiar subSilver style of phpBB version 2.x
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* Layout
+ ------------ */
+* {
+	/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+
+html {
+	font-size: 100%;
+}
+
+body {
+	/* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #323D4F;
+	background-color: #FFFFFF;
+	font-size: 62.5%; /* This sets the default font size to be equivalent to 10px */
+	margin: 0;
+}
+
+#wrapheader {
+	min-height: 120px;
+	height: auto !important;
+	height: 120px;
+/*	background-image: url('./images/background.gif');
+	background-repeat: repeat-x;*/
+/*	padding: 0 25px 15px 25px;*/
+	padding: 0;
+}
+
+#wrapcentre {
+	margin: 15px 25px 0 25px;
+}
+
+#wrapfooter {
+	text-align: center;
+	clear: both;
+}
+
+#wrapnav {
+	width: 100%;
+	margin: 0;
+	background-color: #ECECEC;
+	border-width: 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+}
+
+#logodesc {
+	margin-bottom: 5px;
+	padding: 5px 25px;
+	background: #D9DFE4;
+	border-bottom: 1px solid #4787A7;
+}
+
+#menubar {
+	margin: 0 25px;
+}
+
+#datebar {
+	margin: 10px 25px 0 25px;
+}
+
+#findbar {
+	width: 100%;
+	margin: 0;
+	padding: 0;
+	border: 0;
+}
+
+.forumrules {
+	background-color: #F9CC79;
+	border-width: 1px;
+	border-style: solid;
+	border-color: #BB9860;
+	padding: 4px;
+	font-weight: normal;
+	font-size: 1.1em;
+	font-family: "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
+}
+
+.forumrules h3 {
+	color: red;
+}
+
+#pageheader { }
+#pagecontent { }
+#pagefooter { }
+
+#poll { }
+#postrow { }
+#postdata { }
+
+
+/*  Text
+ --------------------- */
+h1 {
+	color: black;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
+	font-weight: bold;
+	font-size: 1.8em;
+	text-decoration: none;
+}
+
+h2 {
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	font-size: 1.5em;
+	text-decoration: none;
+	line-height: 120%;
+}
+
+h3 {
+	font-size: 1.3em;
+	font-weight: bold;
+	font-family: Arial, Helvetica, sans-serif;
+	line-height: 120%;
+}
+
+h4 {
+	margin: 0;
+	font-size: 1.1em;
+	font-weight: bold;
+}
+
+p {
+	font-size: 1.1em;
+}
+
+p.moderators {
+	margin: 0;
+	float: left;
+	color: black;
+	font-weight: bold;
+}
+
+.rtl p.moderators {
+	float: right;
+}
+
+p.linkmcp {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+}
+
+.rtl p.linkmcp {
+	float: left;
+}
+
+p.breadcrumbs {
+	margin: 0;
+	float: left;
+	color: black;
+	font-weight: bold;
+	white-space: normal;
+	font-size: 1em;
+}
+
+.rtl p.breadcrumbs {
+	float: right;
+}
+
+p.datetime {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+	font-size: 1em;
+}
+
+.rtl p.datetime {
+	float: left;
+}
+
+p.searchbar {
+	padding: 2px 0;
+	white-space: nowrap;
+} 
+
+p.searchbarreg {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+}
+
+.rtl p.searchbarreg {
+	float: left;
+}
+
+p.forumdesc {
+	padding-bottom: 4px;
+}
+
+p.topicauthor {
+	margin: 1px 0;
+}
+
+p.topicdetails {
+	margin: 1px 0;
+}
+
+.postreported, .postreported a:visited, .postreported a:hover, .postreported a:link, .postreported a:active {
+	margin: 1px 0;
+	color: red;
+	font-weight:bold;
+}
+
+.postapprove, .postapprove a:visited, .postapprove a:hover, .postapprove a:link, .postapprove a:active {
+	color: green;
+	font-weight:bold;
+}
+
+.postapprove img, .postreported img {
+	vertical-align: bottom;
+}
+
+.postauthor {
+	color: #000000;
+}
+
+.postdetails {
+	color: #000000;
+}
+
+.postbody {
+	font-size: 1.3em;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Helvetica, Arial, sans-serif;
+}
+
+.postbody li, ol, ul {
+	margin: 0 0 0 1.5em;
+}
+
+.rtl .postbody li, .rtl ol, .rtl ul {
+	margin: 0 1.5em 0 0;
+}
+
+.posthilit {
+	background-color: yellow;
+}
+
+.nav {
+	margin: 0;
+	color: black;
+	font-weight: bold;
+}
+
+.pagination {
+	padding: 4px;
+	color: black;
+	font-size: 1em;
+	font-weight: bold;
+}
+
+.cattitle {
+
+}
+
+.gen {
+	margin: 1px 1px;
+	font-size: 1.2em;
+}
+
+.genmed {
+	margin: 1px 1px;
+	font-size: 1.1em;
+}
+
+.gensmall {
+	margin: 1px 1px;
+	font-size: 1em;
+}
+
+.copyright {
+	color: #444;
+	font-weight: normal;
+	font-family: "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
+}
+
+.titles {
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-weight: bold;
+	font-size: 1.3em;
+	text-decoration: none;
+}
+
+.error {
+	color: red;
+}
+
+
+/* Tables
+ ------------ */
+th {
+	color: #FFA34F;
+	font-size: 1.1em;
+	font-weight: bold;
+	background-color: #006699;
+	background-image: url('./images/cellpic3.gif');
+	white-space: nowrap;
+	padding: 7px 5px;
+}
+
+td {
+	padding: 2px;
+}
+td.profile {
+	padding: 4px;
+}
+
+.tablebg {
+	background-color: #A9B8C2;
+}
+
+.catdiv {
+	height: 28px;
+	margin: 0;
+	padding: 0;
+	border: 0;
+	background: white url('./images/cellpic2.jpg') repeat-y scroll top left;
+}
+.rtl .catdiv {
+	background: white url('./images/cellpic2_rtl.jpg') repeat-y scroll top right;
+}
+
+.cat {
+	height: 28px;
+	margin: 0;
+	padding: 0;
+	border: 0;
+	background-color: #C7D0D7;
+	background-image: url('./images/cellpic1.gif');
+	text-indent: 4px;
+}
+
+.row1 {
+	background-color: #ECECEC;
+	padding: 4px;
+}
+
+.row2 {
+	background-color: #DCE1E5;
+	padding: 4px;
+}
+
+.row3 {
+	background-color: #C0C8D0;
+	padding: 4px;
+}
+
+.spacer {
+	background-color: #D1D7DC;
+}
+
+hr {
+	height: 1px;
+	border-width: 0;
+	background-color: #D1D7DC;
+	color: #D1D7DC;
+}
+
+.legend {
+	text-align:center;
+	margin: 0 auto;
+}
+
+/* Links
+ ------------ */
+a:link {
+	color: #006597;
+	text-decoration: none;
+}
+
+a:active,
+a:visited {
+	color: #005784;
+	text-decoration: none;
+}
+
+a:hover {
+	color: #D46400;
+	text-decoration: underline;
+}
+
+a.forumlink {
+	color: #069;
+	font-weight: bold;
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+}
+
+a.topictitle {
+	margin: 1px 0;
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-weight: bold;
+	font-size: 1.2em;
+}
+
+a.topictitle:visited {
+	color: #5493B4;
+	text-decoration: none;
+}
+
+th a,
+th a:visited {
+	color: #FFA34F !important;
+	text-decoration: none;
+}
+
+th a:hover {
+	text-decoration: underline;
+}
+
+
+/* Form Elements
+ ------------ */
+form {
+	margin: 0;
+	padding: 0;
+	border: 0;
+}
+
+input {
+	color: #333333;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	font-size: 1.1em;
+	font-weight: normal;
+	padding: 1px;
+	border: 1px solid #A9B8C2;
+	background-color: #FAFAFA;
+}
+
+textarea {
+	background-color: #FAFAFA;
+	color: #333333;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.3em; 
+	line-height: 1.4em;
+	font-weight: normal;
+	border: 1px solid #A9B8C2;
+	padding: 2px;
+}
+
+select {
+	color: #333333;
+	background-color: #FAFAFA;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	font-size: 1.1em;
+	font-weight: normal;
+	border: 1px solid #A9B8C2;
+	padding: 1px;
+}
+
+option {
+	padding: 0 1em 0 0;
+}
+
+option.disabled-option {
+	color: graytext;
+}
+
+.rtl option {
+	padding: 0 0 0 1em;
+}
+
+input.radio {
+	border: none;
+	background-color: transparent;
+}
+
+.post {
+	background-color: white;
+	border-style: solid;
+	border-width: 1px;
+}
+
+.btnbbcode {
+	color: #000000;
+	font-weight: normal;
+	font-size: 1.1em;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	background-color: #EFEFEF;
+	border: 1px solid #666666;
+}
+
+.btnmain {
+	font-weight: bold;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	cursor: pointer;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.btnlite {
+	font-weight: normal;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	cursor: pointer;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.btnfile {
+	font-weight: normal;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.helpline {
+	background-color: #DEE3E7;
+	border-style: none;
+}
+
+
+/* BBCode
+ ------------ */
+.quotetitle, .attachtitle {
+	margin: 10px 5px 0 5px;
+	padding: 4px;
+	border-width: 1px 1px 0 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+	color: #333333;
+	background-color: #A9B8C2;
+	font-size: 0.85em;
+	font-weight: bold;
+}
+
+.quotetitle .quotetitle {
+	font-size: 1em;
+}
+
+.quotecontent, .attachcontent {
+	margin: 0 5px 10px 5px;
+	padding: 5px;
+	border-color: #A9B8C2;
+	border-width: 0 1px 1px 1px;
+	border-style: solid;
+	font-weight: normal;
+	font-size: 1em;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Helvetica, Arial, sans-serif;
+	background-color: #FAFAFA;
+	color: #4B5C77;
+}
+
+.attachcontent {
+	font-size: 0.85em;
+}
+
+.codetitle {
+	margin: 10px 5px 0 5px;
+	padding: 2px 4px;
+	border-width: 1px 1px 0 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+	color: #333333;
+	background-color: #A9B8C2;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 0.8em;
+}
+
+.codecontent {
+	direction: ltr;
+	margin: 0 5px 10px 5px;
+	padding: 5px;
+	border-color: #A9B8C2;
+	border-width: 0 1px 1px 1px;
+	border-style: solid;
+	font-weight: normal;
+	color: #006600;
+	font-size: 0.85em;
+	font-family: Monaco, 'Courier New', monospace;
+	background-color: #FAFAFA;
+}
+
+.syntaxbg {
+	color: #FFFFFF;
+}
+
+.syntaxcomment {
+	color: #FF8000;
+}
+
+.syntaxdefault {
+	color: #0000BB;
+}
+
+.syntaxhtml {
+	color: #000000;
+}
+
+.syntaxkeyword {
+	color: #007700;
+}
+
+.syntaxstring {
+	color: #DD0000;
+}
+
+
+/* Private messages
+ ------------------ */
+.pm_marked_colour {
+	background-color: #000000;
+}
+
+.pm_replied_colour {
+	background-color: #A9B8C2;
+}
+
+.pm_friend_colour {
+	background-color: #007700;
+}
+
+.pm_foe_colour {
+	background-color: #DD0000;
+}
+
+
+/* Misc
+ ------------ */
+img {
+	border: none;
+}
+
+.sep {
+	color: black;
+	background-color: #FFA34F;
+}
+
+table.colortable td {
+	padding: 0;
+}
+
+pre {
+	font-size: 1.1em;
+	font-family: Monaco, 'Courier New', monospace;
+}
+
+.nowrap {
+	white-space: nowrap;
+}
+
+.username-coloured {
+	font-weight: bold;
+}
Index: styles/subsilver2/theme/stylesheet.css
===================================================================
--- styles/subsilver2/theme/stylesheet.css	(revision 1)
+++ styles/subsilver2/theme/stylesheet.css	(Premod 3.0.8)
@@ -667,4 +667,27 @@
 
 .username-coloured {
 	font-weight: bold;
-}
\ No newline at end of file
+}
+/* GYM Sitemaps & RSS - www.phpbb-seo.com */
+div.gymsublist {
+	display:block;
+	position:relative;
+	padding-left:10px;
+	padding-top:5px;
+	padding-bottom:10px;
+	padding-right:0;
+	margin:0;
+}
+div.gymsublist ul {
+	display:block;
+	position:relative;
+	height:1%;
+	padding-left:30px;
+}
+div.gymsublist ul li {
+	display:block;
+	position:relative;
+	line-height:18px;
+	font-size:11px;
+}
+/* GYM Sitemaps & RSS - www.phpbb-seo.com */
Index: styles/subsilver2/theme/gym_rss.css
===================================================================
--- styles/subsilver2/theme/gym_rss.css	(phpBB 3.0.8)
+++ styles/subsilver2/theme/gym_rss.css	(Premod 3.0.8)
@@ -0,0 +1,666 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		subsilver2
+	Based on style:	subSilver (the default phpBB 2 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		psoTFX and the phpBB team ( http://www.phpbb.com )
+	
+	This is an alternative style for phpBB3 for those wishing to stay with
+	the familiar subSilver style of phpBB version 2.x
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* Layout
+ ------------ */
+* {
+	/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+
+html {
+	font-size: 100%;
+}
+
+body {
+	/* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #323D4F;
+	background-color: #FFFFFF;
+	font-size: 62.5%; /* This sets the default font size to be equivalent to 10px */
+	margin: 0;
+}
+
+#wrapheader {
+	min-height: 120px;
+	height: auto !important;
+	height: 120px;
+/*	background-image: url('./images/background.gif');
+	background-repeat: repeat-x;*/
+/*	padding: 0 25px 15px 25px;*/
+	padding: 0;
+}
+
+#wrapcentre {
+	margin: 15px 25px 0 25px;
+}
+
+#wrapfooter {
+	text-align: center;
+	clear: both;
+}
+
+#wrapnav {
+	width: 100%;
+	margin: 0;
+	background-color: #ECECEC;
+	border-width: 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+}
+
+#logodesc {
+	margin-bottom: 5px;
+	padding: 5px 25px;
+	background: #D9DFE4;
+	border-bottom: 1px solid #4787A7;
+}
+
+#menubar {
+	margin: 0 25px;
+}
+
+#datebar {
+	margin: 10px 25px 0 25px;
+}
+
+#findbar {
+	width: 100%;
+	margin: 0;
+	padding: 0;
+	border: 0;
+}
+
+.forumrules {
+	background-color: #F9CC79;
+	border-width: 1px;
+	border-style: solid;
+	border-color: #BB9860;
+	padding: 4px;
+	font-weight: normal;
+	font-size: 1.1em;
+	font-family: "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
+}
+
+.forumrules h3 {
+	color: red;
+}
+
+#pageheader { }
+#pagecontent { }
+#pagefooter { }
+
+#poll { }
+#postrow { }
+#postdata { }
+
+
+/*  Text
+ --------------------- */
+h1 {
+	color: black;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
+	font-weight: bold;
+	font-size: 1.8em;
+	text-decoration: none;
+}
+
+h2 {
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	font-size: 1.5em;
+	text-decoration: none;
+	line-height: 120%;
+}
+
+h3 {
+	font-size: 1.3em;
+	font-weight: bold;
+	font-family: Arial, Helvetica, sans-serif;
+	line-height: 120%;
+}
+
+h4 {
+	margin: 0;
+	font-size: 1.1em;
+	font-weight: bold;
+}
+
+p {
+	font-size: 1.1em;
+}
+
+p.moderators {
+	margin: 0;
+	float: left;
+	color: black;
+	font-weight: bold;
+}
+
+.rtl p.moderators {
+	float: right;
+}
+
+p.linkmcp {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+}
+
+.rtl p.linkmcp {
+	float: left;
+}
+
+p.breadcrumbs {
+	margin: 0;
+	float: left;
+	color: black;
+	font-weight: bold;
+	white-space: normal;
+	font-size: 1em;
+}
+
+.rtl p.breadcrumbs {
+	float: right;
+}
+
+p.datetime {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+	font-size: 1em;
+}
+
+.rtl p.datetime {
+	float: left;
+}
+
+p.searchbar {
+	padding: 2px 0;
+	white-space: nowrap;
+} 
+
+p.searchbarreg {
+	margin: 0;
+	float: right;
+	white-space: nowrap;
+}
+
+.rtl p.searchbarreg {
+	float: left;
+}
+
+p.forumdesc {
+	padding-bottom: 4px;
+}
+
+p.topicauthor {
+	margin: 1px 0;
+}
+
+p.topicdetails {
+	margin: 1px 0;
+}
+
+.postreported, .postreported a:visited, .postreported a:hover, .postreported a:link, .postreported a:active {
+	margin: 1px 0;
+	color: red;
+	font-weight:bold;
+}
+
+.postapprove, .postapprove a:visited, .postapprove a:hover, .postapprove a:link, .postapprove a:active {
+	color: green;
+	font-weight:bold;
+}
+
+.postapprove img, .postreported img {
+	vertical-align: bottom;
+}
+
+.postauthor {
+	color: #000000;
+}
+
+.postdetails {
+	color: #000000;
+}
+
+.postbody {
+	font-size: 1.3em;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Helvetica, Arial, sans-serif;
+}
+
+.postbody li, ol, ul {
+	margin: 0 0 0 1.5em;
+}
+
+.rtl .postbody li, .rtl ol, .rtl ul {
+	margin: 0 1.5em 0 0;
+}
+
+.posthilit {
+	background-color: yellow;
+}
+
+.nav {
+	margin: 0;
+	color: black;
+	font-weight: bold;
+}
+
+.pagination {
+	padding: 4px;
+	color: black;
+	font-size: 1em;
+	font-weight: bold;
+}
+
+.cattitle {
+
+}
+
+.gen {
+	margin: 1px 1px;
+	font-size: 1.2em;
+}
+
+.genmed {
+	margin: 1px 1px;
+	font-size: 1.1em;
+}
+
+.gensmall {
+	margin: 1px 1px;
+	font-size: 1em;
+}
+
+.copyright {
+	color: #444;
+	font-weight: normal;
+	font-family: "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
+}
+
+.titles {
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-weight: bold;
+	font-size: 1.3em;
+	text-decoration: none;
+}
+
+.error {
+	color: red;
+}
+
+
+/* Tables
+ ------------ */
+th {
+	color: #FFA34F;
+	font-size: 1.1em;
+	font-weight: bold;
+	background-color: #006699;
+	background-image: url('./images/cellpic3.gif');
+	white-space: nowrap;
+	padding: 7px 5px;
+}
+
+td {
+	padding: 2px;
+}
+td.profile {
+	padding: 4px;
+}
+
+.tablebg {
+	background-color: #A9B8C2;
+}
+
+.catdiv {
+	height: 28px;
+	margin: 0;
+	padding: 0;
+	border: 0;
+	background: white url('./images/cellpic2.jpg') repeat-y scroll top left;
+}
+.rtl .catdiv {
+	background: white url('./images/cellpic2_rtl.jpg') repeat-y scroll top right;
+}
+
+.cat {
+	height: 28px;
+	margin: 0;
+	padding: 0;
+	border: 0;
+	background-color: #C7D0D7;
+	background-image: url('./images/cellpic1.gif');
+	text-indent: 4px;
+}
+
+.row1 {
+	background-color: #ECECEC;
+	padding: 4px;
+}
+
+.row2 {
+	background-color: #DCE1E5;
+	padding: 4px;
+}
+
+.row3 {
+	background-color: #C0C8D0;
+	padding: 4px;
+}
+
+.spacer {
+	background-color: #D1D7DC;
+}
+
+hr {
+	height: 1px;
+	border-width: 0;
+	background-color: #D1D7DC;
+	color: #D1D7DC;
+}
+
+.legend {
+	text-align:center;
+	margin: 0 auto;
+}
+
+/* Links
+ ------------ */
+a:link {
+	color: #006597;
+	text-decoration: none;
+}
+
+a:active,
+a:visited {
+	color: #005784;
+	text-decoration: none;
+}
+
+a:hover {
+	color: #D46400;
+	text-decoration: underline;
+}
+
+a.forumlink {
+	color: #069;
+	font-weight: bold;
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+}
+
+a.topictitle {
+	margin: 1px 0;
+	font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
+	font-weight: bold;
+	font-size: 1.2em;
+}
+
+a.topictitle:visited {
+	color: #5493B4;
+	text-decoration: none;
+}
+
+th a,
+th a:visited {
+	color: #FFA34F !important;
+	text-decoration: none;
+}
+
+th a:hover {
+	text-decoration: underline;
+}
+
+
+/* Form Elements
+ ------------ */
+form {
+	margin: 0;
+	padding: 0;
+	border: 0;
+}
+
+input {
+	color: #333333;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	font-size: 1.1em;
+	font-weight: normal;
+	padding: 1px;
+	border: 1px solid #A9B8C2;
+	background-color: #FAFAFA;
+}
+
+textarea {
+	background-color: #FAFAFA;
+	color: #333333;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.3em; 
+	line-height: 1.4em;
+	font-weight: normal;
+	border: 1px solid #A9B8C2;
+	padding: 2px;
+}
+
+select {
+	color: #333333;
+	background-color: #FAFAFA;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	font-size: 1.1em;
+	font-weight: normal;
+	border: 1px solid #A9B8C2;
+	padding: 1px;
+}
+
+option {
+	padding: 0 1em 0 0;
+}
+
+option.disabled-option {
+	color: graytext;
+}
+
+.rtl option {
+	padding: 0 0 0 1em;
+}
+
+input.radio {
+	border: none;
+	background-color: transparent;
+}
+
+.post {
+	background-color: white;
+	border-style: solid;
+	border-width: 1px;
+}
+
+.btnbbcode {
+	color: #000000;
+	font-weight: normal;
+	font-size: 1.1em;
+	font-family: "Lucida Grande", Verdana, Helvetica, sans-serif;
+	background-color: #EFEFEF;
+	border: 1px solid #666666;
+}
+
+.btnmain {
+	font-weight: bold;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	cursor: pointer;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.btnlite {
+	font-weight: normal;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	cursor: pointer;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.btnfile {
+	font-weight: normal;
+	background-color: #ECECEC;
+	border: 1px solid #A9B8C2;
+	padding: 1px 5px;
+	font-size: 1.1em;
+}
+
+.helpline {
+	background-color: #DEE3E7;
+	border-style: none;
+}
+
+
+/* BBCode
+ ------------ */
+.quotetitle, .attachtitle {
+	margin: 10px 5px 0 5px;
+	padding: 4px;
+	border-width: 1px 1px 0 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+	color: #333333;
+	background-color: #A9B8C2;
+	font-size: 0.85em;
+	font-weight: bold;
+}
+
+.quotetitle .quotetitle {
+	font-size: 1em;
+}
+
+.quotecontent, .attachcontent {
+	margin: 0 5px 10px 5px;
+	padding: 5px;
+	border-color: #A9B8C2;
+	border-width: 0 1px 1px 1px;
+	border-style: solid;
+	font-weight: normal;
+	font-size: 1em;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Helvetica, Arial, sans-serif;
+	background-color: #FAFAFA;
+	color: #4B5C77;
+}
+
+.attachcontent {
+	font-size: 0.85em;
+}
+
+.codetitle {
+	margin: 10px 5px 0 5px;
+	padding: 2px 4px;
+	border-width: 1px 1px 0 1px;
+	border-style: solid;
+	border-color: #A9B8C2;
+	color: #333333;
+	background-color: #A9B8C2;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 0.8em;
+}
+
+.codecontent {
+	direction: ltr;
+	margin: 0 5px 10px 5px;
+	padding: 5px;
+	border-color: #A9B8C2;
+	border-width: 0 1px 1px 1px;
+	border-style: solid;
+	font-weight: normal;
+	color: #006600;
+	font-size: 0.85em;
+	font-family: Monaco, 'Courier New', monospace;
+	background-color: #FAFAFA;
+}
+
+.syntaxbg {
+	color: #FFFFFF;
+}
+
+.syntaxcomment {
+	color: #FF8000;
+}
+
+.syntaxdefault {
+	color: #0000BB;
+}
+
+.syntaxhtml {
+	color: #000000;
+}
+
+.syntaxkeyword {
+	color: #007700;
+}
+
+.syntaxstring {
+	color: #DD0000;
+}
+
+
+/* Private messages
+ ------------------ */
+.pm_marked_colour {
+	background-color: #000000;
+}
+
+.pm_replied_colour {
+	background-color: #A9B8C2;
+}
+
+.pm_friend_colour {
+	background-color: #007700;
+}
+
+.pm_foe_colour {
+	background-color: #DD0000;
+}
+
+
+/* Misc
+ ------------ */
+img {
+	border: none;
+}
+
+.sep {
+	color: black;
+	background-color: #FFA34F;
+}
+
+table.colortable td {
+	padding: 0;
+}
+
+pre {
+	font-size: 1.1em;
+	font-family: Monaco, 'Courier New', monospace;
+}
+
+.nowrap {
+	white-space: nowrap;
+}
+
+.username-coloured {
+	font-weight: bold;
+}
Index: styles/subsilver2/theme/gym_rss_links.css
===================================================================
--- styles/subsilver2/theme/gym_rss_links.css	(phpBB 3.0.8)
+++ styles/subsilver2/theme/gym_rss_links.css	(Premod 3.0.8)
@@ -0,0 +1,18 @@
+/* the news box when JavaScript is available */
+#news.hasJS
+{
+	width:100%;
+	height:120px;
+	overflow:hidden;
+	position:relative;
+}
+/* The nested UL when JavaScript is available */
+#news.hasJS ul
+{
+	width:100%;
+	position:absolute;
+	top:120px;
+	left:0;
+	margin:0 .5em 0 .5em;
+	padding:0;
+}
Index: styles/subsilver2/template/overall_header.html
===================================================================
--- styles/subsilver2/template/overall_header.html	(revision 1)
+++ styles/subsilver2/template/overall_header.html	(Premod 3.0.8)
@@ -1,20 +1,19 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
 <head>
-
+{SEO_BASE_HREF}
+<!-- IF SEO_CANONICAL_URL --><link rel="canonical" href="{SEO_CANONICAL_URL}" /><!-- ENDIF -->
 <meta http-equiv="content-type" content="text/html; charset={S_CONTENT_ENCODING}" />
+<title>{PAGE_TITLE}<!-- IF S_IN_MCP --> &bull; {L_MCP}<!-- ELSEIF S_IN_UCP --> &bull; {L_UCP}<!-- ENDIF --></title>
 <meta http-equiv="content-language" content="{S_USER_LANG}" />
 <meta http-equiv="content-style-type" content="text/css" />
 <meta http-equiv="imagetoolbar" content="no" />
-<meta name="resource-type" content="document" />
-<meta name="distribution" content="global" />
-<meta name="copyright" content="2000, 2002, 2005, 2007 phpBB Group" />
-<meta name="keywords" content="" />
-<meta name="description" content="" />
+{META_TAG}
 <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7; IE=EmulateIE9" />
 {META}
-<title>{SITENAME} &bull; <!-- IF S_IN_MCP -->{L_MCP} &bull; <!-- ELSEIF S_IN_UCP -->{L_UCP} &bull; <!-- ENDIF -->{PAGE_TITLE}</title>
-
+<!-- BEGIN gym_rsslinks -->
+<link rel="alternate" type="application/rss+xml" title="{gym_rsslinks.TITLE}" href="{gym_rsslinks.URL}" />
+<!-- END gym_rsslinks -->
 <!-- IF S_ENABLE_FEEDS -->
 	<!-- IF S_ENABLE_FEEDS_OVERALL --><link rel="alternate" type="application/atom+xml" title="{L_FEED} - {SITENAME}" href="{U_FEED}" /><!-- ENDIF -->
 	<!-- IF S_ENABLE_FEEDS_NEWS --><link rel="alternate" type="application/atom+xml" title="{L_FEED} - {L_FEED_NEWS}" href="{U_FEED}?mode=news" /><!-- ENDIF -->
@@ -47,24 +46,93 @@
 	return false;
 }
 
-function jumpto()
-{
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+function jumpto() {
 	var page = prompt('{LA_JUMP_PAGE}:', '{ON_PAGE}');
-	var per_page = '{PER_PAGE}';
+	var perpage = '{PER_PAGE}';
 	var base_url = '{A_BASE_URL}';
-
-	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
-	{
-		if (base_url.indexOf('?') == -1)
-		{
-			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
+	var seo_delim_start = '{SEO_START_DELIM}';
+	var seo_static_pagination = '{SEO_SATIC_PAGE}';
+	var seo_ext_pagination = '{SEO_EXT_PAGE}';
+	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0) {
+		var seo_page = (page - 1) * perpage;
+		var anchor = '';
+		var anchor_parts = base_url.split('#');
+		if ( anchor_parts[1] ) {
+			base_url = anchor_parts[0];
+			anchor = '#' + anchor_parts[1];
 		}
-		else
-		{
-			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
+		if ( base_url.indexOf('?') >= 0 ) {
+			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + seo_page + anchor;
+		} else if ( seo_page > 0 ) {
+			var seo_type1 = base_url.match(/\.[a-z0-9]+$/i);
+			if (seo_type1 !== null) {
+				document.location.href = base_url.replace(/\.[a-z0-9]+$/i, '') + seo_delim_start + seo_page + seo_type1 + anchor;
+			}
+			var seo_type2 = base_url.match(/\/$/);
+			if (seo_type2 !== null) {
+				document.location.href = base_url + seo_static_pagination + seo_page + seo_ext_pagination + anchor;
+			}
+		} else {
+			document.location.href = base_url + anchor;
 		}
 	}
 }
+var seo_external = {SEO_EXTERNAL};
+var seo_external_sub = {SEO_EXTERNAL_SUB};
+var seo_ext_classes = {SEO_EXT_CLASSES};
+var seo_hashfix = {SEO_HASHFIX};
+/**
+*  phpbb_seo_href()
+*  Fixes href="#something" links with virtual directories
+*  Optionally open external or marked with a css class links in a new window
+*  in a XHTML 1.x compliant way.
+*/
+function phpbb_seo_href() {
+	var current_domain = document.domain.toLowerCase();
+	if (!current_domain || !document.getElementsByTagName) return;
+	if (seo_external_sub && current_domain.indexOf('.') >= 0) {
+		current_domain = current_domain.replace(new RegExp(/^[a-z0-9_-]+\.([a-z0-9_-]+\.([a-z]{2,6}|[a-z]{2,3}\.[a-z]{2,3}))$/i), '$1');
+	}
+	if (seo_ext_classes) {
+		var extclass = new RegExp("(^|\s)(" + seo_ext_classes + ")(\s|$)");
+	}
+	if (seo_hashfix) {
+		var basehref = document.getElementsByTagName('base')[0];
+		if (basehref) {
+			basehref = basehref.href;
+			var hashtest = new RegExp("^(" + basehref + "|)#[a-z0-9_-]+$");
+			var current_href = document.location.href.replace(/#[a-z0-9_-]+$/i, "");
+		} else {
+			seo_hashfix = false;
+		}
+	}
+	var hrefels = document.getElementsByTagName("a");
+	var hrefelslen = hrefels.length;
+	for (var i = 0; i < hrefelslen; i++) {
+		var el = hrefels[i];
+		var hrefinner = el.innerHTML.toLowerCase();
+		if (el.onclick || (el.href == '') || (el.href.indexOf('javascript') >=0 ) || (el.href.indexOf('mailto') >=0 ) || (hrefinner.indexOf('<a') >= 0) ) {
+			continue;
+		}
+		if (seo_hashfix && el.hash && hashtest.test(el.href)) {
+			el.href = current_href + el.hash;
+		}
+		if (seo_external) {
+			if ((el.href.indexOf(current_domain) >= 0) && !(seo_ext_classes && extclass.test(el.className))) {
+				continue;
+			}
+			el.onclick = function () { window.open(this.href); return false; };
+		}
+	}
+}
+window.onload = function() {
+	if (seo_external || seo_hashfix) {
+		phpbb_seo_href();
+	}
+	// here you can add other window.onload events
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 
 /**
 * Find a member
Index: styles/subsilver2/template/login_body.html
===================================================================
--- styles/subsilver2/template/login_body.html	(revision 1)
+++ styles/subsilver2/template/login_body.html	(Premod 3.0.8)
@@ -105,4 +105,4 @@
 // ]]>
 </script>
 
-<!-- INCLUDE overall_footer.html -->
+<!-- INCLUDE overall_footer.html -->
\ No newline at end of file
Index: styles/subsilver2/template/gym_sitemaps/last_topics_list.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/last_topics_list.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/last_topics_list.html	(Premod 3.0.8)
@@ -0,0 +1,23 @@
+<br/><h2>{LASTX_TOPICS_TITLE}</h2>
+<br/>
+<table class="tablebg" cellspacing="1" width="100%">
+	<!-- BEGIN last_forums -->
+	<tr>
+		<td class="cat" colspan="4"><h4><a href="{last_forums.U_VIEWFORUM}" title="{last_forums.FORUM_NAME}" class="forumtitle">{last_forums.FORUM_NAME}</a></h4></td>
+	</tr>
+	<!-- BEGIN last_topics -->
+	<tr class="row<!-- IF last_forums.last_topics.S_ROW_COUNT is odd -->2<!-- ELSE -->1<!-- ENDIF -->">
+		<td width="25" align="center" style="padding:5px;">{last_forums.last_topics.TOPIC_FOLDER_IMG}</td>
+		<!-- IF S_TOPIC_ICONS -->
+		<td width="25" align="center"><!-- IF last_forums.last_topics.TOPIC_ICON_IMG --><img src="{T_ICONS_PATH}{last_forums.last_topics.TOPIC_ICON_IMG}" width="{last_forums.last_topics.TOPIC_ICON_IMG_WIDTH}" height="{last_forums.last_topics.TOPIC_ICON_IMG_HEIGHT}" alt="" title="" /><!-- ENDIF --></td>
+		<!-- ENDIF -->
+		<td>
+			<!-- IF last_forums.last_topics.S_UNREAD_TOPIC --><a href="{last_forums.last_topics.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF -->
+			<a href="{last_forums.last_topics.U_VIEW_TOPIC}">{last_forums.last_topics.TOPIC_TITLE}</a><br/>
+			<!-- IF last_forums.last_topics.PAGINATION --><p class="gensmall"> [ {GOTO_PAGE_IMG}{L_GOTO_PAGE}: {last_forums.last_topics.PAGINATION} ] </p><!-- ENDIF -->
+		</td>
+		<td><a href="{last_forums.last_topics.U_LAST_POST}">{LAST_POST_IMG}</a></td>
+	</tr>
+	<!-- END last_topics -->
+	<!-- END last_forums -->
+</table>
Index: styles/subsilver2/template/gym_sitemaps/display_topics_list.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/display_topics_list.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/display_topics_list.html	(Premod 3.0.8)
@@ -0,0 +1,77 @@
+<!-- IF DISPLAY_TOPICS_H1 --><h1><!-- IF U_TOPICS --><a href="{U_TOPICS}" title="{H1_TOPICS}">{H1_TOPICS}</a><!-- ELSE -->{H1_TOPICS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {FORUM_NEWS}</a><!-- ENDIF --> <strong>&raquo;</strong> <a href="{FORUM_URL}" title="{FORUM_NAME}">{L_FORUM} : {FORUM_NAME}</a></h3><!-- ENDIF -->
+<!-- IF MAP_DESC --><span>{MAP_DESC}<br /></span><!-- ENDIF -->
+<!-- IF MAP_RULES or MAP_RULES_LINK -->
+	<div class="forumrules">
+		<!-- IF MAP_RULES_LINK -->
+			<h3>{L_FORUM_RULES}</h3><br />
+			<a href="{MAP_RULES_LINK}">{L_FORUM_RULES}</a>
+		<!-- ELSE -->
+			<h3>{L_FORUM_RULES}</h3><br />
+			{MAP_RULES}
+		<!-- ENDIF -->
+	</div>
+<!-- ENDIF --><br/>
+
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr>
+		<td class="cat" colspan="4">
+			<!-- IF DISPLAY_PAGINATION -->
+			<table width="100%" cellspacing="1">
+				<tr align="right">
+					<!-- IF DISPLAY_PAGE_NUMBER --><td class="nav" valign="middle" nowrap="nowrap">&nbsp;{DISPLAY_PAGE_NUMBER}<br /></td><!-- ENDIF -->
+					<td class="gensmall" nowrap="nowrap">&nbsp;[ {DISPLAY_TOTAL_TOPICS} ]&nbsp;</td>
+					<!-- IF DISPLAY_PAGINATION --><td class="gensmall" width="100%" align="{S_CONTENT_FLOW_END}" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{L_GOTO_PAGE}</a> {DISPLAY_PAGINATION}</b><!-- ENDIF --></td>
+		
+				</tr>
+			</table>
+			<!-- ENDIF -->&nbsp;
+		</td>
+	</tr>
+	<tr>
+		<th <!-- IF DISPLAY_LAST_POST -->colspan="2"<!-- ELSE -->colspan="3"<!-- ENDIF -->>&nbsp;{L_FORUM}&nbsp;</th>
+		<!-- IF DISPLAY_LAST_POST --><th>&nbsp;{L_LAST_POST}&nbsp;</th><!-- ENDIF -->
+	</tr>
+
+<!-- BEGIN topicrow -->
+	<tr>
+		<td class="row1" width="25" align="center">{topicrow.TOPIC_FOLDER_IMG}</td>
+		<!-- IF S_TOPIC_ICONS -->
+			<td class="row1" width="25" align="center"><!-- IF topicrow.TOPIC_ICON_IMG --><img src="{T_ICONS_PATH}{topicrow.TOPIC_ICON_IMG}" width="{topicrow.TOPIC_ICON_IMG_WIDTH}" height="{topicrow.TOPIC_ICON_IMG_HEIGHT}" alt="" title="" /><!-- ENDIF --></td>
+		<!-- ENDIF -->
+		<td class="row<!-- IF topicrow.S_ROW_COUNT is even -->1<!-- ELSE -->2<!-- ENDIF -->">
+			<!-- IF topicrow.S_UNREAD_TOPIC --><a href="{topicrow.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF -->
+			<!-- IF topicrow.ATTACH_ICON_IMG -->{topicrow.ATTACH_ICON_IMG} <!-- ENDIF --> <a href="{topicrow.U_VIEW_TOPIC}" class="topictitle" title="{topicrow.TOPIC_TITLE}">{topicrow.TOPIC_TITLE}</a>
+					<!-- IF topicrow.S_TOPIC_UNAPPROVED or topicrow.S_POSTS_UNAPPROVED --><a href="{topicrow.U_MCP_QUEUE}">{topicrow.UNAPPROVED_IMG}</a> &nbsp;<!-- ENDIF -->
+					<!-- IF topicrow.S_TOPIC_REPORTED --><a href="{topicrow.U_MCP_REPORT}">{REPORTED_IMG}</a><!-- ENDIF -->&nbsp;
+					<!-- IF topicrow.PAGINATION --><p class="gensmall"> [ {GOTO_PAGE_IMG}{L_GOTO_PAGE}: {topicrow.PAGINATION} ] </p><!-- ENDIF -->
+					
+					<p class="topicdetails"><!-- IF topicrow.TOPIC_AUTHOR_FULL -->{L_POST_BY_AUTHOR} {topicrow.TOPIC_AUTHOR_FULL}<!-- ENDIF --> {L_POSTED_ON_DATE} {topicrow.FIRST_POST_TIME}</p>
+					<!-- IF not S_SINGLE_FORUM and topicrow.U_VIEW_FORUM --><p class="topicdetails">{L_IN} <a href="{topicrow.U_VIEW_FORUM}" style="font-weight: bold;">{topicrow.FORUM_NAME}</a></p><!-- ENDIF -->
+		</td>
+		<!-- IF DISPLAY_LAST_POST -->
+		<td class="row1" width="140" align="center">
+			<p class="topicdetails"><a href="{topicrow.U_MINI_POST}" title="{L_LAST_POST} : {topicrow.TOPIC_LAST_POST_TITLE}">{LAST_POST_IMG} {topicrow.TOPIC_LAST_POST_TITLE}</a></p>
+			<p class="topicdetails">
+				<!-- IF topicrow.TOPIC_AUTHOR_FULL -->{L_POST_BY_AUTHOR} {topicrow.LAST_POST_AUTHOR_FULL} <!-- ENDIF -->
+				{L_POSTED_ON_DATE} {topicrow.LAST_POST_TIME}
+			</p>
+		</td>
+		<!-- ENDIF -->
+	</tr>
+<!-- BEGINELSE -->
+	<tr>
+		<td class="row1" colspan="5" align="center"><p class="gensmall">{L_HTML_NO_ITEMS}</p></td>
+	</tr>
+<!-- END topicrow -->
+</table>
+<!-- IF DISPLAY_PAGINATION -->
+<table width="100%" cellspacing="1">
+	<tr align="right">
+		<!-- IF DISPLAY_PAGE_NUMBER --><td class="nav" valign="middle" nowrap="nowrap">&nbsp;{DISPLAY_PAGE_NUMBER}<br /></td><!-- ENDIF -->
+		<td class="gensmall" nowrap="nowrap">&nbsp;[ {DISPLAY_TOTAL_TOPICS} ]&nbsp;</td>
+		<!-- IF DISPLAY_PAGINATION --><td class="gensmall" width="100%" align="{S_CONTENT_FLOW_END}" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{L_GOTO_PAGE}</a> {DISPLAY_PAGINATION}</b><!-- ENDIF --></td>
+		
+	</tr>
+</table><br/>
+<!-- ENDIF -->
Index: styles/subsilver2/template/gym_sitemaps/index_list.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/index_list.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/index_list.html	(Premod 3.0.8)
@@ -0,0 +1,33 @@
+<h2><!-- IF HTML_NEWS_URL --><a href="{HTML_NEWS_URL}" title="{HTML_NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {HTML_NEWS_TITLE}</a> <!-- ENDIF --><!-- IF HTML_URL --><strong>&raquo;</strong> <a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a><!-- ENDIF --></h2>
+<!-- IF HTML_SITEDESC --><span>{HTML_SITEDESC}<br /></span><!-- ENDIF --><br clear="all" />
+<!-- BEGIN module -->
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr>
+		<td class="cat" colspan="2" align="left"><h4><!-- IF module.NEWS_URL --><a href="{module.NEWS_URL}" title="{module.NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {module.NEWS_TITLE}</a> <!-- ENDIF --><!-- IF module.MAP_URL --> <strong>&raquo;</strong> <a href="{module.MAP_URL}" title="{module.MAP_TITLE}">{module.MAP_TITLE}</a><br /><!-- ENDIF --></h4></td>
+	</tr>
+	<!-- BEGIN links -->
+	<tr style="padding:10px;">
+		<td class="row<!-- IF module.links.S_ROW_COUNT is odd -->2<!-- ELSE -->1<!-- ENDIF -->" <!-- IF not(module.links.NEWS_URL and module.links.MAP_URL) -->colspan="2"<!-- ELSE -->width="50%"<!-- ENDIF -->>
+			<!-- IF module.links.NEWS_URL -->
+			<a class="forumlink" href="{module.links.NEWS_URL}" title="{module.links.NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {module.links.NEWS_TITLE}</a>	
+			<!-- ELSE -->
+			<a class="forumlink" href="{module.links.MAP_URL}" title="{module.links.MAP_TITLE}"> <strong>&raquo;</strong> {module.links.MAP_TITLE}</a>
+			<!-- ENDIF -->
+			<!-- IF module.links.NEWS_URL and module.links.MAP_URL -->
+			</td><td class="row<!-- IF module.links.S_ROW_COUNT is odd -->2<!-- ELSE -->1<!-- ENDIF -->" width="50%">
+				<a class="forumlink" href="{module.links.MAP_URL}" title="{module.links.MAP_TITLE}"> <strong>&raquo;</strong> {module.links.MAP_TITLE}</a>
+			<!-- ENDIF -->
+		</td>
+	</tr>
+	<!-- END links -->
+</table>
+<!-- BEGINELSE -->
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr height="15px">
+		<td class="cat" colspan="2" align="left"><h4><a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a></h4></td>
+	</tr>
+	<tr>
+		<td class="row1" colspan="5" align="center"><p class="gensmall">{L_HTML_MAP_NONE}</p></td>
+	</tr>
+</div>
+<!-- END module -->
Index: styles/subsilver2/template/gym_sitemaps/index_body.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/index_body.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/index_body.html	(Premod 3.0.8)
@@ -0,0 +1,103 @@
+<!-- INCLUDE overall_header.html -->
+
+<!-- IF U_MCP -->
+	<div id="pageheader">
+		<p class="linkmcp">[ <a href="{U_MCP}">{L_MCP}</a> ]</p>
+	</div>
+
+	<br clear="all" /><br />
+<!-- ENDIF -->
+<!-- IF RIGHT_COL -->
+<table width="100%" cellspacing="0">
+	<tr><td valign="top" width="76%">
+<!-- ENDIF -->
+{LEFT_COL}
+<!-- IF RIGHT_COL -->
+</td><td valign="top">
+	{RIGHT_COL}</td>
+</tr>
+</table>
+<!-- ENDIF -->
+
+<!-- IF not S_USER_LOGGED_IN -->
+	<br clear="all" />
+
+	<form method="post" action="{S_LOGIN_ACTION}">
+
+	<table class="tablebg" width="100%" cellspacing="1">
+	<tr>
+		<td class="cat"><h4><a href="{U_LOGIN_LOGOUT}">{L_LOGIN_LOGOUT}</a></h4></td>
+	</tr>
+	<tr>
+		<td class="row1" align="center"><span class="genmed">{L_USERNAME}:</span> <input class="post" type="text" name="username" size="10" />&nbsp; <span class="genmed">{L_PASSWORD}:</span> <input class="post" type="password" name="password" size="10" />&nbsp; <!-- IF S_AUTOLOGIN_ENABLED --> <span class="gensmall">{L_LOG_ME_IN}</span> <input type="checkbox" class="radio" name="autologin" /><!-- ENDIF -->&nbsp; <input type="submit" class="btnmain" name="login" value="{L_LOGIN}" /></td>
+	</tr>
+	</table>
+	{S_LOGIN_REDIRECT}
+	{S_FORM_TOKEN}
+	</form>
+<!-- ENDIF -->
+
+<!-- IF S_DISPLAY_ONLINE_LIST -->
+	<br clear="all" />
+
+	<table class="tablebg" width="100%" cellspacing="1">
+	<!-- IF not S_SINGLE_TRAKING -->
+	<tr>
+		<td class="cat" colspan="2"><!-- IF U_VIEWONLINE --><h4><a href="{U_VIEWONLINE}">{L_WHO_IS_ONLINE}</a></h4><!-- ELSE --><h4>{L_WHO_IS_ONLINE}</h4><!-- ENDIF --></td>
+	</tr>
+	<!-- ENDIF -->
+	<tr>
+	<!-- IF LEGEND -->
+		<td class="row1" rowspan="2" align="center" valign="middle"><img src="{T_THEME_PATH}/images/whosonline.gif" alt="{L_WHO_IS_ONLINE}" /></td>
+	<!-- ELSE -->
+		<td class="row1" align="center" valign="middle"><img src="{T_THEME_PATH}/images/whosonline.gif" alt="{L_WHO_IS_ONLINE}" /></td>
+	<!-- ENDIF -->
+		<td class="row1" width="100%"><span class="genmed"><!-- IF not S_SINGLE_TRAKING -->{TOTAL_USERS_ONLINE} ({L_ONLINE_EXPLAIN})<br />{RECORD_USERS}<br /><br /><!-- ENDIF -->{LOGGED_IN_USER_LIST}</span></td>
+	</tr>
+	<!-- IF LEGEND -->
+		<tr>
+			<td class="row1"><b class="gensmall">{L_LEGEND} :: {LEGEND}</b></td>
+		</tr>
+	<!-- ENDIF -->
+	</table>
+<!-- ENDIF -->
+
+<!-- IF S_DISPLAY_BIRTHDAY_LIST and BIRTHDAY_LIST -->
+	<br clear="all" />
+
+	<table class="tablebg" width="100%" cellspacing="1">
+	<tr>
+		<td class="cat" colspan="2"><h4>{L_BIRTHDAYS}</h4></td>
+	</tr>
+	<tr>
+		<td class="row1" align="center" valign="middle"><img src="{T_THEME_PATH}/images/whosonline.gif" alt="{L_BIRTHDAYS}" /></td>
+		<td class="row1" width="100%"><p class="genmed">{L_CONGRATULATIONS}: <b>{BIRTHDAY_LIST}</b></p></td>
+	</tr>
+	</table>
+<!-- ENDIF -->
+
+<!-- IF TOTAL_USERS -->
+<table class="tablebg" width="100%" cellspacing="1">
+<tr>
+	<td class="cat" colspan="2"><h4>{L_STATISTICS}</h4></td>
+</tr>
+<tr>
+	<td class="row1"><img src="{T_THEME_PATH}/images/whosonline.gif" alt="{L_STATISTICS}" /></td>
+	<td class="row1" width="100%" valign="middle"><p class="genmed">{TOTAL_POSTS} | {TOTAL_TOPICS} | {TOTAL_USERS}<!-- IF NEWEST_USER --> | {NEWEST_USER}<!-- ENDIF --></p></td>
+</tr>
+</table>
+<!-- ENDIF -->
+<br clear="all" />
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team : 2008.
+-->
+<div class="copyright" style="text-align:center;"><a href="http://www.phpbb-seo.com/{S_SEO_FORUM}" title="{L_FORUM} - {L_GYM_SEO}">GYM sitemaps &amp; RSS</a></div>
+<br clear="all" />
+<!-- INCLUDE overall_footer.html -->
Index: styles/subsilver2/template/gym_sitemaps/gym_link_body.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/gym_link_body.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/gym_link_body.html	(Premod 3.0.8)
@@ -0,0 +1,85 @@
+<!-- IF HTML_URL or HTML_NEWS_URL --><h2><!-- IF HTML_NEWS_URL --><a href="{HTML_NEWS_URL}" title="{HTML_NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {HTML_NEWS_TITLE}</a> <!-- ENDIF --><!-- IF HTML_URL --><strong>&raquo;</strong> <a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a><!-- ENDIF --></h2>
+<!-- IF HTML_SITEDESC --><span>{HTML_SITEDESC}<br /></span><!-- ENDIF -->
+<br clear="all" />
+<!-- ENDIF -->
+<!-- IF GYM_RSS_AGREGATED -->
+	<!-- IF GYM_RSS_SLIDE -->
+	<script type="text/javascript">
+	// <![CDATA[
+		// Message to stop scroller
+		var dn_stopMessage='{L_GYM_RSS_SLIDE_STOP}';
+		// Message to start scroller
+		var dn_startMessage='{L_GYM_RSS_SLIDE_START}';
+		// initial position 
+		var dn_startpos={GYM_RSS_SLIDE_SP_JS}; 			
+		// end position
+		var dn_endpos=-{GYM_RSS_SLIDE_EP}; 			
+		// Speed of scroller higher number = slower scroller 
+		var dn_speed={GYM_RSS_SCRSPEED};				
+		// ID of the news box
+		var dn_newsID='{GYM_RSS_CSSID}';
+		// ID of the generated paragraph
+		var dn_paraID='{GYM_RSS_CSSID}DomID';
+	// ]]>
+	</script>
+	<script type="text/javascript" src="{T_TEMPLATE_PATH}/gym_sitemaps/gym_rss_links.js"></script>
+	<!-- ENDIF -->
+	<!-- IF GYM_CHAN_TITLE --><h3><!-- IF GYM_CHAN_SOURCE --><a href="{GYM_CHAN_SOURCE}" title="{GYM_CHAN_TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{GYM_CHAN_TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a> <strong>&raquo;</strong> <a href="{GYM_CHAN_LINK}" title="{GYM_CHAN_TITLE}">{GYM_CHAN_TITLE}</a><!-- ELSE -->{GYM_CHAN_TITLE}<!-- ENDIF --></h3><!-- ENDIF -->
+	
+	<!-- IF not GYM_RSS_DESC -->
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr>
+		<td class="cat" colspan="4">&nbsp;</td>
+	</tr>
+	<tr>
+		<th <!-- IF GYM_RSS_DATE -->colspan="2"<!-- ELSE -->colspan="3"<!-- ENDIF -->>&nbsp;{L_FORUM}&nbsp;</th>
+		<!-- IF GYM_RSS_AUTHOR --><th>&nbsp;{L_AUTHOR}&nbsp;</th><!-- ENDIF -->
+		<!-- IF GYM_RSS_DATE --><th>&nbsp;{L_FILEDATE}&nbsp;</th><!-- ENDIF -->
+	</tr>
+	<!-- BEGIN gym_link_list -->
+	<tr>
+		<td class="row1" width="25" align="center"><img src="{gym_link_list.IMG}" alt=""/></td>
+		<td class="row<!-- IF  gym_link_list.S_ROW_COUNT is even -->1<!-- ELSE -->2<!-- ENDIF -->">
+			<a href="{gym_link_list.LINK}" class="topictitle" title="{gym_link_list.TITLE}">{gym_link_list.TITLE}</a>
+			<!-- IF gym_link_list.SOURCE -->
+				<p class="topicdetails"><a href="{gym_link_list.SOURCE}" title="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a></p>
+			<!-- ENDIF -->
+		</td>
+		<!-- IF GYM_RSS_AUTHOR or GYM_RSS_DATE -->
+		<td class="row1" width="140" align="center">
+			<p class="topicdetails">
+			<!-- IF gym_link_list.AUTHOR --><b class="postauthor">{gym_link_list.AUTHOR}</b> <!-- ENDIF -->
+			<!-- IF gym_link_list.PUBDATE -->{L_POSTED_ON_DATE} {gym_link_list.PUBDATE}<!-- ENDIF -->
+			</p>
+		</td><!-- ENDIF -->
+
+	</tr>
+	<!-- END gym_link_list -->
+</table>	
+<!-- ELSE -->
+<table class="tablebg" width="100%" cellspacing="1">
+	<!-- BEGIN gym_link_list -->
+	<tr>
+		<th align="left"><!-- IF gym_link_list.SOURCE -->&nbsp;<a href="{gym_link_list.SOURCE}" title="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a> &bull; <!-- ENDIF --> <a href="{gym_link_list.LINK}" title="{gym_link_list.TITLE}">{gym_link_list.TITLE}</a> </th>
+	</tr>
+	<!-- IF gym_link_list.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
+		<td valign="top">
+			<!-- IF gym_link_list.AUTHOR -->&nbsp;<b class="postauthor">{gym_link_list.AUTHOR}</b><!-- ENDIF -->
+			<!-- IF gym_link_list.PUBDATE -->&nbsp;<span class="topicdetails">{L_POSTED_ON_DATE} {gym_link_list.PUBDATE}</span><!-- ENDIF -->
+			<br clear="all" /><br clear="all" />
+			<div class="postbody">{gym_link_list.DESC}</div>	
+		</td>
+	</tr>
+	<!-- END gym_link_list -->
+</table>
+	<!-- ENDIF -->
+<!-- ELSE -->
+<table class="tablebg" width="100%" cellspacing="1">
+	<tr>
+		<th><!-- IF HTML_URL --><a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a>&nbsp;<!-- ENDIF --></th>
+	</tr>
+	<tr>
+		<td class="row1" colspan="5" align="center"><p class="gensmall">{L_HTML_NEWS_NONE}</p></td>
+	</tr>
+</table>
+<!-- ENDIF -->
Index: styles/subsilver2/template/gym_sitemaps/display_posts_list.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/display_posts_list.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/display_posts_list.html	(Premod 3.0.8)
@@ -0,0 +1,177 @@
+<!-- IF DISPLAY_POSTS_H1 --><h1 id="news"><!-- IF U_POSTS --><a href="{U_POSTS}" title="{H1_POSTS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {H1_POSTS}</a><!-- ELSE -->{H1_POSTS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_MAP_URL --><a href="{FORUM_MAP_URL}" title="{FORUM_MAP}">{FORUM_MAP}</a><!-- ENDIF --> <strong>&raquo;</strong> <a href="{FORUM_URL}" title="{FORUM_NAME}">{L_FORUM} : {FORUM_NAME}</a></h3><!-- ENDIF -->
+<!-- IF NEWS_DESC --><span>{NEWS_DESC}<br /></span><!-- ENDIF -->
+<!-- IF NEWS_RULES or NEWS_RULES_LINK -->
+	<div class="forumrules">
+		<!-- IF MAP_RULES_LINK -->
+			<h3>{L_FORUM_RULES}</h3><br />
+			<a href="{MAP_RULES_LINK}">{L_FORUM_RULES}</a>
+		<!-- ELSE -->
+			<h3>{L_FORUM_RULES}</h3><br />
+			{MAP_RULES}
+		<!-- ENDIF -->
+	</div>
+<!-- ENDIF --><br/>
+<div id="pagecontent">
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr>
+		<td class="cat"><!-- IF DISPLAY_PAGINATION --><table width="100%" cellspacing="1">
+	<tr align="right">
+		<!-- IF DISPLAY_PAGE_NUMBER --><td class="nav" valign="middle" nowrap="nowrap">&nbsp;{DISPLAY_PAGE_NUMBER}<br /></td><!-- ENDIF -->
+		<td class="gensmall" nowrap="nowrap">&nbsp;[ {DISPLAY_TOTAL_TOPICS} ]&nbsp;</td>
+		<!-- IF DISPLAY_PAGINATION --><td class="gensmall" width="100%" align="{S_CONTENT_FLOW_END}" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{L_GOTO_PAGE}</a> {DISPLAY_PAGINATION}</b></td><!-- ENDIF -->
+		
+	</tr>
+</table><br/><!-- ENDIF -->
+		</td>
+		
+</tr></table>
+<!-- BEGIN postrow -->
+	<table class="tablebg" width="100%" cellspacing="1">
+	<!-- IF postrow.S_FIRST_ROW -->
+		<tr>
+			<!-- IF DISPLAY_USER_INFO --><th>{L_AUTHOR}</th><!-- ENDIF -->
+			<th>{L_MESSAGE}</th>
+		</tr>
+	<!-- ENDIF -->
+	<!-- IF postrow.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
+			<!-- IF DISPLAY_USER_INFO --><td align="center" valign="middle">
+				<b class="postauthor"<!-- IF postrow.POST_AUTHOR_COLOUR --> style="color: {postrow.POST_AUTHOR_COLOUR}"<!-- ENDIF -->>{postrow.POST_AUTHOR}</b>
+			</td><!-- ENDIF -->
+			<td width="100%" height="25">
+				<table width="100%" cellspacing="0">
+				<tr>
+				<!-- IF postrow.POST_ICON_IMG -->
+					<td><img src="{T_ICONS_PATH}{postrow.POST_ICON_IMG}" width="{postrow.POST_ICON_IMG_WIDTH}" height="{postrow.POST_ICON_IMG_HEIGHT}" alt="" title="" /></td>
+				<!-- ENDIF -->
+					<td class="gensmall" width="100%"><div style="float: {S_CONTENT_FLOW_BEGIN};">&nbsp;<b>{L_POST_SUBJECT}:</b> {postrow.POST_SUBJECT}</div><div style="float: {S_CONTENT_FLOW_END};"><!-- IF S_IS_BOT -->{postrow.MINI_POST_IMG}<!-- ELSE --><a href="{postrow.U_MINI_POST}">{postrow.MINI_POST_IMG}</a><!-- ENDIF --><b>{L_POSTED}:</b> {postrow.POST_DATE}&nbsp;</div></td>
+				</tr>
+				</table>
+			</td>
+		</tr>
+		<!-- IF postrow.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
+			<!-- IF DISPLAY_USER_INFO -->
+			<td valign="top" class="profile">
+				<table cellspacing="4" align="center" width="150">
+				<!-- IF postrow.ONLINE_IMG -->
+					<tr>
+						<td>{postrow.ONLINE_IMG}</td>
+					</tr>
+					<!-- ENDIF -->
+					<!-- IF postrow.RANK_TITLE -->
+					<tr>
+						<td class="postdetails">{postrow.RANK_TITLE}</td>
+					</tr>
+					<!-- ENDIF -->
+					<!-- IF postrow.RANK_IMG -->
+					<tr>
+						<td>{postrow.RANK_IMG}</td>
+					</tr>
+					<!-- ENDIF -->
+					<!-- IF postrow.POSTER_AVATAR -->
+					<tr>
+						<td>{postrow.POSTER_AVATAR}</td>
+					</tr>
+					<!-- ENDIF -->
+				</table>
+				<span class="postdetails">
+					<!-- IF postrow.POSTER_JOINED --><br /><b>{L_JOINED}:</b> {postrow.POSTER_JOINED}<!-- ENDIF -->
+					<!-- IF postrow.POSTER_POSTS != '' --><br /><b>{L_POSTS}:</b> {postrow.POSTER_POSTS}<!-- ENDIF -->
+					<!-- IF postrow.POSTER_FROM --><br /><b>{L_LOCATION}:</b> {postrow.POSTER_FROM}<!-- ENDIF -->
+
+					<!-- IF postrow.S_PROFILE_FIELD1 -->
+						<!-- Use a construct like this to include admin defined profile fields. Replace FIELD1 with the name of your field. -->
+						<br /><b>{postrow.PROFILE_FIELD1_NAME}:</b> {postrow.PROFILE_FIELD1_VALUE}
+					<!-- ENDIF -->
+
+					<!-- BEGIN custom_fields -->
+						<br /><b>{postrow.custom_fields.PROFILE_FIELD_NAME}:</b> {postrow.custom_fields.PROFILE_FIELD_VALUE}
+					<!-- END custom_fields -->
+				</span>
+
+			</td>
+			<!-- ENDIF -->
+			<td valign="top">
+				<table width="100%" cellspacing="5">
+				<tr>
+					<td>
+					<!-- IF postrow.S_POST_UNAPPROVED or postrow.S_POST_REPORTED -->
+						<table width="100%" cellspacing="0">
+						<tr>
+							<td class="gensmall"><!-- IF postrow.S_POST_UNAPPROVED --><span class="postapprove">{UNAPPROVED_IMG} <a href="{postrow.U_MCP_APPROVE}">{L_POST_UNAPPROVED}</a></span> <!-- ENDIF --> <!-- IF postrow.S_POST_REPORTED --><span class="postreported">{REPORTED_IMG} <a href="{postrow.U_MCP_REPORT}">{L_POST_REPORTED}</a></span><!-- ENDIF --></td>
+						</tr>
+						</table>
+
+						<br clear="all" />
+					<!-- ENDIF -->
+						<div class="postbody">{postrow.MESSAGE}</div>
+					<!-- IF postrow.S_HAS_ATTACHMENTS -->
+						<br clear="all" /><br />
+
+						<table class="tablebg" width="100%" cellspacing="1">
+							<tr>
+								<td class="row3"><b class="genmed">{L_ATTACHMENTS}: </b></td>
+							</tr>
+						<!-- BEGIN attachment -->
+							<tr>
+								<!-- IF postrow.attachment.S_ROW_COUNT is even --><td class="row2"><!-- ELSE --><td class="row1"><!-- ENDIF -->{postrow.attachment.DISPLAY_ATTACHMENT}</td>
+							</tr>
+						<!-- END attachment -->
+						</table>
+					<!-- ENDIF -->
+					<!-- IF postrow.S_DISPLAY_NOTICE -->
+						<span class="gensmall error"><br /><br />{L_DOWNLOAD_NOTICE}</span>
+						<!-- ENDIF -->
+					<!-- IF postrow.U_MINI_POST -->
+					<br /><span class="postbody">
+						<strong>{L_HTML_MORE} :</strong> <a href="{postrow.U_MINI_POST}" title="{postrow.POST_SUBJECT}">{postrow.POST_SUBJECT}</a> | <strong>{L_VIEWS} :</strong> {postrow.VIEWS} | <strong>{L_REPLIES} :</strong> {postrow.REPLIES}<!-- IF not S_SINGLE_FORUM and postrow.U_VIEW_FORUM --> | <strong>{L_FORUM} :</strong> <a href="{postrow.U_VIEW_FORUM}" title="{postrow.FORUM_NAME}">{postrow.FORUM_NAME}</a><!-- ENDIF -->
+					</span>
+					<!-- ENDIF -->
+					<!-- IF postrow.SIGNATURE -->
+						<span class="postbody"><br />_________________<br />{postrow.SIGNATURE}</span>
+					<!-- ENDIF -->
+					<!-- IF not postrow.S_HAS_ATTACHMENTS --><br clear="all" /><br /><!-- ENDIF -->
+					<!-- IF DISPLAY_POST_BUTTONS -->
+						<table width="100%" cellspacing="0">
+							<tr valign="middle">
+								<td class="gensmall" align="{S_CONTENT_FLOW_END}">
+							<!-- IF not S_IS_BOT -->
+								<!-- IF postrow.U_REPORT --><a href="{postrow.U_REPORT}">{REPORT_IMG}</a> <!-- ENDIF --> 
+								<!-- IF postrow.U_INFO --><a href="{postrow.U_INFO}">{INFO_IMG}</a> <!-- ENDIF --> 
+								<!-- IF postrow.U_WARN --><a href="{postrow.U_WARN}">{WARN_IMG}</a> <!-- ENDIF --> 
+								<!-- IF postrow.U_DELETE --><a href="{postrow.U_DELETE}">{DELETE_IMG}</a> <!-- ENDIF -->
+							<!-- ENDIF -->
+								</td>
+							</tr>
+						</table>
+					<!-- ENDIF -->
+					</td>
+				</tr>
+				</table>
+			</td>
+		</tr>
+		<!-- IF postrow.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
+			<td class="profile"><strong><a href="#wrapheader">{L_BACK_TO_TOP}</a></strong></td>
+			<!-- IF DISPLAY_USER_INFO --><td><div class="gensmall" style="float: {S_CONTENT_FLOW_BEGIN};">&nbsp;<!-- IF postrow.U_PROFILE --><a href="{postrow.U_PROFILE}">{PROFILE_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_PM --><a href="{postrow.U_PM}">{PM_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_EMAIL --><a href="{postrow.U_EMAIL}">{EMAIL_IMG}</a> <!-- ENDIF -->&nbsp;</div> <div class="gensmall" style="float: {S_CONTENT_FLOW_END};"><!-- IF not S_IS_BOT --><!-- IF postrow.U_EDIT --><a href="{postrow.U_EDIT}">{EDIT_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_QUOTE --><a href="{postrow.U_QUOTE}">{QUOTE_IMG}</a> <!-- ENDIF --> <!-- ENDIF -->&nbsp;</div></td><!-- ENDIF -->
+		</tr>
+		<tr>
+			<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
+		</tr>
+		</table>
+<!-- BEGINELSE -->
+<div class="panel">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<p>{L_HTML_NEWS_NONE}</p>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- END postrow -->
+
+</div>
+<!-- IF DISPLAY_PAGINATION --><table width="100%" cellspacing="1">
+	<tr align="right">
+		<!-- IF DISPLAY_PAGE_NUMBER --><td class="nav" valign="middle" nowrap="nowrap">&nbsp;{DISPLAY_PAGE_NUMBER}<br /></td><!-- ENDIF -->
+		<td class="gensmall" nowrap="nowrap">&nbsp;[ {DISPLAY_TOTAL_TOPICS} ]&nbsp;</td>
+		<!-- IF DISPLAY_PAGINATION --><td class="gensmall" width="100%" align="{S_CONTENT_FLOW_END}" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{L_GOTO_PAGE}</a> {DISPLAY_PAGINATION}</b></td><!-- ENDIF -->
+		
+	</tr>
+</table><br/><!-- ENDIF -->
Index: styles/subsilver2/template/gym_sitemaps/display_forums_list.html
===================================================================
--- styles/subsilver2/template/gym_sitemaps/display_forums_list.html	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/display_forums_list.html	(Premod 3.0.8)
@@ -0,0 +1,57 @@
+<!-- IF DISPLAY_FORUMS_H1 --><h1><!-- IF U_FORUMS --><a href="{U_FORUMS}" title="{H1_FORUMS}">{H1_FORUMS}</a><!-- ELSE -->{H1_FORUMS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {FORUM_NEWS}</a><!-- ENDIF --><!-- IF FORUM_MAP_URL --> <strong>&raquo;</strong> <a href="{FORUM_MAP_URL}" title="{H1_FORUMS}">{H1_FORUMS}</a><!-- ENDIF --></h3><!-- ENDIF -->
+<!-- IF MAP_DESC --><span>{MAP_DESC}<br /></span><!-- ENDIF --><br />
+<table class="tablebg" cellspacing="1" width="100%">
+	<tr>
+		<td class="cat" colspan="4">&nbsp;</td>
+	</tr>
+	<tr>
+		<th <!-- IF DISPLAY_LAST_POST -->colspan="2"<!-- ELSE -->colspan="3"<!-- ENDIF -->>&nbsp;{L_FORUM}&nbsp;</th>
+		<!-- IF DISPLAY_LAST_POST --><th>&nbsp;{L_LAST_POST}&nbsp;</th><!-- ENDIF -->
+	</tr>
+<!-- BEGIN forumrow -->
+	<!-- IF forumrow.S_IS_CAT or forumrow.S_FIRST_ROW  or forumrow.S_NO_CAT-->
+	<tr>
+		<td class="cat" colspan="3"><h4>
+			<!-- IF forumrow.FORUM_NEWS_LINK -->{forumrow.FORUM_NEWS_LINK} <!-- ENDIF -->
+			<!-- IF forumrow.FORUM_MAP_LINK --> &nbsp; {forumrow.FORUM_MAP_LINK}<!-- ENDIF --></h4>
+		</td>
+	</tr>
+	<!-- ENDIF -->
+	<!-- IF not forumrow.S_IS_CAT -->
+	<tr>
+		<td class="row1" width="50" align="center">{forumrow.FORUM_FOLDER_IMG}</td>
+		<td class="row1" width="<!-- IF DISPLAY_LAST_POST -->75%<!-- ELSE -->100%<!-- ENDIF -->">
+			<!-- IF forumrow.FORUM_IMAGE --><div style="float: {S_CONTENT_FLOW_BEGIN}; margin-{S_CONTENT_FLOW_END}: 5px;">{forumrow.FORUM_IMAGE}</div><div style="float: {S_CONTENT_FLOW_BEGIN};"><!-- ENDIF -->
+			<!-- IF forumrow.FORUM_NEWS_LINK --><span class="forumlink">{forumrow.FORUM_NEWS_LINK}</span> <!-- ENDIF -->
+			<!-- IF forumrow.FORUM_MAP_LINK --><span class="forumlink"> &nbsp; {forumrow.FORUM_MAP_LINK}</span><!-- ENDIF -->
+			<p class="forumdesc">{forumrow.FORUM_DESC}</p>
+			<!-- IF forumrow.MODERATORS -->
+				<p class="forumdesc"><strong>{forumrow.L_MODERATOR_STR}:</strong> {forumrow.MODERATORS}</p>
+			<!-- ENDIF -->
+			<!-- IF forumrow.SUBFORUMS --><div class="gymsublist"><b>{L_SUBFORUMS} :</b><hr/>{forumrow.SUBFORUMS}</div><!-- ENDIF -->
+			<!-- IF forumrow.FORUM_IMAGE --></div><!-- ENDIF -->
+		</td>
+		<!-- IF DISPLAY_LAST_POST and not forumrow.S_IS_LINK -->
+		<td class="row2" align="center"  width="24%">
+			<!-- IF forumrow.LAST_POST_TIME -->
+				<!-- IF forumrow.LAST_POST_LINK -->
+				<p class="topicdetails"><i>{forumrow.LAST_POST_LINK}</i></p>
+				<!-- ENDIF -->
+				<p class="topicdetails">
+					<!-- IF DISPLAY_USER_INFO -->{L_POST_BY_AUTHOR} {forumrow.LAST_POSTER_FULL}<!-- ENDIF -->
+					<a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a> {L_POSTED_ON_DATE} {forumrow.LAST_POST_TIME}
+				</p>
+			<!-- ELSE -->
+				<p class="topicdetails">{L_NO_POSTS}</p>
+			<!-- ENDIF -->
+			</td>
+		</tr>
+		<!-- ENDIF -->
+	<!-- ENDIF -->
+<!-- BEGINELSE -->
+	<tr>
+		<td class="row1" colspan="5" align="center"><p class="gensmall">{L_HTML_MAP_NONE}</p></td>
+	</tr>
+<!-- END forumrow -->
+</table>
Index: styles/subsilver2/template/gym_sitemaps/gym_rss_links.js
===================================================================
--- styles/subsilver2/template/gym_sitemaps/gym_rss_links.js	(phpBB 3.0.8)
+++ styles/subsilver2/template/gym_sitemaps/gym_rss_links.js	(Premod 3.0.8)
@@ -0,0 +1,97 @@
+/**
+* gym_rss_links.js Dom scrolling
+* Based on
+* DOMnews 1.0 
+* homepage: http://www.onlinetools.org/tools/domnews/
+* released 11.07.05
+*/
+var dn_interval = 0;
+/* Initialise scroller when window loads */
+// check for DOM
+if(document.getElementById && document.createTextNode) {
+	window.onload = initDOMnews();
+	window.onunload = clearInterval(dn_interval);
+}
+var dn_scrollpos=dn_startpos;
+var dn_paused=false;
+var dn_els = '';
+var dn_inels = '';
+var dn_interval = '';
+/* Initialise scroller */
+function initDOMnews(reinit) {
+	if(!dn_els) {
+		dn_els = document.getElementById(dn_newsID);
+		if(!dn_els){
+			return;
+		}
+		dn_inels = document.getElementById(dn_newsID+'scrld');
+		if(!dn_inels){
+			return;
+		}
+		// Auto height for Gecko browsers
+		if (document.defaultView) {
+			dn_els.style.cssText = '';
+			dn_inels.style.cssText = '';
+			var real_endpos = document.defaultView.getComputedStyle(dn_els,"").getPropertyValue("height");
+			real_endpos = parseInt(real_endpos.replace(/px/ig, ""));
+			if (real_endpos) {
+				dn_endpos = - real_endpos;
+			}
+		}	
+	}
+	if (reinit) {
+		dn_els.parentNode.removeChild(dn_els.nextSibling);
+		clearInterval(dn_interval);
+	}
+	dn_els.height = dn_startpos;
+	dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow:hidden;position:relative;';
+	dn_inels.style.cssText = 'width:100%; position:relative; top:'+dn_startpos+'px;';
+	dn_interval=setInterval('scrollDOMnews()',dn_speed);
+	var newa=document.createElement('a');
+	var newp=document.createElement('p');
+	newp.setAttribute('id',dn_paraID);
+	newa.href='#' + dn_newsID;
+	newa.appendChild(document.createTextNode(dn_stopMessage));
+	newa.onclick=stopDOMnews;
+	newp.appendChild(newa);
+	dn_els.parentNode.insertBefore(newp,dn_els.nextSibling);
+	if (!dn_paused) {
+		dn_inels.style.cssText = 'width:100%;position:absolute; top:'+dn_startpos+'px;';
+		dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow:hidden;position:relative;';
+	}
+	dn_els.onmouseover=function() {		
+		clearInterval(dn_interval);
+	}
+	dn_els.onmouseout=function() {
+		if (!dn_paused) {
+			dn_interval=setInterval('scrollDOMnews()',dn_speed);
+		}
+	}
+}
+function ReinitDOMnews() {
+	dn_paused= dn_paused ? false : true;
+	initDOMnews(true);
+}
+function stopDOMnews() {
+	dn_paused = true;
+	clearInterval(dn_interval);
+	dn_inels.style.cssText = 'width:100%;position:absolute;';
+	dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow-y:auto;overflow-x:hidden;position:relative;';
+	dn_els.parentNode.removeChild(dn_els.nextSibling);
+	var newa=document.createElement('a');
+	var newp=document.createElement('p');
+	newp.setAttribute('id',dn_paraID);
+	newa.href='#' + dn_newsID;
+	newa.appendChild(document.createTextNode(dn_startMessage));
+	newa.onclick=ReinitDOMnews;
+	newp.appendChild(newa);
+	dn_els.parentNode.insertBefore(newp,dn_els.nextSibling);
+	return false;
+}
+function scrollDOMnews() {
+	dn_inels.style.top=dn_scrollpos+'px';	
+	if(dn_scrollpos==dn_endpos) {
+		dn_scrollpos=dn_startpos;
+	}
+	dn_scrollpos--;	
+}
Index: styles/subsilver2/template/posting_body.html
===================================================================
--- styles/subsilver2/template/posting_body.html	(revision 1)
+++ styles/subsilver2/template/posting_body.html	(Premod 3.0.8)
@@ -175,7 +175,13 @@
 	<td class="row1" width="22%"><b class="genmed">{L_SUBJECT}:</b></td>
 	<td class="row2" width="78%"><input class="post" style="width:450px" type="text" name="subject" size="45" maxlength="<!-- IF S_NEW_MESSAGE -->60<!-- ELSE -->64<!-- ENDIF -->" tabindex="2" value="{SUBJECT}" /></td>
 </tr>
+<!-- IF S_URL -->
 <tr>
+	<td class="row1" width="22%"><b class="genmed">URL:</b></td>
+	<td class="row2" width="78%"><input class="post" style="width:450px" type="text" name="url" size="45" maxlength="250" tabindex="2" value="{TOPIC_URL}" /></td>
+</tr>
+<!-- ENDIF -->
+<tr>
 	<td class="row1" valign="top"><b class="genmed">{L_MESSAGE_BODY}:</b><br /><span class="gensmall">{L_MESSAGE_BODY_EXPLAIN}&nbsp;</span><br /><br />
 	<!-- IF S_SMILIES_ALLOWED -->
 		<table width="100%" cellspacing="5" cellpadding="0" border="0" align="center">
Index: styles/subsilver2/template/forumlist_body.html
===================================================================
--- styles/subsilver2/template/forumlist_body.html	(revision 1)
+++ styles/subsilver2/template/forumlist_body.html	(Premod 3.0.8)
@@ -56,9 +56,12 @@
 			<td class="row2" align="center"><p class="topicdetails">{forumrow.POSTS}</p></td>
 			<td class="row2" align="center" nowrap="nowrap">
 				<!-- IF forumrow.LAST_POST_TIME -->
+					<!-- IF forumrow.LAST_POST_LINK -->
+					<p class="topicdetails"><i>{forumrow.LAST_POST_LINK}</i></p>
+					<!-- ENDIF -->
 					<p class="topicdetails"><!-- IF forumrow.U_UNAPPROVED_TOPICS --><a href="{forumrow.U_UNAPPROVED_TOPICS}">{UNAPPROVED_IMG}</a>&nbsp;<!-- ENDIF -->{forumrow.LAST_POST_TIME}</p>
 					<p class="topicdetails">{forumrow.LAST_POSTER_FULL}
-						<!-- IF not S_IS_BOT --><a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a><!-- ENDIF -->
+						<a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a>
 					</p>
 				<!-- ELSE -->
 					<p class="topicdetails">{L_NO_POSTS}</p>
Index: styles/subsilver2/template/search_body.html
===================================================================
--- styles/subsilver2/template/search_body.html	(revision 1)
+++ styles/subsilver2/template/search_body.html	(Premod 3.0.8)
@@ -92,4 +92,4 @@
 // ]]>
 </script>
 
-<!-- INCLUDE overall_footer.html -->
+<!-- INCLUDE overall_footer.html -->
\ No newline at end of file
Index: styles/subsilver2/template/viewtopic_body.html
===================================================================
--- styles/subsilver2/template/viewtopic_body.html	(revision 1)
+++ styles/subsilver2/template/viewtopic_body.html	(Premod 3.0.8)
@@ -284,7 +284,7 @@
 
 		<!-- IF postrow.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
 
-			<td class="profile"><strong><a href="#wrapheader">{L_BACK_TO_TOP}</a></strong></td>
+			<td class="profile"><strong><a href="{U_VIEW_TOPIC}#wrapheader">{L_BACK_TO_TOP}</a></strong></td>
 			<td><div class="gensmall" style="float: {S_CONTENT_FLOW_BEGIN};">&nbsp;<!-- IF postrow.U_POST_AUTHOR --><a href="{postrow.U_POST_AUTHOR}">{PROFILE_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_PM --><a href="{postrow.U_PM}">{PM_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_EMAIL --><a href="{postrow.U_EMAIL}">{EMAIL_IMG}</a> <!-- ENDIF -->&nbsp;</div> <div class="gensmall" style="float: {S_CONTENT_FLOW_END};"><!-- IF not S_IS_BOT --><!-- IF postrow.U_EDIT --><a href="{postrow.U_EDIT}">{EDIT_IMG}</a> <!-- ENDIF --> <!-- IF postrow.U_QUOTE --><a href="{postrow.U_QUOTE}">{QUOTE_IMG}</a> <!-- ENDIF --> <!-- ENDIF -->&nbsp;</div></td>
 	<!-- ENDIF -->
 		</tr>
@@ -330,6 +330,59 @@
 
 <!-- INCLUDE breadcrumbs.html -->
 
+<!-- IF S_RELATED_RESULTS --><br clear="all" />
+	<table class="tablebg" width="100%" cellspacing="1">
+	<tr>
+		<td class="cat" colspan="<!-- IF S_TOPIC_ICONS -->7<!-- ELSE -->6<!-- ENDIF -->"><span class="nav">{L_RELATED_TOPICS}</span></td>
+	</tr>
+	<tr>
+		<!-- IF S_TOPIC_ICONS -->
+			<th colspan="3">&nbsp;{L_TOPICS}&nbsp;</th>
+		<!-- ELSE -->
+			<th colspan="2">&nbsp;{L_TOPICS}&nbsp;</th>
+		<!-- ENDIF -->
+		<th>&nbsp;{L_AUTHOR}&nbsp;</th>
+		<th>&nbsp;{L_REPLIES}&nbsp;</th>
+		<th>&nbsp;{L_VIEWS}&nbsp;</th>
+		<th>&nbsp;{L_LAST_POST}&nbsp;</th>
+	</tr>
+	<!-- BEGIN related -->
+		<tr>
+			<td class="row1" width="25" align="center">{related.TOPIC_FOLDER_IMG}</td>
+			<!-- IF S_TOPIC_ICONS -->
+				<td class="row1" width="25" align="center"><!-- IF related.TOPIC_ICON_IMG --><img src="{T_ICONS_PATH}{related.TOPIC_ICON_IMG}" width="{related.TOPIC_ICON_IMG_WIDTH}" height="{related.TOPIC_ICON_IMG_HEIGHT}" alt="" title="" /><!-- ENDIF --></td>
+			<!-- ENDIF -->
+			<td class="row1">
+				<!-- IF related.S_UNREAD_TOPIC --><a href="{related.U_NEWEST_POST}">{NEWEST_POST_IMG}</a><!-- ENDIF -->
+				{related.ATTACH_ICON_IMG} <a title="{L_POSTED}: {related.FIRST_POST_TIME}" href="{related.U_TOPIC}"class="topictitle">{related.TOPIC_TITLE}</a>
+				<!-- IF related.S_TOPIC_UNAPPROVED -->
+					<a href="{related.U_MCP_QUEUE}">{UNAPPROVED_IMG}</a>&nbsp;
+				<!-- ENDIF -->
+				<!-- IF related.S_TOPIC_REPORTED -->
+					<a href="{related.U_MCP_REPORT}">{REPORTED_IMG}</a>&nbsp;
+				<!-- ENDIF -->
+				<!-- IF related.PAGINATION -->
+					<p class="gensmall"> [ {GOTO_PAGE_IMG}{L_GOTO_PAGE}: {related.PAGINATION} ] </p>
+				<!-- ENDIF -->
+			</td>
+			<td class="row2" width="130" align="center"><p class="topicauthor">{related.TOPIC_AUTHOR_FULL}</p></td>
+			<td class="row1" width="50" align="center"><p class="topicdetails">{related.REPLIES}</p></td>
+			<td class="row2" width="50" align="center"><p class="topicdetails">{related.VIEWS}</p></td>
+			<td class="row1" width="140" align="center">
+				<p class="topicdetails" style="white-space: nowrap;">{related.LAST_POST_TIME}</p>
+				<p class="topicdetails">{related.LAST_POST_AUTHOR_FULL}
+					<a href="{related.U_LAST_POST}">{LAST_POST_IMG}</a>
+				</p>
+			</td>
+		</tr>
+	<!-- END related -->
+	<tr align="center">
+		<td class="cat" colspan="<!-- IF S_TOPIC_ICONS -->7<!-- ELSE -->6<!-- ENDIF -->">&nbsp;</td>
+	</tr>
+	</table>
+	<br clear="all" />
+<!-- ENDIF -->
+
 <!-- IF S_DISPLAY_ONLINE_LIST -->
 	<br clear="all" />
 
Index: styles/subsilver2/template/viewforum_body.html
===================================================================
--- styles/subsilver2/template/viewforum_body.html	(revision 1)
+++ styles/subsilver2/template/viewforum_body.html	(Premod 3.0.8)
@@ -58,7 +58,7 @@
 			<td class="row1" width="140" align="center">
 				<p class="topicdetails" style="white-space: nowrap;">{topicrow.LAST_POST_TIME}</p>
 				<p class="topicdetails">{topicrow.LAST_POST_AUTHOR_FULL}
-					<!-- IF not S_IS_BOT --><a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a><!-- ENDIF -->
+					<a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a>
 				</p>
 			</td>
 		</tr>
@@ -90,7 +90,7 @@
 <!-- IF S_IS_POSTABLE or S_NO_READ_ACCESS -->
 	<div id="pageheader">
 		<h2><a class="titles" href="{U_VIEW_FORUM}">{FORUM_NAME}</a></h2>
-
+		<!-- IF GYM_LINKS_CAT --><h3>{GYM_HTML_FORUM_NEWS_LINK} {GYM_HTML_FORUM_MAP_LINK} {GYM_RSS_FORUM_LINK} {GYM_GOOGLE_FORUM_LINK}</h3><!-- ENDIF -->
 		<!-- IF MODERATORS -->
 			<p class="moderators"><!-- IF S_SINGLE_MODERATOR -->{L_MODERATOR}<!-- ELSE -->{L_MODERATORS}<!-- ENDIF -->: {MODERATORS}</p>
 		<!-- ENDIF -->
@@ -209,7 +209,7 @@
 				<td class="row1" width="140" align="center">
 					<p class="topicdetails" style="white-space: nowrap;">{topicrow.LAST_POST_TIME}</p>
 					<p class="topicdetails">{topicrow.LAST_POST_AUTHOR_FULL}
-						<!-- IF not S_IS_BOT --><a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a><!-- ENDIF -->
+						<a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a>
 					</p>
 				</td>
 			</tr>
@@ -326,4 +326,4 @@
 </tr>
 </table>
 
-<!-- INCLUDE overall_footer.html -->
\ No newline at end of file
+<!-- INCLUDE overall_footer.html -->
Index: styles/subsilver2/template/simple_header.html
===================================================================
--- styles/subsilver2/template/simple_header.html	(revision 1)
+++ styles/subsilver2/template/simple_header.html	(Premod 3.0.8)
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
 <head>
-
+{SEO_BASE_HREF}
 <meta http-equiv="content-type" content="text/html; charset={S_CONTENT_ENCODING}" />
 <meta http-equiv="content-language" content="{S_USER_LANG}" />
 <meta http-equiv="content-style-type" content="text/css" />
Index: styles/subsilver2/template/overall_footer.html
===================================================================
--- styles/subsilver2/template/overall_footer.html	(revision 1)
+++ styles/subsilver2/template/overall_footer.html	(Premod 3.0.8)
@@ -13,6 +13,7 @@
 //-->
 
 <div id="wrapfooter">
+	<!-- IF GYM_LINKS --><span>{GYM_HTML_NEWS_LINK} {GYM_HTML_MAP_LINK} {GYM_GOOGLE_LINK} {GYM_RSS_LINK} {GYM_RSS_CHAN_LINK}</span><br /><!-- ENDIF -->
 	<!-- IF U_ACP --><span class="gensmall">[ <a href="{U_ACP}">{L_ACP}</a> ]</span><br /><br /><!-- ENDIF -->
 	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &copy; 2000, 2002, 2005, 2007 phpBB Group
 	<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->
Index: styles/subsilver2/template/attachment.html
===================================================================
--- styles/subsilver2/template/attachment.html	(revision 1)
+++ styles/subsilver2/template/attachment.html	(Premod 3.0.8)
@@ -10,19 +10,19 @@
 		<!-- ENDIF -->
 
 		<!-- IF _file.S_THUMBNAIL -->
-			<a href="{_file.U_DOWNLOAD_LINK}"><img src="{_file.THUMB_IMAGE}" alt="{_file.DOWNLOAD_NAME}" /></a><br />
+			<a href="{_file.U_DOWNLOAD_LINK}"><img src="{_file.THUMB_IMAGE}" alt="{_file.DOWNLOAD_NAME}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / {_file.DOWNLOAD_NAME}<!-- ELSE -->{_file.DOWNLOAD_NAME} ({_file.FILESIZE} {_file.SIZE_LANG}) {_file.L_DOWNLOAD_COUNT}<!-- ENDIF -->"/></a><br />
 			<span class="gensmall">{_file.DOWNLOAD_NAME} [ {_file.FILESIZE} {_file.SIZE_LANG} | {_file.L_DOWNLOAD_COUNT} ]</span>
 		<!-- ENDIF -->
 
 		<!-- IF _file.S_IMAGE -->
-			<img src="{_file.U_INLINE_LINK}" alt="{_file.DOWNLOAD_NAME}" /><br />
+			<img src="{_file.U_INLINE_LINK}" alt="{_file.DOWNLOAD_NAME}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / <!-- ENDIF -->{_file.DOWNLOAD_NAME}"/><br />
 			<span class="gensmall">{_file.DOWNLOAD_NAME} [ {_file.FILESIZE} {_file.SIZE_LANG} | {_file.L_DOWNLOAD_COUNT} ]</span>
 		<!-- ENDIF -->
 
 		<!-- IF _file.S_FILE -->
 			<span class="genmed">
 				<!-- IF _file.UPLOAD_ICON -->{_file.UPLOAD_ICON} <!-- ENDIF -->
-				<a href="{_file.U_DOWNLOAD_LINK}">{_file.DOWNLOAD_NAME}</a> [{_file.FILESIZE} {_file.SIZE_LANG}]
+				<a href="{_file.U_DOWNLOAD_LINK}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / <!-- ENDIF -->{_file.DOWNLOAD_NAME}">{_file.DOWNLOAD_NAME}</a> [{_file.FILESIZE} {_file.SIZE_LANG}]
 			</span><br />
 			<span class="gensmall">{_file.L_DOWNLOAD_COUNT}</span>
 		<!-- ENDIF -->
Index: styles/prosilver/theme/common.css
===================================================================
--- styles/prosilver/theme/common.css	(revision 1)
+++ styles/prosilver/theme/common.css	(Premod 3.0.8)
@@ -630,3 +630,26 @@
 	line-height: 1px;
 	background: transparent;
 }
+/* GYM Sitemaps & RSS - www.phpbb-seo.com */
+div.gymsublist {
+	display:block;
+	position:relative;
+	padding-left:10px;
+	padding-top:5px;
+	padding-bottom:10px;
+	padding-right:0;
+	margin:0;
+}
+div.gymsublist ul {
+	display:block;
+	position:relative;
+	height:1%;
+	padding-left:30px;
+}
+div.gymsublist ul li {
+	display:block;
+	position:relative;
+	line-height:18px;
+	font-size:11px;
+}
+/* GYM Sitemaps & RSS - www.phpbb-seo.com */
Index: styles/prosilver/theme/gym_google.css
===================================================================
--- styles/prosilver/theme/gym_google.css	(phpBB 3.0.8)
+++ styles/prosilver/theme/gym_google.css	(Premod 3.0.8)
@@ -0,0 +1,1547 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		proSilver
+	Based on style:	proSilver (this is the default phpBB 3 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		dcz phpBB SEO ( www.phpbb-seo.com )
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* General proSilver Markup Styles
+---------------------------------------- */
+
+* {/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+html { font-size: 100%;
+	/* Always show a scrollbar for short pages - stops the jump when the scrollbar appears. non-IE browsers */
+	height: 100%;
+	margin-bottom: 1px;
+}
+body { /* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	color: #828282;
+	background-color: #FFFFFF;
+	/*font-size: 62.5%;			 This sets the default font size to be equivalent to 10px */
+	font-size: 10px;
+	margin: 10px;
+	padding: 12px 0;
+}
+h1 { /* Forum name */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	margin-right: 200px;
+	color: #FFFFFF;
+	margin-top: 15px;
+	font-weight: bold;
+	font-size: 2em;
+}
+h2 { /* Forum header titles */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	font-weight: normal;
+	color: #3f3f3f;
+	font-size: 2em;
+	margin: 0.8em 0 0.2em 0;
+}
+h2.solo { margin-bottom: 1em; }
+
+h3 { /* Sub-headers (also used as post headers, but defined later) */
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	padding-bottom: 2px;
+	font-size: 1.05em;
+	color: #989898;
+	margin-top: 20px;
+}
+h4 { /* Forum and topic list titles */
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, Sans-serif;
+	font-size: 1.3em;
+}
+h5 { font-family: "Trebuchet MS",Verdana, Arial, Helvetica, sans-serif;
+	float: right;
+	font-weight:bold;
+	font-size:16px;
+	color:#707070;
+	margin-top:1px;
+}
+p { line-height: 1.3em;
+	font-size: 1.1em;
+	margin-bottom: 1.5em;
+}
+
+img {
+	border-width: 0;
+}
+
+hr { /* Also see tweaks.css */
+	border: 0 none #FFFFFF;
+	border-top: 1px solid #CCCCCC;
+	height: 1px;
+	margin: 5px 0;
+	display: block;
+	clear: both;
+}
+hr.dashed { border-top: 1px dashed #CCCCCC;
+	margin: 10px 0;
+}
+hr.divider { display: none;}
+p.right { text-align: right;}
+
+/* Main blocks
+---------------------------------------- */
+#simple-wrap { padding: 6px 10px; }
+#page-body { margin: 4px 0;
+	clear: both;
+}
+#page-footer { clear: both;
+}
+#page-footer h3 { margin-top: 20px;
+}
+#logo { float: left;
+	width: auto;
+	padding: 10px 13px 0 10px;
+}
+a#logo:hover { text-decoration: none;}
+/* Search box
+--------------------------------------------- */
+#search-box { color: #FFFFFF;
+	position: relative;
+	margin-top: 30px;
+	margin-right: 5px;
+	display: block;
+	float: right;
+	text-align: right;
+	white-space: nowrap; /* For Opera */
+}
+#search-box #keywords { width: 95px;
+	background-color: #FFF;
+}
+#search-box input { border: 1px solid #b0b0b0;
+}
+/* .button1 style defined later, just a few tweaks for the search button version */
+#search-box input.button1 { padding: 1px 5px;}
+#search-box li { text-align: right;
+	margin-top: 4px;
+}
+#search-box img {
+	vertical-align: middle;
+	margin-right: 3px;
+}
+/* Site description and logo */
+#site-description { float: left;
+	width: 70%;
+}
+
+#site-description h1 {	margin-right: 0;}
+
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar { background: #ebebeb none repeat-x 0 0;
+	color: #FFFFFF;
+	margin-bottom: 4px;
+	padding: 0 5px;
+}
+.navbar { background-color: #ebebeb;
+	padding: 0 10px;
+}
+.forabg { background: #b1b1b1 none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.forumbg { background: #ebebeb none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.panel { margin-bottom: 4px;
+	padding: 0 10px;
+	background-color: #f3f3f3;
+	color: #3f3f3f;
+}
+.post { padding: 0 10px;
+	margin-bottom: 4px;
+	background-repeat: no-repeat;
+	background-position: 100% 0;
+}
+.post:target .content { color: #000000;}
+.post:target h3 a { color: #000000;}
+.bg1	{ background-color: #f7f7f7;}
+.bg2	{ background-color: #f2f2f2; }
+.bg3	{ background-color: #ebebeb; }
+.rowbg { margin: 5px 5px 2px 5px;}
+.ucprowbg { background-color: #e2e2e2; }
+.fieldsbg { /*border: 1px #DBDEE2 solid;*/
+	background-color: #eaeaea;
+}
+span.corners-top, span.corners-bottom, span.corners-top span, span.corners-bottom span {
+	font-size: 1px;
+	line-height: 1px;
+	display: block;
+	height: 5px;
+	background-repeat: no-repeat;
+}
+span.corners-top { background-image: none;
+	background-position: 0 0;
+	margin: 0 -5px;
+}
+span.corners-top span { background-image: none;
+	background-position: 100% 0;
+}
+span.corners-bottom { background-image: none;
+	background-position: 0 100%;
+	margin: 0 -5px;
+	clear: both;
+}
+span.corners-bottom span { background-image: none;;
+	background-position: 100% 100%;
+}
+.headbg span.corners-bottom { margin-bottom: -1px; }
+.post span.corners-top, .post span.corners-bottom, .panel span.corners-top, .panel span.corners-bottom, .navbar span.corners-top, .navbar span.corners-bottom { margin: 0 -10px; }
+.rules span.corners-top { margin: 0 -10px 5px -10px;}
+.rules span.corners-bottom { margin: 5px -10px 0 -10px;}
+/* Horizontal lists
+----------------------------------------*/
+ul.linklist { display: block;
+	margin: 0;
+}
+ul.linklist li { display: block;
+	list-style-type: none;
+	float: left;
+	width: auto;
+	margin-right: 5px;
+	font-size: 1.1em;
+	line-height: 2.2em;
+}
+ul.linklist li.rightside, p.rightside { float: right;
+	margin-right: 0;
+	margin-left: 5px;
+	text-align: right;
+}
+ul.navlinks { padding-bottom: 1px;
+	margin-bottom: 1px;
+	border-bottom: 1px solid #FFFFFF;
+	font-weight: bold;
+}
+ul.leftside { float: left;
+	margin-left: 0;
+	margin-right: 5px;
+	text-align: left;
+}
+ul.rightside { float: right;
+	margin-left: 5px;
+	margin-right: -5px;
+	text-align: right;
+}
+/* Misc layout styles
+---------------------------------------- */
+dl.details {
+	/*font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;*/
+	font-size: 1.1em;
+}
+dl.details dt {
+	float: left;
+	clear: left;
+	width: 15em;
+	text-align: right;
+	color: #000000;
+	display: block;
+}
+dl.details dd {
+	margin-left: 0;
+	padding-left: 5px;
+	margin-bottom: 5px;
+	color: #828282;
+	float: left;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright { padding: 5px;
+	text-align: center;
+	color: #555555;
+}
+div.rules {
+	background-color: #ececec;
+	color: #bcbcbc;
+	padding: 0 10px;
+	margin: 10px 0;
+	font-size: 1.1em;
+}
+div.rules ul { margin-left: 20px; }
+p.rules { background-color: #ececec;
+	background-image: none;
+	padding: 5px;
+}
+p.rules img { vertical-align: middle; }
+p.rules a { vertical-align: middle;
+	clear: both;
+}
+#top { position: absolute;
+	top: -20px;
+}
+/* proSilver Link Styles
+---------------------------------------- */
+a:link	{ color: #898989; text-decoration: none; }
+a:visited	{ color: #898989; text-decoration: none; }
+a:hover	{ color: #d3d3d3; text-decoration: underline; }
+a:active	{ color: #d2d2d2; text-decoration: none; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {
+	color: #ffffff;
+	text-decoration: underline;
+}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {
+	color: #ffffff;
+	text-decoration: none;
+}
+/* Links for forum/topic lists */
+a.forumtitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.forumtitle:visited { color: #898989; } */
+a.forumtitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.forumtitle:active { color: #898989; }
+a.topictitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.topictitle:visited { color: #d2d2d2; } */
+a.topictitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.topictitle:active {
+	color: #898989;
+}
+/* Post body links */
+.postlink { text-decoration: none;
+	color: #d2d2d2;
+	border-bottom: 1px solid #d2d2d2;
+	padding-bottom: 0;
+}
+.postlink:visited { color: #bdbdbd;
+	border-bottom-style: dotted;
+	border-bottom-color: #666666;
+}
+.postlink:active { color: #d2d2d2; }
+.postlink:hover { background-color: #f6f6f6;
+	text-decoration: none;
+	color: #404040;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {
+	border: none;
+	text-decoration: underline;
+	background-color: transparent;
+}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a { font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+.postprofile a:hover, .postprofile dt.author a:hover { text-decoration: underline;
+	color: #d3d3d3;
+}
+/* Profile searchresults */	
+.search .postprofile a { color: #898989;
+	text-decoration: none; 
+	font-weight: normal;
+}
+.search .postprofile a:hover { color: #d3d3d3;
+	text-decoration: underline; 
+}
+/* Back to top of page */
+.back2top { clear: both;
+	height: 11px;
+	text-align: right;
+}
+a.top { background: none no-repeat top left;
+	text-decoration: none;
+	width: 11px;
+	height: 11px;
+	display: block;
+	float: right;
+	overflow: hidden;
+	letter-spacing: 1000px;
+	text-indent: 11px;
+}
+a.top2 {
+	background: none no-repeat 0 50%;
+	text-decoration: none;
+	padding-left: 15px;
+}
+/* Arrow links  */
+a.up		{ background: none no-repeat left center; }
+a.down		{ background: none no-repeat right center; }
+a.left		{ background: none no-repeat 3px 60%; }
+a.right		{ background: none no-repeat 95% 60%; }
+a.up, a.up:link, a.up:active, a.up:visited { padding-left: 10px;
+	text-decoration: none;
+	border-bottom-width: 0;
+}
+a.up:hover { background-position: left top;
+	background-color: transparent;
+}
+a.down, a.down:link, a.down:active, a.down:visited { padding-right: 10px; }
+a.down:hover { background-position: right bottom;
+	text-decoration: none;
+}
+a.left, a.left:active, a.left:visited { padding-left: 12px; }
+a.left:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 0 60%;
+}
+a.right, a.right:active, a.right:visited { padding-right: 12px;}
+a.right:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 100% 60%;
+}
+/* proSilver Content Styles
+---------------------------------------- */
+ul.topiclist { display: block;
+	list-style-type: none;
+	margin: 0;
+}
+ul.forums { background: #f9f9f9 none repeat-x 0 0;
+}
+ul.topiclist li { display: block;
+	list-style-type: none;
+	color: #777777;
+	margin: 0;
+}
+ul.topiclist dl { position: relative;}
+ul.topiclist li.row dl {padding: 2px 0;}
+ul.topiclist dt {display: block;
+	float: left;
+	width: 50%;
+	font-size: 1.1em;
+	padding-left: 5px;
+	padding-right: 5px;
+}
+ul.topiclist dd { display: block;
+	float: left;
+	border-left: 1px solid #FFFFFF;
+	padding: 4px 0;
+}
+ul.topiclist dfn { /* Labels for post/view counts */
+	display: none;
+}
+
+ul.topiclist li.row dt a.subforum { background-image: none;
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	position: relative;
+	white-space: nowrap;
+	padding: 0 0 0 12px;
+}
+.forum-image { float: left;
+	padding-top: 5px;
+	margin-right: 5px;
+}
+li.row { border-top: 1px solid #FFFFFF;
+	border-bottom: 1px solid #8f8f8f;
+}
+li.row strong { font-weight: normal;
+	color: #000000;
+}
+li.row:hover { background-color: #f6f6f6;
+}
+li.row:hover dd { border-left-color: #CCCCCC;
+}
+li.header dt, li.header dd { line-height: 1em;
+	border-left-width: 0;
+	margin: 2px 0 4px 0;
+	color: #FFFFFF;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	font-size: 1em;
+	font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+li.header dt { font-weight: bold;}
+li.header dd { margin-left: 1px;}
+li.header dl.icon { min-height: 0;}
+li.header dl.icon dt { /* Tweak for headers alignment when folder icon used */
+	padding-left: 0;
+	padding-right: 44px;
+}
+/* Forum list column styles */
+dl.icon { min-height: 35px;
+	background-position: 10px 50%;		/* Position of folder icon */
+	background-repeat: no-repeat;
+}
+dl.icon dt { padding-left: 45px;					/* Space for folder icon */
+	background-repeat: no-repeat;
+	background-position: 5px 95%;		/* Position of topic icon */
+}
+dd.posts, dd.topics, dd.views { width: 8%;
+	text-align: center;
+	line-height: 2.2em;
+	font-size: 1.2em;
+}
+dd.lastpost { width: 25%;
+	font-size: 1.1em;
+}
+dd.redirect { font-size: 1.1em;
+	line-height: 2.5em;
+}
+dd.moderation { font-size: 1.1em; }
+dd.lastpost span, ul.topiclist dd.searchby span, ul.topiclist dd.info span, ul.topiclist dd.time span, dd.redirect span, dd.moderation span { display: block;
+	padding-left: 5px;
+}
+dd.time { width: auto;
+	line-height: 200%;
+	font-size: 1.1em;
+}
+dd.extra { width: 65px;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.mark { float: right !important;
+	width: 9%;
+	text-align: center;
+	line-height: 200%;
+	font-size: 1.2em;
+}
+dd.info { width: 30%; }
+dd.option { width: 15%;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.searchby { width: 47%;
+	font-size: 1.1em;
+	line-height: 1em;
+}
+ul.topiclist dd.searchextra { margin-left: 5px;
+	padding: 0.2em 0;
+	font-size: 1.1em;
+	color: #333333;
+	border-left: none;
+	clear: both;
+	width: 98%;
+	overflow: hidden;
+}
+/* Container for post/reply buttons and pagination */
+.topic-actions { margin-bottom: 3px;
+	font-size: 1.1em;
+	height: 28px;
+	min-height: 28px;
+}
+div[class].topic-actions { height: auto; }
+/* Post body styles
+----------------------------------------*/
+.postbody { padding: 0;
+	line-height: 1.48em;
+	color: #333333;
+	width: 76%;
+	float: left;
+	clear: both;
+}
+.postbody .ignore { font-size: 1.1em; }
+.postbody h3.first { /* The first post on the page uses this */
+	font-size: 1.7em;
+}
+.postbody h3 { /* Postbody requires a different h3 format - so change it here */
+	font-size: 1.5em;
+	padding: 2px 0 0 0;
+	margin: 0 0 0.3em 0 !important;
+	text-transform: none;
+	border: none;
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	line-height: 125%;
+}
+.postbody h3 img { /* Also see tweaks.css */
+	vertical-align: bottom;
+}
+.postbody .content { font-size: 1.3em; }
+.search .postbody { width: 68% }
+/* Content container styles
+----------------------------------------*/
+.content { min-height: 3em;
+	overflow: hidden;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	color: #333333;
+}
+.content h2, .panel h2 { font-weight: normal;
+	color: #989898;
+	border-bottom: 1px solid #CCCCCC;
+	font-size: 1.6em;
+	margin-top: 0.5em;
+	margin-bottom: 0.5em;
+	padding-bottom: 0.5em;
+}
+.panel h3 { margin: 0.5em 0; }
+.panel p { font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+.content p { font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+dl.faq { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+	margin-top: 1em;
+	margin-bottom: 2em;
+	line-height: 1.4em;
+}
+dl.faq dt { font-weight: bold;
+	color: #333333;
+}
+.content dl.faq { font-size: 1.2em;
+	margin-bottom: 0.5em;
+}
+.content li { list-style-type: inherit; }
+.content ul, .content ol { margin-bottom: 1em;
+	margin-left: 3em;
+}
+.announce, .unreadpost {
+	/* Highlight the announcements & unread posts box */
+	border-left-color: #BCBCBC;
+	border-right-color: #BCBCBC;
+}
+/* Post author */
+p.author { margin: 0 15em 0.6em 0;
+	padding: 0 0 5px 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	line-height: 1.2em;
+}
+/* Post signature */
+.signature { margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1.1em;
+	border-top: 1px solid #CCCCCC;
+	clear: left;
+	line-height: 140%;
+	overflow: hidden;
+	width: 100%;
+}
+dd .signature { margin: 0;
+	padding: 0;
+	clear: none;
+	border: none;
+}
+/* Post noticies */
+.notice { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: auto;
+	margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1em;
+	border-top: 1px dashed #CCCCCC;
+	clear: left;
+	line-height: 130%;
+}
+/* Jump to post link for now */
+ul.searchresults {
+	list-style: none;
+	text-align: right;
+	clear: both;
+}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {
+	background: #ebebeb none 6px 8px no-repeat;
+	border: 1px solid #dbdbdb;
+	font-size: 0.95em;
+	margin: 0.5em 1px 0 25px;
+	overflow: hidden;
+	padding: 5px;
+}
+blockquote blockquote { /* Nested quotes */
+	background-color: #bababa;
+	font-size: 1em;
+	margin: 0.5em 1px 0 15px;	
+}
+blockquote blockquote blockquote { /* Nested quotes */
+	background-color: #e4e4e4;
+}
+blockquote cite { /* Username/source of quoter */
+	font-style: normal;
+	font-weight: bold;
+	margin-left: 20px;
+	display: block;
+	font-size: 0.9em;
+}
+blockquote cite cite { font-size: 1em; }
+blockquote.uncited { padding-top: 25px; }
+/* Code block */
+dl.codebox {
+	padding: 3px;
+	background-color: #FFFFFF;
+	border: 1px solid #d8d8d8;
+	font-size: 1em;
+}
+dl.codebox dt { text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	font-size: 0.8em;
+	font-weight: bold;
+	display: block;
+}
+blockquote dl.codebox { margin-left: 0; }
+dl.codebox code { /* Also see tweaks.css */
+	overflow: auto;
+	display: block;
+	height: auto;
+	max-height: 200px;
+	white-space: normal;
+	padding-top: 5px;
+	font: 0.9em Monaco, "Andale Mono","Courier New", Courier, mono;
+	line-height: 1.3em;
+	color: #8b8b8b;
+	margin: 2px 0;
+}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #000000; }
+.syntaxdefault	{ color: #bcbcbc; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #585858; }
+.syntaxstring	{ color: #a7a7a7; }
+/* Attachments
+----------------------------------------*/
+.attachbox { float: left;
+	width: auto; 
+	margin: 5px 5px 5px 0;
+	padding: 6px;
+	background-color: #FFFFFF;
+	border: 1px dashed #d8d8d8;
+	clear: left;
+}
+.pm-message .attachbox { background-color: #f3f3f3; }
+.attachbox dt { font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+.attachbox dd { margin-top: 4px;
+	padding-top: 4px;
+	clear: left;
+	border-top: 1px solid #d8d8d8;
+}
+.attachbox dd dd { border: none; }
+.attachbox p { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attachbox p.stats { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attach-image { margin: 3px 0;
+	width: 100%;
+	max-height: 350px;
+	overflow: auto;
+}
+.attach-image img { border: 1px solid #999999;
+/*	cursor: move; */
+	cursor: default;
+}
+/* Inline image thumbnails */
+div.inline-attachment dl.thumbnail, div.inline-attachment dl.file { display: block;
+	margin-bottom: 4px;
+}
+div.inline-attachment p { font-size: 100%; }
+dl.file { font-family: Verdana, Arial, Helvetica, sans-serif;
+	display: block;
+}
+dl.file dt { text-transform: none;
+	margin: 0;
+	padding: 0;
+	font-weight: bold;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+dl.file dd { color: #666666;
+	margin: 0;
+	padding: 0;	
+}
+dl.thumbnail img { padding: 3px;
+	border: 1px solid #666666;
+	display: block;
+	background-color: #FFF;
+}
+dl.thumbnail dd { color: #666666;
+	font-style: italic;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+.attachbox dl.thumbnail dd { font-size: 100%; }
+dl.thumbnail dt a:hover { background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img { border: 1px solid #d2d2d2; }
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls { font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif; }
+fieldset.polls dl { margin-top: 5px;
+	border-top: 1px solid #e2e2e2;
+	padding: 5px 0 0 0;
+	line-height: 120%;
+	color: #666666;
+}
+fieldset.polls dl.voted { font-weight: bold;
+	color: #000000;
+}
+fieldset.polls dt { text-align: left;
+	float: left;
+	display: block;
+	width: 30%;
+	border-right: none;
+	padding: 0;
+	margin: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd { float: left;
+	width: 10%;
+	border-left: none;
+	padding: 0 5px;
+	margin-left: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd.resultbar { width: 50%;}
+fieldset.polls dd input { margin: 2px 0; }
+fieldset.polls dd div { text-align: right;
+	font-family: Arial, Helvetica, sans-serif;
+	color: #FFFFFF;
+	font-weight: bold;
+	padding: 0 2px;
+	overflow: visible;
+	min-width: 2%;
+}
+.pollbar1 { background-color: #aaaaaa;
+	border-bottom: 1px solid #747474;
+	border-right: 1px solid #747474;
+}
+.pollbar2 { background-color: #bebebe;
+	border-bottom: 1px solid #8c8c8c;
+	border-right: 1px solid #8c8c8c;
+}
+.pollbar3 { background-color: #D1D1D1;
+	border-bottom: 1px solid #aaaaaa;
+	border-right: 1px solid #aaaaaa;
+}
+.pollbar4 { background-color: #e4e4e4;
+	border-bottom: 1px solid #bebebe;
+	border-right: 1px solid #bebebe;
+}
+.pollbar5 { background-color: #f8f8f8;
+	border-bottom: 1px solid #D1D1D1;
+	border-right: 1px solid #D1D1D1;
+}
+/* Poster profile block
+----------------------------------------*/
+.postprofile { /* Also see tweaks.css */
+	margin: 5px 0 10px 0;
+	min-height: 80px;
+	color: #666666;
+	border-left: 1px solid #FFFFFF;
+	width: 22%;
+	float: right;
+	display: inline;
+}
+.pm .postprofile { border-left: 1px solid #DDDDDD; }
+.postprofile dd, .postprofile dt { line-height: 1.2em;
+	margin-left: 8px;
+}
+.postprofile strong {font-weight: normal;
+	color: #000000;
+}
+.avatar { border: none;
+	margin-bottom: 3px;
+}
+.online { background-image: none;
+	background-position: 100% 0;
+	background-repeat: no-repeat;
+}
+/* Poster profile used by search*/
+.search .postprofile { width: 30%;}
+/* pm list in compose message if mass pm is enabled */
+dl.pmlist dt { width: 60% !important;}
+dl.pmlist dt textarea { width: 95%;}
+dl.pmlist dd { margin-left: 61% !important;
+	margin-bottom: 2px;
+}
+/* proSilver Button Styles
+---------------------------------------- */
+/* Rollover buttons
+   Based on: http://wellstyled.com/css-nopreload-rollovers.html
+----------------------------------------*/
+.buttons { float: left;
+	width: auto;
+	height: auto;
+}
+/* Rollover state */
+.buttons div { float: left;
+	margin: 0 5px 0 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+.buttons div a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+.buttons div span		{ display: none; }
+.buttons div a:hover	{ background-image: none; }
+/* Big button images */
+.reply-icon, .reply-icon a			{ background: transparent none 0 0 no-repeat; }
+.post-icon, .post-icon a				{ background: transparent none 0 0 no-repeat; }
+.locked-icon, .locked-icon a			{ background: transparent none 0 0 no-repeat; }
+.pmreply-icon, .pmreply-icon a		{ background: none 0 0 no-repeat; }
+.newpm-icon, .newpm-icon a			{ background: none 0 0 no-repeat; }
+.forwardpm-icon, .forwardpm-icon a 	{ background: none 0 0 no-repeat; }
+/* Set big button dimensions */
+.buttons div.reply-icon		{ width: 96px; height: 25px; }
+.buttons div.post-icon		{ width: 96px; height: 25px; }
+.buttons div.locked-icon	{ width: 96px; height: 25px; }
+.buttons div.pmreply-icon	{ width: 96px; height: 25px; }
+.buttons div.newpm-icon		{ width: 96px; height: 25px; }
+.buttons div.forwardpm-icon	{ width: 110px; height: 25px; }
+/* Sub-header (navigation bar)
+--------------------------------------------- */
+a.print, a.sendemail, a.fontsize { display: block;
+	overflow: hidden;
+	height: 18px;
+	text-indent: -5000px;
+	text-align: left;
+	background-repeat: no-repeat;
+}
+a.fontsize { background-image: none;
+	background-position: 0 -1px;
+	width: 29px;
+}
+a.fontsize:hover { background-position: 0 -20px;
+	text-decoration: none;
+}
+/* Icon images
+---------------------------------------- */
+.sitehome, .icon-faq, .icon-members, .icon-home, .icon-ucp, .icon-register, .icon-logout,
+.icon-bookmark, .icon-bump, .icon-subscribe, .icon-unsubscribe, .icon-pages, .icon-search {
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	background-image: none;
+	padding: 1px 0 0 17px;
+}
+/* Poster profile icons
+----------------------------------------*/
+ul.profile-icons { padding-top: 10px;
+	list-style: none;
+}
+/* Rollover state */
+ul.profile-icons li { float: left;
+	margin: 0 6px 3px 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+ul.profile-icons li a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+ul.profile-icons li span { display:none; }
+ul.profile-icons li a:hover { background: none; }
+/* Positioning of moderator icons */
+.postbody ul.profile-icons { float: right;
+	width: auto;
+	padding: 0;
+}
+.postbody ul.profile-icons li { margin: 0 3px;}
+/* Profile & navigation icons */
+.email-icon, .email-icon a		{ background: none top left no-repeat; }
+.aim-icon, .aim-icon a			{ background: none top left no-repeat; }
+.yahoo-icon, .yahoo-icon a		{ background: none top left no-repeat; }
+.web-icon, .web-icon a			{ background: none top left no-repeat; }
+.msnm-icon, .msnm-icon a			{ background: none top left no-repeat; }
+.icq-icon, .icq-icon a			{ background: none top left no-repeat; }
+.jabber-icon, .jabber-icon a		{ background: none top left no-repeat; }
+.pm-icon, .pm-icon a				{ background: none top left no-repeat; }
+.quote-icon, .quote-icon a		{ background: none top left no-repeat; }
+/* Moderator icons */
+.report-icon, .report-icon a		{ background: none top left no-repeat; }
+.warn-icon, .warn-icon a			{ background: none top left no-repeat; }
+.edit-icon, .edit-icon a			{ background: none top left no-repeat; }
+.delete-icon, .delete-icon a		{ background: none top left no-repeat; }
+.info-icon, .info-icon a			{ background: none top left no-repeat; }
+/* Set profile icon dimensions */
+ul.profile-icons li.email-icon		{ width: 20px; height: 20px; }
+ul.profile-icons li.aim-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.yahoo-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.web-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.msnm-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.icq-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.jabber-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.pm-icon		{ width: 28px; height: 20px; }
+ul.profile-icons li.quote-icon	{ width: 54px; height: 20px; }
+ul.profile-icons li.report-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.edit-icon	{ width: 58px; height: 20px; }
+ul.profile-icons li.delete-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.info-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.warn-icon	{ width: 20px; height: 20px; }
+/* Fix profile icon default margins */
+ul.profile-icons li.edit-icon	{ margin: 0 0 0 3px; }
+ul.profile-icons li.quote-icon	{ margin: 0 0 0 10px; }
+ul.profile-icons li.info-icon, ul.profile-icons li.report-icon	{ margin: 0 3px 0 0; }
+/* proSilver Form Styles
+---------------------------------------- */
+/* General form styles
+----------------------------------------*/
+fieldset { border-width: 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+}
+input { font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	padding: 0 3px;
+	font-size: 1em;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+}
+select {font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	border: 1px solid #666666;
+	padding: 1px;
+	background-color: #FAFAFA;
+}
+option { padding-right: 1em; }
+option.disabled-option { color: graytext; }
+textarea { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: 60%;
+	padding: 2px;
+	font-size: 1em;
+	line-height: 1.4em;
+}
+label { cursor: default;
+	padding-right: 5px;
+	color: #676767;
+}
+label input { vertical-align: middle;}
+label img { vertical-align: middle;}
+/* Definition list layout for forms
+---------------------------------------- */
+fieldset dl { padding: 4px 0;}
+fieldset dt { float: left;	
+	width: 40%;
+	text-align: left;
+	display: block;
+}
+fieldset dd { margin-left: 41%;
+	vertical-align: top;
+	margin-bottom: 3px;
+}
+/* Specific layout 1 */
+fieldset.fields1 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields1 dd { margin-left: 15em;
+	border-left-width: 0;
+}
+fieldset.fields1 { background-color: transparent; }
+fieldset.fields1 div { margin-bottom: 3px; }
+/* Specific layout 2 */
+fieldset.fields2 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields2 dd { margin-left: 16em;
+	border-left-width: 0;
+}
+/* Form elements */
+dt label { font-weight: bold;
+	text-align: left;
+}
+dd label { white-space: nowrap;
+	color: #333;
+}
+dd input, dd textarea { margin-right: 3px; }
+dd select { width: auto; }
+dd textarea { width: 85%; }
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label { color: inherit;}
+/* Submit button fieldset */
+fieldset.submit-buttons { text-align: center;
+	vertical-align: middle;
+	margin: 5px 0;
+}
+fieldset.submit-buttons input { vertical-align: middle;
+	padding-top: 3px;
+	padding-bottom: 3px;
+}
+/* Input field styles
+---------------------------------------- */
+.inputbox { background-color: #FFFFFF;
+	border: 1px solid #c0c0c0;
+	color: #333333;
+	padding: 2px;
+	cursor: text;
+}
+.inputbox:hover { border: 1px solid #eaeaea;}
+.inputbox:focus { border: 1px solid #eaeaea;
+	color: #4b4b4b;
+}
+input.inputbox	{ width: 85%; }
+input.medium	{ width: 50%; }
+input.narrow	{ width: 25%; }
+input.tiny	{ width: 125px; }
+textarea.inputbox { width: 85%; }
+.autowidth {width: auto !important;}
+/* Form button styles
+---------------------------------------- */
+input.button1, input.button2 {font-size: 1em;}
+a.button1, input.button1, input.button3, a.button2, input.button2 {
+	width: auto !important;
+	padding-top: 1px;
+	padding-bottom: 1px;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #000;
+	background: #FAFAFA none repeat-x top;
+}
+a.button1, input.button1 {font-weight: bold;
+	border: 1px solid #666666;
+}
+input.button3 {padding: 0;
+	margin: 0;
+	line-height: 5px;
+	height: 12px;
+	background-image: none;
+	font-variant: small-caps;
+}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border: 1px solid #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {
+	text-decoration: none;
+	color: #000000;
+	padding: 2px 8px;
+	line-height: 250%;
+	vertical-align: text-bottom;
+	background-position: 0 1px;
+}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {
+	border: 1px solid #BCBCBC;
+	background-position: 0 100%;
+	color: #BCBCBC;
+}
+
+/* Topic and forum Search */
+.search-box {margin-top: 3px;
+	margin-left: 5px;
+	float: left;
+}
+.search-box input {
+}
+input.search {background-image: none;
+	background-repeat: no-repeat;
+	background-position: left 1px;
+	padding-left: 17px;
+}
+/* proSilver Style Sheet Tweaks
+These style definitions are mainly IE specific 
+tweaks required due to its poor CSS support.
+-------------------------------------------------*/
+* html table, * html select, * html input { font-size: 100%; }
+* html hr { margin: 0; }
+* html span.corners-top, * html span.corners-bottom { background-image: url("{T_IMAGE_PATH}corners_left.gif"); }
+* html span.corners-top span, * html span.corners-bottom span { background-image: url("{T_IMAGE_PATH}corners_right.gif"); }
+table.table1 {width: 99%;		/* IE < 6 browsers */
+	/* Tantek hack */
+	voice-family: "\"}\"";
+	voice-family: inherit;
+	width: 100%;
+}
+html>body table.table1 { width: 100%; }	/* Reset 100% for opera */
+* html ul.topiclist li { position: relative; }
+* html .postbody h3 img { vertical-align: middle; }
+/* Form styles */
+html>body dd label input { vertical-align: text-bottom; }	/* Align checkboxes/radio buttons nicely */
+* html input.button1, * html input.button2 {
+	padding-bottom: 0;
+	margin-bottom: 1px;
+}
+/* Misc layout styles */
+* html .column1, * html .column2 { width: 45%; }
+/* Nice method for clearing floated blocks without having to insert any extra markup (like spacer above)
+   From http://www.positioniseverything.net/easyclearing.html 
+#tabs:after, #minitabs:after, .post:after, .navbar:after, fieldset dl:after, ul.topiclist dl:after, ul.linklist:after, dl.polls:after {
+	content: "."; 
+	display: block; 
+	height: 0; 
+	clear: both; 
+	visibility: hidden;
+}*/
+.clearfix, #tabs, #minitabs, .post, .navbar, fieldset dl, ul.topiclist dl, ul.linklist, dl.polls {
+	height: 1%;
+	overflow: hidden;
+}
+/* Simple fix so forum and topic lists always have a min-height set, even in IE6
+	From http://www.dustindiaz.com/min-height-fast-hack */
+dl.icon { min-height: 35px;
+	height: auto !important;
+	height: 35px;
+}
+* html #search-box {
+	margin-right: 35px;
+}
+/* Correctly clear floating for details on profile view */
+*:first-child+html dl.details dd { margin-left: 15em;
+	float: none;
+}
+* html dl.details dd { margin-left: 15em;
+	float: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for common.css
+-------------------------------------------------------------- */
+html, body { color: #536482;
+	background-color: #FFFFFF;
+}
+h1 { color: #FFFFFF;}
+h2 {color: #28313F;}
+h3 {border-bottom-color: #CCCCCC;
+	color: #115098;
+}
+hr {border-color: #FFFFFF;
+	border-top-color: #CCCCCC;
+}
+hr.dashed {border-top-color: #CCCCCC;}
+/* Search box
+--------------------------------------------- */
+#search-box {color: #FFFFFF;}
+#search-box #keywords {background-color: #FFF;}
+#search-box input {border-color: #0075B0;}
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+	color: #FFFFFF;
+}
+.navbar {background-color: #cadceb;}
+.forabg {background-color: #0076b1;
+	background-image: url("{T_IMAGE_PATH}bg_list.gif");
+}
+.forumbg {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+}
+.panel {background-color: #ECF1F3;
+	color: #28313F;
+}
+.post:target .content {color: #000000;}
+.post:target h3 a {color: #000000;}
+.bg1	{ background-color: #ECF3F7; }
+.bg2	{ background-color: #e1ebf2;  }
+.bg3	{ background-color: #cadceb; }
+.ucprowbg {background-color: #DCDEE2;}
+.fieldsbg {background-color: #E7E8EA;}
+span.corners-top {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-top span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+span.corners-bottom {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-bottom span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+/* Horizontal lists
+----------------------------------------*/
+ul.navlinks {border-bottom-color: #FFFFFF;}
+/* Misc layout styles
+---------------------------------------- */
+dl.details dt {
+	color: #000000;
+}
+
+dl.details dd {
+	color: #536482;
+}
+
+.sep {
+	color: #1198D9;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright {color: #555555;}
+.error {color: #BC2A4D;}
+.reported {background-color: #F7ECEF;}
+li.reported:hover {background-color: #ECD5D8 !important;}
+.sticky, .announce {/* you can add a background for stickies and announcements*/}
+div.rules {background-color: #ECD5D8;
+	color: #BC2A4D;
+}
+p.rules {background-color: #ECD5D8;
+	background-image: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for links.css
+-------------------------------------------------------------- */
+a:link	{ color: #105289; }
+a:visited	{ color: #105289; }
+a:hover	{ color: #D31141; }
+a:active	{ color: #368AD2; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {color: #FFFFFF;}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {color: #FFFFFF;}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {color: #A8D8FF;}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {color: #C8E6FF;}
+/* Links for forum/topic lists */
+a.forumtitle {color: #105289;}
+/* a.forumtitle:visited { color: #105289; } */
+a.forumtitle:hover {color: #BC2A4D;}
+a.forumtitle:active {color: #105289;}
+a.topictitle {color: #105289;}
+/* a.topictitle:visited { color: #368AD2; } */
+a.topictitle:hover {color: #BC2A4D;}
+a.topictitle:active {color: #105289;}
+/* Post body links */
+.postlink {color: #368AD2;
+	border-bottom-color: #368AD2;
+}
+.postlink:visited {color: #5D8FBD;
+	border-bottom-color: #666666;
+}
+.postlink:active {color: #368AD2;}
+.postlink:hover {background-color: #D0E4F6;
+	color: #0D4473;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {background-color: transparent;}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a {color: #105289;}
+.postprofile a:hover, .postprofile dt.author a:hover {color: #D31141;}
+/* Profile searchresults */	
+.search .postprofile a {color: #105289;}
+.search .postprofile a:hover {color: #D31141;}
+/* Back to top of page */
+a.top {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+a.top2 {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+/* Arrow links  */
+a.up		{ background-image: url("{T_IMAGE_PATH}arrow_up.gif") }
+a.down		{ background-image: url("{T_IMAGE_PATH}arrow_down.gif") }
+a.left		{ background-image: url("{T_IMAGE_PATH}arrow_left.gif") }
+a.right		{ background-image: url("{T_IMAGE_PATH}arrow_right.gif") }
+a.up:hover {background-color: transparent;}
+a.left:hover {color: #368AD2;}
+a.right:hover {color: #368AD2;}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for content.css
+-------------------------------------------------------------- */
+ul.forums {background-color: #eef5f9;
+	background-image: url("{T_IMAGE_PATH}gradient.gif");
+}
+ul.topiclist li {color: #4C5D77;}
+ul.topiclist dd {border-left-color: #FFFFFF;}
+.rtl ul.topiclist dd {border-right-color: #fff;
+	border-left-color: transparent;
+}
+ul.topiclist li.row dt a.subforum.read {background-image: url("{T_IMAGE_PATH}subforum_read.gif");}
+ul.topiclist li.row dt a.subforum.unread {background-image: url("{T_IMAGE_PATH}subforum_unread.gif");}
+li.row {border-top-color:  #FFFFFF;
+	border-bottom-color: #00608F;
+}
+li.row strong {color: #000000;}
+li.row:hover {background-color: #F6F4D0;}
+li.row:hover dd {border-left-color: #CCCCCC;}
+.rtl li.row:hover dd {border-right-color: #CCCCCC;
+	border-left-color: transparent;
+}
+li.header dt, li.header dd {color: #FFFFFF;}
+/* Forum list column styles */
+ul.topiclist dd.searchextra {color: #333333;}
+/* Post body styles
+----------------------------------------*/
+.postbody {color: #333333;}
+/* Content container styles
+----------------------------------------*/
+.content {color: #333333;}
+.content h2, .panel h2 {color: #115098;
+	border-bottom-color:  #CCCCCC;
+}
+dl.faq dt {color: #333333;}
+.posthilit {background-color: #F3BFCC;
+	color: #BC2A4D;
+}
+/* Post signature */
+.signature {border-top-color: #CCCCCC;}
+/* Post noticies */
+.notice {border-top-color:  #CCCCCC;}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {background-color: #EBEADD;
+	background-image: url("{T_IMAGE_PATH}quote.gif");
+	border-color:#DBDBCE;
+}
+blockquote blockquote {/* Nested quotes */
+	background-color:#EFEED9;
+}
+blockquote blockquote blockquote {/* Nested quotes */
+	background-color: #EBEADD;
+}
+/* Code block */
+dl.codebox {background-color: #FFFFFF;
+	border-color: #C9D2D8;
+}
+dl.codebox dt {border-bottom-color:  #CCCCCC;
+}
+dl.codebox code {color: #2E8B57;}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #FF8000; }
+.syntaxdefault	{ color: #0000BB; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #007700; }
+.syntaxstring	{ color: #DD0000; }
+/* Attachments
+----------------------------------------*/
+.attachbox {background-color: #FFFFFF;
+	border-color:  #C9D2D8;
+}
+.pm-message .attachbox {background-color: #F2F3F3;}
+.attachbox dd {border-top-color: #C9D2D8;}
+.attachbox p {color: #666666;}
+.attachbox p.stats {color: #666666;}
+.attach-image img {border-color: #999999;}
+/* Inline image thumbnails */
+dl.file dd {color: #666666;}
+dl.thumbnail img {border-color: #666666;
+	background-color: #FFFFFF;
+}
+dl.thumbnail dd {color: #666666;}
+dl.thumbnail dt a:hover {background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img {border-color: #368AD2;}
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls dl {border-top-color: #DCDEE2;
+	color: #666666;
+}
+fieldset.polls dl.voted {color: #000000;
+}
+fieldset.polls dd div {color: #FFFFFF;
+}
+.rtl .pollbar1, .rtl .pollbar2, .rtl .pollbar3, .rtl .pollbar4, .rtl .pollbar5 {border-right-color: transparent;
+}
+.pollbar1 {background-color: #AA2346;
+	border-bottom-color: #74162C;
+	border-right-color: #74162C;
+}
+.rtl .pollbar1 {border-left-color: #74162C;}
+.pollbar2 {background-color: #BE1E4A;
+	border-bottom-color: #8C1C38;
+	border-right-color: #8C1C38;
+}
+.rtl .pollbar2 {border-left-color: #8C1C38;}
+.pollbar3 {background-color: #D11A4E;
+	border-bottom-color: #AA2346;
+	border-right-color: #AA2346;
+}
+.rtl .pollbar3 {border-left-color: #AA2346;}
+.pollbar4 {background-color: #E41653;
+	border-bottom-color: #BE1E4A;
+	border-right-color: #BE1E4A;
+}
+.rtl .pollbar4 {border-left-color: #BE1E4A;}
+.pollbar5 {background-color: #F81157;
+	border-bottom-color: #D11A4E;
+	border-right-color: #D11A4E;
+}
+.rtl .pollbar5 {border-left-color: #D11A4E;}
+/* Poster profile block
+----------------------------------------*/
+.postprofile {color: #666666;
+	border-left-color: #FFFFFF;
+}
+.rtl .postprofile {border-right-color: #FFFFFF;
+	border-left-color: transparent;
+}
+.pm .postprofile {border-left-color: #DDDDDD;}
+.rtl .pm .postprofile {border-right-color: #DDDDDD;
+	border-left-color: transparent;
+}
+.postprofile strong {color: #000000;}
+.online {background-image: url("./styles/prosilver/imageset/fr/icon_user_online.gif");}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for buttons.css
+-------------------------------------------------------------- */
+a.fontsize {background-image: url("{T_IMAGE_PATH}icon_fontsize.gif");}
+/* Icon images
+---------------------------------------- */
+.sitehome						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-faq						{ background-image: url("{T_IMAGE_PATH}icon_faq.gif"); }
+.icon-ucp						{ background-image: url("{T_IMAGE_PATH}sitemap-icon.gif"); }
+.icon-members					{ background-image: url("{T_IMAGE_PATH}icon_members.gif"); }
+.icon-home						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-register					{ background-image: url("{T_IMAGE_PATH}icon_register.gif"); }
+.icon-logout					{ background-image: url("{T_IMAGE_PATH}icon_logout.gif"); }
+.icon-bookmark					{ background-image: url("{T_IMAGE_PATH}icon_bookmark.gif"); }
+.icon-subscribe					{ background-image: url("{T_IMAGE_PATH}icon_subscribe.gif"); }
+.icon-search					{ background-image: url("{T_IMAGE_PATH}icon_search.gif"); }
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for forms.css
+-------------------------------------------------------------- */
+/* General form styles
+----------------------------------------*/
+select {border-color: #666666;
+	background-color: #FAFAFA;
+}
+label {color: #425067;}
+option.disabled-option {color: graytext;}
+/* Definition list layout for forms
+---------------------------------------- */
+dd label {color: #333;}
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label {color: inherit;}
+/* Quick-login on index page */
+fieldset.quick-login input.inputbox {background-color: #F2F3F3;}
+/* Input field styles
+---------------------------------------- */
+.inputbox {background-color: #FFFFFF; 
+	border-color: #B4BAC0;
+	color: #333333;
+}
+.inputbox:hover {border-color: #11A3EA;}
+.inputbox:focus {border-color: #11A3EA;
+	color: #0F4987;
+}
+/* Form button styles
+---------------------------------------- */
+a.button1, input.button1, input.button3, a.button2, input.button2 {color: #000;
+	background-color: #FAFAFA;
+	background-image: url("{T_IMAGE_PATH}bg_button.gif");
+}
+a.button1, input.button1 {border-color: #666666;}
+input.button3 {background-image: none;}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border-color: #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {color: #000000;}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {border-color: #BC2A4D;
+	color: #BC2A4D;
+}
+input.search {background-image: url("{T_IMAGE_PATH}icon_textbox_search.gif");}
+#wrap {  
+   padding: 0 20px;
+}
Index: styles/prosilver/theme/gym_rss_links.css
===================================================================
--- styles/prosilver/theme/gym_rss_links.css	(phpBB 3.0.8)
+++ styles/prosilver/theme/gym_rss_links.css	(Premod 3.0.8)
@@ -0,0 +1,18 @@
+/* the news box when JavaScript is available */
+#news.hasJS
+{
+	width:100%;
+	height:120px;
+	overflow:hidden;
+	position:relative;
+}
+/* The nested UL when JavaScript is available */
+#news.hasJS ul
+{
+	width:100%;
+	position:absolute;
+	top:120px;
+	left:0;
+	margin:0 .5em 0 .5em;
+	padding:0;
+}
Index: styles/prosilver/theme/gym_rss.css
===================================================================
--- styles/prosilver/theme/gym_rss.css	(phpBB 3.0.8)
+++ styles/prosilver/theme/gym_rss.css	(Premod 3.0.8)
@@ -0,0 +1,1547 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		proSilver
+	Based on style:	proSilver (this is the default phpBB 3 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		dcz phpBB SEO ( www.phpbb-seo.com )
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* General proSilver Markup Styles
+---------------------------------------- */
+
+* {/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+html { font-size: 100%;
+	/* Always show a scrollbar for short pages - stops the jump when the scrollbar appears. non-IE browsers */
+	height: 100%;
+	margin-bottom: 1px;
+}
+body { /* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	color: #828282;
+	background-color: #FFFFFF;
+	/*font-size: 62.5%;			 This sets the default font size to be equivalent to 10px */
+	font-size: 10px;
+	margin: 10px;
+	padding: 12px 0;
+}
+h1 { /* Forum name */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	margin-right: 200px;
+	color: #FFFFFF;
+	margin-top: 15px;
+	font-weight: bold;
+	font-size: 2em;
+}
+h2 { /* Forum header titles */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	font-weight: normal;
+	color: #3f3f3f;
+	font-size: 2em;
+	margin: 0.8em 0 0.2em 0;
+}
+h2.solo { margin-bottom: 1em; }
+
+h3 { /* Sub-headers (also used as post headers, but defined later) */
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	padding-bottom: 2px;
+	font-size: 1.05em;
+	color: #989898;
+	margin-top: 20px;
+}
+h4 { /* Forum and topic list titles */
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, Sans-serif;
+	font-size: 1.3em;
+}
+h5 { font-family: "Trebuchet MS",Verdana, Arial, Helvetica, sans-serif;
+	float: right;
+	font-weight:bold;
+	font-size:16px;
+	color:#707070;
+	margin-top:1px;
+}
+p { line-height: 1.3em;
+	font-size: 1.1em;
+	margin-bottom: 1.5em;
+}
+
+img {
+	border-width: 0;
+}
+
+hr { /* Also see tweaks.css */
+	border: 0 none #FFFFFF;
+	border-top: 1px solid #CCCCCC;
+	height: 1px;
+	margin: 5px 0;
+	display: block;
+	clear: both;
+}
+hr.dashed { border-top: 1px dashed #CCCCCC;
+	margin: 10px 0;
+}
+hr.divider { display: none;}
+p.right { text-align: right;}
+
+/* Main blocks
+---------------------------------------- */
+#simple-wrap { padding: 6px 10px; }
+#page-body { margin: 4px 0;
+	clear: both;
+}
+#page-footer { clear: both;
+}
+#page-footer h3 { margin-top: 20px;
+}
+#logo { float: left;
+	width: auto;
+	padding: 10px 13px 0 10px;
+}
+a#logo:hover { text-decoration: none;}
+/* Search box
+--------------------------------------------- */
+#search-box { color: #FFFFFF;
+	position: relative;
+	margin-top: 30px;
+	margin-right: 5px;
+	display: block;
+	float: right;
+	text-align: right;
+	white-space: nowrap; /* For Opera */
+}
+#search-box #keywords { width: 95px;
+	background-color: #FFF;
+}
+#search-box input { border: 1px solid #b0b0b0;
+}
+/* .button1 style defined later, just a few tweaks for the search button version */
+#search-box input.button1 { padding: 1px 5px;}
+#search-box li { text-align: right;
+	margin-top: 4px;
+}
+#search-box img {
+	vertical-align: middle;
+	margin-right: 3px;
+}
+/* Site description and logo */
+#site-description { float: left;
+	width: 70%;
+}
+
+#site-description h1 {	margin-right: 0;}
+
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar { background: #ebebeb none repeat-x 0 0;
+	color: #FFFFFF;
+	margin-bottom: 4px;
+	padding: 0 5px;
+}
+.navbar { background-color: #ebebeb;
+	padding: 0 10px;
+}
+.forabg { background: #b1b1b1 none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.forumbg { background: #ebebeb none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.panel { margin-bottom: 4px;
+	padding: 0 10px;
+	background-color: #f3f3f3;
+	color: #3f3f3f;
+}
+.post { padding: 0 10px;
+	margin-bottom: 4px;
+	background-repeat: no-repeat;
+	background-position: 100% 0;
+}
+.post:target .content { color: #000000;}
+.post:target h3 a { color: #000000;}
+.bg1	{ background-color: #f7f7f7;}
+.bg2	{ background-color: #f2f2f2; }
+.bg3	{ background-color: #ebebeb; }
+.rowbg { margin: 5px 5px 2px 5px;}
+.ucprowbg { background-color: #e2e2e2; }
+.fieldsbg { /*border: 1px #DBDEE2 solid;*/
+	background-color: #eaeaea;
+}
+span.corners-top, span.corners-bottom, span.corners-top span, span.corners-bottom span {
+	font-size: 1px;
+	line-height: 1px;
+	display: block;
+	height: 5px;
+	background-repeat: no-repeat;
+}
+span.corners-top { background-image: none;
+	background-position: 0 0;
+	margin: 0 -5px;
+}
+span.corners-top span { background-image: none;
+	background-position: 100% 0;
+}
+span.corners-bottom { background-image: none;
+	background-position: 0 100%;
+	margin: 0 -5px;
+	clear: both;
+}
+span.corners-bottom span { background-image: none;;
+	background-position: 100% 100%;
+}
+.headbg span.corners-bottom { margin-bottom: -1px; }
+.post span.corners-top, .post span.corners-bottom, .panel span.corners-top, .panel span.corners-bottom, .navbar span.corners-top, .navbar span.corners-bottom { margin: 0 -10px; }
+.rules span.corners-top { margin: 0 -10px 5px -10px;}
+.rules span.corners-bottom { margin: 5px -10px 0 -10px;}
+/* Horizontal lists
+----------------------------------------*/
+ul.linklist { display: block;
+	margin: 0;
+}
+ul.linklist li { display: block;
+	list-style-type: none;
+	float: left;
+	width: auto;
+	margin-right: 5px;
+	font-size: 1.1em;
+	line-height: 2.2em;
+}
+ul.linklist li.rightside, p.rightside { float: right;
+	margin-right: 0;
+	margin-left: 5px;
+	text-align: right;
+}
+ul.navlinks { padding-bottom: 1px;
+	margin-bottom: 1px;
+	border-bottom: 1px solid #FFFFFF;
+	font-weight: bold;
+}
+ul.leftside { float: left;
+	margin-left: 0;
+	margin-right: 5px;
+	text-align: left;
+}
+ul.rightside { float: right;
+	margin-left: 5px;
+	margin-right: -5px;
+	text-align: right;
+}
+/* Misc layout styles
+---------------------------------------- */
+dl.details {
+	/*font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;*/
+	font-size: 1.1em;
+}
+dl.details dt {
+	float: left;
+	clear: left;
+	width: 15em;
+	text-align: right;
+	color: #000000;
+	display: block;
+}
+dl.details dd {
+	margin-left: 0;
+	padding-left: 5px;
+	margin-bottom: 5px;
+	color: #828282;
+	float: left;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright { padding: 5px;
+	text-align: center;
+	color: #555555;
+}
+div.rules {
+	background-color: #ececec;
+	color: #bcbcbc;
+	padding: 0 10px;
+	margin: 10px 0;
+	font-size: 1.1em;
+}
+div.rules ul { margin-left: 20px; }
+p.rules { background-color: #ececec;
+	background-image: none;
+	padding: 5px;
+}
+p.rules img { vertical-align: middle; }
+p.rules a { vertical-align: middle;
+	clear: both;
+}
+#top { position: absolute;
+	top: -20px;
+}
+/* proSilver Link Styles
+---------------------------------------- */
+a:link	{ color: #898989; text-decoration: none; }
+a:visited	{ color: #898989; text-decoration: none; }
+a:hover	{ color: #d3d3d3; text-decoration: underline; }
+a:active	{ color: #d2d2d2; text-decoration: none; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {
+	color: #ffffff;
+	text-decoration: underline;
+}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {
+	color: #ffffff;
+	text-decoration: none;
+}
+/* Links for forum/topic lists */
+a.forumtitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.forumtitle:visited { color: #898989; } */
+a.forumtitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.forumtitle:active { color: #898989; }
+a.topictitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.topictitle:visited { color: #d2d2d2; } */
+a.topictitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.topictitle:active {
+	color: #898989;
+}
+/* Post body links */
+.postlink { text-decoration: none;
+	color: #d2d2d2;
+	border-bottom: 1px solid #d2d2d2;
+	padding-bottom: 0;
+}
+.postlink:visited { color: #bdbdbd;
+	border-bottom-style: dotted;
+	border-bottom-color: #666666;
+}
+.postlink:active { color: #d2d2d2; }
+.postlink:hover { background-color: #f6f6f6;
+	text-decoration: none;
+	color: #404040;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {
+	border: none;
+	text-decoration: underline;
+	background-color: transparent;
+}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a { font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+.postprofile a:hover, .postprofile dt.author a:hover { text-decoration: underline;
+	color: #d3d3d3;
+}
+/* Profile searchresults */	
+.search .postprofile a { color: #898989;
+	text-decoration: none; 
+	font-weight: normal;
+}
+.search .postprofile a:hover { color: #d3d3d3;
+	text-decoration: underline; 
+}
+/* Back to top of page */
+.back2top { clear: both;
+	height: 11px;
+	text-align: right;
+}
+a.top { background: none no-repeat top left;
+	text-decoration: none;
+	width: 11px;
+	height: 11px;
+	display: block;
+	float: right;
+	overflow: hidden;
+	letter-spacing: 1000px;
+	text-indent: 11px;
+}
+a.top2 {
+	background: none no-repeat 0 50%;
+	text-decoration: none;
+	padding-left: 15px;
+}
+/* Arrow links  */
+a.up		{ background: none no-repeat left center; }
+a.down		{ background: none no-repeat right center; }
+a.left		{ background: none no-repeat 3px 60%; }
+a.right		{ background: none no-repeat 95% 60%; }
+a.up, a.up:link, a.up:active, a.up:visited { padding-left: 10px;
+	text-decoration: none;
+	border-bottom-width: 0;
+}
+a.up:hover { background-position: left top;
+	background-color: transparent;
+}
+a.down, a.down:link, a.down:active, a.down:visited { padding-right: 10px; }
+a.down:hover { background-position: right bottom;
+	text-decoration: none;
+}
+a.left, a.left:active, a.left:visited { padding-left: 12px; }
+a.left:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 0 60%;
+}
+a.right, a.right:active, a.right:visited { padding-right: 12px;}
+a.right:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 100% 60%;
+}
+/* proSilver Content Styles
+---------------------------------------- */
+ul.topiclist { display: block;
+	list-style-type: none;
+	margin: 0;
+}
+ul.forums { background: #f9f9f9 none repeat-x 0 0;
+}
+ul.topiclist li { display: block;
+	list-style-type: none;
+	color: #777777;
+	margin: 0;
+}
+ul.topiclist dl { position: relative;}
+ul.topiclist li.row dl {padding: 2px 0;}
+ul.topiclist dt {display: block;
+	float: left;
+	width: 50%;
+	font-size: 1.1em;
+	padding-left: 5px;
+	padding-right: 5px;
+}
+ul.topiclist dd { display: block;
+	float: left;
+	border-left: 1px solid #FFFFFF;
+	padding: 4px 0;
+}
+ul.topiclist dfn { /* Labels for post/view counts */
+	display: none;
+}
+
+ul.topiclist li.row dt a.subforum { background-image: none;
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	position: relative;
+	white-space: nowrap;
+	padding: 0 0 0 12px;
+}
+.forum-image { float: left;
+	padding-top: 5px;
+	margin-right: 5px;
+}
+li.row { border-top: 1px solid #FFFFFF;
+	border-bottom: 1px solid #8f8f8f;
+}
+li.row strong { font-weight: normal;
+	color: #000000;
+}
+li.row:hover { background-color: #f6f6f6;
+}
+li.row:hover dd { border-left-color: #CCCCCC;
+}
+li.header dt, li.header dd { line-height: 1em;
+	border-left-width: 0;
+	margin: 2px 0 4px 0;
+	color: #FFFFFF;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	font-size: 1em;
+	font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+li.header dt { font-weight: bold;}
+li.header dd { margin-left: 1px;}
+li.header dl.icon { min-height: 0;}
+li.header dl.icon dt { /* Tweak for headers alignment when folder icon used */
+	padding-left: 0;
+	padding-right: 44px;
+}
+/* Forum list column styles */
+dl.icon { min-height: 35px;
+	background-position: 10px 50%;		/* Position of folder icon */
+	background-repeat: no-repeat;
+}
+dl.icon dt { padding-left: 45px;					/* Space for folder icon */
+	background-repeat: no-repeat;
+	background-position: 5px 95%;		/* Position of topic icon */
+}
+dd.posts, dd.topics, dd.views { width: 8%;
+	text-align: center;
+	line-height: 2.2em;
+	font-size: 1.2em;
+}
+dd.lastpost { width: 25%;
+	font-size: 1.1em;
+}
+dd.redirect { font-size: 1.1em;
+	line-height: 2.5em;
+}
+dd.moderation { font-size: 1.1em; }
+dd.lastpost span, ul.topiclist dd.searchby span, ul.topiclist dd.info span, ul.topiclist dd.time span, dd.redirect span, dd.moderation span { display: block;
+	padding-left: 5px;
+}
+dd.time { width: auto;
+	line-height: 200%;
+	font-size: 1.1em;
+}
+dd.extra { width: 65px;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.mark { float: right !important;
+	width: 9%;
+	text-align: center;
+	line-height: 200%;
+	font-size: 1.2em;
+}
+dd.info { width: 30%; }
+dd.option { width: 15%;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.searchby { width: 47%;
+	font-size: 1.1em;
+	line-height: 1em;
+}
+ul.topiclist dd.searchextra { margin-left: 5px;
+	padding: 0.2em 0;
+	font-size: 1.1em;
+	color: #333333;
+	border-left: none;
+	clear: both;
+	width: 98%;
+	overflow: hidden;
+}
+/* Container for post/reply buttons and pagination */
+.topic-actions { margin-bottom: 3px;
+	font-size: 1.1em;
+	height: 28px;
+	min-height: 28px;
+}
+div[class].topic-actions { height: auto; }
+/* Post body styles
+----------------------------------------*/
+.postbody { padding: 0;
+	line-height: 1.48em;
+	color: #333333;
+	width: 76%;
+	float: left;
+	clear: both;
+}
+.postbody .ignore { font-size: 1.1em; }
+.postbody h3.first { /* The first post on the page uses this */
+	font-size: 1.7em;
+}
+.postbody h3 { /* Postbody requires a different h3 format - so change it here */
+	font-size: 1.5em;
+	padding: 2px 0 0 0;
+	margin: 0 0 0.3em 0 !important;
+	text-transform: none;
+	border: none;
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	line-height: 125%;
+}
+.postbody h3 img { /* Also see tweaks.css */
+	vertical-align: bottom;
+}
+.postbody .content { font-size: 1.3em; }
+.search .postbody { width: 68% }
+/* Content container styles
+----------------------------------------*/
+.content { min-height: 3em;
+	overflow: hidden;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	color: #333333;
+}
+.content h2, .panel h2 { font-weight: normal;
+	color: #989898;
+	border-bottom: 1px solid #CCCCCC;
+	font-size: 1.6em;
+	margin-top: 0.5em;
+	margin-bottom: 0.5em;
+	padding-bottom: 0.5em;
+}
+.panel h3 { margin: 0.5em 0; }
+.panel p { font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+.content p { font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+dl.faq { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+	margin-top: 1em;
+	margin-bottom: 2em;
+	line-height: 1.4em;
+}
+dl.faq dt { font-weight: bold;
+	color: #333333;
+}
+.content dl.faq { font-size: 1.2em;
+	margin-bottom: 0.5em;
+}
+.content li { list-style-type: inherit; }
+.content ul, .content ol { margin-bottom: 1em;
+	margin-left: 3em;
+}
+.announce, .unreadpost {
+	/* Highlight the announcements & unread posts box */
+	border-left-color: #BCBCBC;
+	border-right-color: #BCBCBC;
+}
+/* Post author */
+p.author { margin: 0 15em 0.6em 0;
+	padding: 0 0 5px 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	line-height: 1.2em;
+}
+/* Post signature */
+.signature { margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1.1em;
+	border-top: 1px solid #CCCCCC;
+	clear: left;
+	line-height: 140%;
+	overflow: hidden;
+	width: 100%;
+}
+dd .signature { margin: 0;
+	padding: 0;
+	clear: none;
+	border: none;
+}
+/* Post noticies */
+.notice { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: auto;
+	margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1em;
+	border-top: 1px dashed #CCCCCC;
+	clear: left;
+	line-height: 130%;
+}
+/* Jump to post link for now */
+ul.searchresults {
+	list-style: none;
+	text-align: right;
+	clear: both;
+}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {
+	background: #ebebeb none 6px 8px no-repeat;
+	border: 1px solid #dbdbdb;
+	font-size: 0.95em;
+	margin: 0.5em 1px 0 25px;
+	overflow: hidden;
+	padding: 5px;
+}
+blockquote blockquote { /* Nested quotes */
+	background-color: #bababa;
+	font-size: 1em;
+	margin: 0.5em 1px 0 15px;	
+}
+blockquote blockquote blockquote { /* Nested quotes */
+	background-color: #e4e4e4;
+}
+blockquote cite { /* Username/source of quoter */
+	font-style: normal;
+	font-weight: bold;
+	margin-left: 20px;
+	display: block;
+	font-size: 0.9em;
+}
+blockquote cite cite { font-size: 1em; }
+blockquote.uncited { padding-top: 25px; }
+/* Code block */
+dl.codebox {
+	padding: 3px;
+	background-color: #FFFFFF;
+	border: 1px solid #d8d8d8;
+	font-size: 1em;
+}
+dl.codebox dt { text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	font-size: 0.8em;
+	font-weight: bold;
+	display: block;
+}
+blockquote dl.codebox { margin-left: 0; }
+dl.codebox code { /* Also see tweaks.css */
+	overflow: auto;
+	display: block;
+	height: auto;
+	max-height: 200px;
+	white-space: normal;
+	padding-top: 5px;
+	font: 0.9em Monaco, "Andale Mono","Courier New", Courier, mono;
+	line-height: 1.3em;
+	color: #8b8b8b;
+	margin: 2px 0;
+}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #000000; }
+.syntaxdefault	{ color: #bcbcbc; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #585858; }
+.syntaxstring	{ color: #a7a7a7; }
+/* Attachments
+----------------------------------------*/
+.attachbox { float: left;
+	width: auto; 
+	margin: 5px 5px 5px 0;
+	padding: 6px;
+	background-color: #FFFFFF;
+	border: 1px dashed #d8d8d8;
+	clear: left;
+}
+.pm-message .attachbox { background-color: #f3f3f3; }
+.attachbox dt { font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+.attachbox dd { margin-top: 4px;
+	padding-top: 4px;
+	clear: left;
+	border-top: 1px solid #d8d8d8;
+}
+.attachbox dd dd { border: none; }
+.attachbox p { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attachbox p.stats { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attach-image { margin: 3px 0;
+	width: 100%;
+	max-height: 350px;
+	overflow: auto;
+}
+.attach-image img { border: 1px solid #999999;
+/*	cursor: move; */
+	cursor: default;
+}
+/* Inline image thumbnails */
+div.inline-attachment dl.thumbnail, div.inline-attachment dl.file { display: block;
+	margin-bottom: 4px;
+}
+div.inline-attachment p { font-size: 100%; }
+dl.file { font-family: Verdana, Arial, Helvetica, sans-serif;
+	display: block;
+}
+dl.file dt { text-transform: none;
+	margin: 0;
+	padding: 0;
+	font-weight: bold;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+dl.file dd { color: #666666;
+	margin: 0;
+	padding: 0;	
+}
+dl.thumbnail img { padding: 3px;
+	border: 1px solid #666666;
+	display: block;
+	background-color: #FFF;
+}
+dl.thumbnail dd { color: #666666;
+	font-style: italic;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+.attachbox dl.thumbnail dd { font-size: 100%; }
+dl.thumbnail dt a:hover { background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img { border: 1px solid #d2d2d2; }
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls { font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif; }
+fieldset.polls dl { margin-top: 5px;
+	border-top: 1px solid #e2e2e2;
+	padding: 5px 0 0 0;
+	line-height: 120%;
+	color: #666666;
+}
+fieldset.polls dl.voted { font-weight: bold;
+	color: #000000;
+}
+fieldset.polls dt { text-align: left;
+	float: left;
+	display: block;
+	width: 30%;
+	border-right: none;
+	padding: 0;
+	margin: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd { float: left;
+	width: 10%;
+	border-left: none;
+	padding: 0 5px;
+	margin-left: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd.resultbar { width: 50%;}
+fieldset.polls dd input { margin: 2px 0; }
+fieldset.polls dd div { text-align: right;
+	font-family: Arial, Helvetica, sans-serif;
+	color: #FFFFFF;
+	font-weight: bold;
+	padding: 0 2px;
+	overflow: visible;
+	min-width: 2%;
+}
+.pollbar1 { background-color: #aaaaaa;
+	border-bottom: 1px solid #747474;
+	border-right: 1px solid #747474;
+}
+.pollbar2 { background-color: #bebebe;
+	border-bottom: 1px solid #8c8c8c;
+	border-right: 1px solid #8c8c8c;
+}
+.pollbar3 { background-color: #D1D1D1;
+	border-bottom: 1px solid #aaaaaa;
+	border-right: 1px solid #aaaaaa;
+}
+.pollbar4 { background-color: #e4e4e4;
+	border-bottom: 1px solid #bebebe;
+	border-right: 1px solid #bebebe;
+}
+.pollbar5 { background-color: #f8f8f8;
+	border-bottom: 1px solid #D1D1D1;
+	border-right: 1px solid #D1D1D1;
+}
+/* Poster profile block
+----------------------------------------*/
+.postprofile { /* Also see tweaks.css */
+	margin: 5px 0 10px 0;
+	min-height: 80px;
+	color: #666666;
+	border-left: 1px solid #FFFFFF;
+	width: 22%;
+	float: right;
+	display: inline;
+}
+.pm .postprofile { border-left: 1px solid #DDDDDD; }
+.postprofile dd, .postprofile dt { line-height: 1.2em;
+	margin-left: 8px;
+}
+.postprofile strong {font-weight: normal;
+	color: #000000;
+}
+.avatar { border: none;
+	margin-bottom: 3px;
+}
+.online { background-image: none;
+	background-position: 100% 0;
+	background-repeat: no-repeat;
+}
+/* Poster profile used by search*/
+.search .postprofile { width: 30%;}
+/* pm list in compose message if mass pm is enabled */
+dl.pmlist dt { width: 60% !important;}
+dl.pmlist dt textarea { width: 95%;}
+dl.pmlist dd { margin-left: 61% !important;
+	margin-bottom: 2px;
+}
+/* proSilver Button Styles
+---------------------------------------- */
+/* Rollover buttons
+   Based on: http://wellstyled.com/css-nopreload-rollovers.html
+----------------------------------------*/
+.buttons { float: left;
+	width: auto;
+	height: auto;
+}
+/* Rollover state */
+.buttons div { float: left;
+	margin: 0 5px 0 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+.buttons div a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+.buttons div span		{ display: none; }
+.buttons div a:hover	{ background-image: none; }
+/* Big button images */
+.reply-icon, .reply-icon a			{ background: transparent none 0 0 no-repeat; }
+.post-icon, .post-icon a				{ background: transparent none 0 0 no-repeat; }
+.locked-icon, .locked-icon a			{ background: transparent none 0 0 no-repeat; }
+.pmreply-icon, .pmreply-icon a		{ background: none 0 0 no-repeat; }
+.newpm-icon, .newpm-icon a			{ background: none 0 0 no-repeat; }
+.forwardpm-icon, .forwardpm-icon a 	{ background: none 0 0 no-repeat; }
+/* Set big button dimensions */
+.buttons div.reply-icon		{ width: 96px; height: 25px; }
+.buttons div.post-icon		{ width: 96px; height: 25px; }
+.buttons div.locked-icon	{ width: 96px; height: 25px; }
+.buttons div.pmreply-icon	{ width: 96px; height: 25px; }
+.buttons div.newpm-icon		{ width: 96px; height: 25px; }
+.buttons div.forwardpm-icon	{ width: 110px; height: 25px; }
+/* Sub-header (navigation bar)
+--------------------------------------------- */
+a.print, a.sendemail, a.fontsize { display: block;
+	overflow: hidden;
+	height: 18px;
+	text-indent: -5000px;
+	text-align: left;
+	background-repeat: no-repeat;
+}
+a.fontsize { background-image: none;
+	background-position: 0 -1px;
+	width: 29px;
+}
+a.fontsize:hover { background-position: 0 -20px;
+	text-decoration: none;
+}
+/* Icon images
+---------------------------------------- */
+.sitehome, .icon-faq, .icon-members, .icon-home, .icon-ucp, .icon-register, .icon-logout,
+.icon-bookmark, .icon-bump, .icon-subscribe, .icon-unsubscribe, .icon-pages, .icon-search {
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	background-image: none;
+	padding: 1px 0 0 17px;
+}
+/* Poster profile icons
+----------------------------------------*/
+ul.profile-icons { padding-top: 10px;
+	list-style: none;
+}
+/* Rollover state */
+ul.profile-icons li { float: left;
+	margin: 0 6px 3px 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+ul.profile-icons li a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+ul.profile-icons li span { display:none; }
+ul.profile-icons li a:hover { background: none; }
+/* Positioning of moderator icons */
+.postbody ul.profile-icons { float: right;
+	width: auto;
+	padding: 0;
+}
+.postbody ul.profile-icons li { margin: 0 3px;}
+/* Profile & navigation icons */
+.email-icon, .email-icon a		{ background: none top left no-repeat; }
+.aim-icon, .aim-icon a			{ background: none top left no-repeat; }
+.yahoo-icon, .yahoo-icon a		{ background: none top left no-repeat; }
+.web-icon, .web-icon a			{ background: none top left no-repeat; }
+.msnm-icon, .msnm-icon a			{ background: none top left no-repeat; }
+.icq-icon, .icq-icon a			{ background: none top left no-repeat; }
+.jabber-icon, .jabber-icon a		{ background: none top left no-repeat; }
+.pm-icon, .pm-icon a				{ background: none top left no-repeat; }
+.quote-icon, .quote-icon a		{ background: none top left no-repeat; }
+/* Moderator icons */
+.report-icon, .report-icon a		{ background: none top left no-repeat; }
+.warn-icon, .warn-icon a			{ background: none top left no-repeat; }
+.edit-icon, .edit-icon a			{ background: none top left no-repeat; }
+.delete-icon, .delete-icon a		{ background: none top left no-repeat; }
+.info-icon, .info-icon a			{ background: none top left no-repeat; }
+/* Set profile icon dimensions */
+ul.profile-icons li.email-icon		{ width: 20px; height: 20px; }
+ul.profile-icons li.aim-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.yahoo-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.web-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.msnm-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.icq-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.jabber-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.pm-icon		{ width: 28px; height: 20px; }
+ul.profile-icons li.quote-icon	{ width: 54px; height: 20px; }
+ul.profile-icons li.report-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.edit-icon	{ width: 58px; height: 20px; }
+ul.profile-icons li.delete-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.info-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.warn-icon	{ width: 20px; height: 20px; }
+/* Fix profile icon default margins */
+ul.profile-icons li.edit-icon	{ margin: 0 0 0 3px; }
+ul.profile-icons li.quote-icon	{ margin: 0 0 0 10px; }
+ul.profile-icons li.info-icon, ul.profile-icons li.report-icon	{ margin: 0 3px 0 0; }
+/* proSilver Form Styles
+---------------------------------------- */
+/* General form styles
+----------------------------------------*/
+fieldset { border-width: 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+}
+input { font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	padding: 0 3px;
+	font-size: 1em;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+}
+select {font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	border: 1px solid #666666;
+	padding: 1px;
+	background-color: #FAFAFA;
+}
+option { padding-right: 1em; }
+option.disabled-option { color: graytext; }
+textarea { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: 60%;
+	padding: 2px;
+	font-size: 1em;
+	line-height: 1.4em;
+}
+label { cursor: default;
+	padding-right: 5px;
+	color: #676767;
+}
+label input { vertical-align: middle;}
+label img { vertical-align: middle;}
+/* Definition list layout for forms
+---------------------------------------- */
+fieldset dl { padding: 4px 0;}
+fieldset dt { float: left;	
+	width: 40%;
+	text-align: left;
+	display: block;
+}
+fieldset dd { margin-left: 41%;
+	vertical-align: top;
+	margin-bottom: 3px;
+}
+/* Specific layout 1 */
+fieldset.fields1 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields1 dd { margin-left: 15em;
+	border-left-width: 0;
+}
+fieldset.fields1 { background-color: transparent; }
+fieldset.fields1 div { margin-bottom: 3px; }
+/* Specific layout 2 */
+fieldset.fields2 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields2 dd { margin-left: 16em;
+	border-left-width: 0;
+}
+/* Form elements */
+dt label { font-weight: bold;
+	text-align: left;
+}
+dd label { white-space: nowrap;
+	color: #333;
+}
+dd input, dd textarea { margin-right: 3px; }
+dd select { width: auto; }
+dd textarea { width: 85%; }
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label { color: inherit;}
+/* Submit button fieldset */
+fieldset.submit-buttons { text-align: center;
+	vertical-align: middle;
+	margin: 5px 0;
+}
+fieldset.submit-buttons input { vertical-align: middle;
+	padding-top: 3px;
+	padding-bottom: 3px;
+}
+/* Input field styles
+---------------------------------------- */
+.inputbox { background-color: #FFFFFF;
+	border: 1px solid #c0c0c0;
+	color: #333333;
+	padding: 2px;
+	cursor: text;
+}
+.inputbox:hover { border: 1px solid #eaeaea;}
+.inputbox:focus { border: 1px solid #eaeaea;
+	color: #4b4b4b;
+}
+input.inputbox	{ width: 85%; }
+input.medium	{ width: 50%; }
+input.narrow	{ width: 25%; }
+input.tiny	{ width: 125px; }
+textarea.inputbox { width: 85%; }
+.autowidth {width: auto !important;}
+/* Form button styles
+---------------------------------------- */
+input.button1, input.button2 {font-size: 1em;}
+a.button1, input.button1, input.button3, a.button2, input.button2 {
+	width: auto !important;
+	padding-top: 1px;
+	padding-bottom: 1px;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #000;
+	background: #FAFAFA none repeat-x top;
+}
+a.button1, input.button1 {font-weight: bold;
+	border: 1px solid #666666;
+}
+input.button3 {padding: 0;
+	margin: 0;
+	line-height: 5px;
+	height: 12px;
+	background-image: none;
+	font-variant: small-caps;
+}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border: 1px solid #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {
+	text-decoration: none;
+	color: #000000;
+	padding: 2px 8px;
+	line-height: 250%;
+	vertical-align: text-bottom;
+	background-position: 0 1px;
+}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {
+	border: 1px solid #BCBCBC;
+	background-position: 0 100%;
+	color: #BCBCBC;
+}
+
+/* Topic and forum Search */
+.search-box {margin-top: 3px;
+	margin-left: 5px;
+	float: left;
+}
+.search-box input {
+}
+input.search {background-image: none;
+	background-repeat: no-repeat;
+	background-position: left 1px;
+	padding-left: 17px;
+}
+/* proSilver Style Sheet Tweaks
+These style definitions are mainly IE specific 
+tweaks required due to its poor CSS support.
+-------------------------------------------------*/
+* html table, * html select, * html input { font-size: 100%; }
+* html hr { margin: 0; }
+* html span.corners-top, * html span.corners-bottom { background-image: url("{T_IMAGE_PATH}corners_left.gif"); }
+* html span.corners-top span, * html span.corners-bottom span { background-image: url("{T_IMAGE_PATH}corners_right.gif"); }
+table.table1 {width: 99%;		/* IE < 6 browsers */
+	/* Tantek hack */
+	voice-family: "\"}\"";
+	voice-family: inherit;
+	width: 100%;
+}
+html>body table.table1 { width: 100%; }	/* Reset 100% for opera */
+* html ul.topiclist li { position: relative; }
+* html .postbody h3 img { vertical-align: middle; }
+/* Form styles */
+html>body dd label input { vertical-align: text-bottom; }	/* Align checkboxes/radio buttons nicely */
+* html input.button1, * html input.button2 {
+	padding-bottom: 0;
+	margin-bottom: 1px;
+}
+/* Misc layout styles */
+* html .column1, * html .column2 { width: 45%; }
+/* Nice method for clearing floated blocks without having to insert any extra markup (like spacer above)
+   From http://www.positioniseverything.net/easyclearing.html 
+#tabs:after, #minitabs:after, .post:after, .navbar:after, fieldset dl:after, ul.topiclist dl:after, ul.linklist:after, dl.polls:after {
+	content: "."; 
+	display: block; 
+	height: 0; 
+	clear: both; 
+	visibility: hidden;
+}*/
+.clearfix, #tabs, #minitabs, .post, .navbar, fieldset dl, ul.topiclist dl, ul.linklist, dl.polls {
+	height: 1%;
+	overflow: hidden;
+}
+/* Simple fix so forum and topic lists always have a min-height set, even in IE6
+	From http://www.dustindiaz.com/min-height-fast-hack */
+dl.icon { min-height: 35px;
+	height: auto !important;
+	height: 35px;
+}
+* html #search-box {
+	margin-right: 35px;
+}
+/* Correctly clear floating for details on profile view */
+*:first-child+html dl.details dd { margin-left: 15em;
+	float: none;
+}
+* html dl.details dd { margin-left: 15em;
+	float: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for common.css
+-------------------------------------------------------------- */
+html, body { color: #536482;
+	background-color: #FFFFFF;
+}
+h1 { color: #FFFFFF;}
+h2 {color: #28313F;}
+h3 {border-bottom-color: #CCCCCC;
+	color: #115098;
+}
+hr {border-color: #FFFFFF;
+	border-top-color: #CCCCCC;
+}
+hr.dashed {border-top-color: #CCCCCC;}
+/* Search box
+--------------------------------------------- */
+#search-box {color: #FFFFFF;}
+#search-box #keywords {background-color: #FFF;}
+#search-box input {border-color: #0075B0;}
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+	color: #FFFFFF;
+}
+.navbar {background-color: #cadceb;}
+.forabg {background-color: #0076b1;
+	background-image: url("{T_IMAGE_PATH}bg_list.gif");
+}
+.forumbg {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+}
+.panel {background-color: #ECF1F3;
+	color: #28313F;
+}
+.post:target .content {color: #000000;}
+.post:target h3 a {color: #000000;}
+.bg1	{ background-color: #ECF3F7; }
+.bg2	{ background-color: #e1ebf2;  }
+.bg3	{ background-color: #cadceb; }
+.ucprowbg {background-color: #DCDEE2;}
+.fieldsbg {background-color: #E7E8EA;}
+span.corners-top {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-top span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+span.corners-bottom {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-bottom span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+/* Horizontal lists
+----------------------------------------*/
+ul.navlinks {border-bottom-color: #FFFFFF;}
+/* Misc layout styles
+---------------------------------------- */
+dl.details dt {
+	color: #000000;
+}
+
+dl.details dd {
+	color: #536482;
+}
+
+.sep {
+	color: #1198D9;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright {color: #555555;}
+.error {color: #BC2A4D;}
+.reported {background-color: #F7ECEF;}
+li.reported:hover {background-color: #ECD5D8 !important;}
+.sticky, .announce {/* you can add a background for stickies and announcements*/}
+div.rules {background-color: #ECD5D8;
+	color: #BC2A4D;
+}
+p.rules {background-color: #ECD5D8;
+	background-image: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for links.css
+-------------------------------------------------------------- */
+a:link	{ color: #105289; }
+a:visited	{ color: #105289; }
+a:hover	{ color: #D31141; }
+a:active	{ color: #368AD2; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {color: #FFFFFF;}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {color: #FFFFFF;}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {color: #A8D8FF;}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {color: #C8E6FF;}
+/* Links for forum/topic lists */
+a.forumtitle {color: #105289;}
+/* a.forumtitle:visited { color: #105289; } */
+a.forumtitle:hover {color: #BC2A4D;}
+a.forumtitle:active {color: #105289;}
+a.topictitle {color: #105289;}
+/* a.topictitle:visited { color: #368AD2; } */
+a.topictitle:hover {color: #BC2A4D;}
+a.topictitle:active {color: #105289;}
+/* Post body links */
+.postlink {color: #368AD2;
+	border-bottom-color: #368AD2;
+}
+.postlink:visited {color: #5D8FBD;
+	border-bottom-color: #666666;
+}
+.postlink:active {color: #368AD2;}
+.postlink:hover {background-color: #D0E4F6;
+	color: #0D4473;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {background-color: transparent;}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a {color: #105289;}
+.postprofile a:hover, .postprofile dt.author a:hover {color: #D31141;}
+/* Profile searchresults */	
+.search .postprofile a {color: #105289;}
+.search .postprofile a:hover {color: #D31141;}
+/* Back to top of page */
+a.top {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+a.top2 {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+/* Arrow links  */
+a.up		{ background-image: url("{T_IMAGE_PATH}arrow_up.gif") }
+a.down		{ background-image: url("{T_IMAGE_PATH}arrow_down.gif") }
+a.left		{ background-image: url("{T_IMAGE_PATH}arrow_left.gif") }
+a.right		{ background-image: url("{T_IMAGE_PATH}arrow_right.gif") }
+a.up:hover {background-color: transparent;}
+a.left:hover {color: #368AD2;}
+a.right:hover {color: #368AD2;}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for content.css
+-------------------------------------------------------------- */
+ul.forums {background-color: #eef5f9;
+	background-image: url("{T_IMAGE_PATH}gradient.gif");
+}
+ul.topiclist li {color: #4C5D77;}
+ul.topiclist dd {border-left-color: #FFFFFF;}
+.rtl ul.topiclist dd {border-right-color: #fff;
+	border-left-color: transparent;
+}
+ul.topiclist li.row dt a.subforum.read {background-image: url("{T_IMAGE_PATH}subforum_read.gif");}
+ul.topiclist li.row dt a.subforum.unread {background-image: url("{T_IMAGE_PATH}subforum_unread.gif");}
+li.row {border-top-color:  #FFFFFF;
+	border-bottom-color: #00608F;
+}
+li.row strong {color: #000000;}
+li.row:hover {background-color: #F6F4D0;}
+li.row:hover dd {border-left-color: #CCCCCC;}
+.rtl li.row:hover dd {border-right-color: #CCCCCC;
+	border-left-color: transparent;
+}
+li.header dt, li.header dd {color: #FFFFFF;}
+/* Forum list column styles */
+ul.topiclist dd.searchextra {color: #333333;}
+/* Post body styles
+----------------------------------------*/
+.postbody {color: #333333;}
+/* Content container styles
+----------------------------------------*/
+.content {color: #333333;}
+.content h2, .panel h2 {color: #115098;
+	border-bottom-color:  #CCCCCC;
+}
+dl.faq dt {color: #333333;}
+.posthilit {background-color: #F3BFCC;
+	color: #BC2A4D;
+}
+/* Post signature */
+.signature {border-top-color: #CCCCCC;}
+/* Post noticies */
+.notice {border-top-color:  #CCCCCC;}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {background-color: #EBEADD;
+	background-image: url("{T_IMAGE_PATH}quote.gif");
+	border-color:#DBDBCE;
+}
+blockquote blockquote {/* Nested quotes */
+	background-color:#EFEED9;
+}
+blockquote blockquote blockquote {/* Nested quotes */
+	background-color: #EBEADD;
+}
+/* Code block */
+dl.codebox {background-color: #FFFFFF;
+	border-color: #C9D2D8;
+}
+dl.codebox dt {border-bottom-color:  #CCCCCC;
+}
+dl.codebox code {color: #2E8B57;}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #FF8000; }
+.syntaxdefault	{ color: #0000BB; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #007700; }
+.syntaxstring	{ color: #DD0000; }
+/* Attachments
+----------------------------------------*/
+.attachbox {background-color: #FFFFFF;
+	border-color:  #C9D2D8;
+}
+.pm-message .attachbox {background-color: #F2F3F3;}
+.attachbox dd {border-top-color: #C9D2D8;}
+.attachbox p {color: #666666;}
+.attachbox p.stats {color: #666666;}
+.attach-image img {border-color: #999999;}
+/* Inline image thumbnails */
+dl.file dd {color: #666666;}
+dl.thumbnail img {border-color: #666666;
+	background-color: #FFFFFF;
+}
+dl.thumbnail dd {color: #666666;}
+dl.thumbnail dt a:hover {background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img {border-color: #368AD2;}
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls dl {border-top-color: #DCDEE2;
+	color: #666666;
+}
+fieldset.polls dl.voted {color: #000000;
+}
+fieldset.polls dd div {color: #FFFFFF;
+}
+.rtl .pollbar1, .rtl .pollbar2, .rtl .pollbar3, .rtl .pollbar4, .rtl .pollbar5 {border-right-color: transparent;
+}
+.pollbar1 {background-color: #AA2346;
+	border-bottom-color: #74162C;
+	border-right-color: #74162C;
+}
+.rtl .pollbar1 {border-left-color: #74162C;}
+.pollbar2 {background-color: #BE1E4A;
+	border-bottom-color: #8C1C38;
+	border-right-color: #8C1C38;
+}
+.rtl .pollbar2 {border-left-color: #8C1C38;}
+.pollbar3 {background-color: #D11A4E;
+	border-bottom-color: #AA2346;
+	border-right-color: #AA2346;
+}
+.rtl .pollbar3 {border-left-color: #AA2346;}
+.pollbar4 {background-color: #E41653;
+	border-bottom-color: #BE1E4A;
+	border-right-color: #BE1E4A;
+}
+.rtl .pollbar4 {border-left-color: #BE1E4A;}
+.pollbar5 {background-color: #F81157;
+	border-bottom-color: #D11A4E;
+	border-right-color: #D11A4E;
+}
+.rtl .pollbar5 {border-left-color: #D11A4E;}
+/* Poster profile block
+----------------------------------------*/
+.postprofile {color: #666666;
+	border-left-color: #FFFFFF;
+}
+.rtl .postprofile {border-right-color: #FFFFFF;
+	border-left-color: transparent;
+}
+.pm .postprofile {border-left-color: #DDDDDD;}
+.rtl .pm .postprofile {border-right-color: #DDDDDD;
+	border-left-color: transparent;
+}
+.postprofile strong {color: #000000;}
+.online {background-image: url("./styles/prosilver/imageset/fr/icon_user_online.gif");}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for buttons.css
+-------------------------------------------------------------- */
+a.fontsize {background-image: url("{T_IMAGE_PATH}icon_fontsize.gif");}
+/* Icon images
+---------------------------------------- */
+.sitehome						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-faq						{ background-image: url("{T_IMAGE_PATH}icon_faq.gif"); }
+.icon-ucp						{ background-image: url("{T_IMAGE_PATH}feed-icon.png"); }
+.icon-members					{ background-image: url("{T_IMAGE_PATH}icon_members.gif"); }
+.icon-home						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-register					{ background-image: url("{T_IMAGE_PATH}icon_register.gif"); }
+.icon-logout					{ background-image: url("{T_IMAGE_PATH}icon_logout.gif"); }
+.icon-bookmark					{ background-image: url("{T_IMAGE_PATH}icon_bookmark.gif"); }
+.icon-subscribe					{ background-image: url("{T_IMAGE_PATH}icon_subscribe.gif"); }
+.icon-search					{ background-image: url("{T_IMAGE_PATH}icon_search.gif"); }
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for forms.css
+-------------------------------------------------------------- */
+/* General form styles
+----------------------------------------*/
+select {border-color: #666666;
+	background-color: #FAFAFA;
+}
+label {color: #425067;}
+option.disabled-option {color: graytext;}
+/* Definition list layout for forms
+---------------------------------------- */
+dd label {color: #333;}
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label {color: inherit;}
+/* Quick-login on index page */
+fieldset.quick-login input.inputbox {background-color: #F2F3F3;}
+/* Input field styles
+---------------------------------------- */
+.inputbox {background-color: #FFFFFF; 
+	border-color: #B4BAC0;
+	color: #333333;
+}
+.inputbox:hover {border-color: #11A3EA;}
+.inputbox:focus {border-color: #11A3EA;
+	color: #0F4987;
+}
+/* Form button styles
+---------------------------------------- */
+a.button1, input.button1, input.button3, a.button2, input.button2 {color: #000;
+	background-color: #FAFAFA;
+	background-image: url("{T_IMAGE_PATH}bg_button.gif");
+}
+a.button1, input.button1 {border-color: #666666;}
+input.button3 {background-image: none;}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border-color: #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {color: #000000;}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {border-color: #BC2A4D;
+	color: #BC2A4D;
+}
+input.search {background-image: url("{T_IMAGE_PATH}icon_textbox_search.gif");}
+#wrap {  
+   padding: 0 20px;
+}
Index: styles/prosilver/template/overall_header.html
===================================================================
--- styles/prosilver/template/overall_header.html	(revision 1)
+++ styles/prosilver/template/overall_header.html	(Premod 3.0.8)
@@ -1,20 +1,19 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
 <head>
-
+{SEO_BASE_HREF}
+<!-- IF SEO_CANONICAL_URL --><link rel="canonical" href="{SEO_CANONICAL_URL}" /><!-- ENDIF -->
 <meta http-equiv="content-type" content="text/html; charset={S_CONTENT_ENCODING}" />
+<title>{PAGE_TITLE}<!-- IF S_IN_MCP --> &bull; {L_MCP}<!-- ELSEIF S_IN_UCP --> &bull; {L_UCP}<!-- ENDIF --></title>
 <meta http-equiv="content-style-type" content="text/css" />
 <meta http-equiv="content-language" content="{S_USER_LANG}" />
 <meta http-equiv="imagetoolbar" content="no" />
-<meta name="resource-type" content="document" />
-<meta name="distribution" content="global" />
-<meta name="copyright" content="2000, 2002, 2005, 2007 phpBB Group" />
-<meta name="keywords" content="" />
-<meta name="description" content="" />
+{META_TAG}
 <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7; IE=EmulateIE9" />
 {META}
-<title>{SITENAME} &bull; <!-- IF S_IN_MCP -->{L_MCP} &bull; <!-- ELSEIF S_IN_UCP -->{L_UCP} &bull; <!-- ENDIF -->{PAGE_TITLE}</title>
-
+<!-- BEGIN gym_rsslinks -->
+<link rel="alternate" type="application/rss+xml" title="{gym_rsslinks.TITLE}" href="{gym_rsslinks.URL}" />
+<!-- END gym_rsslinks -->
 <!-- IF S_ENABLE_FEEDS -->
 	<!-- IF S_ENABLE_FEEDS_OVERALL --><link rel="alternate" type="application/atom+xml" title="{L_FEED} - {SITENAME}" href="{U_FEED}" /><!-- ENDIF -->
 	<!-- IF S_ENABLE_FEEDS_NEWS --><link rel="alternate" type="application/atom+xml" title="{L_FEED} - {L_FEED_NEWS}" href="{U_FEED}?mode=news" /><!-- ENDIF -->
@@ -46,6 +45,15 @@
 	var style_cookie_settings = '{A_COOKIE_SETTINGS}';
 	var onload_functions = new Array();
 	var onunload_functions = new Array();
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	var seo_delim_start = '{SEO_START_DELIM}';
+	var seo_static_pagination = '{SEO_SATIC_PAGE}';
+	var seo_ext_pagination = '{SEO_EXT_PAGE}';
+	var seo_external = {SEO_EXTERNAL};
+	var seo_external_sub = {SEO_EXTERNAL_SUB};
+	var seo_ext_classes = {SEO_EXT_CLASSES};
+	var seo_hashfix = {SEO_HASHFIX};
+	// www.phpBB-SEO.com SEO TOOLKIT END
 
 	<!-- IF S_USER_PM_POPUP -->
 		if ({S_NEW_PM})
Index: styles/prosilver/template/gym_sitemaps/last_topics_list.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/last_topics_list.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/last_topics_list.html	(Premod 3.0.8)
@@ -0,0 +1,30 @@
+<br/><h2>{LASTX_TOPICS_TITLE}</h2>
+<br/>
+	<div class="forabg" style="width:100%">
+		<div class="inner">
+			<span class="corners-top"><span></span></span>
+			<!-- BEGIN last_forums -->
+			<ul class="topiclist">
+				<li class="header">
+					<dl>
+						<dt style="width:85%"><a href="{last_forums.U_VIEWFORUM}" title="{last_forums.FORUM_NAME}" class="forumtitle">{last_forums.FORUM_NAME}</a></dt>
+					</dl>
+				</li>
+			</ul>
+			<ul class="topiclist topics">
+				<!-- BEGIN last_topics -->
+				<li class="row<!-- IF last_forums.last_topics.S_ROW_COUNT is even --> bg1<!-- ELSE --> bg2<!-- ENDIF --><!-- IF last_forums.last_topics.S_POST_ANNOUNCE --> announce<!-- ENDIF --><!-- IF last_forums.last_topics.S_POST_STICKY --> sticky<!-- ENDIF --><!-- IF last_forums.last_topics.S_TOPIC_REPORTED --> reported<!-- ENDIF -->">
+					<dl class="icon" style="background-image: url({last_forums.last_topics.TOPIC_FOLDER_IMG_SRC}); background-repeat: no-repeat;">
+						<dt class="column1"<!-- IF last_forums.last_topics.TOPIC_ICON_IMG and S_TOPIC_ICONS --> style="background-image: url({T_ICONS_PATH}{last_forums.last_topics.TOPIC_ICON_IMG}); background-repeat: no-repeat;"<!-- ENDIF --> title="{last_forums.last_topics.TOPIC_FOLDER_IMG_ALT}" style="width:63%;text-align:left;padding-top:2px;">
+							<!-- IF last_forums.last_topics.S_UNREAD_TOPIC --><a href="{last_forums.last_topics.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF --><a href="{last_forums.last_topics.U_VIEW_TOPIC}">{last_forums.last_topics.TOPIC_TITLE}</a><br/>
+							<!-- IF last_forums.last_topics.PAGINATION --><br/><strong class="pagination"><span>{last_forums.last_topics.PAGINATION}</span></strong><!-- ELSE --><br/><!-- ENDIF -->
+						</dt>
+						<dd class="column2" style="width:1%;"><a href="{last_forums.last_topics.U_LAST_POST}">{LAST_POST_IMG}</a></dd>
+					</dl>
+				</li>
+				<!-- END last_topics -->
+			</ul>
+			<!-- END last_forums -->
+			<span class="corners-bottom"><span></span></span>
+		</div>
+	</div>
Index: styles/prosilver/template/gym_sitemaps/display_topics_list.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/display_topics_list.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/display_topics_list.html	(Premod 3.0.8)
@@ -0,0 +1,100 @@
+<!-- IF DISPLAY_TOPICS_H1 --><h1><!-- IF U_TOPICS --><a href="{U_TOPICS}" title="{H1_TOPICS}">{H1_TOPICS}</a><!-- ELSE -->{H1_TOPICS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {FORUM_NEWS}</a><!-- ENDIF --> <strong>&raquo;</strong> <a href="{FORUM_URL}" title="{FORUM_NAME}">{L_FORUM} : {FORUM_NAME}</a></h3><!-- ENDIF -->
+<!-- IF MAP_DESC --><span>{MAP_DESC}<br /></span><!-- ENDIF -->
+<!-- IF MAP_RULES or MAP_RULES_LINK -->
+	<div class="rules">
+		<div class="inner"><span class="corners-top"><span></span></span>
+		<!-- IF MAP_RULES_LINK -->
+			<a href="{MAP_RULES_LINK}">{L_FORUM_RULES}</a>
+		<!-- ELSE -->
+			<strong>{L_FORUM_RULES}</strong><br />
+			{MAP_RULES}
+		<!-- ENDIF -->
+		<span class="corners-bottom"><span></span></span></div>
+	</div>
+<!-- ENDIF -->
+<!-- IF DISPLAY_PAGINATION -->
+<div class="topic-actions">
+	<div class="pagination">
+		{DISPLAY_TOTAL_TOPICS}
+		<!-- IF DISPLAY_PAGE_NUMBER --><!-- IF DISPLAY_PAGINATION --> &bull; <a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{DISPLAY_PAGE_NUMBER}</a> &bull; <span>{DISPLAY_PAGINATION}</span><!-- ELSE --> &bull; {DISPLAY_PAGE_NUMBER}<!-- ENDIF --><!-- ENDIF -->
+	</div>
+</div>
+<div class="clear"></div>
+<!-- ELSE -->
+<br/><br/>
+<!-- ENDIF -->
+<!-- BEGIN topicrow -->
+	<!-- IF not topicrow.S_TOPIC_TYPE_SWITCH and not topicrow.S_FIRST_ROW -->
+		</ul>
+		<span class="corners-bottom"><span></span></span></div>
+	</div>
+	<!-- ENDIF -->
+
+	<!-- IF topicrow.S_FIRST_ROW or not topicrow.S_TOPIC_TYPE_SWITCH -->
+		<div class="forumbg">
+		<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt <!-- IF not DISPLAY_LAST_POST -->style="width:85%;"<!-- ENDIF -->>
+					<!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}">{FORUM_NEWS}</a> <strong>&raquo;</strong> <!-- ENDIF --><!-- IF U_TOPICS --><a href="{U_TOPICS}" title="{H1_TOPICS}">{H1_TOPICS}</a><!-- ELSE -->{H1_TOPICS}<!-- ENDIF --></dt>
+					<!-- IF DISPLAY_LAST_POST --><dd class="lastpost"><span>{L_LAST_POST}</span></dd><!-- ENDIF -->
+				</dl>
+			</li>
+		</ul>
+		<ul class="topiclist topics">
+	<!-- ENDIF -->
+	
+		<li class="row<!-- IF topicrow.S_ROW_COUNT is even --> bg1<!-- ELSE --> bg2<!-- ENDIF -->">
+			<dl class="icon" style="background-image: url({topicrow.TOPIC_FOLDER_IMG_SRC}); background-repeat: no-repeat;">
+				<dt style="<!-- IF topicrow.TOPIC_ICON_IMG -->background-image: url({T_ICONS_PATH}{topicrow.TOPIC_ICON_IMG}); background-repeat: no-repeat;<!-- ENDIF --><!-- IF not DISPLAY_LAST_POST -->width:85%;<!-- ENDIF -->" title="{topicrow.TOPIC_FOLDER_IMG_ALT}"><!-- IF topicrow.S_UNREAD_TOPIC --><a href="{topicrow.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF --><a href="{topicrow.U_VIEW_TOPIC}" class="topictitle" title="{topicrow.TOPIC_TITLE}">{topicrow.TOPIC_TITLE}</a>
+					<!-- IF topicrow.S_TOPIC_UNAPPROVED or topicrow.S_POSTS_UNAPPROVED --><a href="{topicrow.U_MCP_QUEUE}">{topicrow.UNAPPROVED_IMG}</a> <!-- ENDIF -->
+					<!-- IF topicrow.S_TOPIC_REPORTED --><a href="{topicrow.U_MCP_REPORT}">{REPORTED_IMG}</a><!-- ENDIF --><br />
+					<!-- IF topicrow.PAGINATION --><strong class="pagination"><span>{topicrow.PAGINATION}</span></strong><!-- ENDIF -->
+					<!-- IF topicrow.ATTACH_ICON_IMG -->{topicrow.ATTACH_ICON_IMG} <!-- ENDIF -->
+					<!-- IF topicrow.TOPIC_AUTHOR_FULL -->{L_POST_BY_AUTHOR} {topicrow.TOPIC_AUTHOR_FULL}<!-- ENDIF --> {L_POSTED_ON_DATE} {topicrow.FIRST_POST_TIME}
+					<!-- IF not S_SINGLE_FORUM and topicrow.U_VIEW_FORUM --><br />{L_IN} <a href="{topicrow.U_VIEW_FORUM}" style="font-weight: bold;">{topicrow.FORUM_NAME}</a><!-- ENDIF -->
+				</dt>
+				<!-- IF DISPLAY_LAST_POST --><dd class="lastpost"><span><dfn>{L_LAST_POST} </dfn>
+					<a href="{topicrow.U_MINI_POST}" title="{L_LAST_POST} : {topicrow.TOPIC_LAST_POST_TITLE}">{LAST_POST_IMG} {topicrow.TOPIC_LAST_POST_TITLE}</a> <br />
+					<!-- IF topicrow.TOPIC_AUTHOR_FULL -->{L_POST_BY_AUTHOR} {topicrow.LAST_POST_AUTHOR_FULL} <!-- ENDIF -->
+					{L_POSTED_ON_DATE} {topicrow.LAST_POST_TIME}</span>
+				</dd>
+				<!-- ENDIF -->
+			</dl>
+		</li>
+
+	<!-- IF topicrow.S_LAST_ROW -->
+			</ul>
+		<span class="corners-bottom"><span></span></span></div>
+	</div>
+	<!-- ENDIF -->
+
+	<!-- BEGINELSE -->
+<div class="forumbg">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt><!-- IF U_TOPICS --><a href="{U_TOPICS}" title="{H1_TOPICS}">{H1_TOPICS}</a><!-- ELSE -->{H1_TOPICS}<!-- ENDIF --></dt>
+					<dd>&nbsp;</dd>
+				</dl>
+			</li>
+		</ul>
+		<div class="panel">
+			<div class="inner"><span class="corners-top"><span></span></span>
+				<p>{L_HTML_NO_ITEMS}</p>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- END topicrow -->
+<!-- IF DISPLAY_PAGINATION -->
+<div class="topic-actions">
+	<div class="pagination">
+		{DISPLAY_TOTAL_TOPICS}
+		<!-- IF DISPLAY_PAGE_NUMBER --><!-- IF DISPLAY_PAGINATION --> &bull; <a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{DISPLAY_PAGE_NUMBER}</a> &bull; <span>{DISPLAY_PAGINATION}</span><!-- ELSE --> &bull; {DISPLAY_PAGE_NUMBER}<!-- ENDIF --><!-- ENDIF -->
+	</div>
+</div>
+<!-- ENDIF -->
Index: styles/prosilver/template/gym_sitemaps/index_list.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/index_list.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/index_list.html	(Premod 3.0.8)
@@ -0,0 +1,56 @@
+<h2><!-- IF HTML_NEWS_URL --><a href="{HTML_NEWS_URL}" title="{HTML_NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {HTML_NEWS_TITLE}</a> <!-- ENDIF --><!-- IF HTML_URL --><strong>&raquo;</strong> <a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a><!-- ENDIF --></h2>
+<!-- IF HTML_SITEDESC --><span>{HTML_SITEDESC}<br /></span><!-- ENDIF -->
+<!-- BEGIN module -->
+	<h3><!-- IF module.NEWS_URL --><a href="{module.NEWS_URL}" title="{module.NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {module.NEWS_TITLE}</a><!-- ENDIF --><!-- IF module.MAP_URL --> <strong>&raquo;</strong> <a href="{module.MAP_URL}" title="{module.MAP_TITLE}">{module.MAP_TITLE}</a><br /><!-- ENDIF --></h3>
+<span>{module.DESC}<br /></span><br />
+		<div class="forabg" style="width:100%">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl>
+						<dt style="width:64%;"><!-- IF module.NEWS_URL --><a href="{module.NEWS_URL}" title="{module.NEWS_TITLE}">{module.NEWS_TITLE}</a> <!-- ENDIF -->
+					<!-- IF module.MAP_URL --> <strong>&raquo;</strong> <a href="{module.MAP_URL}" title="{module.MAP_TITLE}">{module.MAP_TITLE}</a><br /><!-- ENDIF --></dt>
+					</dl>
+				</li>
+			</ul>
+			<ul class="topiclist forums">
+				<!-- BEGIN links -->
+				<li class="row<!-- IF module.links.S_ROW_COUNT is odd --> bg2<!-- ENDIF -->" style="padding:10px;">
+					<!-- IF module.links.NEWS_URL or module.links.MAP_URL -->
+					<h4 class="column1" style="position:relative;">
+						<!-- IF module.links.NEWS_URL -->
+							<a href="{module.links.NEWS_URL}" title="{module.links.NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {module.links.NEWS_TITLE}</a>
+						<!-- ELSE -->
+							<a href="{module.links.MAP_URL}" title="{module.links.MAP_TITLE}"> <strong>&raquo;</strong> {module.links.MAP_TITLE}</a>
+						<!-- ENDIF -->
+					</h4>
+					<!-- ENDIF -->
+					<!-- IF module.links.NEWS_URL and module.links.MAP_URL -->
+					<h4 class="column2" style="position:relative;">
+						<a href="{module.links.MAP_URL}" title="{module.links.MAP_TITLE}"> <strong>&raquo;</strong> {module.links.MAP_TITLE}</a>
+					</h4>
+					<!-- ENDIF -->
+					<div class="clear">&nbsp;</div>
+				</li>
+				<!-- END links -->
+			</ul>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+<!-- BEGINELSE -->
+<div class="forabg">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt style="width:64%;"><a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a></dt>
+				</dl>
+			</li>
+		</ul>
+		<div class="panel">
+			<div class="inner"><span class="corners-top"><span></span></span>
+				<p>{L_HTML_MAP_NONE}</p>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- END module -->
Index: styles/prosilver/template/gym_sitemaps/index_body.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/index_body.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/index_body.html	(Premod 3.0.8)
@@ -0,0 +1,65 @@
+<!-- INCLUDE overall_header.html -->
+
+<p class="{S_CONTENT_FLOW_END}<!-- IF S_REGISTERED_USER --> rightside<!-- ENDIF -->"><!-- IF S_REGISTERED_USER -->{LAST_VISIT_DATE}<!-- ELSE -->{CURRENT_TIME}<!-- ENDIF --></p>
+<!-- IF U_MCP --><p>{CURRENT_TIME} <br />[&nbsp;<a href="{U_MCP}">{L_MCP}</a>&nbsp;]</p><!-- ELSEIF S_REGISTERED_USER --><p>{CURRENT_TIME}</p><!-- ENDIF -->
+
+<!-- IF S_DISPLAY_SEARCH or S_REGISTERED_USER -->
+<ul class="linklist">
+	<!-- IF S_DISPLAY_SEARCH -->
+		<li><a href="{U_SEARCH_UNANSWERED}">{L_SEARCH_UNANSWERED}</a><!-- IF S_REGISTERED_USER --> &bull; <a href="{U_SEARCH_NEW}">{L_SEARCH_NEW}</a><!-- ENDIF --> &bull; <a href="{U_SEARCH_ACTIVE_TOPICS}">{L_SEARCH_ACTIVE_TOPICS}</a></li>
+	<!-- ENDIF -->
+	<!-- IF S_REGISTERED_USER and U_MARK_FORUMS --><li class="rightside"><a href="{U_MARK_FORUMS}" accesskey="m">{L_MARK_FORUMS_READ}</a></li><!-- ENDIF -->
+</ul>
+<!-- ENDIF -->
+
+<div style="width:99%"><div class="column1" style="width:<!-- IF RIGHT_COL -->73<!-- ELSE -->99<!-- ENDIF -->%;text-align:left">{LEFT_COL}</div>
+<!-- IF RIGHT_COL --><div class="column2" style="width:25%;text-align:left">{RIGHT_COL}</div><!-- ENDIF -->
+<div class="clear">&nbsp;</div></div>
+<!-- IF not S_USER_LOGGED_IN and not S_IS_BOT -->
+	<form method="post" action="{S_LOGIN_ACTION}" class="headerspace">
+	<h3><a href="{U_LOGIN_LOGOUT}">{L_LOGIN_LOGOUT}</a><!-- IF S_REGISTER_ENABLED -->&nbsp; &bull; &nbsp;<a href="{U_REGISTER}">{L_REGISTER}</a><!-- ENDIF --></h3>
+		<fieldset class="quick-login">
+			<label for="username">{L_USERNAME}:</label>&nbsp;<input type="text" name="username" id="username" size="10" class="inputbox" title="{L_USERNAME}" />
+			<label for="password">{L_PASSWORD}:</label>&nbsp;<input type="password" name="password" id="password" size="10" class="inputbox" title="{L_PASSWORD}" />
+			<!-- IF S_AUTOLOGIN_ENABLED -->
+				| <label for="autologin">{L_LOG_ME_IN} <input type="checkbox" name="autologin" id="autologin" /></label>
+			<!-- ENDIF -->
+			<input type="submit" name="login" value="{L_LOGIN}" class="button2" />
+			{S_LOGIN_REDIRECT}
+		</fieldset>
+	</form>
+<br /><!-- ENDIF -->
+
+<!-- IF S_DISPLAY_ONLINE_LIST -->
+	<!-- IF not S_SINGLE_TRAKING -->
+		<!-- IF U_VIEWONLINE --><h3><a href="{U_VIEWONLINE}">{L_WHO_IS_ONLINE}</a></h3><!-- ELSE --><h3>{L_WHO_IS_ONLINE}</h3><!-- ENDIF -->
+		<p>{TOTAL_USERS_ONLINE} ({L_ONLINE_EXPLAIN})<br />{RECORD_USERS}<br /> <br />
+	<!-- ELSE -->
+	<p>
+	<!-- ENDIF -->
+	{LOGGED_IN_USER_LIST}
+	<!-- IF LEGEND --><br /><em>{L_LEGEND}: {LEGEND}</em><!-- ENDIF --><br /> <br /></p>
+
+<!-- ENDIF -->
+
+<!-- IF S_DISPLAY_BIRTHDAY_LIST and BIRTHDAY_LIST -->
+	<h3>{L_BIRTHDAYS}</h3>
+	<p>{L_CONGRATULATIONS}: <strong>{BIRTHDAY_LIST}</strong></p>
+<!-- ENDIF -->
+
+<!-- IF TOTAL_USERS -->
+	<h3>{L_STATISTICS}</h3>
+	<p>{TOTAL_POSTS} &bull; {TOTAL_TOPICS} &bull; {TOTAL_USERS}<!-- IF NEWEST_USER --> &bull; {NEWEST_USER}<!-- ENDIF --></p>
+<!-- ENDIF -->
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team : 2008.
+-->
+<div class="copyright"><a href="http://www.phpbb-seo.com/{S_SEO_FORUM}" title="{L_FORUM} - {L_GYM_SEO}">GYM sitemaps &amp; RSS</a></div>
+<!-- INCLUDE overall_footer.html -->
Index: styles/prosilver/template/gym_sitemaps/gym_rss.xsl
===================================================================
--- styles/prosilver/template/gym_sitemaps/gym_rss.xsl	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/gym_rss.xsl	(Premod 3.0.8)
@@ -0,0 +1,197 @@
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+<xsl:output 
+	method="html" 
+	version="1.0" 
+	encoding="utf-8" 
+	omit-xml-declaration="yes"		
+	doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" 
+	doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
+	indent="yes" />
+<xsl:template match="/rss" >
+
+<xsl:variable name="rss_link">
+	<xsl:value-of select="channel/textInput/link" />
+</xsl:variable>
+<xsl:variable name="home_link">{ROOT_URL}</xsl:variable>
+<xsl:variable name="browser">
+	<xsl:choose><xsl:when test="system-property('xsl:vendor')='Transformiix'">mozilla</xsl:when>
+		<xsl:otherwise>other</xsl:otherwise>
+	</xsl:choose>
+</xsl:variable>
+<xsl:variable name="sorting">
+	<xsl:choose><xsl:when test="$browser='mozilla'">descending</xsl:when>
+		<xsl:otherwise>ascending</xsl:otherwise>
+	</xsl:choose>
+</xsl:variable>
+<html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
+<head>
+	<base href="{PHPBB_URL}"/>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
+	<title><xsl:value-of select="channel/title" /> -  {L_FEED}</title>
+	<link rel="alternate" type="application/rss+xml" title="{channel/title}" href="{$rss_link}" />
+	<link rel="stylesheet" href="{T_CSS_PATH}" type="text/css"  media="screen, projection"/>
+	<link href="{T_STYLE_PATH}normal.css" rel="stylesheet" type="text/css" title="A" />
+	<link href="{T_STYLE_PATH}medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
+	<link href="{T_STYLE_PATH}large.css" rel="alternate stylesheet" type="text/css" title="A++" />
+	<script type="text/javascript" src="{T_STYLE_PATH}gym_js.js"></script>
+</head>
+<body id="phpbb">
+<!--
+	GYM Sitemaps and RSS XSLTransform
+	(C) phpBB SEO - http://www.phpbb-seo.com/
+-->
+			<div id="wrap">
+				<a id="top" name="top" accesskey="t"></a>
+				<div id="page-header">
+					<div class="headerbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div id="site-description"><a href="{$home_link}" title="{L_HOME}" id="logo"><img src="{channel/image/url}" alt="{channel/image/title}" /></a>
+								<h1>{SITENAME}</h1>
+								<p>{SITE_DESCRIPTION}</p>
+								<p style="display: none;"><a href="#start_here">{L_SKIP}</a></p>
+							</div>
+							<div id="search-box">
+								<form action="{PHPBB_URL}search.php" method="post" id="search">
+								<fieldset>
+									<input name="keywords" id="keywords" type="text" maxlength="128" title="" class="inputbox search" value="" /> 
+									<input class="button2" value="{L_SEARCH}" type="submit" /><br />
+									<a href="{PHPBB_URL}search.php" title="{L_SEARCH_ADV_EXPLAIN}">{L_SEARCH_ADV}</a>
+								</fieldset>
+								</form>
+							</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<div class="navbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<ul class="linklist navlinks">
+								<li class="icon-home">
+									<a href="{$home_link}" accesskey="h">{L_HOME}</a>&#160;<strong>&#8249;</strong>&#160;
+									<xsl:if test="$home_link != '{PHPBB_URL}'">
+										<xsl:if test="'{PHPBB_URL}' != channel/link">
+											<a href="{PHPBB_URL}">{L_FORUM_INDEX}</a>&#160;<strong>&#8249;</strong>&#160;
+										</xsl:if>
+									</xsl:if>
+									<a href="{channel/link}" title="{channel/title}"><span class="html"><xsl:value-of select="channel/title" /></span></a>&#160;<strong>&#8249;</strong>&#160;<a href="{$rss_link}">{L_SOURCE}</a></li>
+								<li class="rightside"><a href="#" onclick="fontsizeup(); return false;" class="fontsize" title="{L_CHANGE_FONT_SIZE}">{L_CHANGE_FONT_SIZE}</a></li>
+							</ul>
+							<ul class="linklist leftside">
+								<li class="icon-ucp">
+									<a href="{$rss_link}" title="{channel/title}" accesskey="u"><span class="html"><xsl:value-of select="channel/title" />&#160;-&#160;{L_FEED}</span></a>
+								</li>
+							</ul>
+							<ul class="linklist rightside">
+								<li class="icon-faq"><a href="{PHPBB_URL}faq.php" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>
+								<li class="icon-register"><a href="{PHPBB_URL}ucp.php?mode=register">{L_REGISTER}</a></li>
+							</ul>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+				</div>
+				<a name="start_here"></a>
+				<div id="page-body"><br/>
+					<div class="clear"></div>
+					<xsl:for-each select="channel">
+					<div class="post bg3">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div class="postbody"><div class="html"><p><h2><a href="{link}" title="{title}"><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a></h2></p><hr/>
+
+								<p><span class="html"><xsl:call-template name="nl2br"><xsl:with-param name="input" select="description" /></xsl:call-template></span><br/><br/>
+{L_SUBSCRIBE}
+							<form action="" method="POST" >
+								<fieldset >
+									<label><a href="{$rss_link}" title="{title}"><img src="{T_IMAGE_PATH}feed-icon.png" alt="{L_2_LINK}" align="middle"/></a> {L_2_LINK}</label>
+									<input name="urlrss" type="text" value="{$rss_link}" size="80" maxlength="500"/>
+								</fieldset>
+							</form>
+							<br/>
+{L_LAST_UPDATE} : <xsl:value-of select="lastBuildDate"/><br/>
+{L_UPDATE} : <xsl:value-of select="ttl"/>&#160;{L_MINUTES}.<br/><br/>
+				<xsl:choose>
+					<xsl:when test="count(item) = 1">&#160;<b>{L_ITEM_LISTED}</b>
+						</xsl:when>
+					<xsl:otherwise>
+						<b><xsl:value-of select="count(item)"/>&#160;{L_ITEMS_LISTED}</b>
+					</xsl:otherwise>
+					</xsl:choose></p></div></div>
+							<dl class="postprofile">
+								<dt>{L_SUBSCRIBE_POD}<br/><br/>
+								<a href="http://fusion.google.com/add?feedurl={$rss_link}" target="_google"><img src="{T_IMAGE_PATH}addGoogle.gif" border="0" alt="Add to Google" title="Add to Google"/></a><br/>
+								<a href="http://add.my.yahoo.com/rss?url={$rss_link}" target="_yahoo"><img src="{T_IMAGE_PATH}addtomyyahoo.gif" border="0" alt="Add to My Yahoo" title="Add to My Yahoo"/></a><br/>
+								<a href="http://my.msn.com/addtomymsn.armx?id=rss&#038;ut={$rss_link}&#038;ru={$rss_link}" target="_msn"><img src="{T_IMAGE_PATH}MyMSN.gif" alt="Add to My MSN" title="Add to My MSN"/></a><br/>
+								<a href="http://feeds.my.aol.com/index.jsp?url={$rss_link}" target="_aol"><img alt="Add to MY AOL" src="{T_IMAGE_PATH}myaol.gif"  title="Add to My AOL" border="0"/></a><br/>
+								<a href="http://www.newsgator.com/ngs/subscriber/subext.aspx?url={$rss_link}" target="_newsgator"><img src="{T_IMAGE_PATH}newsgator.gif" alt="Subscribe in NewsGator Online" title="Subscribe in NewsGator Online" border="0"/></a><br/>
+								<a href="http://www.netvibes.com/subscribe.php?url={$rss_link}" target="_netvibes"><img src="{T_IMAGE_PATH}add2netvibes.gif" border="0" alt="Add to Netvibes" title="Add to Netvibes"/></a><br/>
+								<a href="http://www.pageflakes.com/subscribe.aspx?url={$rss_link}" target="_pageflakes"><img src="{T_IMAGE_PATH}pageflakes.gif" border="0" alt="Add to Page Flakes" title="Add to Page Flakes"/></a><br/>
+								</dt>
+							</dl>
+							
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<br/><br/>
+					<xsl:for-each select="item">
+						<xsl:sort select="substring(pubDate,12,string-length(pubDate))" order="{$sorting}" data-type="number"/> 
+					<div class="post bg2">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div class="postbody">
+								<div class="content"><p><h2><a href="{link}" title="{title}"><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a></h2></p>
+									<span class="html"><xsl:call-template name="nl2br"><xsl:with-param name="input" select="description" /></xsl:call-template></span>
+									<div class="signature">
+										<b>{L_BOOKMARK_THIS}</b>&#160;
+										<a href="http://www.scoopeo.com/scoop/new?newurl={link}&amp;title={title}" title="Scoopeo : {title}"><img src="{T_IMAGE_PATH}scoopeo.png" alt="Scoopeo" /></a>&#160;  
+										<a href="http://www.wikio.fr/publish?url={link}&amp;title={title}" title="Wikio : {title}"><img src="{T_IMAGE_PATH}wikio.gif" alt="Wikio" /></a>&#160;
+										<a href="http://digg.com/submit?phase=2&amp;url={link}&amp;title={title}" title="Digg : {title}"><img src="{T_IMAGE_PATH}digg.png" alt="Digg" /></a>&#160;
+										<a href="http://www.fuzz.fr/submit?url={link}&amp;title={title}" title="Fuzz : {title}"><img src="{T_IMAGE_PATH}fuzz.png" alt="Fuzz" /></a>&#160;
+										<a href="http://www.nuouz.com/addNews.aspx?url={link}&amp;title={title}" title="Nuouz : {title}"><img src="{T_IMAGE_PATH}nuouz.png" alt="Nuouz" /></a>&#160;
+										<a href="http://reddit.com/submit?url={link}&amp;title={title}" title="Reddit : {title}"><img src="{T_IMAGE_PATH}reddit.png" alt="Reddit" /></a>&#160;
+										<a href="http://www.addthis.com/bookmark.php" onclick="window.open('http://www.addthis.com/bookmark.php?wt=nw&amp;url={link}&amp;title={title}', 'addthis', 'scrollbars=yes,menubar=no,resizable=yes,toolbar=no,location=no,status=no,width=620,height=560,left=200,top=100'); return false;" title="addThis : {title}"><img src="{T_IMAGE_PATH}addthis.gif" alt="addThis" /></a>
+									</div>
+								</div>
+							</div>
+							<dl class="postprofile">
+								<dt><b>{L_LINK} :</b><br/> <a href="{link}" title="{title}" ><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a><br/>
+									<b>{L_SOURCE} :</b><br/> <a href="{source/@url}" title="{source}"><img src="{T_IMAGE_PATH}feed-icon.png" alt="{L_2_LINK}" align="middle"/>&#160;<span class="html"><xsl:value-of select="source" disable-output-escaping="yes"/></span></a><br/> 
+									<b>{L_LASTMOD_DATE} :</b><br/> <xsl:value-of select="pubDate" />
+								</dt>
+								<dd> </dd>
+							</dl>
+							<div class="back2top"><a href="{$rss_link}#wrap" class="top" title="{L_BACK_TO_TOP}"></a>{L_BACK_TO_TOP}&#160;</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<br/><hr class="divider" />
+					</xsl:for-each>
+				</xsl:for-each>
+				</div>
+			</div>
+
+<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &#169; 2000 - 2008 phpBB Group</div>
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team.
+-->
+<div class="copyright">{L_COPY}&#160;<a href="http://feedvalidator.org/check.cgi?url={$rss_link}"><img src="{T_IMAGE_PATH}rss-valid.gif" alt="{L_RSS_VALID}" title="{L_RSS_VALID}" /></a></div>
+</body>
+</html>
+</xsl:template>
+<!-- nl2br template for cleaner output, no brs in xml ! -->
+<xsl:template name="nl2br">
+	<xsl:param name="input" />
+		<xsl:choose>
+			<xsl:when test="contains($input,'&#xA;')">
+				<xsl:call-template name="nl2br"><xsl:with-param name="input" select="concat(substring-before($input,'&#xA;'), '&lt;br&gt;',substring-after($input,'&#xA;'))" />
+				</xsl:call-template>
+			</xsl:when>
+		<xsl:otherwise>
+			<xsl:value-of disable-output-escaping="yes" select="$input" />
+		</xsl:otherwise>
+		</xsl:choose>
+</xsl:template>
+</xsl:stylesheet>
Index: styles/prosilver/template/gym_sitemaps/gym_link_body.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/gym_link_body.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/gym_link_body.html	(Premod 3.0.8)
@@ -0,0 +1,114 @@
+<!-- IF HTML_URL or HTML_NEWS_URL --><h2><!-- IF HTML_NEWS_URL --><a href="{HTML_NEWS_URL}" title="{HTML_NEWS_TITLE}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {HTML_NEWS_TITLE}</a> <!-- ENDIF --><!-- IF HTML_URL --><strong>&raquo;</strong> <a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a><!-- ENDIF --></h2>
+<!-- IF HTML_SITEDESC --><span>{HTML_SITEDESC}<br /></span><!-- ENDIF -->
+<!-- ENDIF -->
+<!-- IF GYM_RSS_AGREGATED -->
+	<!-- IF GYM_RSS_SLIDE -->
+	<script type="text/javascript">
+	// <![CDATA[
+		// Message to stop scroller
+		var dn_stopMessage='{L_GYM_RSS_SLIDE_STOP}';
+		// Message to start scroller
+		var dn_startMessage='{L_GYM_RSS_SLIDE_START}';
+		// initial position 
+		var dn_startpos={GYM_RSS_SLIDE_SP_JS}; 			
+		// end position
+		var dn_endpos=-{GYM_RSS_SLIDE_EP}; 			
+		// Speed of scroller higher number = slower scroller 
+		var dn_speed={GYM_RSS_SCRSPEED};				
+		// ID of the news box
+		var dn_newsID='{GYM_RSS_CSSID}';
+		// ID of the generated paragraph
+		var dn_paraID='{GYM_RSS_CSSID}DomID';
+	// ]]>
+	</script>
+	<script type="text/javascript" src="{T_TEMPLATE_PATH}/gym_sitemaps/gym_rss_links.js"></script>
+	<!-- ENDIF -->
+	<!-- IF GYM_CHAN_TITLE --><h3><!-- IF GYM_CHAN_SOURCE --><a href="{GYM_CHAN_SOURCE}" title="{GYM_CHAN_TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{GYM_CHAN_TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a> <strong>&raquo;</strong> <a href="{GYM_CHAN_LINK}" title="{GYM_CHAN_TITLE}">{GYM_CHAN_TITLE}</a><!-- ELSE -->{GYM_CHAN_TITLE}<!-- ENDIF --></h3><!-- ENDIF -->
+	<div class="forumbg">
+		<div class="inner">
+			<span class="corners-top"><span></span></span>
+		<!-- IF not GYM_RSS_DESC -->
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt<!-- IF not GYM_RSS_DATE --> style="width:72%;"<!-- ENDIF -->>{L_GYM_LINKS}</dt>
+						<!-- IF GYM_RSS_AUTHOR --><dd class="views">{L_AUTHOR}</dd><!-- ENDIF -->
+						<!-- IF GYM_RSS_DATE --><dd class="lastpost"><span>{L_FILEDATE}</span></dd><!-- ENDIF -->
+					</dl>
+				</li>
+			</ul>
+			<div class="bg1">
+				<div id="{GYM_RSS_CSSID}">
+					<ul id="{GYM_RSS_CSSID}scrld" class="topiclist topics">
+					<!-- BEGIN gym_link_list -->
+		
+						<li class="row<!-- IF gym_link_list.S_ROW_COUNT is even --> bg1<!-- ELSE --> bg2<!-- ENDIF -->">
+							<dl class="icon" style="background-image: url({gym_link_list.IMG}); background-repeat: no-repeat;">
+								<dt title="{gym_link_list.TITLE}"><a href="{gym_link_list.LINK}" class="topictitle">{gym_link_list.TITLE}</a>
+									<br/><!-- IF gym_link_list.SOURCE --><a href="{gym_link_list.SOURCE}" title="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a><!-- ENDIF --><br/>
+								</dt>
+								<!-- IF gym_link_list.AUTHOR --><dd class="views"><b>{gym_link_list.AUTHOR}</b> <dfn>{L_AUTHOR}</dfn></dd><!-- ENDIF -->
+								<!-- IF gym_link_list.PUBDATE --><dd class="lastpost"><span><dfn>{L_FILEDATE} </dfn>{L_POSTED_ON_DATE} {gym_link_list.PUBDATE}</span></dd><!-- ENDIF -->
+							</dl>
+						</li>
+					<!-- END gym_link_list -->
+					</ul>
+				</div>
+			</div>&nbsp;
+		<!-- ELSE -->
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt>{L_POST}</dt>
+						<dd>&nbsp;</dd>
+					</dl>
+				</li>
+			</ul>
+			<div class="bg1">
+				<div id="{GYM_RSS_CSSID}" style="width:100%;{GYM_RSS_SLIDE_SP}overflow-y:auto;position:relative;overflow-x:hidden;">
+					<div id="{GYM_RSS_CSSID}scrld"  <!-- IF GYM_RSS_SLIDE_SP -->style="width:100%;position:absolute;"<!-- ENDIF -->>
+					<!-- BEGIN gym_link_list -->
+						<div class="post <!-- IF gym_link_list.S_ROW_COUNT is odd -->bg1<!-- ELSE -->bg2<!-- ENDIF -->">
+							<div class="inner">
+								<span class="corners-top"><span></span></span>
+								<div class="postbody">
+									<h3><a href="{gym_link_list.LINK}" title="{gym_link_list.TITLE}">{gym_link_list.TITLE}</a></h3>
+									<!-- IF gym_link_list.AUTHOR --><p class="author">{L_POST_BY_AUTHOR} <b>{gym_link_list.AUTHOR}</b></p><!-- ENDIF -->
+									<div class="content">{gym_link_list.DESC}</div>
+								</div>
+								<dl class="postprofile">
+									<dt>{L_GYM_LINK} : <a href="{gym_link_list.LINK}" title="{gym_link_list.TITLE}">{gym_link_list.TITLE}</a>
+										<!-- IF gym_link_list.SOURCE --><br /><a href="{gym_link_list.SOURCE}" title="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"><img src="{ROOT_PATH}gym_sitemaps/images/feed-icon.png" alt="{gym_link_list.TITLE} - {L_GYM_RSS_SOURCE}"/> {L_GYM_RSS_SOURCE}</a><!-- ENDIF -->
+										<!-- IF gym_link_list.PUBDATE --><br /><span>{L_POSTED_ON_DATE} {gym_link_list.PUBDATE}</span><!-- ENDIF -->
+									</dt>
+									<dd>&nbsp;</dd>
+								</dl>
+								<span class="corners-bottom"><span></span></span>
+							</div>
+						</div>
+					<!-- END gym_link_list -->
+					</div>
+				</div>
+			</div>
+		<!-- ENDIF -->
+			<span class="corners-bottom"><span></span></span>
+		</div>
+	</div>
+<!-- ELSE IF HTML_URL -->
+<div class="forabg">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt style="width:64%;"><a href="{HTML_URL}" title="{HTML_SITENAME}">{HTML_SITENAME}</a></dt>
+				</dl>
+			</li>
+		</ul>
+		<div class="panel">
+			<div class="inner"><span class="corners-top"><span></span></span>
+				<p>{L_HTML_NEWS_NONE}</P>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- ENDIF -->
Index: styles/prosilver/template/gym_sitemaps/display_posts_list.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/display_posts_list.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/display_posts_list.html	(Premod 3.0.8)
@@ -0,0 +1,149 @@
+<!-- IF DISPLAY_POSTS_H1 --><h1 id="news"><!-- IF U_POSTS --><a href="{U_POSTS}" title="{H1_POSTS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {H1_POSTS}</a><!-- ELSE -->{H1_POSTS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_MAP_URL --><a href="{FORUM_MAP_URL}" title="{FORUM_MAP}">{FORUM_MAP}</a><!-- ENDIF --> <strong>&raquo;</strong> <a href="{FORUM_URL}" title="{FORUM_NAME}">{L_FORUM} : {FORUM_NAME}</a></h3><!-- ENDIF -->
+<!-- IF NEWS_DESC --><span>{NEWS_DESC}<br /></span><!-- ENDIF -->
+<!-- IF NEWS_RULES or NEWS_RULES_LINK -->
+	<div class="rules">
+		<div class="inner"><span class="corners-top"><span></span></span>
+		<!-- IF NEWS_RULES_LINK -->
+			<a href="{NEWS_RULES_LINK}">{L_FORUM_RULES}</a>
+		<!-- ELSE -->
+			<strong>{L_FORUM_RULES}</strong><br />
+			{NEWS_RULES}
+		<!-- ENDIF -->
+		<span class="corners-bottom"><span></span></span></div>
+	</div>
+<!-- ENDIF -->
+<!-- IF DISPLAY_PAGINATION -->
+<div class="topic-actions">
+	<div class="pagination">
+		{DISPLAY_TOTAL_TOPICS}
+		<!-- IF DISPLAY_PAGE_NUMBER --><!-- IF DISPLAY_PAGINATION --> &bull; <a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{DISPLAY_PAGE_NUMBER}</a> &bull; <span>{DISPLAY_PAGINATION}</span><!-- ELSE --> &bull; {DISPLAY_PAGE_NUMBER}<!-- ENDIF --><!-- ENDIF -->
+	</div>
+</div>
+<div class="clear"></div>
+<!-- ELSE -->
+<br/>
+<!-- ENDIF -->
+<div class="forumbg">
+	<div class="inner">
+		<span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt style="width:85%;"><!-- IF FORUM_MAP_URL --><a href="{FORUM_MAP_URL}" title="{FORUM_MAP}">{FORUM_MAP}</a> <strong>&raquo;</strong> <!-- ENDIF --><!-- IF U_POSTS --><a href="{U_POSTS}" title="{H1_POSTS}">{H1_POSTS}</a><!-- ELSE -->{H1_POSTS}<!-- ENDIF --></dt>
+					</dl>
+				</li>
+			</ul>
+			<div style="background-color:#fff;padding:2px">
+<!-- BEGIN postrow -->
+	<div id="p{postrow.POST_ID}" class="post <!-- IF postrow.S_ROW_COUNT is odd -->bg1<!-- ELSE -->bg2<!-- ENDIF --><!-- IF postrow.S_UNREAD_POST --> unreadpost<!-- ENDIF --><!-- IF postrow.S_POST_REPORTED --> reported<!-- ENDIF --><!-- IF DISPLAY_USER_INFO --><!-- IF postrow.S_ONLINE --> online<!-- ENDIF --><!-- ENDIF -->">
+		<div class="inner">
+			<span class="corners-top"><span></span></span>
+			<div class="postbody" <!-- IF not DISPLAY_USER_INFO -->style="width:100%;"<!-- ENDIF -->>
+				<!-- IF DISPLAY_POST_BUTTONS -->
+				<!-- IF postrow.U_QUOTE or postrow.U_INFO or postrow.U_DELETE or postrow.U_EDIT -->
+				<ul class="profile-icons">
+					<!-- IF postrow.U_QUOTE --><li class="quote-icon"><a href="{postrow.U_QUOTE}" title="{L_REPLY_WITH_QUOTE}"><span>{L_REPLY_WITH_QUOTE}</span></a></li><!-- ENDIF -->
+					<!-- IF postrow.U_EDIT --><li class="edit-icon"><a href="{postrow.U_EDIT}" title="{L_EDIT_POST}"><span>{L_EDIT_POST}</span></a></li><!-- ENDIF -->
+					<!-- IF postrow.U_DELETE --><li class="delete-icon"><a href="{postrow.U_DELETE}" title="{L_DELETE_POST}"><span>{L_DELETE_POST}</span></a></li><!-- ENDIF -->
+					<!-- IF postrow.U_REPORT --><li class="report-icon"><a href="{postrow.U_REPORT}" title="{L_REPORT_POST}"><span>{L_REPORT_POST}</span></a></li><!-- ENDIF -->
+					<!-- IF postrow.U_WARN --><li class="warn-icon"><a href="{postrow.U_WARN}" title="{L_WARN_USER}"><span>{WARN_USER}</span></a></li><!-- ENDIF -->
+					<!-- IF postrow.U_INFO --><li class="info-icon"><a href="{postrow.U_INFO}" title="{L_INFORMATION}"><span>{L_INFORMATION}</span></a></li><!-- ENDIF -->
+				</ul>
+				<!-- ENDIF -->
+				<!-- ENDIF -->
+				<h3 <!-- IF postrow.S_FIRST_ROW -->class="first"<!-- ENDIF -->><!-- IF postrow.POST_ICON_IMG --><img src="{T_ICONS_PATH}{postrow.POST_ICON_IMG}" width="{postrow.POST_ICON_IMG_WIDTH}" height="{postrow.POST_ICON_IMG_HEIGHT}" alt="{postrow.POST_SUBJECT}" /> <!-- ENDIF --><!-- IF postrow.U_MINI_POST --><a href="{postrow.U_MINI_POST}" title="{postrow.POST_SUBJECT}">{postrow.POST_SUBJECT}</a><!-- ELSE -->{postrow.POST_SUBJECT}<!-- ENDIF --></h3>
+				<!-- IF postrow.POST_AUTHOR_FULL --><p class="author"><a href="{postrow.U_MINI_POST}">{postrow.MINI_POST_IMG}</a>{L_POST_BY_AUTHOR} <strong>{postrow.POST_AUTHOR_FULL}</strong> {L_POSTED_ON_DATE} {postrow.POST_DATE}</p><!-- ENDIF -->
+				<!-- IF postrow.S_POST_UNAPPROVED or postrow.S_POST_REPORTED -->
+				<p class="rules">
+					<!-- IF postrow.S_POST_UNAPPROVED -->{UNAPPROVED_IMG} <a href="{postrow.U_MCP_APPROVE}"><strong>{L_POST_UNAPPROVED}</strong></a><!-- ENDIF -->
+					<!-- IF postrow.S_POST_REPORTED -->{REPORTED_IMG} <a href="{postrow.U_MCP_REPORT}"><strong>{L_POST_REPORTED}</strong></a><!-- ENDIF -->
+				</p>
+				<!-- ENDIF -->
+				<div class="content">{postrow.MESSAGE}</div>
+				<!-- IF postrow.S_HAS_ATTACHMENTS -->
+				<dl class="attachbox">
+					<dt>{L_ATTACHMENTS}</dt>
+					<!-- BEGIN attachment -->
+						<dd>{postrow.attachment.DISPLAY_ATTACHMENT}</dd>
+					<!-- END attachment -->
+				</dl>
+				<!-- ENDIF -->
+				<!-- IF postrow.S_DISPLAY_NOTICE --><div class="rules">{L_DOWNLOAD_NOTICE}</div><!-- ENDIF -->
+				<!-- IF postrow.SIGNATURE --><div id="sig{postrow.POST_ID}" class="signature">{postrow.SIGNATURE}</div><!-- ENDIF -->
+				<!-- IF postrow.U_MINI_POST -->
+				<div class="notice">
+					<strong>{L_HTML_MORE} :</strong> <a href="{postrow.U_MINI_POST}" title="{postrow.POST_SUBJECT}">{postrow.POST_SUBJECT}</a> | <strong>{L_VIEWS} :</strong> {postrow.VIEWS} | <strong>{L_REPLIES} :</strong> {postrow.REPLIES}<!-- IF not S_SINGLE_FORUM and postrow.U_VIEW_FORUM --> | <strong>{L_FORUM} :</strong> <a href="{postrow.U_VIEW_FORUM}" title="{postrow.FORUM_NAME}">{postrow.FORUM_NAME}</a><!-- ENDIF -->
+				</div>
+				<!-- ENDIF -->
+			</div>
+			<!-- IF DISPLAY_USER_INFO -->
+			<!-- IF not postrow.S_IGNORE_POST -->
+			<dl class="postprofile" id="profile{postrow.POST_ID}">
+				<dt>
+					<!-- IF postrow.POSTER_AVATAR -->
+						<!-- IF postrow.U_POST_AUTHOR --><a href="{postrow.U_POST_AUTHOR}">{postrow.POSTER_AVATAR}</a><!-- ELSE -->{postrow.POSTER_AVATAR}<!-- ENDIF --><br />
+					<!-- ENDIF -->
+					<!-- IF not postrow.U_POST_AUTHOR --><strong>{postrow.POST_AUTHOR_FULL}</strong><!-- ELSE -->{postrow.POST_AUTHOR_FULL}<!-- ENDIF -->
+				</dt>
+
+				<!-- IF postrow.RANK_TITLE or postrow.RANK_IMG --><dd>{postrow.RANK_TITLE}<!-- IF postrow.RANK_TITLE and postrow.RANK_IMG --><br /><!-- ENDIF -->{postrow.RANK_IMG}</dd><!-- ENDIF -->
+
+				<dd>&nbsp;</dd>
+
+				<!-- IF postrow.POSTER_POSTS != '' --><dd><strong>{L_POSTS}:</strong> {postrow.POSTER_POSTS}</dd><!-- ENDIF -->
+				<!-- IF postrow.POSTER_JOINED --><dd><strong>{L_JOINED}:</strong> {postrow.POSTER_JOINED}</dd><!-- ENDIF -->
+				<!-- IF postrow.POSTER_FROM --><dd><strong>{L_LOCATION}:</strong> {postrow.POSTER_FROM}</dd><!-- ENDIF -->
+
+				<!-- IF postrow.S_PROFILE_FIELD1 -->
+				<!-- Use a construct like this to include admin defined profile fields. Replace FIELD1 with the name of your field. -->
+				<dd><strong>{postrow.PROFILE_FIELD1_NAME}:</strong> {postrow.PROFILE_FIELD1_VALUE}</dd>
+				<!-- ENDIF -->
+
+				<!-- BEGIN custom_fields -->
+				<dd><strong>{postrow.custom_fields.PROFILE_FIELD_NAME}:</strong> {postrow.custom_fields.PROFILE_FIELD_VALUE}</dd>
+				<!-- END custom_fields -->
+
+				<!-- IF DISPLAY_USER_INFO -->
+				<!-- IF postrow.U_PM or postrow.U_EMAIL or postrow.U_WWW or postrow.U_MSN or postrow.U_ICQ or postrow.U_YIM or postrow.U_AIM -->
+				<dd>
+					<ul class="profile-icons">
+						<!-- IF postrow.U_PM --><li class="pm-icon"><a href="{postrow.U_PM}" title="{L_PRIVATE_MESSAGE}"><span>{L_PRIVATE_MESSAGE}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_EMAIL --><li class="email-icon"><a href="{postrow.U_EMAIL}" title="{L_EMAIL}"><span>{L_EMAIL}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_WWW --><li class="web-icon"><a href="{postrow.U_WWW}" title="{L_VISIT_WEBSITE}: {postrow.U_WWW}"><span>{L_WEBSITE}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_MSN --><li class="msnm-icon"><a href="{postrow.U_MSN}" onclick="popup(this.href, 550, 320); return false;" title="{L_MSNM}"><span>{L_MSNM}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_ICQ --><li class="icq-icon"><a href="{postrow.U_ICQ}" onclick="popup(this.href, 550, 320); return false;" title="{L_ICQ}"><span>{L_ICQ}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_YIM --><li class="yahoo-icon"><a href="{postrow.U_YIM}" onclick="popup(this.href, 780, 550); return false;" title="{L_YIM}"><span>{L_YIM}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_AIM --><li class="aim-icon"><a href="{postrow.U_AIM}" onclick="popup(this.href, 550, 320); return false;" title="{L_AIM}"><span>{L_AIM}</span></a></li><!-- ENDIF -->
+						<!-- IF postrow.U_JABBER --><li class="jabber-icon"><a href="{postrow.U_JABBER}" onclick="popup(this.href, 550, 320); return false;" title="{L_JABBER}"><span>{L_JABBER}</span></a></li><!-- ENDIF -->
+					</ul>
+				</dd>
+				<!-- ENDIF -->
+				<!-- ENDIF -->
+			</dl>
+			<!-- ENDIF -->
+			<!-- ENDIF -->
+			<div class="back2top"><a href="#wrap" class="top" title="{L_BACK_TO_TOP}">{L_BACK_TO_TOP}</a></div>	
+			<span class="corners-bottom"><span></span></span>
+		</div>
+	</div>
+	<hr class="divider" /><br/>
+<!-- BEGINELSE -->
+<div class="panel">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<p>{L_HTML_NEWS_NONE}</p>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- END postrow -->
+		</div><span class="corners-bottom"><span></span></span>
+	</div>
+</div>
+<!-- IF DISPLAY_PAGINATION -->
+<div class="topic-actions">
+	<div class="pagination">
+		{DISPLAY_TOTAL_TOPICS}
+		<!-- IF DISPLAY_PAGE_NUMBER --><!-- IF DISPLAY_PAGINATION --> &bull; <a href="#" onclick="jumpto(); return false;" title="{L_JUMP_TO_PAGE}">{DISPLAY_PAGE_NUMBER}</a> &bull; <span>{DISPLAY_PAGINATION}</span><!-- ELSE --> &bull; {DISPLAY_PAGE_NUMBER}<!-- ENDIF --><!-- ENDIF -->
+	</div>
+</div>
+<div class="clear"></div>
+<!-- ENDIF -->
Index: styles/prosilver/template/gym_sitemaps/gym_google.xsl
===================================================================
--- styles/prosilver/template/gym_sitemaps/gym_google.xsl	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/gym_google.xsl	(Premod 3.0.8)
@@ -0,0 +1,238 @@
+<xsl:stylesheet version="2.0" 
+                xmlns:html="http://www.w3.org/TR/REC-html40"
+                xmlns:sitemap="http://www.sitemaps.org/schemas/sitemap/0.9"
+                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+  
+<xsl:output 
+	method="html" 
+	version="1.0" 
+	encoding="utf-8" 
+	omit-xml-declaration="yes"		
+	doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" 
+	doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
+	indent="yes" />
+
+<!-- Root template -->    
+<xsl:template match="/">
+	<!-- Store in $fileType if we are in a sitemap or in a SitemapIndex -->
+	<xsl:variable name="fileType">
+		<xsl:choose>
+			<xsl:when test="//sitemap:url">Sitemap</xsl:when>
+			<xsl:otherwise>SitemapIndex</xsl:otherwise>
+		</xsl:choose>      
+	</xsl:variable>
+	<xsl:variable name="browser">
+		<xsl:choose><xsl:when test="system-property('xsl:vendor')='Transformiix'">mozilla</xsl:when>
+			<xsl:otherwise>other</xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="sorting">
+		<xsl:choose><xsl:when test="$browser='mozilla'">descending</xsl:when>
+			<xsl:otherwise>ascending</xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="home_link">{ROOT_URL}</xsl:variable>
+
+	<xsl:variable name="sitemap_url">
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:urlset/sitemap:url/sitemap:loc" /></xsl:call-template></xsl:when>
+			<xsl:otherwise></xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="sitemap_title">
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:value-of select="substring-after($sitemap_url, '{ROOT_URL}')"/></xsl:when>
+			<xsl:otherwise></xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>	
+<html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
+<head>
+	<base href="{PHPBB_URL}"/>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
+	<title><xsl:choose>
+			<xsl:when test="$fileType='Sitemap'">{L_SITEMAP} : <xsl:value-of select="$sitemap_title"/></xsl:when>
+			<xsl:otherwise>{L_SITEMAPINDEX}</xsl:otherwise>
+	</xsl:choose></title>
+	<link rel="stylesheet" href="{T_CSS_PATH}" type="text/css"  media="screen, projection"/>
+	<link href="{T_STYLE_PATH}normal.css" rel="stylesheet" type="text/css" title="A" />
+	<link href="{T_STYLE_PATH}medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
+	<link href="{T_STYLE_PATH}large.css" rel="alternate stylesheet" type="text/css" title="A++" />
+	<script type="text/javascript" src="{T_STYLE_PATH}gym_js.js"></script>
+</head>
+      <!-- Body -->
+<body id="phpbb">
+<!--
+	GYM Sitemaps and RSS XSLTransform
+	(C) phpBB SEO - http://www.phpbb-seo.com/
+-->
+		<div id="wrap">
+			<a id="top" name="top" accesskey="t"></a>
+				<div id="page-header">
+					<div class="headerbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div id="site-description"><a href="{$home_link}" title="{L_HOME}" id="logo"><img src="{T_IMAGE_PATH}site_logo.gif" alt="{SITENAME}" /></a>
+								<h1>{SITENAME}</h1>
+								<p>{SITE_DESCRIPTION}</p>
+								<p style="display: none;"><a href="#start_here">{L_SKIP}</a></p>
+							</div>
+							<div id="search-box">
+								<form action="{PHPBB_URL}search.php" method="post" id="search">
+								<fieldset>
+									<input name="keywords" id="keywords" type="text" maxlength="128" title="" class="inputbox search" value="" /> 
+									<input class="button2" value="{L_SEARCH}" type="submit" /><br />
+									<a href="{PHPBB_URL}search.php" title="{L_SEARCH_ADV_EXPLAIN}">{L_SEARCH_ADV}</a>
+								</fieldset>
+								</form>
+							</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<div class="navbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<ul class="linklist navlinks">
+								<li class="icon-home">
+									<a href="{$home_link}" accesskey="h">{L_HOME}</a>
+									<xsl:if test="$home_link != '{PHPBB_URL}'">&#160;<strong>&#8249;</strong>&#160;<a href="{PHPBB_URL}">{L_FORUM_INDEX}</a></xsl:if>
+									<xsl:if test="$fileType='Sitemap'">
+										<xsl:if test="'{PHPBB_URL}' != $sitemap_url">&#160;<strong>&#8249;</strong>&#160;<a href="{$sitemap_url}"><xsl:value-of select="$sitemap_title"/></a></xsl:if>
+									</xsl:if>
+								</li>
+								<li class="rightside"><a href="#" onclick="fontsizeup(); return false;" class="fontsize" title="{L_CHANGE_FONT_SIZE}">{L_CHANGE_FONT_SIZE}</a></li>
+							</ul>
+							<ul class="linklist leftside">
+								<li class="icon-ucp">
+								<xsl:choose>
+									<xsl:when test="$fileType='Sitemap'">{L_SITEMAP_OF} : <a href="{$sitemap_url}"><xsl:value-of select="$sitemap_title"/></a></xsl:when>
+									<xsl:otherwise>{L_SITEMAPINDEX}</xsl:otherwise>
+								</xsl:choose>
+								</li>
+							</ul>
+							<ul class="linklist rightside">
+								<li class="icon-faq"><a href="{PHPBB_URL}faq.php" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>
+								<li class="icon-register"><a href="{PHPBB_URL}ucp.php?mode=register">{L_REGISTER}</a></li>
+							</ul>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+				</div>
+				<a name="start_here"></a>
+				<div id="page-body"><br />
+					<div class="clear"></div>
+					<div class="post bg3">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<xsl:choose>
+								<xsl:when test="$fileType='Sitemap'"><h2><a href="{$sitemap_url}">{L_SITEMAP_OF} : <xsl:value-of select="$sitemap_title"/></a></h2><h4>{L_NUMBER_OF_URL} : <xsl:value-of select="count(sitemap:urlset/sitemap:url)"/></h4></xsl:when>
+								<xsl:otherwise><h2>{L_SITEMAPINDEX}</h2><h4>{L_NUMBER_OF_SITEMAP} : <xsl:value-of select="count(sitemap:sitemapindex/sitemap:sitemap)"/></h4></xsl:otherwise>
+  							</xsl:choose>
+							<br />
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div><br />
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:call-template name="sitemapTable"/></xsl:when>
+			<xsl:otherwise><xsl:call-template name="siteindexTable"/></xsl:otherwise>
+		</xsl:choose>
+	</div>
+</div>
+<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &#169; 2000 - 2010 phpBB Group</div>
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team.
+-->
+<div class="copyright">{L_COPY}</div>
+</body>
+</html>
+</xsl:template>
+
+<!-- siteindexTable template -->
+<xsl:template name="siteindexTable">
+		<div class="forumbg">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt>{L_SITEMAP_URL}</dt>
+						<dd class="lastpost"><span>{L_LASTMOD_DATE}</span></dd>
+					</dl>
+				</li>
+			</ul>
+			<xsl:apply-templates select="sitemap:sitemapindex/sitemap:sitemap"></xsl:apply-templates>  
+			<span class="corners-bottom"><span></span></span></div>
+		</div>       
+</xsl:template>  
+<!-- sitemapTable template -->  
+<xsl:template name="sitemapTable">
+		<div class="forumbg">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt>{L_LINK}</dt>
+						<dd class="topics">{L_PRIORITY}</dd>
+						<dd class="posts">{L_CHANGEFREQ}</dd>
+						<dd class="lastpost"><span>{L_LASTMOD_DATE}</span></dd>
+					</dl>
+				</li>
+			</ul>
+			<xsl:apply-templates select="sitemap:urlset/sitemap:url"></xsl:apply-templates>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+</xsl:template>
+<!-- sitemap:url template -->  
+<xsl:template match="sitemap:url">
+	<ul class="topiclist forums">
+		<li class="row">
+			<dl class="icon" style="background-image: url({T_IMAGE_PATH}forum_read.gif); background-repeat: no-repeat;">
+				<dt style="overflow:hidden">
+					<xsl:variable name="sitemapURL"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:loc" /></xsl:call-template></xsl:variable>
+					<a href="{$sitemapURL}" class="topictitle"><span><xsl:call-template name="hreftitle"><xsl:with-param name="input" select="$sitemapURL" /></xsl:call-template></span></a>
+				</dt>
+				<dd class="topics"><span><xsl:value-of select="sitemap:priority"/></span></dd>
+				<dd class="posts"><span><xsl:value-of select="sitemap:changefreq"/></span></dd>
+				<dd class="lastpost"><span><xsl:value-of select="sitemap:lastmod" /></span></dd>
+			</dl>
+		</li>
+	</ul>
+</xsl:template>
+<!-- sitemap:sitemap template -->
+<xsl:template match="sitemap:sitemap">
+	<ul class="topiclist forums">
+		<li class="row">
+			<dl class="icon" style="background-image: url({T_IMAGE_PATH}topic_read.gif); background-repeat: no-repeat;">
+				<dt style="overflow:hidden">
+					<xsl:variable name="sitemapURL"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:loc" /></xsl:call-template></xsl:variable>
+					<a href="{$sitemapURL}" class="forumtitle"><span><xsl:call-template name="hreftitle"><xsl:with-param name="input" select="$sitemapURL" /></xsl:call-template></span></a>
+				</dt>
+				<dd class="lastpost"><span><xsl:value-of select="sitemap:lastmod" /></span></dd>
+			</dl>
+		</li>
+	</ul>
+</xsl:template>
+<!-- http template to preserve SSL navigation when ssl is not forced (if so, the xml source only uses http) -->
+<xsl:template name="http">
+	<xsl:param name="input" />
+	<xsl:choose>
+		<xsl:when test="contains($input, '{HTTP_PROTO_REQUEST}')"><xsl:value-of select="$input"/></xsl:when>
+		<xsl:otherwise>
+			<xsl:choose>
+				<xsl:when test="contains($input, 'http://')"><xsl:value-of select="concat('{HTTP_PROTO_REQUEST}', substring-after($input, 'http://'))"/></xsl:when>
+				<xsl:otherwise><xsl:value-of select="concat('{HTTP_PROTO_REQUEST}', substring-after($input, 'https://'))"/></xsl:otherwise>
+			</xsl:choose>
+		</xsl:otherwise>
+	</xsl:choose>
+</xsl:template>
+<!-- title template : use nicer titles in href links ! -->
+<xsl:template name="hreftitle">
+	<xsl:param name="input" />
+	<xsl:choose>
+		<xsl:when test="contains($input, '{ROOT_URL}')"><xsl:value-of select="substring-after($input, '{ROOT_URL}')"/></xsl:when>
+		<xsl:otherwise><xsl:value-of select="substring-after($input, '{HTTP_PROTO_REQUEST}')"/></xsl:otherwise>
+	</xsl:choose>
+</xsl:template>
+</xsl:stylesheet>
Index: styles/prosilver/template/gym_sitemaps/display_forums_list.html
===================================================================
--- styles/prosilver/template/gym_sitemaps/display_forums_list.html	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/display_forums_list.html	(Premod 3.0.8)
@@ -0,0 +1,73 @@
+<!-- IF DISPLAY_FORUMS_H1 --><h1><!-- IF U_FORUMS --><a href="{U_FORUMS}" title="{H1_FORUMS}">{H1_FORUMS}</a><!-- ELSE -->{H1_FORUMS}<!-- ENDIF --></h1><!-- ENDIF -->
+<!-- IF FORUM_MAP_URL or FORUM_NEWS_URL --><h3><!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {FORUM_NEWS}</a><!-- ENDIF --><!-- IF FORUM_MAP_URL --> <strong>&raquo;</strong> <a href="{FORUM_MAP_URL}" title="{H1_FORUMS}">{H1_FORUMS}</a><!-- ENDIF --></h3><!-- ENDIF -->
+<!-- IF MAP_DESC --><span>{MAP_DESC}<br /></span><!-- ENDIF --><br />
+<!-- BEGIN forumrow -->
+	<!-- IF (forumrow.S_IS_CAT and not forumrow.S_FIRST_ROW) or forumrow.S_NO_CAT  -->
+			</ul>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<!-- ENDIF -->
+
+	<!-- IF forumrow.S_IS_CAT or forumrow.S_FIRST_ROW  or forumrow.S_NO_CAT  -->
+		<div class="forabg">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt <!-- IF DISPLAY_LAST_POST -->style="width:64%;"<!-- ENDIF -->><!-- IF forumrow.S_IS_CAT --><!-- IF forumrow.FORUM_NEWS_LINK -->{forumrow.FORUM_NEWS_LINK} <!-- ENDIF -->
+					<!-- IF forumrow.FORUM_MAP_LINK --> &nbsp; {forumrow.FORUM_MAP_LINK}<br /><!-- ENDIF --><!-- ELSE -->{L_FORUM}<!-- ENDIF --></dt>
+						<!-- IF DISPLAY_LAST_POST --><dd class="lastpost"><span>{L_LAST_POST}</span></dd><!-- ENDIF -->
+					</dl>
+				</li>
+			</ul>
+			<ul class="topiclist forums">
+	<!-- ENDIF -->
+
+	<!-- IF not forumrow.S_IS_CAT -->
+		<li class="row<!-- IF forumrow.S_ROW_COUNT is even --> bg1<!-- ELSE --> bg2<!-- ENDIF -->">
+			<dl class="icon" style="background-image: url({forumrow.FORUM_FOLDER_IMG_SRC}); background-repeat: no-repeat;">
+				<dt title="{forumrow.FORUM_FOLDER_IMG_ALT}" <!-- IF DISPLAY_LAST_POST -->style="width:63%;"<!-- ELSE -->style="width:85%;"<!-- ENDIF -->>
+					<!-- IF forumrow.FORUM_IMAGE --><span class="forum-image">{forumrow.FORUM_IMAGE}</span><!-- ENDIF -->
+					<!-- IF forumrow.FORUM_NEWS_LINK -->{forumrow.FORUM_NEWS_LINK} <!-- ENDIF -->
+					<!-- IF forumrow.FORUM_MAP_LINK --> &nbsp; {forumrow.FORUM_MAP_LINK}<!-- ENDIF --><br />
+					{forumrow.FORUM_DESC}<br />
+					<!-- IF forumrow.MODERATORS -->
+						<br /><strong>{forumrow.L_MODERATOR_STR}:</strong> {forumrow.MODERATORS}
+					<!-- ENDIF -->
+				</dt>
+				<!-- IF DISPLAY_LAST_POST and not forumrow.S_IS_LINK -->
+					<dd class="lastpost"><span>
+						<!-- IF forumrow.LAST_POST_TIME --><dfn>{L_LAST_POST}</dfn><!-- IF forumrow.LAST_POST_LINK --><i>{forumrow.LAST_POST_LINK}</i><br/><!-- ENDIF --><!-- IF DISPLAY_USER_INFO --> {L_POST_BY_AUTHOR} {forumrow.LAST_POSTER_FULL}<!-- ENDIF -->
+						<a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a> {L_POSTED_ON_DATE} {forumrow.LAST_POST_TIME}<!-- ELSE -->{L_NO_POSTS}<!-- ENDIF --></span>
+					</dd>
+				<!-- ENDIF -->
+			</dl>
+			<!-- IF forumrow.SUBFORUMS --><div class="gymsublist"><b>{L_SUBFORUMS} :</b><hr/>{forumrow.SUBFORUMS}</div><!-- ENDIF -->
+		</li>
+	<!-- ENDIF -->
+
+	<!-- IF forumrow.S_LAST_ROW -->
+			</ul>
+
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<!-- ENDIF -->
+
+<!-- BEGINELSE -->
+<div class="forabg">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt style="width:64%;"><!-- IF FORUM_NEWS_URL --><a href="{FORUM_NEWS_URL}" title="{FORUM_NEWS}"><img src="{NEWS_IMG_SRC}" alt="{L_HTML_NEWS}"/> {FORUM_NEWS}</a><!-- ENDIF --><!-- IF FORUM_MAP_URL --> <strong>&raquo;</strong> <a href="{FORUM_MAP_URL}" title="{H1_FORUMS}">{H1_FORUMS}</a><br /><!-- ENDIF --></dt>
+				</dl>
+			</li>
+		</ul>
+		<div class="panel">
+			<div class="inner"><span class="corners-top"><span></span></span>
+				<p>{L_HTML_MAP_NONE}</p>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- END forumrow -->
Index: styles/prosilver/template/gym_sitemaps/gym_rss_links.js
===================================================================
--- styles/prosilver/template/gym_sitemaps/gym_rss_links.js	(phpBB 3.0.8)
+++ styles/prosilver/template/gym_sitemaps/gym_rss_links.js	(Premod 3.0.8)
@@ -0,0 +1,96 @@
+/**
+* gym_rss_links.js Dom scrolling
+* Based on
+* DOMnews 1.0 
+* homepage: http://www.onlinetools.org/tools/domnews/
+* released 11.07.05
+*/
+var dn_interval = 0;
+/* Initialise scroller when window loads */
+// check for DOM
+if(document.getElementById && document.createTextNode) {
+	onload_functions.push('initDOMnews()');
+	onunload_functions.push('clearInterval(dn_interval)');
+}
+var dn_scrollpos=dn_startpos;
+var dn_paused=false;
+var dn_els = '';
+var dn_inels = '';
+var dn_interval = '';
+/* Initialise scroller */
+function initDOMnews(reinit) {
+	if(!dn_els) {
+		dn_els = document.getElementById(dn_newsID);
+		if(!dn_els){
+			return;
+		}
+		dn_inels = document.getElementById(dn_newsID+'scrld');
+		if(!dn_inels){
+			return;
+		}
+		// Auto height for Gecko browsers
+		if (document.defaultView) {
+			dn_els.style.cssText = '';
+			dn_inels.style.cssText = '';
+			var real_endpos = document.defaultView.getComputedStyle(dn_els,"").getPropertyValue("height");
+			real_endpos = parseInt(real_endpos.replace(/px/ig, ""));
+			if (real_endpos) {
+				dn_endpos = - real_endpos;
+			}
+		}	
+	}
+	if (reinit) {
+		dn_els.parentNode.removeChild(dn_els.nextSibling);
+		clearInterval(dn_interval);
+	}
+	dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow:hidden;position:relative;';
+	dn_inels.style.cssText = 'width:100%; position:relative; top:'+dn_startpos+'px;';
+	dn_interval=setInterval('scrollDOMnews()',dn_speed);
+	var newa=document.createElement('a');
+	var newp=document.createElement('p');
+	newp.setAttribute('id',dn_paraID);
+	newa.href='#' + dn_newsID;
+	newa.appendChild(document.createTextNode(dn_stopMessage));
+	newa.onclick=stopDOMnews;
+	newp.appendChild(newa);
+	dn_els.parentNode.insertBefore(newp,dn_els.nextSibling);
+	if (!dn_paused) {
+		dn_inels.style.cssText = 'width:100%;position:absolute; top:'+dn_startpos+'px;';
+		dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow:hidden;position:relative;';
+	}
+	dn_els.onmouseover=function() {		
+		clearInterval(dn_interval);
+	}
+	dn_els.onmouseout=function() {
+		if (!dn_paused) {
+			dn_interval=setInterval('scrollDOMnews()',dn_speed);
+		}
+	}
+}
+function ReinitDOMnews() {
+	dn_paused= dn_paused ? false : true;
+	initDOMnews(true);
+}
+function stopDOMnews() {
+	dn_paused = true;
+	clearInterval(dn_interval);
+	dn_inels.style.cssText = 'width:100%;position:absolute;';
+	dn_els.style.cssText = 'width:100%;height:'+dn_startpos+'px;overflow-y:auto;overflow-x:hidden;position:relative;';
+	dn_els.parentNode.removeChild(dn_els.nextSibling);
+	var newa=document.createElement('a');
+	var newp=document.createElement('p');
+	newp.setAttribute('id',dn_paraID);
+	newa.href='#' + dn_newsID;
+	newa.appendChild(document.createTextNode(dn_startMessage));
+	newa.onclick=ReinitDOMnews;
+	newp.appendChild(newa);
+	dn_els.parentNode.insertBefore(newp,dn_els.nextSibling);
+	return false;
+}
+function scrollDOMnews() {
+	dn_inels.style.top=dn_scrollpos+'px';	
+	if(dn_scrollpos==dn_endpos) {
+		dn_scrollpos=dn_startpos;
+	}
+	dn_scrollpos--;	
+}
Index: styles/prosilver/template/posting_editor.html
===================================================================
--- styles/prosilver/template/posting_editor.html	(revision 1)
+++ styles/prosilver/template/posting_editor.html	(Premod 3.0.8)
@@ -105,6 +105,12 @@
 		<dt><label for="subject">{L_SUBJECT}:</label></dt>
 		<dd><input type="text" name="subject" id="subject" size="45" maxlength="<!-- IF S_NEW_MESSAGE -->60<!-- ELSE -->64<!-- ENDIF -->" tabindex="2" value="{SUBJECT}{DRAFT_SUBJECT}" class="inputbox autowidth" /></dd>
 	</dl>
+	<!-- IF S_URL -->
+	<dl style="clear: left;">
+		<dt><label for="url">URL:</label></dt>
+			<dd><input type="text" name="url" id="url" size="45" maxlength="250" tabindex="2" value="{TOPIC_URL}" class="inputbox autowidth" /></dd>
+	</dl>
+	<!-- ENDIF -->
 	<!-- IF CAPTCHA_TEMPLATE and S_CONFIRM_CODE -->
 		<!-- DEFINE $CAPTCHA_TAB_INDEX = 3 -->
 		<!-- INCLUDE {CAPTCHA_TEMPLATE} -->
Index: styles/prosilver/template/forumlist_body.html
===================================================================
--- styles/prosilver/template/forumlist_body.html	(revision 1)
+++ styles/prosilver/template/forumlist_body.html	(Premod 3.0.8)
@@ -44,8 +44,8 @@
 					<dd class="posts">{forumrow.POSTS} <dfn>{L_POSTS}</dfn></dd>
 					<dd class="lastpost"><span>
 						<!-- IF forumrow.U_UNAPPROVED_TOPICS --><a href="{forumrow.U_UNAPPROVED_TOPICS}">{UNAPPROVED_IMG}</a><!-- ENDIF -->
-						<!-- IF forumrow.LAST_POST_TIME --><dfn>{L_LAST_POST}</dfn> {L_POST_BY_AUTHOR} {forumrow.LAST_POSTER_FULL}
-						<!-- IF not S_IS_BOT --><a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a> <!-- ENDIF --><br />{forumrow.LAST_POST_TIME}<!-- ELSE -->{L_NO_POSTS}<br />&nbsp;<!-- ENDIF --></span>
+						<!-- IF forumrow.LAST_POST_TIME --><dfn>{L_LAST_POST}</dfn><!-- IF forumrow.LAST_POST_LINK --><i>{forumrow.LAST_POST_LINK}</i><br/><!-- ENDIF --> {L_POST_BY_AUTHOR} {forumrow.LAST_POSTER_FULL}
+						<a href="{forumrow.U_LAST_POST}">{LAST_POST_IMG}</a><br />{forumrow.LAST_POST_TIME}<!-- ELSE -->{L_NO_POSTS}<br />&nbsp;<!-- ENDIF --></span>
 					</dd>
 				<!-- ENDIF -->
 			</dl>
Index: styles/prosilver/template/search_body.html
===================================================================
--- styles/prosilver/template/search_body.html	(revision 1)
+++ styles/prosilver/template/search_body.html	(Premod 3.0.8)
@@ -125,4 +125,4 @@
 </div>
 <!-- ENDIF -->
 
-<!-- INCLUDE overall_footer.html -->
+<!-- INCLUDE overall_footer.html -->
\ No newline at end of file
Index: styles/prosilver/template/forum_fn.js
===================================================================
--- styles/prosilver/template/forum_fn.js	(revision 1)
+++ styles/prosilver/template/forum_fn.js	(Premod 3.0.8)
@@ -19,22 +19,83 @@
 /**
 * Jump to page
 */
-function jumpto()
-{
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+function jumpto() {
 	var page = prompt(jump_page, on_page);
 
-	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
-	{
-		if (base_url.indexOf('?') == -1)
-		{
-			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
+	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0) {
+		var seo_page = (page - 1) * per_page;
+		var anchor = '';
+		var anchor_parts = base_url.split('#');
+		if ( anchor_parts[1] ) {
+			base_url = anchor_parts[0];
+			anchor = '#' + anchor_parts[1];
 		}
-		else
-		{
-			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
+		if ( base_url.indexOf('?') >= 0 ) {
+			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + seo_page + anchor;
+		} else if ( seo_page > 0 ) {
+			var seo_type1 = base_url.match(/\.[a-z0-9]+$/i);
+			if (seo_type1 !== null) {
+				document.location.href = base_url.replace(/\.[a-z0-9]+$/i, '') + seo_delim_start + seo_page + seo_type1 + anchor;
+			}
+			var seo_type2 = base_url.match(/\/$/);
+			if (seo_type2 !== null) {
+				document.location.href = base_url + seo_static_pagination + seo_page + seo_ext_pagination + anchor;
+			}
+		} else {
+			document.location.href = base_url + anchor;
 		}
 	}
 }
+// Open external links in new window in a XHTML 1.x compliant way.
+/**
+*  phpbb_seo_href()
+*  Fixes href="#something" links with virtual directories
+*  Optionally open external or marked with a css class links in a new window
+*  in a XHTML 1.x compliant way.
+*/
+function phpbb_seo_href() {
+	var current_domain = document.domain.toLowerCase();
+	if (!current_domain || !document.getElementsByTagName) return;
+	if (seo_external_sub && current_domain.indexOf('.') >= 0) {
+		current_domain = current_domain.replace(new RegExp(/^[a-z0-9_-]+\.([a-z0-9_-]+\.([a-z]{2,6}|[a-z]{2,3}\.[a-z]{2,3}))$/i), '$1');
+	}
+	if (seo_ext_classes) {
+		var extclass = new RegExp("(^|\s)(" + seo_ext_classes + ")(\s|$)");
+	}
+	if (seo_hashfix) {
+		var basehref = document.getElementsByTagName('base')[0];
+		if (basehref) {
+			basehref = basehref.href;
+			var hashtest = new RegExp("^(" + basehref + "|)#[a-z0-9_-]+$");
+			var current_href = document.location.href.replace(/#[a-z0-9_-]+$/i, "");
+		} else {
+			seo_hashfix = false;
+		}
+	}
+	var hrefels = document.getElementsByTagName("a");
+	var hrefelslen = hrefels.length;
+	for (var i = 0; i < hrefelslen; i++) {
+		var el = hrefels[i];
+		var hrefinner = el.innerHTML.toLowerCase();
+		if (el.onclick || (el.href == '') || (el.href.indexOf('javascript') >=0 ) || (el.href.indexOf('mailto') >=0 ) || (hrefinner.indexOf('<a') >= 0) ) {
+			continue;
+		}
+		if (seo_hashfix && el.hash && hashtest.test(el.href)) {
+			el.href = current_href + el.hash;
+		}
+		if (seo_external) {
+			if ((el.href.indexOf(current_domain) >= 0) && !(seo_ext_classes && extclass.test(el.className))) {
+				continue;
+			}
+			el.onclick = function () { window.open(this.href); return false; };
+		}
+	}
+}
+if (seo_external || seo_hashfix) {
+	onload_functions.push('phpbb_seo_href()');
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 
 /**
 * Mark/unmark checklist
Index: styles/prosilver/template/viewtopic_body.html
===================================================================
--- styles/prosilver/template/viewtopic_body.html	(revision 1)
+++ styles/prosilver/template/viewtopic_body.html	(Premod 3.0.8)
@@ -135,7 +135,7 @@
 			<!-- ENDIF -->
 		<!-- ENDIF -->
 
-			<h3 <!-- IF postrow.S_FIRST_ROW -->class="first"<!-- ENDIF -->><!-- IF postrow.POST_ICON_IMG --><img src="{T_ICONS_PATH}{postrow.POST_ICON_IMG}" width="{postrow.POST_ICON_IMG_WIDTH}" height="{postrow.POST_ICON_IMG_HEIGHT}" alt="" /> <!-- ENDIF --><a href="#p{postrow.POST_ID}">{postrow.POST_SUBJECT}</a></h3>
+			<h3 <!-- IF postrow.S_FIRST_ROW -->class="first"<!-- ENDIF -->><!-- IF postrow.POST_ICON_IMG --><img src="{T_ICONS_PATH}{postrow.POST_ICON_IMG}" width="{postrow.POST_ICON_IMG_WIDTH}" height="{postrow.POST_ICON_IMG_HEIGHT}" alt="" /> <!-- ENDIF --><a href="{U_VIEW_TOPIC}#p{postrow.POST_ID}">{postrow.POST_SUBJECT}</a></h3>
 			<p class="author"><!-- IF S_IS_BOT -->{postrow.MINI_POST_IMG}<!-- ELSE --><a href="{postrow.U_MINI_POST}">{postrow.MINI_POST_IMG}</a><!-- ENDIF -->{L_POST_BY_AUTHOR} <strong>{postrow.POST_AUTHOR_FULL}</strong> &raquo; {postrow.POST_DATE} </p>
 
 			<!-- IF postrow.S_POST_UNAPPROVED or postrow.S_POST_REPORTED -->
@@ -215,7 +215,7 @@
 		</dl>
 	<!-- ENDIF -->
 
-		<div class="back2top"><a href="#wrap" class="top" title="{L_BACK_TO_TOP}">{L_BACK_TO_TOP}</a></div>
+		<div class="back2top"><a href="{U_VIEW_TOPIC}#wrap" class="top" title="{L_BACK_TO_TOP}">{L_BACK_TO_TOP}</a></div>
 
 		<span class="corners-bottom"><span></span></span></div>
 	</div>
@@ -266,7 +266,42 @@
 	</fieldset>
 	</form>
 <!-- ENDIF -->
+<!-- IF S_RELATED_RESULTS --><div class="clear">&nbsp;</div><br /><br />
+<div class="forumbg">
+	<div class="inner"><span class="corners-top"><span></span></span>
+		<ul class="topiclist">
+			<li class="header">
+				<dl class="icon">
+					<dt>{L_RELATED_TOPICS}</dt>
+					<dd class="posts">{L_REPLIES}</dd>
+					<dd class="views">{L_VIEWS}</dd>
+					<dd class="lastpost"><span>{L_LAST_POST}</span></dd>
+				</dl>
+			</li>
+		</ul>
 
+	<ul class="topiclist forums">
+	<!-- BEGIN related -->
+	<li class="row bg1<!-- IF related.S_POST_ANNOUNCE --> announce<!-- ENDIF --><!-- IF related.S_POST_STICKY --> sticky<!-- ENDIF --><!-- IF related.S_TOPIC_REPORTED --> reported<!-- ENDIF -->">
+		<dl class="icon" style="background-image: url({related.TOPIC_FOLDER_IMG_SRC}); background-repeat: no-repeat;">
+			<dt <!-- IF related.TOPIC_ICON_IMG and S_TOPIC_ICONS --> style="background-image: url({T_ICONS_PATH}{related.TOPIC_ICON_IMG}); background-repeat: no-repeat;"<!-- ENDIF -->><!-- IF related.S_UNREAD_TOPIC --><a href="{related.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF --><a class="topictitle" href="{related.U_TOPIC}" title="{related.TOPIC_TITLE} : {related.FORUM}">{related.TOPIC_TITLE}</a>
+			<!-- IF related.S_TOPIC_UNAPPROVED --><a href="{related.U_MCP_QUEUE}">{UNAPPROVED_IMG}</a> <!-- ENDIF -->
+			<!-- IF related.S_TOPIC_REPORTED --><a href="{related.U_MCP_REPORT}">{REPORTED_IMG}</a><!-- ENDIF --><br />
+			<!-- IF related.PAGINATION --><strong class="pagination"><span>{related.PAGINATION}</span></strong><!-- ENDIF -->
+			<!-- IF related.ATTACH_ICON_IMG -->{related.ATTACH_ICON_IMG} <!-- ENDIF -->{L_POST_BY_AUTHOR} {related.TOPIC_AUTHOR_FULL} &raquo; {related.FIRST_POST_TIME}
+			</dt>
+			<dd class="posts">{related.REPLIES} <dfn>{L_REPLIES}</dfn></dd>
+			<dd class="views">{related.VIEWS} <dfn>{L_VIEWS}</dfn></dd>
+			<dd class="lastpost"><span><dfn>{L_LAST_POST} </dfn>{L_POST_BY_AUTHOR} {related.LAST_POST_AUTHOR_FULL}
+				<a href="{related.U_LAST_POST}">{LAST_POST_IMG}</a><br />{related.LAST_POST_TIME}
+				<!-- IF related.U_FORUM and not related.S_POST_GLOBAL --><br /><a class="topictitle" href="{related.U_FORUM}" title="{related.FORUM}">{related.FORUM}</a><!-- ENDIF --></span></dd>
+		</dl>
+	</li>
+	<!-- END related -->
+	</ul>
+	<span class="corners-bottom"><span></span></span></div>
+</div>
+<!-- ENDIF -->
 <!-- IF S_DISPLAY_ONLINE_LIST -->
 	<h3><!-- IF U_VIEWONLINE --><a href="{U_VIEWONLINE}">{L_WHO_IS_ONLINE}</a><!-- ELSE -->{L_WHO_IS_ONLINE}<!-- ENDIF --></h3>
 	<p>{LOGGED_IN_USER_LIST}</p>
Index: styles/prosilver/template/viewforum_body.html
===================================================================
--- styles/prosilver/template/viewforum_body.html	(revision 1)
+++ styles/prosilver/template/viewforum_body.html	(Premod 3.0.8)
@@ -1,7 +1,7 @@
 <!-- INCLUDE overall_header.html -->
 <!-- IF U_MCP --><p>[&nbsp;<a href="{U_MCP}">{L_MCP}</a>&nbsp;]</p><!-- ENDIF -->
 <h2><a href="{U_VIEW_FORUM}">{FORUM_NAME}</a></h2>
-
+<!-- IF GYM_LINKS_CAT --><h3>{GYM_HTML_FORUM_NEWS_LINK} {GYM_HTML_FORUM_MAP_LINK} {GYM_RSS_FORUM_LINK} {GYM_GOOGLE_FORUM_LINK}</h3><!-- ENDIF -->
 <!-- IF FORUM_DESC or MODERATORS or U_MCP -->
 <div>
 	<!-- NOTE: remove the style="display: none" when you want to have the forum description on the forum body -->
@@ -148,7 +148,7 @@
 				<dd class="posts">{topicrow.REPLIES} <dfn>{L_REPLIES}</dfn></dd>
 				<dd class="views">{topicrow.VIEWS} <dfn>{L_VIEWS}</dfn></dd>
 				<dd class="lastpost"><span><dfn>{L_LAST_POST} </dfn>{L_POST_BY_AUTHOR} {topicrow.LAST_POST_AUTHOR_FULL}
-					<!-- IF not S_IS_BOT --><a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a> <!-- ENDIF --><br />{topicrow.LAST_POST_TIME}</span>
+					<a href="{topicrow.U_LAST_POST}">{LAST_POST_IMG}</a> <br />{topicrow.LAST_POST_TIME}</span>
 				</dd>
 			</dl>
 		</li>
@@ -216,4 +216,4 @@
 	<p><!-- BEGIN rules -->{rules.RULE}<br /><!-- END rules --></p>
 <!-- ENDIF -->
 
-<!-- INCLUDE overall_footer.html -->
\ No newline at end of file
+<!-- INCLUDE overall_footer.html -->
Index: styles/prosilver/template/simple_header.html
===================================================================
--- styles/prosilver/template/simple_header.html	(revision 1)
+++ styles/prosilver/template/simple_header.html	(Premod 3.0.8)
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
 <head>
-
+{SEO_BASE_HREF}
 <meta http-equiv="content-type" content="text/html; charset={S_CONTENT_ENCODING}" />
 <meta http-equiv="content-style-type" content="text/css" />
 <meta http-equiv="content-language" content="{S_USER_LANG}" />
@@ -25,6 +25,15 @@
 	var onload_functions = new Array();
 	var onunload_functions = new Array();
 	var style_cookie_settings = '{A_COOKIE_SETTINGS}';
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	var seo_delim_start = '{SEO_START_DELIM}';
+	var seo_static_pagination = '{SEO_SATIC_PAGE}';
+	var seo_ext_pagination = '{SEO_EXT_PAGE}';
+	var seo_external = {SEO_EXTERNAL};
+	var seo_external_sub = {SEO_EXTERNAL_SUB};
+	var seo_ext_classes = {SEO_EXT_CLASSES};
+	var seo_hashfix = {SEO_HASHFIX};
+	// www.phpBB-SEO.com SEO TOOLKIT END
 
 	/**
 	* New function for handling multiple calls to window.onload and window.unload by pentapenguin
Index: styles/prosilver/template/overall_footer.html
===================================================================
--- styles/prosilver/template/overall_footer.html	(revision 1)
+++ styles/prosilver/template/overall_footer.html	(Premod 3.0.8)
@@ -5,7 +5,7 @@
 	<div class="navbar">
 		<div class="inner"><span class="corners-top"><span></span></span>
 
-		<ul class="linklist">
+		<ul class="linklist<!-- IF GYM_LINKS --> navlinks<!-- ENDIF -->">
 			<li class="icon-home"><a href="{U_INDEX}" accesskey="h">{L_INDEX}</a></li>
 				<!-- IF not S_IS_BOT -->
 					<!-- IF S_WATCH_FORUM_LINK --><li <!-- IF S_WATCHING_FORUM -->class="icon-unsubscribe"<!-- ELSE -->class="icon-subscribe"<!-- ENDIF -->><a href="{S_WATCH_FORUM_LINK}" title="{S_WATCH_FORUM_TITLE}">{S_WATCH_FORUM_TITLE}</a></li><!-- ENDIF -->
@@ -15,7 +15,15 @@
 				<!-- ENDIF -->
 			<li class="rightside"><!-- IF U_TEAM --><a href="{U_TEAM}">{L_THE_TEAM}</a> &bull; <!-- ENDIF --><!-- IF not S_IS_BOT --><a href="{U_DELETE_COOKIES}">{L_DELETE_COOKIES}</a> &bull; <!-- ENDIF -->{S_TIMEZONE}</li>
 		</ul>
-
+		<!-- IF GYM_LINKS -->
+		<ul class="linklist">
+			<!-- IF GYM_HTML_NEWS_LINK --><li class="leftside">{GYM_HTML_NEWS_LINK}</li><!-- ENDIF -->
+			<!-- IF GYM_HTML_MAP_LINK --><li class="leftside">{GYM_HTML_MAP_LINK}</li><!-- ENDIF -->
+			<!-- IF GYM_GOOGLE_LINK --><li class="leftside">{GYM_GOOGLE_LINK}</li><!-- ENDIF -->
+			<!-- IF GYM_RSS_LINK --><li class="leftside">{GYM_RSS_LINK}</li><!-- ENDIF -->
+			<!-- IF GYM_RSS_CHAN_LINK --><li class="leftside">{GYM_RSS_CHAN_LINK}</li><!-- ENDIF -->
+		</ul>
+		<!-- ENDIF -->
 		<span class="corners-bottom"><span></span></span></div>
 	</div>
 
Index: styles/prosilver/template/attachment.html
===================================================================
--- styles/prosilver/template/attachment.html	(revision 1)
+++ styles/prosilver/template/attachment.html	(Premod 3.0.8)
@@ -6,7 +6,7 @@
 
 		<!-- IF _file.S_THUMBNAIL -->
 		<dl class="thumbnail">
-			<dt><a href="{_file.U_DOWNLOAD_LINK}"><img src="{_file.THUMB_IMAGE}" alt="{_file.DOWNLOAD_NAME}" title="{_file.DOWNLOAD_NAME} ({_file.FILESIZE} {_file.SIZE_LANG}) {_file.L_DOWNLOAD_COUNT}" /></a></dt>
+			<dt><a href="{_file.U_DOWNLOAD_LINK}"><img src="{_file.THUMB_IMAGE}" alt="{_file.DOWNLOAD_NAME}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / {_file.DOWNLOAD_NAME}<!-- ELSE -->{_file.DOWNLOAD_NAME} ({_file.FILESIZE} {_file.SIZE_LANG}) {_file.L_DOWNLOAD_COUNT}<!-- ENDIF -->" /></a></dt>
 			<!-- IF _file.COMMENT --><dd> {_file.COMMENT}</dd><!-- ENDIF -->
 		</dl>
 		<!-- ENDIF -->
@@ -14,7 +14,7 @@
 
 		<!-- IF _file.S_IMAGE -->
 		<dl class="file">
-			<dt class="attach-image"><img src="{_file.U_INLINE_LINK}" alt="{_file.DOWNLOAD_NAME}" onclick="viewableArea(this);" /></dt>
+			<dt class="attach-image"><img src="{_file.U_INLINE_LINK}" alt="{_file.DOWNLOAD_NAME}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / <!-- ENDIF -->{_file.DOWNLOAD_NAME}" onclick="viewableArea(this);" /></dt>
 			<!-- IF _file.COMMENT --><dd><em>{_file.COMMENT}</em></dd><!-- ENDIF -->
 			<dd>{_file.DOWNLOAD_NAME} ({_file.FILESIZE} {_file.SIZE_LANG}) {_file.L_DOWNLOAD_COUNT}</dd>
 		</dl>
@@ -22,7 +22,7 @@
 
 		<!-- IF _file.S_FILE -->
 		<dl class="file">
-			<dt><!-- IF _file.UPLOAD_ICON -->{_file.UPLOAD_ICON} <!-- ENDIF --><a class="postlink" href="{_file.U_DOWNLOAD_LINK}">{_file.DOWNLOAD_NAME}</a></dt>
+			<dt><!-- IF _file.UPLOAD_ICON -->{_file.UPLOAD_ICON} <!-- ENDIF --><a class="postlink" href="{_file.U_DOWNLOAD_LINK}" title="<!-- IF _file.COMMENT_CLEAN -->{_file.COMMENT_CLEAN} / <!-- ENDIF -->{_file.DOWNLOAD_NAME}">{_file.DOWNLOAD_NAME}</a></dt>
 			<!-- IF _file.COMMENT --><dd><em>{_file.COMMENT}</em></dd><!-- ENDIF -->
 			<dd>({_file.FILESIZE} {_file.SIZE_LANG}) {_file.L_DOWNLOAD_COUNT}</dd>
 		</dl>
Index: language/en/gym_sitemaps/acp/google_txt.php
===================================================================
--- language/en/gym_sitemaps/acp/google_txt.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/google_txt.php	(Premod 3.0.8)
@@ -0,0 +1,57 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_txt.php 204 2009-12-20 12:04:51Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* google_txt [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'GOOGLE_TXT' => 'TXT Sitemap',
+	'GOOGLE_TXT_EXPLAIN' => 'These are the parameter for the TXT Google sitemap module. It can fully integrate URL list from a text file (on url per line) in GYM sitemaps and take advantage of all the modules features such as XSLt styling and caching.<br/> Some settings can be overridden depending on the Google sitemaps and main override settings.<br/>Each texte file added in the gym_sitemaps/sources/ directory will be taken into account once you will have cleared the module ACP cache, using the maintenance link above.<br/> Each URL list texte file must be composed of one full URL per line and will have to follow a basic pattern for file naming : <b>google_</b>txt_file_name<b>.txt</b>.<br />An entry will be created in the SitemapIndex with URL<b>example.com/sitemap.php?txt=txt_file_name</b> and <b>example.com/txt-txt_file_name.xml</b> when url rewritten.<br/> The name of the source file must must use alphanumerical characters (0-9a-z) plus both separators "_" and "-".<br/><u style="color:red;">Note :</u><br/> It is advised to cache this modules sitemaps to prevent useless parsing of potentially big text files.',
+	// Main
+	'GOOGLE_TXT_CONFIG' => 'TXT Sitemap settings',
+	'GOOGLE_TXT_CONFIG_EXPLAIN' => 'Some settings can be overridden depending on the Google sitemaps and main override settings.',
+	'GOOGLE_TXT_RANDOMIZE' => 'Randomize',
+	'GOOGLE_TXT_RANDOMIZE_EXPLAIN' => 'You can randomize URLs grabbed from the text file. Changing the order on a regular basis may help for crawling a bit. This option is as well handy for example when you would limit the urls to 1000 for this module and use text source files with 5000 urls, in such cases all the 5000 URLs will be regularly  displayed on the corresponding sitemap.',
+	'GOOGLE_TXT_UNIQUE' => 'Check duplicate',
+	'GOOGLE_TXT_UNIQUE_EXPLAIN' => 'Activate to make sure that if some URL appear more than one time in the text source, it will only display once in the sitemap.',
+	'GOOGLE_TXT_FORCE_LASTMOD' => 'Last modification',
+	'GOOGLE_TXT_FORCE_LASTMOD_EXPLAIN' => 'You can force a last modification time based on the cache duration cycle (even if cache is not activated) for all URLs in the sitemap. The module will as well compute priorities and change frequencies based on this last mod time. By default, no lastmod tag is added.',
+	// Reset settings
+	'GOOGLE_TXT_RESET' => 'TXT Sitemaps Module',
+	'GOOGLE_TXT_RESET_EXPLAIN' => 'Reset to default all the sorting options of the TXT Sitemaps module.',
+	'GOOGLE_TXT_MAIN_RESET' => 'TXT Sitemap Settings',
+	'GOOGLE_TXT_MAIN_RESET_EXPLAIN' => 'Reset to default all the options in the "TXT Sitemap settings" (main) tab of the TXT Sitemap module.',
+	'GOOGLE_TXT_CACHE_RESET' => 'TXT Sitemap Cache',
+	'GOOGLE_TXT_CACHE_RESET_EXPLAIN' => 'Reset to default all the caching options of the TXT Sitemap module.',
+	'GOOGLE_TXT_GZIP_RESET' => 'TXT Sitemap Gunzip',
+	'GOOGLE_TXT_GZIP_RESET_EXPLAIN' => 'Reset to default all the Gunzip options of the TXT Sitemap module.',
+	'GOOGLE_TXT_LIMIT_RESET' => 'TXT Sitemap Limit',
+	'GOOGLE_TXT_LIMIT_RESET_EXPLAIN' => 'Reset to default all the Limit options of the TXT Sitemap module.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/google_xml.php
===================================================================
--- language/en/gym_sitemaps/acp/google_xml.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/google_xml.php	(Premod 3.0.8)
@@ -0,0 +1,59 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_xml.php 204 2009-12-20 12:04:51Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* google_xml [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'GOOGLE_XML' => 'XML Sitemap',
+	'GOOGLE_XML_EXPLAIN' => 'These are the parameter for the XML Google sitemap module. It can fully integrate URL list from a xml file (on url per line) in GYM sitemaps and take advantage of all the modules features such as XSLt styling and caching.<br/> Some settings can be overridden depending on the Google sitemaps and main override settings.<br/>Each xml file added in the gym_sitemaps/sources/ directory will be taken into account once you will have cleared the module ACP cache, using the maintenance link above.<br/> Each URL list xml file must be composed of one full URL per line and will have to follow a basic pattern for file naming : <b>google_</b>xml_file_name<b>.xml</b>.<br />An entry will be created in the SitemapIndex with URL <b>example.com/sitemap.php?xml=xml_file_name</b> or <b>example.com/xml-xml_file_name.xml</b> when url rewritten.<br/> The name of the source file must must use alphanumerical characters (0-9a-z) plus both separators "_" and "-".<p>You can as well use a full sitemap URL generated by an external application, by configuring the gym_sitemaps/sources/xml_google_external.php file (Read comments in the file for more details).</p><u style="color:red;">Note :</u><br/> It is advised to cache this modules sitemaps to prevent useless parsing of potentially big xml files.',
+	// Main
+	'GOOGLE_XML_CONFIG' => 'XML Sitemap settings',
+	'GOOGLE_XML_CONFIG_EXPLAIN' => 'Some settings can be overridden depending on the Google sitemaps and main override settings.',
+	'GOOGLE_XML_RANDOMIZE' => 'Randomize',
+	'GOOGLE_XML_RANDOMIZE_EXPLAIN' => 'You can randomize URLs grabbed from the xml file. Changing the order on a regular basis may help for crawling a bit. This option is as well handy for example when you would limit the urls to 1000 for this module and use xml source files with 5000 urls, in such cases all the 5000 URLs will be regularly  displayed on the corresponding sitemap.<br/><u>Note :</u><br/>This option requires a full parsing of the source file, it is advised to use it when caching is activated.',
+	'GOOGLE_XML_UNIQUE' => 'Check duplicate',
+	'GOOGLE_XML_UNIQUE_EXPLAIN' => 'Activate to make sure that if some URL appear more than one time in the xml source, it will only display once in the sitemap.<br/><u>Note :</u><br/>This option requires a full parsing of the source file, it is advised to use it when caching is activated.',
+	'GOOGLE_XML_FORCE_LASTMOD' => 'Last modification',
+	'GOOGLE_XML_FORCE_LASTMOD_EXPLAIN' => 'You can force a last modification time based on the cache duration cycle (even if cache is not activated) for all URLs in the sitemap. The module will as well compute priorities and change frequencies based on this last mod time. Else the eventual lastmod, changefreq and priority tags provided in the xml source file will be used, or no lastmod tags in case the source file does not provide with any.<br/><u>Note :</u><br/>This option requires a full parsing of the source file, it is advised to use it when caching is activated.',
+	'GOOGLE_XML_FORCE_LIMIT' => 'Forcer limit',
+	'GOOGLE_XML_FORCE_LIMIT_EXPLAIN' => 'You can here make sure that no more than the maximum amount of URL set will be displayed in the sitemap.<br/><u>Note :</u><br/>This option requires a full parsing of the source file, it is advised to use it when caching is activated.',
+	// Reset settings
+	'GOOGLE_XML_RESET' => 'XML Sitemaps Module',
+	'GOOGLE_XML_RESET_EXPLAIN' => 'Reset to default all the options in the "XML Sitemap settings" (main) tab of the XML Sitemap module.',
+	'GOOGLE_XML_MAIN_RESET' => 'XML Sitemap Settings',
+	'GOOGLE_XML_MAIN_RESET_EXPLAIN' => 'Reset to default all the options in the "XML Sitemap settings" (main) tab of the XML Sitemap module.',
+	'GOOGLE_XML_CACHE_RESET' => 'XML Sitemaps Cache',
+	'GOOGLE_XML_CACHE_RESET_EXPLAIN' => 'Reset to default all the caching options of the XML Sitemap module.',
+	'GOOGLE_XML_GZIP_RESET' => 'XML Sitemaps Gunzip',
+	'GOOGLE_XML_GZIP_RESET_EXPLAIN' => 'Reset to default all the Gunzip options of the XML Sitemap module.',
+	'GOOGLE_XML_LIMIT_RESET' => 'XML Sitemap Limit',
+	'GOOGLE_XML_LIMIT_RESET_EXPLAIN' => 'Reset to default all the Limit options of the XML Sitemap module.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/html_forum.php
===================================================================
--- language/en/gym_sitemaps/acp/html_forum.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/html_forum.php	(Premod 3.0.8)
@@ -0,0 +1,96 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: html_forum.php 204 2009-12-20 12:04:51Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* html_forum [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'HTML_FORUM' => 'HTML Forum Module',
+	'HTML_FORUM_EXPLAIN' => 'These are the settings for the HTML forum module.<br/> Some of them can be overridden depending on the HTML override settings.',
+	'HTML_FORUM_EXCLUDE' => 'Forum Exclusions',
+	'HTML_FORUM_EXCLUDE_EXPLAIN' => 'You can here exclude one or several forums from the RSS listing.<br /><u>Note :</u> If this field is left empty, all readable forums will be listed.',
+	'HTML_FORUM_ALLOW_NEWS' => 'Forum News',
+	'HTML_FORUM_ALLOW_NEWS_EXPLAIN' => 'The forum news page is a page displaying one or several topics first posts, clipped or not, and coming from one or several forum you may select bellow.',
+	'HTML_FORUM_ALLOW_CAT_NEWS' => 'Forum category news',
+	'HTML_FORUM_ALLOW_CAT_NEWS_EXPLAIN' => 'Activate, or not, the per forum news pages. If activated, each non excluded forum will have a news page for its topics.',
+	'HTML_FORUM_NEWS_IDS' => 'Forum news source',
+	'HTML_FORUM_NEWS_IDS_EXPLAIN' => 'You can select one or several forums, even private, as source for your main forum news page.<br /><u>Note</u> :<br />If left empty, all authed forum will be taken as source for the forum news page.',
+	'HTML_FORUM_LTOPIC' => 'Optional last active topic list',
+	'HTML_FORUM_INDEX_LTOPIC' => 'Display on forum map',
+	'HTML_FORUM_INDEX_LTOPIC_EXPLAIN' => 'Display, or not, the last active topic list on the forum map.<br/>Enter the number of topic to display, 0 to deactivate.',
+	'HTML_FORUM_CAT_LTOPIC' => 'Display on forum category maps',
+	'HTML_FORUM_CAT_LTOPIC_EXPLAIN' => 'Display, or not, the last active topic list on each forum maps.<br/>Enter the number of topic to display, 0 to deactivate.',
+	'HTML_FORUM_NEWS_LTOPIC' => 'Display on forum news page',
+	'HTML_FORUM_NEWS_LTOPIC_EXPLAIN' => 'Display, or not, the last active topic list on the forum news page.<br/>Enter the number of topic to display, 0 to deactivate.',
+	'HTML_FORUM_CAT_NEWS_LTOPIC' => 'Display on forum category news page',
+	'HTML_FORUM_CAT_NEWS_LTOPIC_EXPLAIN' => 'Display, or not, the last active topic list on each forum news page.<br/>Enter the number of topic to display, 0 to deactivate.',
+	'HTML_FORUM_LTOPIC_PAGINATION' => 'Last active topic pagination',
+	'HTML_FORUM_LTOPIC_PAGINATION_EXPLAIN' => 'Display, or not, topic pagination in the last active topic list.',
+	'HTML_FORUM_LTOPIC_EXCLUDE' => 'Last active topic list exclusion',
+	'HTML_FORUM_LTOPIC_EXCLUDE_EXPLAIN' => 'You can here exclude one or several forum from the last active topic listing.<br /><u>Note :</u> If this field is left empty, all readable forums will be listed.',
+	// Pagination
+	'HTML_FORUM_PAGINATION' => 'Forum map Pagination',
+	'HTML_FORUM_PAGINATION_EXPLAIN' => 'Activate, or not, paginating of forum maps. Turn this on if you want to display more than one page and list all topics in each forum map.',
+	'HTML_FORUM_PAGINATION_LIMIT' => 'Topics per page',
+	'HTML_FORUM_PAGINATION_LIMIT_EXPLAIN' => 'When Forum map Pagination is activated, you can here define the number of topic displayed per page.',
+	// Content
+	'HTML_FORUM_CONTENT' => 'Forum Content settings',
+	'HTML_FORUM_FIRST' => 'Map sorting',
+	'HTML_FORUM_FIRST_EXPLAIN' => 'The forum maps can be sorted against the topic first post date or the topic last post date. This means that you can either use the topic creation or the last replied order.',
+	'HTML_FORUM_NEWS_FIRST' => 'News sorting',
+	'HTML_FORUM_NEWS_FIRST_EXPLAIN' => 'The forum news pages can be sorted against the topic first post date or the topic last post date. This means that you can either use the topic creation or the last replied order.',
+	'HTML_FORUM_LAST_POST' => 'Display last post',
+	'HTML_FORUM_LAST_POST_EXPLAIN' => 'Display, or not, the last post information of the topic listed.',
+	'HTML_FORUM_POST_BUTTONS' => 'Display post button',
+	'HTML_FORUM_POST_BUTTONS_EXPLAIN' => 'Display, or not, the post button such as reply, edit etc ...',
+	'HTML_FORUM_RULES' => 'Display forum rules',
+	'HTML_FORUM_RULES_EXPLAIN' => 'Display, or not, forum rules in forum news and map pages.',
+	'HTML_FORUM_DESC' => 'Display forum rules description',
+	'HTML_FORUM_DESC_EXPLAIN' => 'Display, or not, forum description in forum news and map pages.',
+	// Reset settings
+	'HTML_FORUM_RESET' => 'HTML forum module',
+	'HTML_FORUM_RESET_EXPLAIN' => 'Reset all the HTML forum module otpions to default values.',
+	'HTML_FORUM_MAIN_RESET' => 'HTML forum Main',
+	'HTML_FORUM_MAIN_RESET_EXPLAIN' => 'Reset to default all the options in the "HTML Settings" (main) tab of the HTML forum module.',
+	'HTML_FORUM_CONTENT_RESET' => 'HTML forum News',
+	'HTML_FORUM_CONTENT_RESET_EXPLAIN' => 'Reset to default all the news options of the HTML forum module.',
+	'HTML_FORUM_CACHE_RESET' => 'HTML forum Cache',
+	'HTML_FORUM_CACHE_RESET_EXPLAIN' => 'Reset to default all the caching options of the HTML forum module.',
+	'HTML_FORUM_MODREWRITE_RESET' => 'HTML forum URL rewriting',
+	'HTML_FORUM_MODREWRITE_RESET_EXPLAIN' => 'Reset to default all the URL rewriting options of the HTML forum module.',
+	'HTML_FORUM_GZIP_RESET' => 'HTML forum Gunzip',
+	'HTML_FORUM_GZIP_RESET_EXPLAIN' => 'Reset to default all the Gunzip options of the HTML forum module.',
+	'HTML_FORUM_LIMIT_RESET' => 'HTML forum Limits',
+	'HTML_FORUM_LIMIT_RESET_EXPLAIN' => 'Reset to default all the Limits options of the HTML forum module.',
+	'HTML_FORUM_SORT_RESET' => 'HTML forum Sorting',
+	'HTML_FORUM_SORT_RESET_EXPLAIN' => 'Reset to default all the Sorting options of the HTML forum module.',
+	'HTML_FORUM_PAGINATION_RESET' => 'HTML forum Pagination',
+	'HTML_FORUM_PAGINATION_RESET_EXPLAIN' => 'Reset to default all the Pagination options of the HTML forum module.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/rss_forum.php
===================================================================
--- language/en/gym_sitemaps/acp/rss_forum.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/rss_forum.php	(Premod 3.0.8)
@@ -0,0 +1,68 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: rss_forum.php 204 2009-12-20 12:04:51Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* rss_forum [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'RSS_FORUM' => 'Forum RSS module',
+	'RSS_FORUM_EXPLAIN' => 'These are the setting for the forum RSS feeds module.<br/> Some of them can be overridden depending on the RSS and Main override settings.',
+	'RSS_FORUM_ALTERNATE' => 'RSS alternate links',
+	'RSS_FORUM_ALTERNATE_EXPLAIN' => 'Display or not forum RSS alternate links in browsers navigation bar',
+	'RSS_FORUM_EXCLUDE' => 'Forum Exclusions',
+	'RSS_FORUM_EXCLUDE_EXPLAIN' => 'You can here exclude one or several forum from the RSS listing.<br /><u>Note :</u> If this field is left empty, all readable forums will be listed.',
+	// Content
+	'RSS_FORUM_CONTENT' => 'Forum Content settings',
+	'RSS_FORUM_FIRST' => 'First message',
+	'RSS_FORUM_FIRST_EXPLAIN' => 'Display or not the first posts URL for all topics listed in the RSS feeds.<br/> By default, only the last post of each thread is listed. Displaying the first one as well means a bit more work for the server.',
+	'RSS_FORUM_LAST' => 'Last message',
+	'RSS_FORUM_LAST_EXPLAIN' => 'Display or not the last message for all topics listed in the RSS feeds.<br/>  By default, only the last post of each thread is listed. This option is useful if you want to only list the first post URL in RSS feeds.<br/>Please note: Setting First message to YES and last message to NO is the same as building a news feed.',
+	'RSS_FORUM_RULES' => 'Display Forum Rules',
+	'RSS_FORUM_RULES_EXPLAIN' => 'Display or not the Forum Rules in the RSS feeds.',
+	// Reset settings
+	'RSS_FORUM_RESET' => 'Forum RSS module',
+	'RSS_FORUM_RESET_EXPLAIN' => 'Reset all the Forum RSS module options to default values.',
+	'RSS_FORUM_MAIN_RESET' => 'Forums RSS Main',
+	'RSS_FORUM_MAIN_RESET_EXPLAIN' => 'Reset to default all the options in the "RSS Feeds Settings" (main) tab of the forum RSS module.',
+	'RSS_FORUM_CONTENT_RESET' => 'Forums RSS Content',
+	'RSS_FORUM_CONTENT_RESET_EXPLAIN' => 'Reset to default all the Content options of the forum RSS module.',
+	'RSS_FORUM_CACHE_RESET' => 'Forums RSS Cache',
+	'RSS_FORUM_CACHE_RESET_EXPLAIN' => 'Reset to default all the caching options of the forum RSS module.',
+	'RSS_FORUM_MODREWRITE_RESET' => 'Forums RSS URL rewriting',
+	'RSS_FORUM_MODREWRITE_RESET_EXPLAIN' => 'Reset to default all the URL rewriting options of the forum RSS module.',
+	'RSS_FORUM_GZIP_RESET' => 'Forums RSS Gunzip',
+	'RSS_FORUM_GZIP_RESET_EXPLAIN' => 'Reset to default all the Gunzip options of the forum RSS module.',
+	'RSS_FORUM_LIMIT_RESET' => 'Forums RSS Limits',
+	'RSS_FORUM_LIMIT_RESET_EXPLAIN' => 'Reset to default all the Limits options of the forum RSS module.',
+	'RSS_FORUM_SORT_RESET' => 'Forums RSS Sorting',
+	'RSS_FORUM_SORT_RESET_EXPLAIN' => 'Reset to default all the Sorting options of the forum RSS module.',
+	'RSS_FORUM_PAGINATION_RESET' => 'Forums RSS Pagination',
+	'RSS_FORUM_PAGINATION_RESET_EXPLAIN' => 'Reset to default all the Pagination options of the forum RSS module.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/gym_html.php
===================================================================
--- language/en/gym_sitemaps/acp/gym_html.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/gym_html.php	(Premod 3.0.8)
@@ -0,0 +1,153 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_html.php 259 2010-03-18 19:25:40Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_html [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'HTML_MAIN' => 'HTML Settings',
+	'HTML_MAIN_EXPLAIN' => 'These are the main setting for the HTML module.<br/>They can be applied to all the HTML modules depending on your HTML override settings.',
+	// Linking setup
+	'HTML_LINKS_ACTIVATION' => 'Forum Linking',
+	'HTML_LINKS_MAIN' => 'Main links',
+	'HTML_LINKS_MAIN_EXPLAIN' => 'Display or not main news and maps links in footer.<br/>This feature requires that main links display is activated in the main configuration.',
+	'HTML_LINKS_INDEX' => 'Links on index',
+	'HTML_LINKS_INDEX_EXPLAIN' => 'Display or not links to the available news and maps for each forum on the forum index. These links are added below the forum descriptions.<br/>This feature requires that links on index display is activated in the main configuration.',
+	'HTML_LINKS_CAT' => 'Links on forum page',
+	'HTML_LINKS_CAT_EXPLAIN' => 'Display or not links to the news and maps of the current forum. These links are added below the forum title.<br/>This feature requires that links on forum page display is activated in the main configuration.',
+	// Reset settings
+	'HTML_ALL_RESET' => 'ALL HTML modules',
+	// Limits
+	'HTML_RSS_NEWS_LIMIT' => 'Mains news page limit',
+	'HTML_RSS_NEWS_LIMIT_EXPLAIN' => 'Number of items displayed on the main news page, gathered from the configured RSS source for the main new page.',
+	'HTML_MAP_TIME_LIMIT' => 'Time limit for module main maps',
+	'HTML_MAP_TIME_LIMIT_EXPLAIN' => 'Limit in days. The maximum age of the items taken into account when building the module main map page. Can be very useful to lower the server load on large data bases. Enter 0 for no limit',
+	'HTML_CAT_MAP_TIME_LIMIT' => 'Time limit for category maps',
+	'HTML_CAT_MAP_TIME_LIMIT_EXPLAIN' => 'Limit in days. The maximum age of the items taken into account when building the module category map pages. Can be very useful to lower the server load on large data bases. Enter 0 for no limit',
+	'HTML_NEWS_TIME_LIMIT' => 'Time limits for News',
+	'HTML_NEWS_TIME_LIMIT_EXPLAIN' => 'Limit in days. The maximum age of the items taken into account when building the module news page. Can be very useful to lower the server load on large data bases. Enter 0 for no limit',
+	'HTML_CAT_NEWS_TIME_LIMIT' => 'Time limit for category news',
+	'HTML_CAT_NEWS_TIME_LIMIT_EXPLAIN' => 'Limit in days. The maximum age of the items taken into account when building the module category news pages. Can be very useful to lower the server load on large data bases. Enter 0 for no limit',
+	// sort
+	'HTML_MAP_SORT_TITLE' => 'Map sorting',
+	'HTML_NEWS_SORT_TITLE' => 'News sorting',
+	'HTML_CAT_SORT_TYPE' => 'Sorting for category maps',
+	'HTML_CAT_SORT_TYPE_EXPLAIN' => 'Following the same principle as above, this one applies to the module category maps pages, e.g. a forum map for the HTML forum module.',
+	'HTML_NEWS_SORT_TYPE' => 'Sorting for news page',
+	'HTML_NEWS_SORT_TYPE_EXPLAIN' => 'Following the same principle as above, this one applies to the module news page, e.g. the forum news page for the HTML forum module.',
+	'HTML_CAT_NEWS_SORT_TYPE' => 'Sorting for category news pages',
+	'HTML_CAT_NEWS_SORT_TYPE_EXPLAIN' => 'Following the same principle as above, this one applies to the module category news pages, e.g. a forum news page for the HTML forum module.',
+	'HTML_PAGINATION_GEN' => 'Main Pagination',
+	'HTML_PAGINATION_SPEC' => 'Module Pagination',
+	'HTML_PAGINATION' => 'Site map pagination',
+	'HTML_PAGINATION_EXPLAIN' => 'Activate pagination on the site map pages. You can decide to use only one, or several pages for your site maps.',
+	'HTML_PAGINATION_LIMIT' => 'Item per page',
+	'HTML_PAGINATION_LIMIT_EXPLAIN' => 'When site map pagination is activated, you can choose how many item to display per page.',
+	'HTML_NEWS_PAGINATION' => 'News Pagination',
+	'HTML_NEWS_PAGINATION_EXPLAIN' => 'Activate pagination on the news pages. You can decide to use only one, or several pages for your news pages.',
+	'HTML_NEWS_PAGINATION_LIMIT' => 'News per page',
+	'HTML_NEWS_PAGINATION_LIMIT_EXPLAIN' => 'When news pagination is activated, you can choose how many news to display per page.',
+	'HTML_ITEM_PAGINATION' => 'Item pagination',
+	'HTML_ITEM_PAGINATION_EXPLAIN' => 'You can here decide to output paginated links (when available) for the listed items. For example, the module can additionally output links of the forums topic pages.',
+	// Basic settings
+	'HTML_SETTINGS' => 'Basic settings',
+	'HTML_C_INFO' => 'Copyright information',
+	'HTML_C_INFO_EXPLAIN' => 'Info to display in the copyright meta tag for site maps and news pages. Default is the phpBB site name. This info will only be used if you installed the phpBB SEO dynamic meta tag mod.',
+	'HTML_SITENAME' => 'Site name',
+	'HTML_SITENAME_EXPLAIN' => 'The Site name to show in the site maps and news pages. Default is the phpBB site name.',
+	'HTML_SITE_DESC' => 'Site description',
+	'HTML_SITE_DESC_EXPLAIN' => 'The Site description to show in the site maps and news pages. Default is the phpBB site description.',
+	'HTML_LOGO_URL' => 'Site logo',
+	'HTML_LOGO_URL_EXPLAIN' => 'The image file to use as the site logo in the RSS feeds, in the gym_sitemaps/images/ directory.',
+	'HTML_URL_EXPLAIN' => 'Enter the full URL to your map.php file, e.g. http://www.example.com/eventual_dir/ if map.php is installed in http://www.example.com/eventual_dir/.<br/>This option is useful when phpBB is not installed in the domains root and you would like put the map.php file in the root level.',
+	'HTML_RSS_NEWS_URL' => 'Mains news page RSS source',
+	'HTML_RSS_NEWS_URL_EXPLAIN' => 'Enter here the full url to the RSS feed you want to display on the main news page, example http://www.example.com/gymrss.php?news&amp;digest to display all news from all RSS modules installed on the main HTML news page.<br />You can use an RSS 2.0 feed as a source for this page.',
+	'HTML_STATS_ON_NEWS' => 'Display forum stats on news pages',
+	'HTML_STATS_ON_NEWS_EXPLAIN' => 'Display, or not, forum stats on news pages.',
+	'HTML_STATS_ON_MAP' => 'Display forum stats maps',
+	'HTML_STATS_ON_MAP_EXPLAIN' => 'Display, or not, forum stats maps pages.',
+	'HTML_BIRTHDAYS_ON_NEWS' => 'Display birthdays on news pages',
+	'HTML_BIRTHDAYS_ON_NEWS_EXPLAIN' => 'Display, or not, birthdays on news pages.',
+	'HTML_BIRTHDAYS_ON_MAP' => 'Display birthdays on news pages',
+	'HTML_BIRTHDAYS_ON_MAP_EXPLAIN' => 'Display, or not, birthdays on news pages.',
+	'HTML_DISP_ONLINE' => 'Display user online',
+	'HTML_DISP_ONLINE_EXPLAIN' => 'Display, or not, the user online list on the site map and news pages.',
+	'HTML_DISP_TRACKING' => 'Activate tracking',
+	'HTML_DISP_TRACKING_EXPLAIN' => 'Activate, or not, item tracking (read / unread).',
+	'HTML_DISP_STATUS' => 'Activate status',
+	'HTML_DISP_STATUS_EXPLAIN' => 'Activate, or not, the item status system (Announcement, Stickies, locked etc ... ).',
+	// Cache
+	'HTML_CACHE' => 'Cache',
+	'HTML_CACHE_EXPLAIN' => 'You can here define various caching options for the HTML mode. HTML caching is separated from the other modes (Google and RSS). This module uses the standard phpBBs cache.<br/>This options thus cannot be inherited from the main  level, and only publicly visible content will be cached. This settings though, may be transmitted to the HTML modules depending on your HTML override settings.<br/><br/>Cache is separated into two types, one for each column in the output : The main column, containing the maps and news, and the optional one, which for example can be used to add a last active topic listing in the HTML forum module.',
+	'HTML_MAIN_CACHE_ON' => 'Activate main column caching',
+	'HTML_MAIN_CACHE_ON_EXPLAIN' => 'You can here activate / deactivate the site maps and news column caching.',
+	'HTML_OPT_CACHE_ON' => 'Activate optional column caching',
+	'HTML_OPT_CACHE_ON_EXPLAIN' => 'You can here activate / deactivate the optional column caching.',
+	'HTML_MAIN_CACHE_TTL' => 'Main cache duration',
+	'HTML_MAIN_CACHE_TTL_EXPLAIN' => 'Maximum amount of hours the main column cached file will be used before it will be updated. Each cached file will be updated every time someone will browse it after this duration was exceeded.',
+	'HTML_OPT_CACHE_TTL' => 'Optional column cache duration',
+	'HTML_OPT_CACHE_TTL_EXPLAIN' => 'Maximum amount of hours the optional column cached file will be used before it will be updated. Each cached file will be updated every time someone will browse it after this duration was exceeded.',
+	// Auth settings
+	'HTML_AUTH_SETTINGS' => 'Authorization settings',
+	'HTML_ALLOW_AUTH' => 'Authorizations',
+	'HTML_ALLOW_AUTH_EXPLAIN' => 'Activate the authorization for site map and news pages. If activated, logged in users will be able to browse private content and to view items from private forums if they have the proper authorization.',
+	'HTML_ALLOW_NEWS' => 'Activate news',
+	'HTML_ALLOW_NEWS_EXPLAIN' => 'Each module can have a news page listing the last X active items with their content, which can be filtered. For the forum, the forum news page is generally a page displaying the 10 last topic first posts digest coming from a selection of public and / or private forums.',
+	'HTML_ALLOW_CAT_NEWS' => 'Activate category news',
+	'HTML_ALLOW_CAT_NEWS_EXPLAIN' => 'Following the same principles as the module news pages, each module category can have a news page.',
+	// Content
+	'HTML_NEWS' => 'News settings',
+	'HTML_NEWS_EXPLAIN' => 'Here you can set up various content filtering / formatting options for the news. <br/>They can be applied to all the HTML modules depending on your HTML override settings.',
+	'HTML_NEWS_CONTENT' => 'News content settings',
+	'HTML_SUMARIZE' => 'Digest Items',
+	'HTML_SUMARIZE_EXPLAIN' => 'You can summarize the message content put in the news pages.<br/> The limit sets the maximum amount of sentences, words or characters, according to the method selected below. Enter 0 to output all of it.',
+	'HTML_SUMARIZE_METHOD' => 'Digest Method',
+	'HTML_SUMARIZE_METHOD_EXPLAIN' => 'You can select between three different methods to limit the message content in feeds.<br/> By number of lines, by number of words and by number of characters. BBcode tags and words wont be broken.',
+	'HTML_ALLOW_PROFILE' => 'Show Profiles',
+	'HTML_ALLOW_PROFILE_EXPLAIN' => 'Item author name can be added to the output if desired.',
+	'HTML_ALLOW_PROFILE_LINKS' => 'Profile link',
+	'HTML_ALLOW_PROFILE_LINKS_EXPLAIN' => 'If author name is included in the output, you can decide to link it or not to the corresponding phpBB profile page.',
+	'HTML_ALLOW_BBCODE' => 'Allow BBcodes',
+	'HTML_ALLOW_BBCODE_EXPLAIN' => 'You may choose here to either parse and output or omit the BBcode.',
+	'HTML_STRIP_BBCODE' => 'Strip BBcodes',
+	'HTML_STRIP_BBCODE_EXPLAIN' => 'You can here set up a list of BBcodes to exclude from parsing.<br/>The format is simple : <br/><ul><li> <u>Comma separated list of BBcodes :</u> Delete BBcode tags, keep the content. <br/><u>Example :</u> <b>img,b,quote</b> <br/> In this example img, bold and quote BBcode wont be parsed, the BBcode tags themselves will be deleted and the content inside the BBcode tags kept.</li><li> <u>Comma separated list of BBcodes with colon option :</u> Delete BBcode tags and decide about their content. <br/><u>Example :</u> <b>img:1,b:0,quote,code:1</b> <br/> In this example, img BBcode and the img link will be deleted, bold wont be processed, but the bold-ed text will be kept, quote wont be parsed, but their content will be kept, code BBcode and their content will be deleted from the output.</ul>The filter will work even if BBcode is empty. Handy to delete code tags content and img links from output for example.<br/>The filtering occurs before summarizing.<br/> The Magic parameter "all" (can be all:0 or all:1 to strip BBcode tags content as well) will take care of all at once.',
+	'HTML_ALLOW_LINKS' => 'Allow active links',
+	'HTML_ALLOW_LINKS_EXPLAIN' => 'You may choose here to either activate or not links used in items content.<br/> If deactivated, links and emails will be included in the content but wont be clickable.',
+	'HTML_ALLOW_EMAILS' => 'Allow Emails',
+	'HTML_ALLOW_EMAILS_EXPLAIN' => 'You chose here to output "email AT domain DOT com" instead of "email@domain.com" in the items content.',
+	'HTML_ALLOW_SMILIES' => 'Allow Smilies',
+	'HTML_ALLOW_SMILIES_EXPLAIN' => 'You may choose here to either parse or ignore the smilies in content.',
+	'HTML_ALLOW_SIG' => 'Allow signatures',
+	'HTML_ALLOW_SIG_EXPLAIN' => 'You may choose here to either display or not the users signatures in content.',
+	'HTML_ALLOW_MAP' => 'Activate the module map',
+	'HTML_ALLOW_MAP_EXPLAIN' => 'You can here activate / deactivate the module site map.',
+	'HTML_ALLOW_CAT_MAP' => 'Activate module category maps',
+	'HTML_ALLOW_CAT_MAP_EXPLAIN' => 'You can here activate / deactivate the module category maps.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/gym_rss.php
===================================================================
--- language/en/gym_sitemaps/acp/gym_rss.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/gym_rss.php	(Premod 3.0.8)
@@ -0,0 +1,133 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_rss.php 259 2010-03-18 19:25:40Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_rss [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'RSS_MAIN' => 'RSS Feeds Settings',
+	'RSS_MAIN_EXPLAIN' => 'These are the main setting for the RSS feeds module.<br/>They can be applied to all the RSS modules depending on your RSS override settings.',
+	// Linking setup
+	'RSS_LINKS_ACTIVATION' => 'Forum Linking',
+	'RSS_LINKS_MAIN' => 'Main links',
+	'RSS_LINKS_MAIN_EXPLAIN' => 'Display or not rss and rss list links in footer.<br/>This feature requires that main links display is activated in the main configuration.',
+	'RSS_LINKS_INDEX' => 'Links on index',
+	'RSS_LINKS_INDEX_EXPLAIN' => 'Display or not links to the available rss feed for each forum on the forum index. These links are added below the forum descriptions.<br/>This feature requires that links on index display is activated in the main configuration.',
+	'RSS_LINKS_CAT' => 'Links on forum page',
+	'RSS_LINKS_CAT_EXPLAIN' => 'Display or not links to the rss feed of the current forum. These links are added below the forum title.<br/>This feature requires that links on forum page display is activated in the main configuration.',
+	// Reset settings
+	'RSS_ALL_RESET' => 'ALL RSS modules',
+	// Limits
+	'RSS_LIMIT_GEN' => 'Main limits',
+	'RSS_LIMIT_SPEC' => 'RSS limits',
+	'RSS_URL_LIMIT_LONG' => 'Long Feeds limit',
+	'RSS_URL_LIMIT_LONG_EXPLAIN' => 'Number of items displayed in a Long feed without content, requires Allow Long Feeds option activated.',
+	'RSS_SQL_LIMIT_LONG' => 'Long SQL cycle',
+	'RSS_SQL_LIMIT_LONG_EXPLAIN' => 'Number of items queried at a time for a long feed without content.',
+	'RSS_URL_LIMIT_SHORT' => 'Short Feeds limit',
+	'RSS_URL_LIMIT_SHORT_EXPLAIN' => 'Number of items displayed on a Short feed without content, requires Allow Short Feeds option activated.',
+	'RSS_SQL_LIMIT_SHORT' => 'Short SQL cycle',
+	'RSS_SQL_LIMIT_SHORT_EXPLAIN' => 'Number of items queried at a time for a Short feed without content.',
+	'RSS_URL_LIMIT_MSG' => 'Default limit with content',
+	'RSS_URL_LIMIT_MSG_EXPLAIN' => 'Number of items displayed by default in feeds with content, requires Allow Item Content option activated.',
+	'RSS_SQL_LIMIT_MSG' => 'SQL cycle with content',
+	'RSS_SQL_LIMIT_MSG_EXPLAIN' => 'Number of items queried at a time for a feed with content.',
+	// Basic settings
+	'RSS_SETTINGS' => 'Basic settings',
+	'RSS_C_INFO' => 'Copyright information',
+	'RSS_C_INFO_EXPLAIN' => 'The Copyright information to show in the copyright tag of the RSS feeds. Default is the phpBB site name.',
+	'RSS_SITENAME' => 'Site name',
+	'RSS_SITENAME_EXPLAIN' => 'The Site name to show in the RSS feeds. Default is the phpBB site name.',
+	'RSS_SITE_DESC' => 'Site description',
+	'RSS_SITE_DESC_EXPLAIN' => 'The Site description to show in the RSS feeds. Default is the phpBB site description.',
+	'RSS_LOGO_URL' => 'Site logo',
+	'RSS_LOGO_URL_EXPLAIN' => 'The image file to use as the site logo in the RSS feeds, in the gym_sitemaps/images/ directory.',
+	'RSS_IMAGE_URL' => 'RSS logo',
+	'RSS_IMAGE_URL_EXPLAIN' => 'The image file to use as the RSS logo in the RSS feeds, in the gym_sitemaps/images/ directory.',
+	'RSS_LANG' => 'RSS Language',
+	'RSS_LANG_EXPLAIN' => 'The language to declare as the main language in the rss feeds. Default is the phpBB default language.',
+	'RSS_URL_EXPLAIN' => 'Enter the full URL to your gymrss.php file, e.g. http://www.example.com/eventual_dir/ if gymrss.php is installed in http://www.example.com/eventual_dir/.<br/>This option is useful when phpBB is not installed in the domains root and you would like put the gymrss.php file in the root level.',
+	// Auth settings
+	'RSS_AUTH_SETTINGS' => 'Authorization settings',
+	'RSS_ALLOW_AUTH' => 'Authorizations',
+	'RSS_ALLOW_AUTH_EXPLAIN' => 'Activate the authorization for RSS feeds. If activated, logged in users will be able to browse private feeds and to view items from private forums in general feeds if they have the proper authorization.',
+	'RSS_CACHE_AUTH' => 'Cache private feeds',
+	'RSS_CACHE_AUTH_EXPLAIN' => 'You can disable cache for non public feeds when allowed.<br/> Caching private feeds will increase the number of file cached;  it should not be a problem, but you can decide to only cache public feeds here.',
+	'RSS_NEWS_UPDATE' => 'News Feeds update',
+	'RSS_NEWS_UPDATE_EXPLAIN' => 'When news feeds are activated, you can here set a custom time to live in hours for all the news feeds. Use 0 or leave blank to deactivate and use the regular update duration instead.',
+	'RSS_ALLOW_NEWS' => 'Allow News Feeds',
+	'RSS_ALLOW_NEWS_EXPLAIN' => 'So called news feeds is a custom mod that will keep the first item listed without considering subsequent replies. Its an additional feed that will not interfere with the others. Its useful if you, for example, want to submit your forum feeds to Google news.',
+	'RSS_ALLOW_SHORT' => 'Allow Short Feeds',
+	'RSS_ALLOW_SHORT_EXPLAIN' => 'Allow or not the use of Short RSS feeds.',
+	'RSS_ALLOW_LONG' => 'Allow Long Feeds',
+	'RSS_ALLOW_LONG_EXPLAIN' => 'Allow or not the use of Long RSS feeds.',
+	// Notifications
+	'RSS_NOTIFY' => 'Notifications',
+	'RSS_YAHOO_NOTIFY' => 'Yahoo Notifications',
+	'RSS_YAHOO_NOTIFY_EXPLAIN' => 'Activate the Yahoo! Notifications for RSS feeds.<br/> This does not concern the general feeds (RSS.xml).<br/>Each time a feeds cache is updated, a notification will be sent to Yahoo!<br/><u>NOTE :</u>You MUST enter your Yahoo! AppID below for the notification to be sent.',
+	'RSS_YAHOO_APPID' => 'Yahoo! AppID',
+	'RSS_YAHOO_APPID_EXPLAIN' => 'Enter your Yahoo! AppID. If you dont have one yet, please visit <a href="http://api.search.yahoo.com/webservices/register_application">this page</a>.<br/><u>NOTE :</u>You will have to register for a Yahoo! account before you can obtain a Yahoo! AppID.',
+	// Styling
+	'RSS_STYLE' => 'Rss Style',
+	'RSS_XSLT' => 'XSLT Styling',
+	'RSS_XSLT_EXPLAIN' => 'The RSS feeds can be styled using <a href="http://www.w3schools.com/xsl/xsl_transformation.asp">XSL-Transform</a> Style Sheet.',
+	'RSS_FORCE_XSLT' => 'Force Styling',
+	'RSS_FORCE_XSLT_EXPLAIN' => 'Isnt this a bit stupid, we need to trick browsers to allow xlst usage. We do it by adding some space chars at the beginning of the xml code.<br/>FF 2 and IE7 only look for the first 500 chars to decide its rss or not and impose their private handling',
+	'RSS_LOAD_PHPBB_CSS' => 'Load phpBB CSS',
+	'RSS_LOAD_PHPBB_CSS_EXPLAIN' => 'The GYM sitemap module fully uses the phpBB3 powerful templating system. The XSL stylesheets used to build the html output is compatible with phpBB3 styling.<btr/>With this option, you can decide to apply the phpBB CSS on the XSL stylesheet instead of the default one. This way, all your theme personalisations such as background and font color or even images will be used in the RSS styled output.<br/>This will only have effect after you will have cleared the RSS cache in the "Maintenance" menu.<br/>If the RSS style file are not present in the current style, the default style (always available, based on prosilver) will be used.<br/>Do not try to use prosilver templates with another style, the CSS most likely wont match.',
+	// Content
+	'RSS_CONTENT' => 'Content settings',
+	'RSS_CONTENT_EXPLAIN' => 'Here you can set up various content filtering / formatting options. <br/>They can be applied to all the RSS modules depending on your RSS override settings.',
+	'RSS_ALLOW_CONTENT' => 'Allow Item Content',
+	'RSS_ALLOW_CONTENT_EXPLAIN' => 'You may choose here to allow the message content to be fully or partially displayed in the RSS feeds. <br/><u>NOTE :</u> This option means a bit more work for the server. Limits with content output should be set smaller than the ones without it.',
+	'RSS_SUMARIZE' => 'Digest Items',
+	'RSS_SUMARIZE_EXPLAIN' => 'You can summarize the message content put in the feeds.<br/> The limit sets the maximum amount of sentences, words or characters, according to the method selected below. Enter 0 to output all of it.',
+	'RSS_SUMARIZE_METHOD' => 'Digest Method',
+	'RSS_SUMARIZE_METHOD_EXPLAIN' => 'You can select between three different methods to limit the message content in feeds.<br/> By number of lines, by number of words and by number of characters. BBcode tags and words wont be broken.',
+	'RSS_ALLOW_PROFILE' => 'Show Profiles',
+	'RSS_ALLOW_PROFILE_EXPLAIN' => 'Item author name can be added to the RSS feeds if desired.',
+	'RSS_ALLOW_PROFILE_LINKS' => 'Profile link',
+	'RSS_ALLOW_PROFILE_LINKS_EXPLAIN' => 'If author name is included in the output, you can decide to link it or not to the corresponding phpBB profile page.',
+	'RSS_ALLOW_BBCODE' => 'Allow BBcodes',
+	'RSS_ALLOW_BBCODE_EXPLAIN' => 'You may choose here to either parse and output or omit the BBcode.',
+	'RSS_STRIP_BBCODE' => 'Strip BBcodes',
+	'RSS_STRIP_BBCODE_EXPLAIN' => 'You can here set up a list of BBcodes to exclude from parsing.<br/>The format is simple : <br/><ul><li> <u>Comma separated list of BBcodes :</u> Delete BBcode tags, keep the content. <br/><u>Example :</u> <b>img,b,quote</b> <br/> In this example img, bold and quote BBcode wont be parsed, the BBcode tags themselves will be deleted and the content inside the BBcode tags kept.</li><li> <u>Comma separated list of BBcodes with colon option :</u> Delete BBcode tags and decide about their content. <br/><u>Example :</u> <b>img:1,b:0,quote,code:1</b> <br/> In this example, img BBcode and the img link will be deleted, bold wont be processed, but the bold text will be kept, quote wont be parsed, but their content will be kept, code BBcode and their content will be deleted from the output.</ul>The filter will work even if BBcode is empty. Handy to delete code tags content and img links from output for example.<br/>The filtering occurs before summarizing.<br/> The Magic parameter "all" (can be all:0 or all:1 to strip BBcode tags content as well) will take care of all at once.',
+	'RSS_ALLOW_LINKS' => 'Allow active links',
+	'RSS_ALLOW_LINKS_EXPLAIN' => 'You may choose here to either activate or not links used in items content.<br/> If deactivated, links and emails will be included in the content but wont be clickable.',
+	'RSS_ALLOW_EMAILS' => 'Allow Emails',
+	'RSS_ALLOW_EMAILS_EXPLAIN' => 'You chose here to output "email AT domain DOT com" instead of "email@domain.com" in the items content.',
+	'RSS_ALLOW_SMILIES' => 'Allow Smilies',
+	'RSS_ALLOW_SMILIES_EXPLAIN' => 'You may choose here to either parse or ignore the smilies in content.',
+	'RSS_NOHTML' => 'HTML filter',
+	'RSS_NOHTML_EXPLAIN' => 'Filter, or not, html in rss feeds. If you activate this option, rss feeds will only contain plain text.',
+	// Old URL handling
+	'RSS_1XREDIR' => 'Handle GYM 1x rewritten URL',
+	'RSS_1XREDIR_EXPLAIN' => 'Activate the GYM 1x rewritten URLs detection. The module will display a custom feed providing with the new URL of the requested feed.<br/><u>Note :</u><br/>This option requires the compatibility rewriterules as explained in the install file.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/google_forum.php
===================================================================
--- language/en/gym_sitemaps/acp/google_forum.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/google_forum.php	(Premod 3.0.8)
@@ -0,0 +1,64 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_forum.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* google_forum [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'GOOGLE_FORUM' => 'Forum sitemaps',
+	'GOOGLE_FORUM_EXPLAIN' => 'These are the settings for the forum Google sitemap module.<br/> Some are overridden depending on the Google sitemaps and main override settings.',
+	'GOOGLE_FORUM_SETTINGS' => 'Forum sitemaps settings',
+	'GOOGLE_FORUM_SETTINGS_EXPLAIN' => 'The following settings are specific to the forum Google sitemap module.',
+	'GOOGLE_FORUM_STICKY_PRIORITY' => 'Sticky Priority',
+	'GOOGLE_FORUM_STICKY_PRIORITY_EXPLAIN' => 'Sticky Priority (must be a number between 0.0 &amp; 1.0 inclusive).',
+	'GOOGLE_FORUM_ANNOUCE_PRIORITY' => 'Announcement Priority',
+	'GOOGLE_FORUM_ANNOUCE_PRIORITY_EXPLAIN' => 'Announcement Priority (must be a number between 0.0 &amp; 1.0 inclusive).',
+	'GOOGLE_FORUM_GLOBAL_PRIORITY' => 'Global Announcement Priority',
+	'GOOGLE_FORUM_GLOBAL_PRIORITY_EXPLAIN' => 'Global Announcement Priority (must be a number between 0.0 &amp; 1.0 inclusive).',
+	'GOOGLE_FORUM_EXCLUDE' => 'Forum Exclusions',
+	'GOOGLE_FORUM_EXCLUDE_EXPLAIN' => 'You can here exclude one or several forum from the sitemap listing.<br /><u>Note :</u> If this field is left empty, all public forums will be listed.',
+	// Reset settings
+	'GOOGLE_FORUM_RESET' => 'Forum sitemap module',
+	'GOOGLE_FORUM_RESET_EXPLAIN' => 'Reset all the forum sitemap module options to default values.',
+	'GOOGLE_FORUM_MAIN_RESET' => 'Forums sitemaps main',
+	'GOOGLE_FORUM_MAIN_RESET_EXPLAIN' => 'Reset to default all the options in the "Forums sitemaps" (main) tab of the forum sitemap module.',
+	'GOOGLE_FORUM_CACHE_RESET' => 'Forums sitemaps cache',
+	'GOOGLE_FORUM_CACHE_RESET_EXPLAIN' => 'Reset to default all the caching options of the forum sitemap module.',
+	'GOOGLE_FORUM_MODREWRITE_RESET' => 'Forums sitemaps URL rewriting',
+	'GOOGLE_FORUM_MODREWRITE_RESET_EXPLAIN' => 'Reset to default all the URL rewriting options of the forum sitemap module.',
+	'GOOGLE_FORUM_GZIP_RESET' => 'Forums sitemaps gunzip',
+	'GOOGLE_FORUM_GZIP_RESET_EXPLAIN' => 'Reset to default all the gunzip options of the forum sitemap module.',
+	'GOOGLE_FORUM_LIMIT_RESET' => 'Forums sitemaps limits',
+	'GOOGLE_FORUM_LIMIT_RESET_EXPLAIN' => 'Reset to default all the limit options of the forum sitemap module.',
+	'GOOGLE_FORUM_SORT_RESET' => 'Forums sitemaps Sorting',
+	'GOOGLE_FORUM_SORT_RESET_EXPLAIN' => 'Reset to default all the sorting options of the forum sitemap module.',
+	'GOOGLE_FORUM_PAGINATION_RESET' => 'Forums sitemaps pagination',
+	'GOOGLE_FORUM_PAGINATION_RESET_EXPLAIN' => 'Reset to default all the pagination options of the forum sitemap module.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/acp/gym_common.php
===================================================================
--- language/en/gym_sitemaps/acp/gym_common.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/gym_common.php	(Premod 3.0.8)
@@ -0,0 +1,263 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_common.php 279 2010-11-26 09:19:15Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_common [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	// Main
+	'ALL' => 'All',
+	'MAIN' => 'GYM Sitemaps',
+	'MAIN_MAIN_RESET' => 'GYM sitemaps main options',
+	'MAIN_MAIN_RESET_EXPLAIN' => 'Reset all the GYM main options to default values.',
+	// Linking setup
+	'GYM_LINKS_ACTIVATION' => 'Forum Linking',
+	'GYM_LINKS_MAIN' => 'Main links',
+	'GYM_LINKS_MAIN_EXPLAIN' => 'Display or not links to main GYM page in footer : SitemapIndex, main RSS feed and feed list page, main map and new page.',
+	'GYM_LINKS_INDEX' => 'Links on index',
+	'GYM_LINKS_INDEX_EXPLAIN' => 'Display or not links to the available GYM pages for each forum on the forum index. These links are added below the forum descriptions.',
+	'GYM_LINKS_CAT' => 'Links on forum page',
+	'GYM_LINKS_CAT_EXPLAIN' => 'Display or not links to the available GYM pages on a forum page. These links are added below the forum title.',
+	// Google sitemaps
+	'GOOGLE' => 'Google',
+	'GOOGLE_URL' => 'Google Sitemaps URL',
+	// Reset settings
+	'GOOGLE_MAIN_RESET' => 'Google Sitemap main options',
+	'GOOGLE_MAIN_RESET_EXPLAIN' => 'Reset all the Google Sitemap main options to default values.',
+	// RSS feeds
+	'RSS' => 'RSS',
+	'RSS_URL' => 'RSS feed URL',
+	'RSS_ALTERNATE' => 'RSS alternate links',
+	'RSS_ALTERNATE_EXPLAIN' => 'Display or not RSS alternate links in browsers navigation bar',
+	'RSS_LINKING_TYPE' => 'RSS Linking Type',
+	'RSS_LINKING_TYPE_EXPLAIN' => 'The type of feed to display among the forum pages.<br/>Can be set to :<br/><b>&bull; News Feeds with or without content</b><br/>Items are displayed in the creation date order, with or without content,<br/><b>&bull; Regular Feeds with or without content</b><br/>Items are displayed in the last activity date order, with or without content.<br/>This only affects the link displayed, not the feeds actually available.',
+	'RSS_LINKING_NEWS' => 'News Feeds',
+	'RSS_LINKING_NEWS_DIGEST' => 'News Feeds with content',
+	'RSS_LINKING_REGULAR' => 'Regular Feeds',
+	'RSS_LINKING_REGULAR_DIGEST' => 'Regular Feeds with content',
+	// Reset settings
+	'RSS_MAIN_RESET' => 'RSS main options',
+	'RSS_MAIN_RESET_EXPLAIN' => 'Reset all the RSS main options to default values.',
+	'YAHOO' => 'Yahoo',
+	// HTML
+	'HTML_MAIN_RESET' => 'Global HTML options',
+	'HTML_MAIN_RESET_EXPLAIN' => 'Reset all the HTML maps and news main options to default values.',
+	'HTML' => 'Html',
+	'HTML_URL' => 'HTML URL',
+
+	// GYM authorisation array
+	'GYM_AUTH_ADMIN' => 'Admin',
+	'GYM_AUTH_GLOBALMOD' => 'Global moderators',
+	'GYM_AUTH_REG' => 'Logged in',
+	'GYM_AUTH_GUEST' => 'Guests',
+	'GYM_AUTH_ALL' => 'All',
+	'GYM_AUTH_NONE' => 'None',
+	// XSLT
+	'GYM_STYLE' => 'Styling',
+
+	// Cache status
+	'SEO_CACHE_FILE_TITLE' => 'Cache Status',
+	'SEO_CACHE_STATUS' => 'File cache is configured at: <b>%s</b>',
+	'SEO_CACHE_FOUND' => 'File cache found.',
+	'SEO_CACHE_NOT_FOUND' => 'File cache was not found.',
+	'SEO_CACHE_WRITABLE' => 'File cache is writeable.',
+	'SEO_CACHE_UNWRITABLE' => 'File cache is <b>not</b> writeable.  Please CHMOD the cache folder to 0777.',
+
+	// Mod Rewrite type
+	'ACP_SEO_SIMPLE' => 'Simple',
+	'ACP_SEO_MIXED' => 'Intermediate',
+	'ACP_SEO_ADVANCED' => 'Advanced',
+	'ACP_PHPBB_SEO_VERSION' => 'Version',
+	'ACP_SEO_SUPPORT_FORUM' => 'Support Forum',
+	'ACP_SEO_RELEASE_THREAD' => 'Subject to availability',
+	'ACP_SEO_REGISTER_TITLE' => 'Register',
+	'ACP_SEO_REGISTER_UPDATE' => 'notified about updates',
+	'ACP_SEO_REGISTER_MSG' => 'You may want to %1$s to be %2$s',
+
+	// Maintenance
+	'GYM_MAINTENANCE' => 'Maintenance',
+	'GYM_MODULE_MAINTENANCE' => '%1$s maintenance',
+	'GYM_MODULE_MAINTENANCE_EXPLAIN' => 'Here you can manage the cached files used by the %1$s modules.<br/> There are two types: the one used to store the data outputted on the public pages, and the ones used to build each modules ACP. You can delete the modules ACP cache if you check the clear cache option; default is clearing the content cache for the selected modules.',
+	'GYM_CLEAR_CACHE' => 'Clear %1$s cache',
+	'GYM_CLEAR_CACHE_EXPLAIN' => 'You can here clear the cached files for the %1$s module. These cached files contains the data used to build the %1$s .<br/>It can be useful if you want to force the cache update.',
+	'GYM_CLEAR_ACP_CACHE' => 'Clear %1$s ACP',
+	'GYM_CLEAR_ACP_CACHE_EXPLAIN' => 'You can choose to clear the %1$s ACP cached setup instead. These cached files contains the data used to build the %1$s ACP.<br/>It can be useful to activate new options that may have been added to the modules of this  type.',
+	'GYM_CACHE_CLEARED' => 'Clear cache success in : ',
+	'GYM_CACHE_NOT_CLEARED' => 'An error occurred while clearing the cache, please check the folder permissions (CHMOD 0666 or 0777).<br/>The folder currently set up for caching is : ',
+	'GYM_FILE_CLEARED' => 'File(s) erased: ',
+	'GYM_CACHE_ACCESSED' => 'The caching folder was properly accessed, but no files were deleted: ',
+	'MODULE_CACHE_CLEARED' => 'ACP module cache cleared with success, if you just uploaded a module, its ACP will show up now.',
+
+	// set defaults
+	'GYM_SETTINGS' => 'Settings',
+	'GYM_RESET_ALL' => 'Reset All',
+	'GYM_RESET_ALL_EXPLAIN' => 'If you check the option, all the above options sets will be reset to default.',
+	'GYM_RESET' => 'Reset %1$s config',
+	'GYM_RESET_EXPLAIN' => 'Below you can reset %1$s modules config, either a whole module at once or only a given set of module config.',
+
+	'GYM_INSTALL' => 'Install',
+	'GYM_MODULE_INSTALL' => 'Install %1$s module',
+	'GYM_MODULE_INSTALL_EXPLAIN' => 'Below you can activate / deactivate the %1$s module.<br/>If you just uploaded a module, you need to activate it before you will be able to use it.<br/>If you cannot see new module, try clearing the ACP modules cache in the maintenance page.',
+
+	// Titles
+	'GYM_MAIN' => 'GYM Sitemaps Settings',
+	'GYM_MAIN_EXPLAIN' => 'These are the setting common to all type of output and to all modules.<br/> They can be applied to all type of outputs (html, RSS, Google sitemaps, Yahoo! url list) and/or to all modules depending on your override settings.',
+	'MAIN_MAIN' => 'GYM Sitemaps Overview',
+	'MAIN_MAIN_EXPLAIN' => 'GYM sitemaps is a very flexible and Search Engine Optimized phpBB module. It will allow you to build Google sitemaps, RSS 2.0 feeds, Yahoo! URL lists and html sitemaps for your forum as well as for any part of your website thanks to its modularity.<br/><br/> Each  type (Google, RSS, html &amp; Yahoo) can grab items to list from several applications installed on your site (forum, album etc ...) using a dedicated module.<br/>You can activate / deactivate modules using the install link in each  type ACP, each module has its own configuration pages.<br/><br/>Make sure you check the %1$s, support is provided in the %2$s.<br/>General SEO support and discussion is as well provided on %3$s<br/>%4$s<br/>Enjoy ;-)',
+
+	'GYM_GOOGLE' => 'Google Sitemaps',
+	'GYM_GOOGLE_EXPLAIN' => 'These are the setting common to all Google sitemaps modules (forum, custom etc ...).<br/> They can be applied to all Google sitemaps modules depending on your override settings for this type of output and the main ones.',
+	'GYM_RSS' => 'RSS feeds',
+	'GYM_RSS_EXPLAIN' => 'These are the setting common to all RSS feeds modules (forum, custom etc ...).<br/> They can be applied to all RSS feeds modules depending on your override settings for this type of output and the main ones.',
+	'GYM_HTML' => 'HTML Pages',
+	'GYM_HTML_EXPLAIN' => 'These are the setting common to all HTML modules (forum, custom etc ...).<br/> They can be applied to all HTML modules depending on your override settings for this type of output and the main ones.',
+	'GYM_MODULES_INSTALLED' => 'Active module(s)',
+	'GYM_MODULES_UNINSTALLED' => 'Non active module(s)',
+
+	// Overrides
+	'GYM_OVERRIDE_GLOBAL' => 'Global',
+	'GYM_OVERRIDE_OTYPE' => 'Output Type',
+	'GYM_OVERRIDE_MODULE' => 'Module',
+
+	// override messages
+	'GYM_OVERRIDED_GLOBAL' => 'This option is currently overridden at the top level (Main configuration)',
+	'GYM_OVERRIDED_OTYPE' => 'This option is currently overridden at the  type level',
+	'GYM_OVERRIDED_MODULE' => 'This option is currently overridden at the module level',
+	'GYM_OVERRIDED_VALUE' => 'The value currently taken into account is : ',
+	'GYM_OVERRIDED_VALUE_NOTHING' => 'nothing',
+	'GYM_COULD_OVERRIDE' => 'This option could be overridden but currently isnt.',
+
+	// Overridable / common options
+	'GYM_CACHE' => 'Cache',
+	'GYM_CACHE_EXPLAIN' => 'Here you can set up various caching options. Remember that these settings may be overridden depending on your override settings.',
+	'GYM_MOD_SINCE' => 'Activate Modified Since',
+	'GYM_MOD_SINCE_EXPLAIN' => 'The module will ask the browser if it already has an up-to-date version of the page in its cache before resending the content.<br /><u>NOTE :</u> This option will concern all types of output.',
+	'GYM_CACHE_ON' => 'Activate Caching',
+	'GYM_CACHE_ON_EXPLAIN' => 'You can activate / deactivate caching for this module.',
+	'GYM_CACHE_FORCE_GZIP' => 'Force Cache compression',
+	'GYM_CACHE_FORCE_GZIP_EXPLAIN' => 'Allow you to force gunzip compression for cached files despite the use of gunzip. This can help out a little if you miss web space, but will be a bit more work for the server to uncompress the file before it is sent to the browser.',
+	'GYM_CACHE_MAX_AGE' => 'Cache duration',
+	'GYM_CACHE_MAX_AGE_EXPLAIN' => 'Maximum amount of hours a cached file will be used before it will be updated. Each cached file will be updated every time someone will browse it after this duration was exceeded when auto regen is on. If not, the cache will only be updated upon demand in ACP.',
+	'GYM_CACHE_AUTO_REGEN' => 'Cache auto update',
+	'GYM_CACHE_AUTO_REGEN_EXPLAIN' => 'If you activate the cache auto update, outputted lists will be updated once the cache will have expired, if not, you will have to manually clear your cached files in the maintenance link above to see new URLs in your lists.',
+	'GYM_SHOWSTATS' => 'Cache Statistics',
+	'GYM_SHOWSTATS_EXPLAIN' => 'Output or not the generation statistics in the source code.<br /><u>NOTE :</u> The duration is the time needed to build the page. This step is not repeated when writing from cache.',
+	'GYM_CRITP_CACHE' => 'Encode cache filenames',
+	'GYM_CRITP_CACHE_EXPLAIN' => 'Encrypt the cache file names or not. It is safer to keep the cache filenames encrypted, but it can be handy to check the unencrypted filenames for debugging.<br /><u>NOTE :</u> This option will concern all type of cached files.',
+
+	'GYM_MODREWRITE' => 'URL rewriting',
+	'GYM_MODREWRITE_EXPLAIN' => 'Here you can set up various URL rewriting options. Remember that these settings may be overridden depending on your override settings.',
+	'GYM_MODREWRITE_ON' => 'Activate URL rewriting',
+	'GYM_MODREWRITE_ON_EXPLAIN' => 'This activates URL rewriting for the module links.<br /><u>NOTE :</u> You MUST use an Apache server with the mod_rewrite module loaded or an IIS server running the isapi_rewrite module AND to properly set up the modules rewrite rules in your .htaccess (or httpd.ini with IIS ).',
+	'GYM_ZERO_DUPE_ON' => 'Activate the Zero Duplicate',
+	'GYM_ZERO_DUPE_ON_EXPLAIN' => 'This activates the Zero Duplicate for the module links.<br /><u>NOTE :</u> Redirections will only occur when (re)generating the cache in this version.',
+	'GYM_MODRTYPE' => 'URL rewriting type',
+	'GYM_MODRTYPE_EXPLAIN' => 'These options are overridden by the use of the phpBB SEO mod rewrite (auto detection ).<br/>Four levels of url rewriting can be set up here: None, Simple, Mixed and Advanced :<br/><ul><li><b>None :</b> No URL rewriting;<br/></li><li><b>Simple :</b>Static URL rewriting for all links, no title injection;<br/></li><li><b>Mixed :</b> Forum and category titles are injected in URLs, but topic titles remain statically rewritten;<br/></li><li><b>Advanced :</b> All titles are injected in URLs;</li></ul>',
+
+	'GYM_GZIP' => 'GUNZIP',
+	'GYM_GZIP_EXPLAIN' => 'Here you can set up various gunzip options. Remember that these settings may be overridden depending on your override settings.%1$s',
+	'GYM_GZIP_FORCED' => '<br/><b style="color:red;">NOTE :</b> Gun-zip compressions is activated in phpBB config. It is thus forced in the module.',
+	'GYM_GZIP_CONFIGURABLE' => '<br/><b style="color:red;">NOTE :</b> Gun-zip compressions is not activated in phpBB config. You can set the below options as you wish.',
+	'GYM_GZIP_ON' => 'Activate gunzip',
+	'GYM_GZIP_ON_EXPLAIN' => 'This activates gunzip compression on the output. This can significantly lower the amount of data transmitted to the browser and thus the time required to transmit the content.',
+	'GYM_GZIP_EXT' => 'Gunzip suffix',
+	'GYM_GZIP_EXT_EXPLAIN' => 'You can here chose to use or not the .gz suffix in the module URLs. This only applies when gunzip and URL rewriting are activated.',
+	'GYM_GZIP_LEVEL' => 'Gunzip Compression level',
+	'GYM_GZIP_LEVEL_EXPLAIN' => 'Integer between 1 and 9, 9 being the most compression. Its usually not worth it to go over 6.<br /><u>NOTE :</u> This option will concern all types of output.',
+
+	'GYM_LIMIT' => 'Limits',
+	'GYM_LIMIT_EXPLAIN' => 'Here you can set the limit to apply when building the output : number of url outputted, SQL cycling (amount of item queried at once) and age of items listed.<br/>Remember that these settings may be overridden depending on your override settings.',
+	'GYM_URL_LIMIT' => 'Item Limits',
+	'GYM_URL_LIMIT_EXPLAIN' => 'The maximum amount of item to output.',
+	'GYM_SQL_LIMIT' => 'SQL cycling',
+	'GYM_SQL_LIMIT_EXPLAIN' => 'For all types of output, except html, SQL queries are split into several to be able to list large amount of items without running too heavy queries.<br/>Define here the amount of item to query at once. The number of SQL queries will be the number of item listed divided by this cycle.',
+	'GYM_TIME_LIMIT' => 'Time Limits',
+	'GYM_TIME_LIMIT_EXPLAIN' => 'Limit in days. The maximum age of the items taken into account when building the  lists. Can be very useful to lower the server load on large data bases. Enter 0 for no limit',
+
+	'GYM_SORT' => 'Sorting',
+	'GYM_SORT_EXPLAIN' => 'Here you can chose how to sort the output.<br/>Remember that these settings may be overridden depending on your override settings.',
+	'GYM_SORT_TYPE' => 'Default Sorting',
+	'GYM_SORT_TYPE_EXPLAIN' => 'All outputted links are sorted by default by last activity (Descending). <br /> You can set this to Ascending for example if you wish to make it easier for Search engines to find links to old content.<br/>Remember that these settings may be overridden depending on your override settings.',
+
+	'GYM_PAGINATION' => 'Pagination',
+	'GYM_PAGINATION_EXPLAIN' => 'Here you can set up various pagination options. Remember that these settings may be overridden depending on your override settings.',
+	'GYM_PAGINATION_ON' => 'Activate Pagination',
+	'GYM_PAGINATION_ON_EXPLAIN' => 'You can here decide to output paginated links (when available) for the listed items. For example, the module can additionally output links of the forums topic pages.',
+	'GYM_LIMITDOWN' => 'Pagination: Lower Limit',
+	'GYM_LIMITDOWN_EXPLAIN' => 'Enter here how many paginated pages, starting from the first page, to output.',
+	'GYM_LIMITUP' => 'Pagination: Upper Limit',
+	'GYM_LIMITUP_EXPLAIN' => 'Enter here how many paginated pages, starting from the last one, to output.',
+
+	'GYM_OVERRIDE' => 'Override',
+	'GYM_OVERRIDE_EXPLAIN' => 'GYM sitemaps is fully modular. Each output type (Google, RSS ...) uses its own output modules corresponding to the type of item to list. For example, the first module for all types of output is the forum module, listing items from the forum.<br/> Many options, such as URL rewriting, caching, gunzip compression etc ..., are repeated on several levels of the GYM sitemaps ACP. This allow you to use different settings for the same option depending on the type of output and the output module. But it can occur that you would prefer to, for example, activate URL rewriting on all the GYM sitemaps module at once (all outputs types and all modules).<br/> Thats what the Override setting will allow you to do for many types of settings. <br/>The inheritance process goes from the highest level of settings (Main configuration) to the output type level (Google, RSS ...) and ends at the lowest level : the output modules (forum, album ...)<br/>Overrinding settings can take three values :<br/><ul><li><b>Global :</b> The Main settings will be used;<br/></li><li><b>Output Type :</b> The output type settings will be used for its modules;<br/></li><li><b>Module :</b> The lowest available setting will be used, e.g., the modules one first, and if not set, the output type one and so on up to the global setting if available.</li></ul>',
+	'GYM_OVERRIDE_ON' => 'Activate Main Override',
+	'GYM_OVERRIDE_ON_EXPLAIN' => 'You can here Activate / Deactivate the main overrinding. Deactivating is the same as setting all overrides to "module", letting the output types override settings to set the module override.',
+	'GYM_OVERRIDE_MAIN' => 'Default Overriding',
+	'GYM_OVERRIDE_MAIN_EXPLAIN' => 'Set override level for the other types of settings a module could use.',
+	'GYM_OVERRIDE_CACHE' => 'Cache Overriding',
+	'GYM_OVERRIDE_CACHE_EXPLAIN' => 'What level of overriding to set for the caching options.',
+	'GYM_OVERRIDE_GZIP' => 'Gunzip Overriding',
+	'GYM_OVERRIDE_GZIP_EXPLAIN' => 'What level of overriding to set for the gunzip options.',
+	'GYM_OVERRIDE_MODREWRITE' => 'URL Rewriting Overriding',
+	'GYM_OVERRIDE_MODREWRITE_EXPLAIN' => 'What level of overriding to set for the URL rewriting options.',
+	'GYM_OVERRIDE_LIMIT' => 'Limit Overriding',
+	'GYM_OVERRIDE_LIMIT_EXPLAIN' => 'What level of overriding to set for the limit options.',
+	'GYM_OVERRIDE_PAGINATION' => 'Pagination Overriding',
+	'GYM_OVERRIDE_PAGINATION_EXPLAIN' => 'What level of overriding to set for the pagination options.',
+	'GYM_OVERRIDE_SORT' => 'Sorting Overriding',
+	'GYM_OVERRIDE_SORT_EXPLAIN' => 'What level of overriding to set for the sorting options.',
+
+	// Mod rewrite
+	'GYM_MODREWRITE_ADVANCED' => 'Advanced',
+	'GYM_MODREWRITE_MIXED' => 'Mixed',
+	'GYM_MODREWRITE_SIMPLE' => 'Simple',
+	'GYM_MODREWRITE_NONE' => 'None',
+
+	// Sorting
+	'GYM_ASC' => 'Ascending',
+	'GYM_DESC' => 'Descending',
+
+	// Other
+	// robots.txt
+	'GYM_CHECK_ROBOTS' => 'CHeck robots.txt disallows',
+	'GYM_CHECK_ROBOTS_EXPLAIN' => 'Check and apply robots.txt rules (if any) to the URL list. The module will automatically acknowledge the robots.txt updates.<br />This option is very handy for XML and TXT import, when we cannot be sure about the URL list consistency.<br/><br /><u>Note</u> :<br />This option will imply more work on the source file, it is recommended to use it when caching is activated.',
+	// summarize method
+	'GYM_METHOD_CHARS' => 'By characters',
+	'GYM_METHOD_WORDS' => 'By words',
+	'GYM_METHOD_LINES' => 'By lines',
+
+	// script location checking
+	'GYM_WRONG_PHPBB_URL' => 'phpBB server settings are not correct. You must proprely configure your <a href="%1$s"><b>Server URL settings</b></a>.<br/><a href="http://www.phpbb-seo.com/en/phpbb-forum/server-and-cookie-settings-t4451.html" onclick ="window.open(this.href); return false;">More details about this</a>',
+	'GYM_WRONG_SCRIPT_URL' => 'The configured URL for <b>%1$s</b> mode is wrong. It must lead to where the <b>%2$s</b> file is located on your server.',
+	'GYM_WRONG_SCRIPT_DOMAIN' => 'The configured URL for <b>%1$s</b> mode is not consistant with phpBB one. The URL must use the same domain or sub-domain and the same protocol (http:// or https://) as phpBB. It must contain <b>%2$s</b> and lead to the directory containing <b>%3$s</b> on your server.',
+	'GYM_WRONG_SCRIPT2_PHPBB' => 'Even though the configured URL for <b>%1$s</b> mode is correct, the path to phpBB ($phpbb_root_path) set in <b>%2$s%3$s</b> is wrong. This can only occur when $phpbb_root_path was manually modified and / or the file was moved.<br/>Note that $phpbb_root_path must be a valide relative path from the directory where <b>%3$s</b> is to the directory where phpBB is installed, and that it must start with "./".<br/>According to your settings, $phpbb_root_path should be set to <b>%4$s</b> in <b>%3$s</b>.',
+	'GYM_WRONG_SITEMAP_LOCATION' => 'Your <b>sitemap.php</b> file is located in a place from where it cannot be used to list forum URLs.<br/>It must be placed <b>inside or above</b> the phpBB directory to be valid.<br/>Configured location : <b>%1$s</b><br/>phpBB location : <b>%2$s</b>',
+	'GYM_GO_CONFIG_SCRIPT_URL' => 'Go fix configuration : <a href="%2$s"><b>%1$s</b></a>',
+));
+?>
Index: language/en/gym_sitemaps/acp/gym_google.php
===================================================================
--- language/en/gym_sitemaps/acp/gym_google.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/acp/gym_google.php	(Premod 3.0.8)
@@ -0,0 +1,65 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_google.php 259 2010-03-18 19:25:40Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_google [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'GOOGLE_MAIN' => 'Google Sitemaps Settings',
+	'GOOGLE_MAIN_EXPLAIN' => 'Main settings for the Google sitemap module.<br/>They will applied to all the Google sitemaps modules by default.',
+	// Linking setup
+	'GOOGLE_LINKS_ACTIVATION' => 'Forum Linking',
+	'GOOGLE_LINKS_MAIN' => 'Main links',
+	'GOOGLE_LINKS_MAIN_EXPLAIN' => 'Display or not sitemapindex link in footer.<br/>This feature requires that main links display is activated in the main configuration.',
+	'GOOGLE_LINKS_INDEX' => 'Links on index',
+	'GOOGLE_LINKS_INDEX_EXPLAIN' => 'Display or not links to the available sitemaps for each forum on the forum index. These links are added below the forum descriptions.<br/>This feature requires that links on index display is activated in the main configuration.',
+	'GOOGLE_LINKS_CAT' => 'Links on forum page',
+	'GOOGLE_LINKS_CAT_EXPLAIN' => 'Display or not links to the sitemap of the current forum. These links are added below the forum title.<br/>This feature requires that links on forum page display is activated in the main configuration.',
+	// Reset settings
+	'GOOGLE_ALL_RESET' => '<b>All</b> Google sitemaps modules',
+	'GOOGLE_URL_EXPLAIN' => 'Enter the full URL to your sitemapIndex eg http://www.example.com/eventual_dir/ if sitemap.php is installed in http://www.example.com/eventual_dir/.<br/>This option is useful when phpBB is not installed in the domain\'s root and you would like to list URLs from the domains root level in your Google sitemaps.',
+	'GOOGLE_PING' => 'Google Ping',
+	'GOOGLE_PING_EXPLAIN' => 'Pings Google each time a sitemap gets refreshed.',
+	'GOOGLE_THRESHOLD' => 'Sitemaps threshold',
+	'GOOGLE_THRESHOLD_EXPLAIN' => 'Minimum amount of items to display a sitemap. For the forum, this means that only forum with more than this threshold topic will have a sitemap.',
+	'GOOGLE_PRIORITIES' => 'Priority settings',
+	'GOOGLE_DEFAULT_PRIORITY' => 'Default Priority',
+	'GOOGLE_DEFAULT_PRIORITY_EXPLAIN' => 'The default priority for URLs listed in all the sitemaps; will be used unless additional options are made possible by  module (must be a number between 0.0 &amp; 1.0 inclusive)',
+	'GOOGLE_XSLT' => 'XSLT Styling',
+	'GOOGLE_XSLT_EXPLAIN' => 'Activates the XSL style-sheet to output user-friendly Google sitemaps with clickable links and more. This will only be effective after you will have cleared the Google sitemaps cache using the Maintenance link above.',
+	'GOOGLE_LOAD_PHPBB_CSS' => 'Load phpBB CSS',
+	'GOOGLE_LOAD_PHPBB_CSS_EXPLAIN' => 'The GYM sitemap module uses the phpBB3 templating system. The XSL stylesheets used to build the html output are compatible with phpBB3 styling.<br/>With this, you can apply the phpBB CSS on the XSL stylesheet instead of the default one. This way, all your theme personalizations such as background and font color or even images will be used in the Google sitemap styled output.<br/>This will only have effect after you will have cleared the RSS cache in the "Maintenance" menu.<br/>If the Google sitemaps style file are not present in the current style, the default style (always available, based on prosilver) will be used.<br/>Do not try to use prosilver templates with another style, the CSS most likely won\'t match.',
+	// Auth settings
+	'GOOGLE_AUTH_SETTINGS' => 'Authorization settings',
+	'GOOGLE_ALLOW_AUTH' => 'Authorizations',
+	'GOOGLE_ALLOW_AUTH_EXPLAIN' => 'Activate the authorization for Sitemaps. If activated, logged in users and bots will be able to browse private forum sitemaps if they have the proper authorization.',
+	'GOOGLE_CACHE_AUTH' => 'Cache private sitemaps',
+	'GOOGLE_CACHE_AUTH_EXPLAIN' => 'You can disable cache for non public sitemaps when allowed.<br/> Caching private sitemaps will increase the number of file cached. It should not be a problem, but you can decide to only cache public sitemaps here.',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/gym_common.php
===================================================================
--- language/en/gym_sitemaps/gym_common.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/gym_common.php	(Premod 3.0.8)
@@ -0,0 +1,121 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_common.php 259 2010-03-18 19:25:40Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_common [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	'RSS_AUTH_SOME_USER' => '<b><u>Warning :</u></b>This item list is personalized according to <b>%s</b>\'s authorizations.<br/>Some of the item listed may not be viewable when not logged in.',
+	'RSS_AUTH_THIS_USER' => '<b><u>Warning :</u></b>This item is personalized according to <b>%s</b>\'s authorizations.<br/>It will not be viewable when not logged in.',
+	'RSS_AUTH_SOME' => '<b><u>Warning :</u></b>This item list is not public.<br/>Some of the item listed may not be viewable when not logged in.',
+	'RSS_AUTH_THIS' => '<b><u>Warning :</u></b>This item is not public.<br/>It will not be viewable when not logged in.',
+	'RSS_CHAN_LIST_TITLE' => 'Channel list',
+	'RSS_CHAN_LIST_DESC' => 'This channel list is listing the available RSS feeds.',
+	'RSS_CHAN_LIST_DESC_MODULE' => 'This channel list is listing the RSS feeds available for : %s.',
+	'RSS_ANNOUCES_DESC' => 'This feeds is listing all the global announcements of : %s',
+	'RSS_ANNOUNCES_TITLE' => 'Announces from  : %s',
+	'GYM_LAST_POST_BY' => 'Last post by ',
+	'GYM_FIRST_POST_BY' => 'Post by ',
+	'GYM_LINK' => 'Link',
+	'GYM_SOURCE' => 'Source',
+	'GYM_RSS_SOURCE' => 'Source',
+	'RSS_MORE' => 'more',
+	'RSS_CHANNELS' => 'Channels',
+	'RSS_CONTENT' => 'Digest',
+	'RSS_SHORT' => 'Short list',
+	'RSS_LONG' => 'Long list',
+	'RSS_NEWS' => 'News',
+	'RSS_NEWS_DESC' => 'Latest news from',
+	'RSS_REPORTED_UNAPPROVED' => 'This item is currently waiting for approval.',
+
+	'GYM_HOME' => 'Home Page',
+	'GYM_FORUM_INDEX' => 'Forum Index',
+	'GYM_LASTMOD_DATE' => 'Last modification date',
+	'GYM_SEO' => 'Search Engine Optimization',
+	'GYM_MINUTES' => 'minute(s)',
+	'GYM_SQLEXPLAIN' => 'SQL Explain report',
+	'GYM_SQLEXPLAIN_MSG' => 'Logged in as admin, you can check the %s for this page.',
+	'GYM_BOOKMARK_THIS' => 'Bookmark this',
+	// Errors
+	'GYM_ERROR_404' => 'This page does not exist or is not activated',
+	'GYM_ERROR_404_EXPLAIN' => 'The server did not find any page corresponding to the URL you have used.',
+	'GYM_ERROR_401' => 'You are not allowed to view this page.',
+	'GYM_ERROR_401_EXPLAIN' => 'This page is only accessible to logged in users granted with the required authorisations.',
+	'GYM_LOGIN' => 'You are not allowed to view this page.',
+	'GYM_LOGIN_EXPLAIN' => 'You must be registered and logged in to view this page.',
+	'GYM_TOO_FEW_ITEMS' => 'Page Unavailable',
+	'GYM_TOO_FEW_ITEMS_EXPLAIN' => 'This page does not contain enough item to be displayed.',
+	'GYM_TOO_FEW_ITEMS_EXPLAIN_ADMIN' => 'This page source is either empty or does not contain enough items (less than the configured threshold in ACP) to be displayed.<br/>A 404 Not Found header was sent to properly inform Search Engines to discard this link.',
+
+	'GOOGLE_SITEMAP' => 'Sitemap',
+	'GOOGLE_SITEMAP_OF' => 'Sitemap of',
+	'GOOGLE_MAP_OF' => 'Sitemap of %1$s',
+	'GOOGLE_SITEMAPINDEX' => 'SitemapIndex',
+	'GOOGLE_NUMBER_OF_SITEMAP' => 'Number of Sitemaps in this Google SitemapIndex',
+	'GOOGLE_NUMBER_OF_URL' => 'Number of URLs in this Google Sitemap',
+	'GOOGLE_SITEMAP_URL' => 'Sitemap URL',
+	'GOOGLE_CHANGEFREQ' => 'Change freq.',
+	'GOOGLE_PRIORITY' => 'priority',
+
+	'RSS_FEED' => 'RSS Feed',
+	'RSS_FEED_OF' => 'RSS Feed of %1$s',
+	'RSS_2_LINK' => 'RSS 2.0 feed link',
+	'RSS_UPDATE' => 'Update',
+	'RSS_LAST_UPDATE' => 'Last Update',
+	'RSS_SUBSCRIBE_POD' => '<h2>Bookmark this feed Now!</h2>With your preferred service.',
+	'RSS_SUBSCRIBE' => 'To subscribe to this RSS feed manually, please use the following URL :',
+	'RSS_ITEM_LISTED' => 'One item listed.',
+	'RSS_ITEMS_LISTED' => 'items listed.',
+	'RSS_VALID' => 'RSS 2.0 Valid feed',
+
+	// Old URL handling
+	'RSS_1XREDIR' => 'This RSS Feed has been moved',
+	'RSS_1XREDIR_MSG' => 'This RSS Feed has been moved, you can now find it here ',
+	// HTML sitemaps
+	'HTML_MAP' => 'Site map',
+	'HTML_MAP_OF' => 'Site map of %1$s',
+	'HTML_MAP_NONE' => 'No site map',
+	'HTML_NO_ITEMS' => 'No item',
+	'HTML_NEWS' => 'News',
+	'HTML_NEWS_OF' => 'News of %1$s',
+	'HTML_NEWS_NONE' => 'No news',
+	'HTML_PAGE' => 'Page',
+	'HTML_MORE' => 'Read more',
+	// Forum
+	'HTML_FORUM_MAP' => 'Forum site map',
+	'HTML_FORUM_NEWS' => 'Forums news',
+	'HTML_FORUM_GLOBAL_MAP' => 'Global announcement list',
+	'HTML_FORUM_GLOBAL_NEWS' => 'Global announcements',
+	'HTML_FORUM_ANNOUNCE_MAP' => 'Announcements list',
+	'HTML_FORUM_ANNOUNCE_NEWS' => 'Announcements',
+	'HTML_FORUM_STICKY_MAP' => 'Sticky list',
+	'HTML_FORUM_STICKY_NEWS' => 'Stickies',
+	'HTML_LASTX_TOPICS_TITLE' => 'Last %1$s active topics',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/install.php
===================================================================
--- language/en/gym_sitemaps/install.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/install.php	(Premod 3.0.8)
@@ -0,0 +1,107 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: install.php 204 2009-12-20 12:04:51Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* install [English]
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	// Install
+	'SEO_INSTALL_PANEL'	=> 'Gym Sitemaps &amp; RSS Installation Panel',
+	'CAT_INSTALL_GYM_SITEMAPS' => 'Install GYM Sitemaps',
+	'CAT_UNINSTALL_GYM_SITEMAPS' => 'Un-install GYM Sitemaps',
+	'CAT_UPDATE_GYM_SITEMAPS' => 'Update GYM Sitemaps',
+	'SEO_ERROR_INSTALL'	=> 'An error occurred during the installation process. If you want to retry the installation, uninstall first.',
+	'SEO_ERROR_INSTALLED'	=> 'The %s module is already installed.',
+	'SEO_ERROR_ID'	=> 'The %1$ module had no ID.',
+	'SEO_ERROR_UNINSTALLED'	=> 'The %s module is already uninstalled.',
+	'SEO_ERROR_INFO'	=> 'Information :',
+	'SEO_FINAL_INSTALL_GYM_SITEMAPS'	=> 'Login to ACP',
+	'SEO_FINAL_UPDATE_GYM_SITEMAPS'	=> 'Login to ACP',
+	'SEO_FINAL_UNINSTALL_GYM_SITEMAPS'	=> 'Return to forum index',
+	'SEO_OVERVIEW_TITLE'	=> 'GYM sitemaps &amp; RSS Overview',
+	'SEO_OVERVIEW_BODY'	=> '<p>Welcome to the phpBB SEO GYM sitemaps &amp; RSS %1$s installer.</p><p>Please read <a href="%3$s" title="Check the release thread" target="_phpBBSEO"><b>the release thread</b></a> for more information</p><p><strong style="text-transform: uppercase;">Note:</strong> You must have already performed the required code changes and uploaded all the new files before you can proceed with this install wizard.</p><p>This installation system will guide you through the process of installing the GYM sitemaps &amp; RSS admin control panel (ACP). It will allow you generate efficient and Search Engine Optimized Google Sitemaps and RSS feeds. Its modular design will allow you to generate Google Sitemaps and RSS feeds for any php/SQL application installed on your site, using dedicated plug-ins. Lets meet in the <a href="%3$s" title="Support forum" target="_phpBBSEO"><b>support forum</b></a> for anything regarding the GYM Sitemaps &amp; RSS module.</p> ',
+	'CAT_SEO_PREMOD'	=> 'GYM Sitemaps &amp; RSS',
+	'SEO_INSTALL_INTRO'		=> 'Welcome to the phpBB SEO GYM sitemaps &amp; RSS installer.',
+	'SEO_INSTALL_INTRO_BODY'	=> '<p>You are about to install the %1$s %2$s mod. This install tool will activate the GYM Sitemaps &amp; RSS admin control panel in the phpBB ACP.</p><p>Once installed, you will need to go to the ACP to choose the appropriate settings.</p>
+	<p><strong>Note:</strong>If its the first time you have installed this mod, we strongly encourage you to take the time to test the various features of the module on a local or private test server before going online.</p><br/>
+	<p>Requirements :</p>
+	<ul>
+		<li>Apache server (Linux OS) with mod_rewrite for the URL rewriting features of the module.</li>
+		<li>IIS server (Windows OS) with isapi_rewrite for the URL rewriting features of the module, but you will need to adapt the rewriterules in the httpd.ini</li>
+	</ul>',
+	'SEO_INSTALL'		=> 'Install',
+	'UN_SEO_INSTALL_INTRO'		=> 'Welcome to the GYM Sitemaps &amp; RSS un-installer',
+	'UN_SEO_INSTALL_INTRO_BODY'	=> '<p>You are about to uninstall the %1$s %2$s mod.</p>
+	<p><strong>Note:</strong> Sitemaps and feeds will no longer be available once you have uninstalled the module.</p>',
+	'UN_SEO_INSTALL'		=> 'Uninstall',
+	'SEO_INSTALL_CONGRATS'		=> 'Congratulations!',
+	'SEO_INSTALL_CONGRATS_EXPLAIN'	=> '<p>You have now successfully installed the %1$s %2$s mod. Go to phpBB ACP and proceed with the mod settings.<p>
+	<p>It will show up in the phpBB SEO Category; among many other things you will be able to :</p>
+	<h2>Accurately configure you Google Sitemaps and RSS feeds</h2>
+	<p>Google sitemaps and RSS feeds supports advanced XSLt styling, phpBBs CSS will even be applied to these without editing a single line of code.</p>
+	<p>Google sitemaps and RSS feeds will auto detect the phpBB SEO mod rewrites and their settings; using other URL rewriting mod is made easy.</p>
+	<h2>Generate a personalized .htaccess</h2>
+	<p>With the phpBB SEO mod rewrite and once you will have set up the above options, you will be able to generate a personalized .htaccess quickly and save it directly on the server.</p><br/><h3>Install Report :</h3>',
+	'UN_SEO_INSTALL_CONGRATS'	=> 'The GYM Sitemaps &amp; RSS ACP module was removed.',
+	'UN_SEO_INSTALL_CONGRATS_EXPLAIN'	=> '<p>You have now successfully uninstalled the %1$s %2$s mod.<p>
+	<p> You Google sitemaps and RSS feeds are not available any more.</p>',
+	'SEO_VALIDATE_INFO'	=> 'Validation Info :',
+	'SEO_LICENCE_TITLE'	=> 'GNU LESSER GENERAL PUBLIC LICENSE',
+	'SEO_LICENCE_BODY'	=> 'The phpBB SEO GYM Sitemaps &amp; RSS is released under the GNU LESSER GENERAL PUBLIC LICENSE.',
+	'SEO_SUPPORT_TITLE'	=> 'Support',
+	'SEO_SUPPORT_BODY'	=> 'Full support will be given in the <a href="%1$s" title="Visit the %2$s forum" target="_phpBBSEO"><b>%2$s forum</b></a>. We will provide answers to general setup questions, configuration problems, and support for determining common problems.</p><p>Be sure to visit our <a href="http://www.phpbb-seo.com/boards/" title="SEO Forum" target="_phpBBSEO"><b>Search Engine Optimization forums</b></a>.</p><p>You should <a href="http://www.phpbb-seo.com/boards/profile.php?mode=register" title="Register to phpBB SEO" target="_phpBBSEO"><b>register</b></a>, log in and <a href="%3$s" title="Be notified about updates" target="_phpBBSEO"><b>subscribe to the release thread</b></a> to be notified by mail upon each update.',
+	// Security
+	'SEO_LOGIN'		=> 'The board requires you to be registered and logged in to view this page.',
+	'SEO_LOGIN_ADMIN'	=> 'The board requires you to be logged in as admin to view this page.<br/>Your session has been purged for security purposes.',
+	'SEO_LOGIN_FOUNDER'	=> 'The board requires you to be logged in as the founder to view this page.',
+	'SEO_LOGIN_SESSION'	=> 'Session Check failed.<br/>The Settings were not altered.<br/>Your session has been purged for security purposes.',
+	// Cache status
+	'SEO_CACHE_FILE_TITLE'	=> 'Cache file status',
+	'SEO_CACHE_STATUS'	=> 'The cache folder configured is : <b>%s</b>',
+	'SEO_CACHE_FOUND'	=> 'The cache folder was successfully found.',
+	'SEO_CACHE_NOT_FOUND'	=> 'The cache folder was not found.',
+	'SEO_CACHE_WRITABLE'	=> 'The cache folder is writable.',
+	'SEO_CACHE_not writeable'	=> 'The cache folder is not writeable. You need to CHMOD it to 0777.',
+	'SEO_CACHE_FORUM_NAME'	=> 'Forum name',
+	'SEO_CACHE_URL_OK'	=> 'URL Cached',
+	'SEO_CACHE_URL_NOT_OK'	=> 'This Forum URL is not cached',
+	'SEO_CACHE_URL'		=> 'Final URL',
+	'SEO_CACHE_MSG_OK'	=> 'The cache file was updated successfully.',
+	'SEO_CACHE_MSG_FAIL'	=> 'An error occurred while updating the cache file.',
+	'SEO_CACHE_UPDATE_FAIL'	=> 'The URL you entered cannot be used, the cache was left untouched.',
+	// Update
+	'UPDATE_SEO_INSTALL_INTRO'		=> 'Welcome to the phpBB SEO GYM sitemaps &amp; RSS updater.',
+	'UPDATE_SEO_INSTALL_INTRO_BODY'	=> '<p>You are about to update the %1$s module to %2$s. This script will update the phpBB data base.<br/>Your current settings wont be affected.</p>
+	<p><strong>Note:</strong> This script will not update GYM Sitemaps &amp; RSS physical files.<br/><br/>To update from all 2.0.x (phpBB3) versions you <b>must</b> upload all files in the <b>root/</b> directory of the archive to your phpBB/ ftp directory, after you will have taken care manually of the eventual code change you would have implemented in the template files (directory phpBB/styles/, .html, .js and .xsl) added by the module.<br/><br/>You <b>can</b> restart this update script when you want, for example if you did not upload the required files or simply to display the update code changes for phpBB3 files again.</p>',
+	'UPDATE_SEO_INSTALL'		=> 'Update',
+	'SEO_ERROR_NOTINSTALLED'	=> 'GYM Sitemaps &amp; RSS is not installed!',
+	'SEO_UPDATE_CONGRATS_EXPLAIN'	=> '<p>You have now successfully updated %1$s to %2$s.<p>
+	<p><strong>Note:</strong> This script does not update GYM Sitemaps &amp; RSS physical files.</p><br/><b>Please</b> implement the code changes listed  below.<br/><h3>Update report :</h3>',
+));
+?>
\ No newline at end of file
Index: language/en/gym_sitemaps/gym_iso639.php
===================================================================
--- language/en/gym_sitemaps/gym_iso639.php	(phpBB 3.0.8)
+++ language/en/gym_sitemaps/gym_iso639.php	(Premod 3.0.8)
@@ -0,0 +1,215 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_iso639.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+*
+* gym_iso639 [English]
+*
+*/
+// This is the full iso 639-1 list from http://www.loc.gov/standards/iso639-2/php/French_list.php
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+/**
+* DO NOT CHANGE
+*/
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+$lang = array_merge($lang, array(
+	'ISO_639_1' => array(
+		'ab' => 'Abkhazian (ab)',
+		'aa' => 'Afar (aa)',
+		'af' => 'Afrikaans (af)',
+		'ak' => 'Akan (ak)',
+		'sq' => 'Albanian (sq)',
+		'am' => 'Amharic (am)',
+		'ar' => 'Arabic (ar)',
+		'an' => 'Aragonese (an)',
+		'hy' => 'Armenian (hy)',
+		'as' => 'Assamese (as)',
+		'av' => 'Avaric (av)',
+		'ae' => 'Avestan (ae)',
+		'ay' => 'Aymara (ay)',
+		'az' => 'Azerbaijani (az)',
+		'bm' => 'Bambara (bm)',
+		'ba' => 'Bashkir (ba)',
+		'eu' => 'Basque (eu)',
+		'be' => 'Belarusian (be)',
+		'bn' => 'Bengali (bn)',
+		'bh' => 'Bihari (bh)',
+		'bi' => 'Bislama (bi)',
+		'nb' => 'Bokml, Norwegian; Norwegian Bokml (nb)',
+		'bs' => 'Bosnian (bs)',
+		'br' => 'Breton (br)',
+		'bg' => 'Bulgarian (bg)',
+		'my' => 'Burmese (my)',
+		'ca' => 'Catalan; Valencian (ca)',
+		'km' => 'Central Khmer (km)',
+		'ch' => 'Chamorro (ch)',
+		'ce' => 'Chechen (ce)',
+		'ny' => 'Chichewa; Chewa; Nyanja (ny)',
+		'zh' => 'Chinese (zh)',
+		'cu' => 'Church Slavic; Old Slavonic; Church Slavonic; Old Bulgarian; Old Church Slavonic (cu)',
+		'cv' => 'Chuvash (cv)',
+		'kw' => 'Cornish (kw)',
+		'co' => 'Corsican (co)',
+		'cr' => 'Cree (cr)',
+		'hr' => 'Croatian (hr)',
+		'cs' => 'Czech (cs)',
+		'da' => 'Danish (da)',
+		'dv' => 'Divehi; Dhivehi; Maldivian (dv)',
+		'nl' => 'Dutch; Flemish (nl)',
+		'dz' => 'Dzongkha (dz)',
+		'en' => 'English (en)',
+		'eo' => 'Esperanto (eo)',
+		'et' => 'Estonian (et)',
+		'ee' => 'Ewe (ee)',
+		'fo' => 'Faroese (fo)',
+		'fj' => 'Fijian (fj)',
+		'fi' => 'Finnish (fi)',
+		'fr' => 'French (fr)',
+		'ff' => 'Fulah (ff)',
+		'gd' => 'Gaelic; Scottish Gaelic (gd)',
+		'gl' => 'Galician (gl)',
+		'lg' => 'Ganda (lg)',
+		'ka' => 'Georgian (ka)',
+		'de' => 'German (de)',
+		'el' => 'Greek, Modern (1453-) (el)',
+		'gn' => 'Guarani (gn)',
+		'gu' => 'Gujarati (gu)',
+		'ht' => 'Haitian; Haitian Creole (ht)',
+		'ha' => 'Hausa (ha)',
+		'he' => 'Hebrew (he)',
+		'hz' => 'Herero (hz)',
+		'hi' => 'Hindi (hi)',
+		'ho' => 'Hiri Motu (ho)',
+		'hu' => 'Hungarian (hu)',
+		'is' => 'Icelandic (is)',
+		'io' => 'Ido (io)',
+		'ig' => 'Igbo (ig)',
+		'id' => 'Indonesian (id)',
+		'ia' => 'Interlingua (International Auxiliary Language Association) (ia)',
+		'ie' => 'Interlingue (ie)',
+		'iu' => 'Inuktitut (iu)',
+		'ik' => 'Inupiaq (ik)',
+		'ga' => 'Irish (ga)',
+		'it' => 'Italian (it)',
+		'ja' => 'Japanese (ja)',
+		'jv' => 'Javanese (jv)',
+		'kl' => 'Kalaallisut; Greenlandic (kl)',
+		'kn' => 'Kannada (kn)',
+		'kr' => 'Kanuri (kr)',
+		'ks' => 'Kashmiri (ks)',
+		'kk' => 'Kazakh (kk)',
+		'ki' => 'Kikuyu; Gikuyu (ki)',
+		'rw' => 'Kinyarwanda (rw)',
+		'ky' => 'Kirghiz; Kyrgyz (ky)',
+		'kv' => 'Komi (kv)',
+		'kg' => 'Kongo (kg)',
+		'ko' => 'Korean (ko)',
+		'kj' => 'Kuanyama; Kwanyama (kj)',
+		'ku' => 'Kurdish (ku)',
+		'lo' => 'Lao (lo)',
+		'la' => 'Latin (la)',
+		'lv' => 'Latvian (lv)',
+		'li' => 'Limburgan; Limburger; Limburgish (li)',
+		'ln' => 'Lingala (ln)',
+		'lt' => 'Lithuanian (lt)',
+		'lu' => 'Luba-Katanga (lu)',
+		'lb' => 'Luxembourgish; Letzeburgesch (lb)',
+		'mk' => 'Macedonian (mk)',
+		'mg' => 'Malagasy (mg)',
+		'ms' => 'Malay (ms)',
+		'ml' => 'Malayalam (ml)',
+		'mt' => 'Maltese (mt)',
+		'gv' => 'Manx (gv)',
+		'mi' => 'Maori (mi)',
+		'mr' => 'Marathi (mr)',
+		'mh' => 'Marshallese (mh)',
+		'mo' => 'Moldavian (mo)',
+		'mn' => 'Mongolian (mn)',
+		'na' => 'Nauru (na)',
+		'nv' => 'Navajo; Navaho (nv)',
+		'nd' => 'Ndebele, North; North Ndebele (nd)',
+		'nr' => 'Ndebele, South; South Ndebele (nr)',
+		'ng' => 'Ndonga (ng)',
+		'ne' => 'Nepali (ne)',
+		'se' => 'Northern Sami (se)',
+		'no' => 'Norwegian (no)',
+		'nn' => 'Norwegian Nynorsk; Nynorsk, Norwegian (nn)',
+		'oc' => 'Occitan (post 1500); Provenal (oc)',
+		'oj' => 'Ojibwa (oj)',
+		'or' => 'Oriya (or)',
+		'om' => 'Oromo (om)',
+		'os' => 'Ossetian; Ossetic (os)',
+		'pi' => 'Pali (pi)',
+		'pa' => 'Panjabi; Punjabi (pa)',
+		'fa' => 'Persian (fa)',
+		'pl' => 'Polish (pl)',
+		'pt' => 'Portuguese (pt)',
+		'ps' => 'Pushto (ps)',
+		'qu' => 'Quechua (qu)',
+		'ro' => 'Romanian (ro)',
+		'rm' => 'Romansh (rm)',
+		'rn' => 'Rundi (rn)',
+		'ru' => 'Russian (ru)',
+		'sm' => 'Samoan (sm)',
+		'sg' => 'Sango (sg)',
+		'sa' => 'Sanskrit (sa)',
+		'sc' => 'Sardinian (sc)',
+		'sr' => 'Serbian (sr)',
+		'sn' => 'Shona (sn)',
+		'ii' => 'Sichuan Yi (ii)',
+		'sd' => 'Sindhi (sd)',
+		'si' => 'Sinhala; Sinhalese (si)',
+		'sk' => 'Slovak (sk)',
+		'sl' => 'Slovenian (sl)',
+		'so' => 'Somali (so)',
+		'st' => 'Sotho, Southern (st)',
+		'es' => 'Spanish; Castilian (es)',
+		'su' => 'Sundanese (su)',
+		'sw' => 'Swahili (sw)',
+		'ss' => 'Swati (ss)',
+		'sv' => 'Swedish (sv)',
+		'tl' => 'Tagalog (tl)',
+		'ty' => 'Tahitian (ty)',
+		'tg' => 'Tajik (tg)',
+		'ta' => 'Tamil (ta)',
+		'tt' => 'Tatar (tt)',
+		'te' => 'Telugu (te)',
+		'th' => 'Thai (th)',
+		'bo' => 'Tibetan (bo)',
+		'ti' => 'Tigrinya (ti)',
+		'to' => 'Tonga (Tonga Islands) (to)',
+		'ts' => 'Tsonga (ts)',
+		'tn' => 'Tswana (tn)',
+		'tr' => 'Turkish (tr)',
+		'tk' => 'Turkmen (tk)',
+		'tw' => 'Twi (tw)',
+		'ug' => 'Uighur; Uyghur (ug)',
+		'uk' => 'Ukrainian (uk)',
+		'ur' => 'Urdu (ur)',
+		'uz' => 'Uzbek (uz)',
+		've' => 'Venda (ve)',
+		'vi' => 'Vietnamese (vi)',
+		'vo' => 'Volapk (vo)',
+		'wa' => 'Walloon (wa)',
+		'cy' => 'Welsh (cy)',
+		'fy' => 'Western Frisian (fy)',
+		'wo' => 'Wolof (wo)',
+		'xh' => 'Xhosa (xh)',
+		'yi' => 'Yiddish (yi)',
+		'yo' => 'Yoruba (yo)',
+		'za' => 'Zhuang; Chuang (za)',
+		'zu' => 'Zulu (zu)',
+	),
+));
+?>
\ No newline at end of file
Index: language/en/mods/info_acp_gym_sitemaps.php
===================================================================
--- language/en/mods/info_acp_gym_sitemaps.php	(phpBB 3.0.8)
+++ language/en/mods/info_acp_gym_sitemaps.php	(Premod 3.0.8)
@@ -0,0 +1,57 @@
+<?php
+/**
+*
+* info_acp_gym_sitemaps [English]
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: info_acp_gym_sitemaps.php 131 2009-10-25 12:03:44Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (!defined('IN_PHPBB'))
+{
+	exit;
+}
+
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+
+$lang = array_merge($lang, array(
+	'ACP_GYM_SITEMAPS' => 'GYM Sitemaps &amp; RSS',
+	'ACP_GYM_MAIN' => 'Main configuration',
+	'ACP_GYM_GOOGLE_MAIN' => 'Google Sitemaps',
+	'ACP_GYM_RSS_MAIN' => 'RSS Feeds',
+	'ACP_GYM_YAHOO_MAIN' => 'Yahoo! url list',
+	'ACP_GYM_HTML_MAIN' => 'HTML sitemaps',
+	'GYM_LOG_CONFIG_MAIN' => '<strong>Altered GYM sitemaps &amp; RSS settings</strong><br/>&raquo; Main settings',
+	'GYM_LOG_CONFIG_GOOGLE' => '<strong>Altered GYM sitemaps &amp; RSS settings</strong><br/>&raquo; Google sitemaps',
+	'GYM_LOG_CONFIG_RSS' => '<strong>Altered GYM sitemaps &amp; RSS settings</strong><br/>&raquo; RSS Feeds',
+	'GYM_LOG_CONFIG_HTML' => '<strong>Altered GYM sitemaps &amp; RSS settings</strong><br/>&raquo; HTML sitemaps',
+	'GYM_LOG_CONFIG_YAHOO' => '<strong>Altered GYM sitemaps &amp; RSS settings</strong><br/>&raquo; Yahoo! URL lists',
+	// Install Logs
+	'SEO_LOG_INSTALL_GYM_SITEMAPS' => '<strong>GYM Sitemaps &amp; RSS V%s Installed</strong>',
+	'SEO_LOG_INSTALL_GYM_SITEMAPS_FAIL' => '<strong>GYM Sitemaps &amp; RSS install attempt failed</strong><br/>%s',
+	'SEO_LOG_UNINSTALL_GYM_SITEMAPS' => '<strong>GYM Sitemaps &amp; RSS V%s Un-installed</strong>',
+	'SEO_LOG_UNINSTALL_GYM_SITEMAPS_FAIL' => '<strong>GYM Sitemaps &amp; RSS Un-install attempt failed</strong><br/>%s',
+	'SEO_LOG_UPDATE_GYM_SITEMAPS' => '<strong>Updated GYM Sitemaps &amp; RSS to V%s</strong>',
+	'SEO_LOG_UPDATE_GYM_SITEMAPS_FAIL' => '<strong>GYM Sitemaps &amp; RSS Update attempt failed</strong><br/>%s',
+));
+
+?>
\ No newline at end of file
Index: language/en/mods/info_acp_phpbb_seo.php
===================================================================
--- language/en/mods/info_acp_phpbb_seo.php	(phpBB 3.0.8)
+++ language/en/mods/info_acp_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,56 @@
+<?php
+/**
+*
+* info_acp_phpbb_seo [English]
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: info_acp_phpbb_seo.php 131 2009-10-25 12:03:44Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (!defined('IN_PHPBB'))
+{
+	exit;
+}
+
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+
+$lang = array_merge($lang, array(
+	'ACP_CAT_PHPBB_SEO' => 'phpBB SEO',
+	'ACP_MOD_REWRITE' => 'URL Rewriting settings',
+	'ACP_PHPBB_SEO_CLASS' => 'phpBB SEO Class settings',
+	'ACP_FORUM_URL' => 'Forum URL Management',
+	'ACP_HTACCESS' => '.htaccess',
+	'ACP_SEO_EXTENDED' => 'Extended config',
+	'ACP_PREMOD_UPDATE' => '<h1>Release announcement</h1>
+	<p>This update does only concern the premod, not the phpBB core.</p>
+	<p>A new version of the phpBB SEO premod is thus available : %1$s<br/>Make sure you visit<a href="%2$s" title="The release thread"><b>the release thread</b></a> and update your installation.</p>',
+	'SEO_LOG_INSTALL_PHPBB_SEO' => '<strong>phpBB SEO mod rewrite installed (v%s)</strong>',
+	'SEO_LOG_INSTALL_PHPBB_SEO_FAIL' => '<strong>phpBB SEO mod rewrite install attempt failed</strong><br/>%s',
+	'SEO_LOG_UNINSTALL_PHPBB_SEO' => '<strong>phpBB SEO mod rewrite uninstalled (v%s)</strong>',
+	'SEO_LOG_UNINSTALL_PHPBB_SEO_FAIL' => '<strong>phpBB SEO mod rewrite uninstall attempts failed</strong><br/>%s',
+	'SEO_LOG_CONFIG_SETTINGS' => '<strong>Altered phpBB SEO Class settings</strong>',
+	'SEO_LOG_CONFIG_FORUM_URL' => '<strong>Altered Forum URLs</strong>',
+	'SEO_LOG_CONFIG_HTACCESS' => '<strong>Generated new .htaccess</strong>',
+	'SEO_LOG_CONFIG_EXTENDED' => '<strong>Altered phpBB SEO extended config</strong>',
+));
+
+?>
\ No newline at end of file
Index: language/en/mods/acp_phpbb_seo.php
===================================================================
--- language/en/mods/acp_phpbb_seo.php	(phpBB 3.0.8)
+++ language/en/mods/acp_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,277 @@
+<?php
+/**
+*
+* acp_phpbb_seo [English]
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: acp_phpbb_seo.php 249 2010-03-11 05:08:04Z Typo $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (!defined('IN_PHPBB'))
+{
+	exit;
+}
+
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	// ACP Main CAT
+	'ACP_CAT_PHPBB_SEO'	=> 'phpBB SEO',
+	'ACP_MOD_REWRITE'	=> 'URL Rewriting settings',
+	// ACP phpBB seo class
+	'ACP_PHPBB_SEO_CLASS'	=> 'phpBB SEO Class settings',
+	'ACP_PHPBB_SEO_CLASS_EXPLAIN'	=> 'You can here set up various options of the phpBB SEO %1$s mod (%2$s).<br/>The various default settings such as the delimiters and suffixes still must be set up in <b>phpbb_seo/includes/setup_phpbb_seo.php</b>, since changing these implies an .htaccess update and most likely appropriate redirections.%3$s',
+	'ACP_PHPBB_SEO_VERSION' => 'Version',
+	'ACP_PHPBB_SEO_MODE' => 'Mode',
+	'ACP_SEO_SUPPORT_FORUM' => 'Support Forum',
+	// ACP forum urls
+	'ACP_FORUM_URL'	=> 'Forum URL Management',
+	'ACP_FORUM_URL_EXPLAIN'		=> 'You can here see whats in the cache file containing the forum title to inject in their URLs.<br/>Forum in green colors are cached, the one in red are not yet.<br/><br/><b style="color:red">Please Note :</b><br/><em><b>any-title-fxx/</b> will always be properly redirected with the Zero Duplicate but it wont be the case if you edit <b>any-title/</b> to <b>something-else/</b>.<br/> In such case, <b>any-title/</b> will for now be treated as a forum that does not exist if you do not set appropriate redirections.</em>',
+	'ACP_NO_FORUM_URL'	=> '<b>Forum URL Management disabled<b><br/>The forum URL management is only available in advanced and Mixed mode and when Forum URL caching is activated.<br/>Forum URLs already configured will stay active in advanced and Mixed mode.',
+	// ACP .htaccess
+	'ACP_HTACCESS'	=> '.htaccess',
+	'ACP_HTACCESS_EXPLAIN'	=> 'This tool will help you out building your .htacess.<br/>The version proposed bellow is based on your phpbb_seo/phpbb_seo_class.php settings.<br/>You can edit the $seo_ext and $seo_static values before you install the .htaccess to get personalized URLs.<br/>You can for example choose to use .htm instead of .html, "message" instead of "post" "mysite-team" instead of "the-team" and so on.<br/>If you edit these while they were already indexed in SE, youll need personalized redirections.<br/>The default settings are not bad at all, you can skip this step without worries if you prefer.<br/>Its though the best time to do it, doing it after a while will require some personalized redirections.<br/>By default the following .htaccess shall be uploaded in the domains root (eg where www.example.com is linked).<br/>If phpBB is installed in a sub folder, hitting the more option below will add an option to upload it in the phpBB folder instead.',
+	'SEO_HTACCESS_RBASE'	=> '.htaccess location',
+	'SEO_HTACCESS_RBASE_EXPLAIN' => 'Put the .htaccess in the phpBB folder ?<br/>The RewriteBase setting allow to put the forums .htaccess in its folder. Its usually more convenient to put the .htaccess in the domains root folder even when phpBB is installed in a sub-folder, but you may prefer to put it in the forum folder instead.',
+	'SEO_HTACCESS_SLASH'	=> 'RegEx Right Slash',
+	'SEO_HTACCESS_SLASH_EXPLAIN'	=> 'Depending on the specific host you are using, you might have to get rid of or add the slash ("/") at the beginning of the right part of each rewriterules. This particular slash is used by default when .htaccess are located at the root level. Its the contrary for when phpBB would be installed in a sub-folder and youd want to use an .htaccess in the same folder.<br/>Default settings should generally work, but if its not the case, try regenerating an .htaccess by hitting the "Re-generate" button.',
+	'SEO_HTACCESS_WSLASH'	=> 'RegEx Left Slash',
+	'SEO_HTACCESS_WSLASH_EXPLAIN'	=> 'Depending on the specific host you are using, you might have to add a slash ("/") at the beginning of the left part of each rewriterules. This particular slash ("/") is never used by default.<br/>Default settings should generally work, but if its not the case, try regenerating an .htaccess by hitting the "Re-generate" button.',
+	'SEO_MORE_OPTION'	=> 'More Options',
+	'SEO_MORE_OPTION_EXPLAIN' => 'If the first suggested .htaccess does not work.<br/>First make sure mod_rewrite is activated on your server.<br/>Then, make sure you uploaded it in the right folder, and that another one is not perturbing.<br/>If not enough, hit the "more option" button.',
+	'SEO_HTACCESS_SAVE' => 'Save the .htaccess',
+	'SEO_HTACCESS_SAVE_EXPLAIN' => 'If checked, an .htaccess files will be generated upon submit in the phpbb_seo/cache/ folder. Its ready to go with your last settings, you will still have to move it in the right place.',
+	'SEO_HTACCESS_ROOT_MSG'	=> 'Once you are ready, you can select the .htaccess code, and paste it in a .htaccess file or use the "Save .htaccess" option bellow.<br/> This .htaccess is meant to be used in the domains root folder, which in your case is where %1$s leads to in your FTP.<br/><br/>You can generate an .htaccess meant to be used in the eventual phpBB sub-directory using the "More options" option bellow.',
+	'SEO_HTACCESS_FOLDER_MSG' => 'Once you are ready, you can select the .htaccess code, and paste it in a .htaccess file or use the "Save .htaccess" option bellow.<br/> This .htaccess is meant to be used in the folder where phpBB is installed, which in your case is where %1$s leads to in your FTP.',
+	'SEO_HTACCESS_CAPTION' => 'Caption',
+	'SEO_HTACCESS_CAPTION_COMMENT' => 'Comments',
+	'SEO_HTACCESS_CAPTION_STATIC' => 'Static parts, editable in phpbb_seo_class.php',
+	'SEO_HTACCESS_CAPTION_DELIM' => 'Delimiters, editable in phpbb_seo_class.php',
+	'SEO_HTACCESS_CAPTION_SUFFIX' => 'Suffixes, editable in phpbb_seo_class.php',
+	'SEO_HTACCESS_CAPTION_SLASH' => 'Optional slashes',
+	'SEO_SLASH_DEFAULT'	=> 'Default',
+	'SEO_SLASH_ALT'		=> 'Alternate',
+	'SEO_MOD_TYPE_ER'	=> 'The mod rewrite type is not set up properly in phpbb_seo/phpbb_seo_class.php.',
+	'SEO_SHOW'		=> 'Show',
+	'SEO_HIDE'		=> 'Hide',
+	'SEO_SELECT_ALL'	=> 'Select all',
+	// ACP extended
+	'ACP_SEO_EXTENDED_EXPLAIN' => 'phpBB SEO mods extended settings.',
+	'SEO_EXTERNAL_LINKS' => 'External links',
+	'SEO_EXTERNAL_LINKS_EXPLAIN' => 'Open, or not, external links in a new browser window / tab',
+	'SEO_EXTERNAL_SUBDOMAIN' => 'Sub-domain links',
+	'SEO_EXTERNAL_SUBDOMAIN_EXPLAIN' => 'Open, or not, sub-domains (of your forum domain) links in a new browser window / tab',
+	'SEO_EXTERNAL_CLASSES' => 'External by css class',
+	'SEO_EXTERNAL_CLASSES_EXPLAIN' => 'here you can define some css classes that will activate the new window feature on links using it. Coma separated list of class names, example: postlink,external',
+	// Titles
+	'SEO_PAGE_TITLES' => '<a href="http://www.phpbb-seo.com/en/phpbb-seo-toolkit/optimal-titles-t1289.html" title="Optimal Titles mod" onclick="window.open(this.href); return false;">Page titles</a>',
+	'SEO_APPEND_SITENAME' => 'Append site name to page titles',
+	'SEO_APPEND_SITENAME_EXPLAIN' => 'Append, or not, site name to page titles.<br/><b style="color:red;">Warning :</b><br/>This option requires that you properly edited all your overall_header.html for the Optimal titles mod, site name could be repeated in page titles otherwise',
+	// Meta
+	'SEO_META' => '<a href="http://www.phpbb-seo.com/en/phpbb-seo-toolkit/seo-dynamic-meta-tags-t1308.html" title="Dynamic Meta tags mod" onclick="window.open(this.href); return false;">Meta tags</a>',
+	'SEO_META_TITLE' => 'Meta title',
+	'SEO_META_TITLE_EXPLAIN' => 'Default Meta title, used on page not defining a page title. Inactivates the meta title tag if empty',
+	'SEO_META_DESC' => 'Meta description',
+	'SEO_META_DESC_EXPLAIN' => 'Default Meta description, used on page not defining a meta description',
+	'SEO_META_DESC_LIMIT' => 'Meta description limit',
+	'SEO_META_DESC_LIMIT_EXPLAIN' => 'Limit in words for the Meta description tag',
+	'SEO_META_BBCODE_FILTER' => 'Bbcodes Filter',
+	'SEO_META_BBCODE_FILTER_EXPLAIN' => 'Coma separated list of BBcodes which will be fully filtered in meta tags. Others will simply be deactivated and their content may apear in meta tags.<br/> Default filtered BBcodes are : <b>img,url,flash,code</b>.<br/><b style="color:red;">Attention :</b><br/>Not filtering img, url and flash BBcode is not a good idea, as well as the code one in most cases. Generally speaking, only keep BBcodes content for BBcodes having interesting content for metas',
+	'SEO_META_KEYWORDS' => 'Meta keywords',
+	'SEO_META_KEYWORDS_EXPLAIN' => 'Default Meta keywords, used on page not defining meta keywords. Simply enter a list of keywords',
+	'SEO_META_KEYWORDS_LIMIT' => 'Meta keywords limit',
+	'SEO_META_KEYWORDS_LIMIT_EXPLAIN' => 'Limit in words for the Meta keywords tag',
+	'SEO_META_MIN_LEN' => 'Short words filter',
+	'SEO_META_MIN_LEN_EXPLAIN' => 'Minimum amount of characters in a word to be included in the Meta keywords tag, only words composed of more than this limit will be taken into account',
+	'SEO_META_CHECK_IGNORE' => 'Ignore words filter',
+	'SEO_META_CHECK_IGNORE_EXPLAIN' => 'Apply, or not, the search_ignore_words.php exclusions in the meta keywords tag',
+	'SEO_META_LANG' => 'Meta lang',
+	'SEO_META_LANG_EXPLAIN' => 'Lang code used in meta tags',
+	'SEO_META_COPY' => 'Meta copyright',
+	'SEO_META_COPY_EXPLAIN' => 'Copyright used in meta tags. Inactivates the meta copyright tag if empty',
+	'SEO_META_FILE_FILTER' => 'File filter',
+	'SEO_META_FILE_FILTER_EXPLAIN' => 'Coma separated list of physical php script file name that should not be indexed (robots:noindex,follow). Example : ucp,mcp',
+	'SEO_META_GET_FILTER' => '_GET filter',
+	'SEO_META_GET_FILTER_EXPLAIN' => 'Coma separated list of _GET variable that should not be indexed (robots:noindex,follow). Example : style,hilit,sid',
+	'SEO_META_ROBOTS' => 'Meta Robots',
+	'SEO_META_ROBOTS_EXPLAIN' => 'The Meta Robots tag tells bots how to index your pages. It is set by default to "index,follow", which allow bots to index and cache your pages and to follow links in them. Inactivates the meta Robots tag if empty.<br/><b style="color:red;">Warning :</b><br/>This tag is sensible, if you were to use "noindex", none of your pages would be indexed',
+	'SEO_META_NOARCHIVE' => 'Noarchive Meta Robots',
+	'SEO_META_NOARCHIVE_EXPLAIN' => 'The Noarchive Meta Robots tag tells bots if they can or not cache the page. It only concern caching, it has no relation with indexing and SERPs of the page.<br/>You can here select a list of forum that will have the "noarchive" option added to theire meta robots.<br/>This feature can be handy for example when you have some forums opened to bots but closed to guests. Adding the "noarchive" option to them will prevent guest from accessing content through the search engine cache, while the forum and its topic will still appear in SERPs',
+	// Install
+	'SEO_INSTALL_PANEL'	=> 'phpBB SEO Installation Panel',
+	'SEO_ERROR_INSTALL'	=> 'An error occured during the installtion process. Uninstall once is safer before you retry.',
+	'SEO_ERROR_INSTALLED'	=> 'The %s module is already installed.',
+	'SEO_ERROR_ID'	=> 'The %1$ module had no ID.',
+	'SEO_ERROR_UNINSTALLED'	=> 'The %s module is already uninstalled.',
+	'SEO_ERROR_INFO'	=> 'Information :',
+	'SEO_FINAL_INSTALL_PHPBB_SEO'	=> 'Login to ACP',
+	'SEO_FINAL_UNINSTALL_PHPBB_SEO'	=> 'Return to forum index',
+	'CAT_INSTALL_PHPBB_SEO'	=> 'Installation',
+	'CAT_UNINSTALL_PHPBB_SEO'	=> 'Un-Installation',
+	'SEO_OVERVIEW_TITLE'	=> 'phpBB SEO Ultimate SEO URL Overview',
+	'SEO_OVERVIEW_BODY'	=> 'Welcome to our public release of the %1$s phpBB3 SEO mod rewrite %2$s.</p><p>Please read <a href="%3$s" title="Check the release thread" onclick="window.open(this.href); return false;"><b>the release thread</b></a> for more information</p><p><strong style="text-transform: uppercase;">Note:</strong> You must have already perfomed the required code changes and uploaded all the new files before you can proceed with this install wizard.</p><p>This installation system will guide you through the process of installing the phpBB3 SEO mod rewrite admin control panel. It will allow you to accurately chose your phpBB rewritten URL standard for the best results in search engines</p>.',
+	'CAT_SEO_PREMOD'	=> 'phpBB SEO Premod',
+	'SEO_PREMOD_TITLE'	=> 'phpBB SEO Premod overview',
+	'SEO_PREMOD_BODY'	=> 'Welcome to our public release of the phpBB SEO Premod.</p><p>Please read <a href="http://www.phpbb-seo.com/en/phpbb-seo-premod/seo-url-premod-t1549.html" title="Check the release thread" onclick="window.open(this.href); return false;"><b>the release thread</b></a> for more information</p><p><strong style="text-transform: uppercase;">Note:</strong> You will be able to chose between the three phpBB3 SEO mod rewrites.<br/><br/><b>The three different URL rewriting standards available :</b><ul><li><a href="http://www.phpbb-seo.com/en/simple-seo-url/simple-phpbb-seo-url-t1566.html" title="More details about the Simple mod"><b>The Simple mod</b></a>,</li><li><a href="http://www.phpbb-seo.com/en/mixed-seo-url/mixed-phpbb-seo-url-t1565.html" title="More details about the Mixed mod"><b>The Mixed mod</b></a>,</li><li><a href="http://www.phpbb-seo.com/en/advanced-seo-url/advanced-phpbb-seo-url-t1219.html" title="More details about the Advanced mod"><b>Advanced</b></a>.</li></ul>This choice is very important, we encourage you to take the time to fully discover the SEO features of this premod before you go online.<br/>This premod is as simple to install as phpBB3, just follow the regular process.<br/><br/>
+	<p>Requirements for URL rewriting :</p>
+	<ul>
+		<li>Apache server (linux OS) with mod_rewrite module.</li>
+		<li>IIS server (windows OS) with isapi_rewrite module, but you will need to adapt the rewriterules in the httpd.ini</li>
+	</ul>
+	<p>Once installed, you will need to go to the ACP to set up and activate the mod.</p>',
+	'SEO_LICENCE_TITLE'	=> 'RECIPROCAL PUBLIC LICENSE',
+	'SEO_LICENCE_BODY'	=> 'The phpBB SEO mod rewrites are released under the RPL licence which states you cannot remove the phpBB SEO credits.<br/>For more details about possible exceptions, please contact a phpBB SEO administrator (primarily SeO or dcz).',
+	'SEO_PREMOD_LICENCE'	=> 'The phpBB SEO mod rewrites and the Zero duplicate included in this Premod are released under the RPL licence which states you cannot remove the phpBB SEO credits.<br/>For more details about possible exceptions, please contact a phpBB SEO administrator (primarily SeO or dcz).',
+	'SEO_SUPPORT_TITLE'	=> 'Support',
+	'SEO_SUPPORT_BODY'	=> 'Full support will be given in the <a href="%1$s" title="Visit the %2$s SEO URL forum" onclick="window.open(this.href); return false;"><b>%2$s SEO URL forum</b></a>. We will provide answers to general setup questions, configuration problems, and support for determining common problems.</p><p>Be sure to visit our <a href="http://www.phpbb-seo.com/en/" title="SEO Forum" onclick="window.open(this.href); return false;"><b>Search Engine Optimization forums</b></a>.</p><p>You should <a href="http://www.phpbb-seo.com/en/ucp.php?mode=register" title="Register to phpBB SEO" onclick="window.open(this.href); return false;"><b>register</b></a>, log in and <a href="%3$s" title="Be notified about updates" onclick="window.open(this.href); return false;"><b>subscribe to the release thread</b></a> to be notified by mail upon each update.',
+	'SEO_PREMOD_SUPPORT_BODY'	=> 'Full support will be given in the <a href="http://www.phpbb-seo.com/en/phpbb-seo-premod/seo-url-premod-t1549.html" title="Visit the phpBB SEO Premod forum" onclick="window.open(this.href); return false;"><b>phpBB SEO Premod forum</b></a>. We will provide answers to general setup questions, configuration problems, and support for determining common problems.</p><p>Be sure to visit our <a href="http://www.phpbb-seo.com/en/" title="SEO Forum" onclick="window.open(this.href); return false;"><b>Search Engine Optimization forums</b></a>.</p><p>You should <a href="http://www.phpbb-seo.com/en/ucp.php?mode=register" title="Register to phpBB SEO" onclick="window.open(this.href); return false;"><b>register</b></a>, log in and <a href="http://www.phpbb-seo.com/en/viewtopic.php?t=1549&watch=topic" title="Be notified about updates" onclick="window.open(this.href); return false;"><b>subscribe to the release thread</b></a> to be notified by mail upon each update.',
+	'SEO_INSTALL_INTRO'		=> 'Welcome to the phpBB SEO Installation Wizard',
+	'SEO_INSTALL_INTRO_BODY'	=> '<p>You are about to install the %1$s phpBB SEO mod rewrite %2$s. This install tool will activate the phpBB SEO mod rewrite control panel in phpBB ACP.</p><p>Once installed, you will need to go to the ACP to set up and activate the mod.</p>
+	<p><strong>Note:</strong> If its the first time you try this mod, we strongly encourage you to take the time to test the various url standard this mod can output on a local or private test serveur. This way, you wont show different URL to bots every other day while testing. And you wont discover a month after that you would have prefered different URLs. Patience is virtue SEO wise and even if the zero duplicate makes the HTTP redirecting very easy, you dont want to redirect all your forums URL too often.</p><br/>
+	<p>Requirements :</p>
+	<ul>
+		<li>Apache server (linux OS) with mod_rewrite module.</li>
+		<li>IIS server (windows OS) with isapi_rewrite module, but you will need to adapt the rewriterules in the httpd.ini</li>
+	</ul>',
+	'SEO_INSTALL'		=> 'Install',
+	'UN_SEO_INSTALL_INTRO'		=> 'Welcome to the phpBB SEO uninstall Wizard',
+	'UN_SEO_INSTALL_INTRO_BODY'	=> '<p>You are about to uninstall the %1$s phpBB SEO mod rewrite %2$s ACP module.</p>
+	<p><strong>Note:</strong> This will not deactivate URL rewriting on your board as long as the phpBB files are still modded.</p>',
+	'UN_SEO_INSTALL'		=> 'Uninstall',
+	'SEO_INSTALL_CONGRATS'			=> 'Congratulations!',
+	'SEO_INSTALL_CONGRATS_EXPLAIN'	=> '<p>You have now successfully installed the %1$s phpBB3 SEO mod rewrite %2$s. You should now go to phpBB ACP and proceed with the mod rewrite settings.<p>
+	<p>In the new phpBB SEO category, you will be able to :</p>
+	<h2>Set up and activate URL rewriting</h2>
+		<p>Take your time, thats where you will chose how your URLs will look like. The zero duplicate options will as well be set up from here when installed.</p>
+	<h2>Accurately chose your forums URL</h2>
+		<p>Using the Mixed or the Advanced mod, you will be able to dissociate Forum URLs from their titles and elect to use whatever keyword you may like in them</p>
+	<h2>Generate a personalized .htaccess</h2>
+	<p>Once you will have set up the above options, you will be able to generate a personalized .htaccess within no time and save it directly on the server.</p>',
+	'UN_SEO_INSTALL_CONGRATS'	=> 'The phpBB SEO ACP module was removed.',
+	'UN_SEO_INSTALL_CONGRATS_EXPLAIN'	=> '<p>You have now successfully uninstalled the %1$s phpBB3 SEO mod rewrite %2$s.<p>
+	<p>This will not deactivate URL rewriting on your board as long as the phpBB files are still modded.</p>',
+	'SEO_VALIDATE_INFO'	=> 'Validation Info :',
+	'SEO_SQL_ERROR' => 'SQL error',
+	'SEO_SQL_TRY_MANUALLY' => 'The db user does not seems to have enough rights to run the required SQL query, please run it manually (phpMyadmin) :',
+	// Security
+	'SEO_LOGIN'		=> 'The board requires you to be registered and logged in to view this page.',
+	'SEO_LOGIN_ADMIN'	=> 'The board requires you to be logged in as admin to view this page.<br/>Your session has been destroyed for security purposes.',
+	'SEO_LOGIN_FOUNDER'	=> 'The board requires you to be logged in as the founder to view this page.',
+	'SEO_LOGIN_SESSION'	=> 'Session Check failed.<br/>The Settings were not altered.<br/>Your session has been destroyed for security purposes.',
+	// Cache status
+	'SEO_CACHE_FILE_TITLE'	=> 'Cache file status',
+	'SEO_CACHE_STATUS'	=> 'The cache directory configured is : <b>%s</b>',
+	'SEO_CACHE_FOUND'	=> 'The cache directory was successfully found.',
+	'SEO_CACHE_NOT_FOUND'	=> 'The cache directory was not found.',
+	'SEO_CACHE_WRITABLE'	=> 'The cache directory is writable.',
+	'SEO_CACHE_UNWRITABLE'	=> 'The cache directory is not writable. You need to CHMOD it to 0777.',
+	'SEO_CACHE_INNER_UNWRITABLE' => 'Some files within the cache directory may not be writable, make sure you properly CHMOD the cache directory AND all files in it.',
+	'SEO_CACHE_FORUM_NAME'	=> 'Forum name',
+	'SEO_CACHE_URL_OK'	=> 'URL Cached',
+	'SEO_CACHE_URL_NOT_OK'	=> 'This Forum URL is not cached',
+	'SEO_CACHE_URL'		=> 'Final URL',
+	'SEO_CACHE_MSG_OK'	=> 'The cache file was updated successfully.',
+	'SEO_CACHE_MSG_FAIL'	=> 'An error occurred while updating the cache file.',
+	'SEO_CACHE_UPDATE_FAIL'	=> 'The URL you entered cannot be used, the cache was left untouched.',
+	// Seo advices
+	'SEO_ADVICE_DUPE'	=> 'A duplicate entry in title was detected for a forum URL : <b>%1$s</b>.<br/>It will stay unchanged until you update it.',
+	'SEO_ADVICE_RESERVED'	=> 'A reserved (used by other urls, such as members profiles and such) entry in title was detected for a forum URL : <b>%1$s</b>.<br/>It will stay unchanged until you update it.',
+	'SEO_ADVICE_LENGTH'	=> 'The URL cached is a bit too long.<br/>Consider using a smaller one',
+	'SEO_ADVICE_DELIM'	=> 'The URL cached contains the SEO delimiter and ID.<br/>Consider setting up an original one.',
+	'SEO_ADVICE_WORDS'	=> 'The URL cached contains a bit too many words.<br/>Consider setting up an better one.',
+	'SEO_ADVICE_DEFAULT'	=> 'The ending URL, after formatting, is the default.<br/>Consider setting up an original one.',
+	'SEO_ADVICE_START'	=> 'Forum URLs cannot end with a pagination parameter.<br/>They were thus removed from the one submitted.',
+	'SEO_ADVICE_DELIM_REM'	=> 'Submitted forum URLs cannot end with a forum delimiter.<br/>They were thus removed from one submitted.',
+	// Mod Rewrite type
+	'ACP_SEO_SIMPLE'	=> 'Simple',
+	'ACP_SEO_MIXED'		=> 'Mixed',
+	'ACP_SEO_ADVANCED'	=> 'Advanced',
+	'ACP_ULTIMATE_SEO_URL'	=> 'Ultimate SEO URL',
+	// URL Sync
+	'SYNC_REQ_SQL_REW' => 'You must activate SQL Rewriting to use this script !',
+	'SYNC_TITLE' => 'URL Synchronization',
+	'SYNC_WARN' => 'Attention, do not stop the script until it ends, and back up your db before you use it!',
+	'SYNC_COMPLETE' => 'Synchronization completed !',
+	'SYNC_RESET_COMPLETE' => 'Reset completed !',
+	'SYNC_PROCESSING' => '<b>Processing, please wait ...</b><br/><br/><b>%1$s%%</b> have been processed. <br/>So far, <b>%2$s</b> items have been processed.<br/><b>%3$s</b> items in total, <b>%4$s</b> are processed at a time.<br/>Speed : <b>%5$s item/s.</b><br/>Time spent for this cycle : <b>%6$ss</b><br/>Estimated time left : <b>%7$s minute(s)</b>',
+	'SYNC_ITEM_UPDATED' => '<b>%1$s</b> items have been updated',
+	'SYNC_TOPIC_URLS' => 'Start topic URLs synchronization',
+	'SYNC_RESET_TOPIC_URLS' => 'Reset all topic URLs',
+	'SYNC_TOPIC_URL_NOTE' => 'You just activated the SQL Rewriting option, you should now synchronize all your topics URLs by going to %sthis page%s if you did not already.<br/>This will not change any of your current URLs<br/><b style="color:red">Please note :</b><br/><em>You should only synchronize your topics URLs once you have fully set up your url standard. Its not a drama if you change your url standard after your synchronized topic URLs, but you should do it again each time you do.<br/>Its not a drama either if you dont, your topic URLs would in such case be updated upon each topic visit in case the topic URL would be empty or not matching your current standard.</em>',
+	// phpBB SEO Class option
+	'url_rewrite' => 'Activate URL rewriting',
+	'url_rewrite_explain' => 'Once you will have set up the below options, and generated your personalized .htaccess, you can activate URL rewriting and check if your rewritten URLs do work properly. If you get 404 errors, its most likely an .htaccess issue, try some of the .htaccess tool option to generate a new one.',
+	'modrtype' => 'URL rewriting type',
+	'modrtype_explain' => 'You have here the choice between three phpBB SEO mod rewrite types.<br/>The <a href="http://www.phpbb-seo.com/en/simple-seo-url/simple-phpbb-seo-url-t1566.html" title="More details about the Simple mod" onclick="window.open(this.href); return false;"><b>Simple</b></a> one,the <a href="http://www.phpbb-seo.com/en/mixed-seo-url/mixed-phpbb-seo-url-t1565.html" title="More details about the Mixed mod" onclick="window.open(this.href); return false;"><b>Mixed</b></a> one and the <a href="http://www.phpbb-seo.com/en/advanced-seo-url/advanced-phpbb-seo-url-t1219.html" title="More details about the Advanced mod" onclick="window.open(this.href); return false;"><b>Advanced</b></a> one.<br/><br/><b style="color:red">Please Note :</b><br/><em>Modifying this option will change all your URLs in your web site.<br/>Doing it with an already indexed web site should thus be considered	with as much care as when migrating and not to often.<br/>So youd better be decided to go for it or not.<br/>Changing this option requires and .htaccess update.</em>',
+	'sql_rewrite' => 'Activate SQL Rewriting',
+	'sql_rewrite_explain' => 'This option will allow you to choose url for each topic. You will be able to accurately set topic url when posting new topic or when editing an existing one. This functionality is though limited to forum admins and moderators.<br/><br/><b style="color:red">Please Note :</b><br/><em>Turning on this option will not change topic urls.  Existing urls will be stored as they are displayed in the data base. But it may not be the case if you turn it off after you started to use it. In such case, personalized URLs may be treated as if they werent.<br/>The feature also has the great advantage to fasten the url rewriting by a lot, especially when using the virtual folder option in advanced mode, and to make it a lot easier to retrieve rewritten urls from any page.</em>',
+	'profile_inj' => 'Profiles and groups injection',
+	'profile_inj_explain' => 'You can here chose to inject nicknames, group names and user messages page (optional see below) in their URLs instead of the default static rewriting, <b>phpBB/nickname-uxx.html</b> instead of <b>phpBB/memberxx.html</b>.',
+	'profile_vfolder' => 'Virtual folder Profiles',
+	'profile_vfolder_explain' => 'You can here chose to simulate a folder structure for profiles and user messages page (optional see below) URLs, <b>phpBB/nickname-uxx/(topics/)</b> or <b>phpBB/memberxx/(topics/)</b> instead of <b>phpBB/nickname-uxx(-topics).html</b> and <b>phpBB/memberxx(-topics).html</b>.<br/><br/><b style="color:red">Please Note</b><br/><em>Profile ID removing will override this setting.<br/>Changing this option requires and .htaccess update</em>',
+	'profile_noids' => 'Profiles ID removing',
+	'profile_noids_explain' => 'When Profiles and groups injection is activated, you can here chose to use <b>example.com/phpBB/member/nickname</b> instead of the default <b>example.com/phpBB/nickname-uxx.html</b>. phpBB Uses an extra, but light, SQL query on such pages without user id.<br/><br/><b style="color:red">Please Note</b><br/><em>Special characters wont be hadled the same by all browser. FF always urlencodes (<a href="http://www.php.net/urlencode">urlencode()</a>), and as it seems using Latin1 first, when IE and Opera do not. For advanced urlencoding options, please read the install file.<br/>Changing this option requires and .htaccess update</em>',
+	'rewrite_usermsg' => 'Common Search and User messages pages rewriting',
+	'rewrite_usermsg_explain' => 'This option mostly makes sens if you allow public access to both profiles and search pages.<br/> Using this option most likely implies a greater use of the search functions and thus a heavier server load.<br/> The URL rewriting type (with and without ID) follows the one set for profiles and groups.<br/><b>phpBB/messages/nickname/topics/</b> VS <b>phpBB/nickname-uxx-topics.html</b> VS <b>phpBB/memberxx-topics.html</b>.<br/>Additionally this options will activate the common search page rewriting, such as active topics, unanswered and newposts pages.<br/><br/><b style="color:red">Please Note :</b><br/><em>ID removing on these links will imply the same limitation as per the user profiles.<br/>Changing this option requires and .htaccess update</em>',
+	'rewrite_files' => 'Attachment Rewriting',
+	'rewrite_files_explain' => 'Activate phpBB Attachment Rewriting. Can be of a great help if you have many attached images worth being indexed. Files of course must be downloadable by bots for this to have a meaning SEOwise.<br/><br/><b style="color:red">Please Note :</b><br/><em>Make sure you have the required RewriteRule (# PHPBB FILES ALL MODES) in your .htaccess when you activate this option</em>',
+	'rem_sid' => 'SID Removing',
+	'rem_sid_explain' => 'SID will be removed from 100% of the URLs passing through the phpbb_seo class, for guests thus bots.<br/>This ensure bots wont see any SID on forum, topic and post URLs, but visitors that do not accept cookies will most likely create more than one session.<br/>The Zero duplicate http 301 redirect url with SID for guest and bots by default.',
+	'rem_hilit' => 'Highlights Removing',
+	'rem_hilit_explain' => 'Highlights will be removed from 100% of the URLs passing through the phpbb_seo class, for guests thus bots.<br/>This ensure bots wont see any Highlights on forum, topic and post URLs.<br/>The Zero duplicate will automatically follow this setting, eg http 301 redirect url with highlights for guest and bots.',
+	'rem_small_words' => 'Remove small words',
+	'rem_small_words_explain' => 'Allow to remove all words of less than three letters in rewritten URLs.<br/><br/><b style="color:red">Please Note</b><br/><em>The filtering will change potentially a lot of URLs in your web site.<br/>Even though the zero duplicate mod would take care of all the required redirecting when changing this option, starting to use it with an already indexed web site should thus be considered	with as much care as when migrating and not too often.<br/>So youd better be decided to go for it or not.</em>',
+	'virtual_folder' => 'Virtual Folder',
+	'virtual_folder_explain' => 'Allow to add the forum URL as a virtual folder in topic URLs.<br/><br/><b>Example :</b><br/><em><b>forum-title-fxx/topic-title-txx.html</b> VS <b>topic-title-txx.html</b> for a topic URL.</em><br/><br/><b style="color:red">Please Note</b><br/><em>The Virtual folder injection option can change all your web sites URLs almost too easily.<br/>Starting to use it with an already indexed web site should thus be considered with as much care as when migrating and not too often.<br/>So youd better be decided to go for it or not.<br/>Changing this option requires and .htaccess update.</em>',
+	'virtual_root' => 'Virtual Root',
+	'virtual_root_explain' => 'If phpBB is installed in a sub folder (example phpBB3/), you can simulate a root install for rewritten links.<br/><br/><b>Example :</b><br/><em><b>phpBB3/forum-title-fxx/topic-title-txx.html</b> VS <b>forum-title-fxx/topic-title-txx.html</b> for a topic URL.</em><br/><br/>This can be handy to shorten URLs a bit, especially if you are using the "Virtual Folder" feature. UnRewritten links will continue to appear and work in the phpBB folder.<br/><br/><b style="color:red">Please Note :</b><br/><em>Using this option requires to use a home page for the forum index (like forum.html).<br/> This option can change all your web sites URLs almost too easily.<br/>Starting to use it with an already indexed web site should thus be considered with as much care as when migrating and not too often.<br/>So youd better be decided to go for it or not.<br/>Changing this option requires and .htaccess update.</em>',
+	'cache_layer' => 'Forum URL caching',
+	'cache_layer_explain' => 'Turns on the cache for forum URLs and allow to separate forum titles from their URL<br/><br/><b>Example :</b><br/><em><b>forum-title-fxx/</b> VS <b>any-title-fxx/</b> for a forum URL.</em><br/><br/><b style="color:red">Please Note</b><br/><em>This option will allow you to change your forum URL, thus potentially many topic URLS if you are using the Virtual Folder option.<br/>The topic URLs will always be redirected properly with the Zero Duplicate.<br/>It will as well be the case for forum URL as long as you keep the delimiter and IDs, see below.</em>',
+	'rem_ids' => 'Forum ID Removing',
+	'rem_ids_explain' => 'Get rid of the IDs and delimiters in forum URLs. Only apply if Forum URL caching is activated.<br/><br/><b>Example :</b><br/><em><b>any-title-fxx/</b> VS <b>any-title/</b> for a forum URL.</em><br/><br/><b style="color:red">Please Note :</b><br/><em>This option will allow you to change your forum URL, thus potentially many topic URLS if you are using the Virtual Folder option.<br/>The topic URLs will always be redirected properly with the Zero Duplicate.<br/><b>It will not always be the case with the forum URLs :</b><br/><b>any-title-fxx/</b> will always be properly redirected with the Zero Duplicate but it wont be the case if you edit <b>any-title/</b> to <b>something-else/</b>.<br/> In such case, <b>any-title/</b> will for now be treated as a forum that does not exist.<br/>So youd better be decided to go for it or not, but it can really be powerful SEO wise.</em>',
+	// copyrights
+	'copyrights' => 'Copyrights',
+	'copyrights_img' => 'Link image',
+	'copyrights_img_explain' => 'You can here chose to display the phpBB SEO copyright link as an image or as a text links.',
+	'copyrights_txt' => 'Link text',
+	'copyrights_txt_explain' => 'You can here chose the text to be used as the phpBB SEO copyright link text anchor. Leave empty for defaults.',
+	'copyrights_title' => 'Link title',
+	'copyrights_title_explain' => 'You can here chose the text to be used as the phpBB SEO copyright link title. Leave empty for defaults.',
+	// Zero duplicate
+	// Options
+	'ACP_ZERO_DUPE_OFF' => 'Off',
+	'ACP_ZERO_DUPE_MSG' => 'Post',
+	'ACP_ZERO_DUPE_GUEST' => 'Guest',
+	'ACP_ZERO_DUPE_ALL' => 'All',
+	'zero_dupe' =>'Zero duplicate',
+	'zero_dupe_explain' => 'The following settings concerns the Zero duplicate, you can modify them upon your needs.<br/>These do not imply any .htacess update.',
+	'zero_dupe_on' => 'Activate the Zero duplicate',
+	'zero_dupe_on_explain' => 'Allow to activate and deactivate the Zero duplicate redirections.',
+	'zero_dupe_strict' => 'Strict Mode',
+	'zero_dupe_strict_explain' => 'When activated, the zero dupe will check if the requested URL exactly matches the one attended.<br/>When set to no, the zero dupe will make sure the attended url is the fist part of the one requested.<br/>The interest is to make it easier to deal with mods that could interfere with the zero dupe by adding GET vars.',
+	'zero_dupe_post_redir' => 'Posts Redirections',
+	'zero_dupe_post_redir_explain' => 'This option will determine how to handle post urls; it can take four values :<br/><b>&nbsp;off</b>, do not redirect post url, whatever the case,<br/><b>&nbsp;post</b>, only make sure postxx.html is used for a post url,<br/><b>&nbsp;guest</b>, redirect guests if required to the corresponding topic url rather than to the postxx.html, and only make sure postxx.html is used for logged users,<br/><b>&nbsp;all</b>, redirect if required to the corresponding topic url.<br/><br/><b style="color:red">Please Note</b><br/><em>Keeping the <b>postxx.html</b> URLs is harmless SEO wise as long as you keep the disallow on post urls in your robots.txt.<br/>Redirecting them all will most likely produce the most redirections among all.<br/>If you redirect postxx.html in all cases, this as well mean that a message that would be posted in a thread and then moved in another one will see its url changing, which thanks to the zero duplicate mod is of no harm SEO wise, but the previous link to the post wont link to it anymore in such case.</em>.',
+	// no duplicate
+	'no_dupe' => 'No duplicate',
+	'no_dupe_on' => 'Activate The No duplicate',
+	'no_dupe_on_explain' => 'The No duplicate mod replaces posts URLs with the corresponding Topic URL (with pagination).<br/>It does not add any SQL, just a LEFT JOIN on a query already being performed, this could still mean a bit more work but should not be a problem for server load.',
+));
+?>
\ No newline at end of file
Index: language/en/mods/phpbb_seo_related_install.php
===================================================================
--- language/en/mods/phpbb_seo_related_install.php	(phpBB 3.0.8)
+++ language/en/mods/phpbb_seo_related_install.php	(Premod 3.0.8)
@@ -0,0 +1,64 @@
+<?php
+/**
+*
+* acp_phpbb_seo [english]
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: phpbb_seo_related_install.php 202 2009-12-20 12:04:05Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/licenses/gpl-license.php GNU Public License v2
+*
+*/
+/**
+* DO NOT CHANGE
+*/
+if (!defined('IN_PHPBB'))
+{
+	exit;
+}
+
+if (empty($lang) || !is_array($lang))
+{
+	$lang = array();
+}
+// DEVELOPERS PLEASE NOTE
+//
+// All language files should use UTF-8 as their encoding and the files must not contain a BOM.
+//
+// Placeholders can now contain order information, e.g. instead of
+// 'Page %s of %s' you can (and should) write 'Page %1$s of %2$s', this allows
+// translators to re-order the output of data while ensuring it remains correct
+//
+// You do not need this where single placeholders are used, e.g. 'Message %d' is fine
+// equally where a string contains only two placeholders which are used to wrap text
+// in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
+$lang = array_merge($lang, array(
+	// ACP
+	'SEO_RELATED' => 'Related topics activation',
+	'SEO_RELATED_EXPLAIN' => 'Display or not a related topic list in topic pages.<br/><b style="color:red;">Note :</b><br/>With mySQL >=4.1 and the topic table using MyISAM, related topics will be obtained using a FullText index on  the topic title and will be sorted by relevancy. in other cases, an SQL LIKE will be used, and results will be sorted by publication time',
+	'SEO_RELATED_CHECK_IGNORE' => 'Ignore words filter',
+	'SEO_RELATED_CHECK_IGNORE_EXPLAIN' => 'Apply, or not, the search_ignore_words.php exclusions while searching for related topics',
+	'SEO_RELATED_LIMIT' => 'Related topics limit',
+	'SEO_RELATED_LIMIT_EXPLAIN' => 'Maximum amount of related topics to display',
+	'SEO_RELATED_ALLFORUMS' => 'Search in all forums',
+	'SEO_RELATED_ALLFORUMS_EXPLAIN' => 'Search in all forums instead of searching in the current one.<br/><b style="color:red;">Note :</b><br/>Searching in all forums is a bit slower and does not necessarily bring better results',
+	// Install
+	'INSTALLED' => 'phpBB SEO Related Topics mod installed',
+	'ALREADY_INSTALLED' => 'phpBB SEO Related Topics mod is already installed',
+	'FULLTEXT_INSTALLED' => 'MySQL FullText Index installed',
+	'FULLTEXT_NOT_INSTALLED' => 'MySQL FullText Index is not available on this server, SQL LIKE will be used instead',
+	'INSTALLATION' => 'phpBB SEO Related Topics mod installation',
+	'INSTALLATION_START' => '&rArr; <a href="%1$s" ><b>Proceed with installing the mod</b></a><br/><br/>&rArr; <a href="%2$s" ><b>Retry to set the FullText Index</b></a> (MySQL >= 4.1 using Myisam for topic table only)<br/><br/>&rArr; <a href="%3$s" ><b>Proceed with un-installing the mod</b></a>',
+	// un-install
+	'UNINSTALLED' => 'phpBB SEO Related Topics mod un-installed',
+	'ALREADY_UNINSTALLED' => 'phpBB SEO Related Topics mod is already un-installed',
+	'UNINSTALLATION' => 'phpBB SEO Related Topics mod un-installation',
+	// SQL message
+	'SQL_REQUIRED' => 'The configured db user does not have enough privileges to alter tables, you need to run this query manually in order to add or drop the MySQL FullText index :<br/>%1$s',
+	// Security
+	'SEO_LOGIN'		=> 'The board requires you to be registered and logged in to view this page.',
+	'SEO_LOGIN_ADMIN'	=> 'The board requires you to be logged in as admin to view this page.<br/>Your session has been destroyed for security purposes.',
+	'SEO_LOGIN_FOUNDER'	=> 'The board requires you to be logged in as the founder to view this page.',
+	'SEO_LOGIN_SESSION'	=> 'Session Check failed.<br/>The Settings were not altered.<br/>Your session has been destroyed for security purposes.',
+));
+?>
\ No newline at end of file
Index: language/en/search_ignore_words.php
===================================================================
--- language/en/search_ignore_words.php	(revision 1)
+++ language/en/search_ignore_words.php	(Premod 3.0.8)
@@ -16,7 +16,6 @@
 }
 
 $words = array(
-	'a',
 	'about',
 	'after',
 	'ago',
@@ -25,8 +24,6 @@
 	'along',
 	'alot',
 	'also',
-	'am',
-	'an',
 	'and',
 	'answer',
 	'any',
@@ -36,12 +33,9 @@
 	'are',
 	'arent',
 	'around',
-	'as',
 	'ask',
 	'askd',
-	'at',
 	'bad',
-	'be',
 	'because',
 	'been',
 	'before',
@@ -52,7 +46,6 @@
 	'big',
 	'btw',
 	'but',
-	'by',
 	'can',
 	'cant',
 	'come',
@@ -63,7 +56,6 @@
 	'days',
 	'did',
 	'didnt',
-	'do',
 	'does',
 	'doesnt',
 	'dont',
@@ -84,7 +76,6 @@
 	'found',
 	'from',
 	'get',
-	'go',
 	'going',
 	'gone',
 	'good',
@@ -104,15 +95,10 @@
 	'how',
 	'hows',
 	'href',
-	'I',
 	'Ive',
-	'if',
-	'in',
 	'ini',
 	'into',
-	'is',
 	'isnt',
-	'it',
 	'its',
 	'its',
 	'just',
@@ -129,32 +115,26 @@
 	'lot',
 	'maybe',
 	'many',
-	'me',
 	'more',
 	'most',
 	'much',
 	'must',
 	'mustnt',
-	'my',
 	'near',
 	'need',
 	'never',
 	'new',
 	'news',
-	'no',
 	'none',
 	'not',
 	'nothing',
 	'now',
-	'of',
 	'off',
 	'often',
 	'old',
-	'on',
 	'once',
 	'only',
 	'oops',
-	'or',
 	'other',
 	'our',
 	'ours',
@@ -180,7 +160,6 @@
 	'should',
 	'sites',
 	'small',
-	'so',
 	'some',
 	'something',
 	'sometime',
@@ -213,12 +192,10 @@
 	'thus',
 	'time',
 	'times',
-	'to',
 	'too',
 	'under',
 	'until',
 	'untrue',
-	'up',
 	'upon',
 	'use',
 	'users',
@@ -228,7 +205,6 @@
 	'want',
 	'was',
 	'way',
-	'we',
 	'well',
 	'went',
 	'were',
@@ -261,12 +237,12 @@
 	'your',
 	'youre',
 	'yours',
-	'AFAIK',
-	'IIRC',
-	'LOL',
-	'ROTF',
-	'ROTFLMAO',
-	'YMMV',
+	'afaik',
+	'iirc',
+	'lol',
+	'rotf',
+	'rotflmao',
+	'ymmv',
 );
 
 ?>
\ No newline at end of file
Index: language/en/common.php
===================================================================
--- language/en/common.php	(revision 1)
+++ language/en/common.php	(Premod 3.0.8)
@@ -876,5 +876,19 @@
 	'default_dateformat'	=> 'D M d, Y g:i a', // Mon Jan 01, 2007 1:37 pm
 
 ));
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+$lang['Page'] = 'Page ';
+// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> GYM Sitemaps
+$lang = array_merge($lang, array(
+	'GYM_LINKS' => 'Links',
+	'GYM_LINK' => 'Link',
+	'GYM_RSS_SLIDE_START' => 'Start scroller',
+	'GYM_RSS_SLIDE_STOP' => 'Stop scroller',
+	'GYM_RSS_SOURCE' => 'Source',
+));
+// www.phpBB-SEO.com SEO TOOLKIT END -> GYM Sitemaps
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Related Topics
+$lang['RELATED_TOPICS'] = 'Related topics';
+// www.phpBB-SEO.com SEO TOOLKIT END - Related Topics
 ?>
\ No newline at end of file
Index: sitemap.php
===================================================================
--- sitemap.php	(phpBB 3.0.8)
+++ sitemap.php	(Premod 3.0.8)
@@ -0,0 +1,24 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: sitemap.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+define('IN_PHPBB', true);
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+$phpbb_root_path = './';
+include($phpbb_root_path . 'common.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+
+$user->setup('gym_sitemaps/gym_common');
+// Start the process
+require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_google.' . $phpEx);
+
+$gym_google  = new gym_google();
+exit;
+?>
\ No newline at end of file
Index: search.php
===================================================================
--- search.php	(revision 1)
+++ search.php	(Premod 3.0.8)
@@ -20,7 +20,17 @@
 $user->session_begin();
 $auth->acl($user->data);
 $user->setup('search');
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+$clean_request = array('keywords', 'author', 'add_keywords');
+foreach ($clean_request as $request) {
+	if (!empty($_REQUEST[$request])) {
+		$_REQUEST[$request] = rawurldecode($_REQUEST[$request]);
+		if (!$phpbb_seo->is_utf8($_REQUEST[$request])) {
+			$_REQUEST[$request] = utf8_normalize_nfc(utf8_recode($_REQUEST[$request], 'iso-8859-1'));
+		}
+	}
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 // Define initial vars
 $mode			= request_var('mode', '');
 $search_id		= request_var('search_id', '');
@@ -313,6 +323,14 @@
 				$sort_key = 't';
 				$sort_dir = 'd';
 				$sort_days = request_var('st', 7);
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+				$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+					'search_id' => array('val' => 'active_topics', 'keep' => true),
+					'st' => array('val' => $sort_days, 'keep' => (boolean) ($sort_days != 7) ),
+					'start' => array('val' => $phpbb_seo->seo_chk_start( $start, $config['topics_per_page'] ), 'keep' => true),
+				);
+				$phpbb_seo->seo_chk_dupe();
+				// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 				$sort_by_sql['t'] = 't.topic_last_post_time';
 
 				gen_sort_selects($limit_days, $sort_by_text, $sort_days, $sort_key, $sort_dir, $s_limit_days, $s_sort_key, $s_sort_dir, $u_sort_param);
@@ -334,6 +352,17 @@
 				$l_search_title = $user->lang['SEARCH_UNANSWERED'];
 				$show_results = request_var('sr', 'topics');
 				$show_results = ($show_results == 'posts') ? 'posts' : 'topics';
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+				$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+					'sr' => array('val' => $show_results, 'keep' => (boolean) ($show_results == 'posts') ),
+					'st' => array('val' => $sort_days, 'keep' => true),
+					'sk' => array('val' => $sort_key, 'keep' => true),
+					'sd' => array('val' => $sort_dir, 'keep' => true),
+					'search_id' => array('val' => 'unanswered', 'keep' => true),
+					'start' => array('val' => $phpbb_seo->seo_chk_start( $start, ($show_results == 'posts' ? $config['posts_per_page'] : $config['topics_per_page']) ), 'keep' => true),
+				);
+				$phpbb_seo->seo_chk_dupe();
+				// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 				$sort_by_sql['t'] = ($show_results == 'posts') ? 'p.post_time' : 't.topic_last_post_time';
 				$sort_by_sql['s'] = ($show_results == 'posts') ? 'p.post_subject' : 't.topic_title';
 				$sql_sort = 'ORDER BY ' . $sort_by_sql[$sort_key] . (($sort_dir == 'a') ? ' ASC' : ' DESC');
@@ -386,6 +415,14 @@
 				$l_search_title = $user->lang['SEARCH_UNREAD'];
 				// force sorting
 				$show_results = 'topics';
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+				$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+					'search_id' => array('val' => 'unreadposts', 'keep' => true),
+					'sr' => array('val' => $show_results, 'keep' => (boolean) ($show_results != 'topics') ),
+					'start' => array('val' => $phpbb_seo->seo_chk_start( $start, ($show_results == 'posts' ? $config['posts_per_page'] : $config['topics_per_page']) ), 'keep' => true),
+				);
+				$phpbb_seo->seo_chk_dupe();
+				// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 				$sort_key = 't';
 				$sort_by_sql['t'] = 't.topic_last_post_time';
 				$sql_sort = 'ORDER BY ' . $sort_by_sql[$sort_key] . (($sort_dir == 'a') ? ' ASC' : ' DESC');
@@ -402,6 +439,14 @@
 				$l_search_title = $user->lang['SEARCH_NEW'];
 				// force sorting
 				$show_results = (request_var('sr', 'topics') == 'posts') ? 'posts' : 'topics';
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+				$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+					'search_id' => array('val' => 'newposts', 'keep' => true),
+					'sr' => array('val' => $show_results, 'keep' => (boolean) ($show_results == 'posts') ),
+					'start' => array('val' => $phpbb_seo->seo_chk_start( $start, $config['topics_per_page'] ), 'keep' => true),
+				);
+				$phpbb_seo->seo_chk_dupe();
+				// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 				$sort_key = 't';
 				$sort_dir = 'd';
 				$sort_by_sql['t'] = ($show_results == 'posts') ? 'p.post_time' : 't.topic_last_post_time';
@@ -551,7 +596,9 @@
 	$u_show_results = '&amp;sr=' . $show_results;
 	$u_search_forum = implode('&amp;fid%5B%5D=', $search_forum);
 
-	$u_search = append_sid("{$phpbb_root_path}search.$phpEx", $u_sort_param . $u_show_results);
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	//$u_search = append_sid("{$phpbb_root_path}search.$phpEx", $u_sort_param . $u_show_results);
+	$u_search = $u_sort_param . $u_show_results;
 	$u_search .= ($search_id) ? '&amp;search_id=' . $search_id : '';
 	$u_search .= ($u_hilit) ? '&amp;keywords=' . urlencode(htmlspecialchars_decode($keywords)) : '';
 	$u_search .= ($search_terms != 'all') ? '&amp;terms=' . $search_terms : '';
@@ -562,7 +609,43 @@
 	$u_search .= (!$search_child) ? '&amp;sc=0' : '';
 	$u_search .= ($search_fields != 'all') ? '&amp;sf=' . $search_fields : '';
 	$u_search .= ($return_chars != 300) ? '&amp;ch=' . $return_chars : '';
-
+	$u_search = preg_replace('`(^&amp;|&amp;$)`i', '', $u_search);
+	if ( $phpbb_seo->seo_opt['rewrite_usermsg'] && (!empty($author) || !empty($author_id)) ) {
+		$author_name = '';
+		if (!empty($author_id)) {
+			$sql = $sql = 'SELECT username
+				FROM ' . USERS_TABLE . "
+				WHERE user_id = $author_id
+				AND user_type IN (" . USER_NORMAL . ', ' . USER_FOUNDER . ')';
+			$result = $db->sql_query($sql);
+			if ($row = $db->sql_fetchrow($result)) {
+				$author_name = $row['username'];
+				$phpbb_seo->set_user_url( $author_name, $author_id );
+			}
+		}
+		if (!empty($author) && (strpos($author, '*') === false) ) {
+			$sql = $sql = 'SELECT user_id
+				FROM ' . USERS_TABLE . "
+				WHERE username_clean = '" . $db->sql_escape(utf8_clean_string($author)) . "'
+				AND user_type IN (" . USER_NORMAL . ', ' . USER_FOUNDER . ')';
+			$result = $db->sql_query($sql);
+			if ($row = $db->sql_fetchrow($result)) {
+				$phpbb_seo->set_user_url( $author, $row['user_id'] );
+			}
+		}
+		$author = empty($author) ? $author_name : $author;
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+		if (!$submit && !$u_search_forum) {
+			$seo_search_params = (!empty($u_search) ? '?' . $u_search . '&amp;': '?') .  'start=' .  $phpbb_seo->seo_chk_start( $start, $per_page );
+			$phpbb_seo->seo_chk_dupe("{$phpbb_root_path}search.$phpEx$seo_search_params");
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
+	}
+	$u_search = append_sid( "{$phpbb_root_path}search.$phpEx" . (!empty($u_search) ? '?' . $u_search : '') );
+	// www.phpBB-SEO.com SEO TOOLKIT END
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+	$l_search_title = empty($l_search_title) && !empty($author) ? $author  . ' - ' . ($show_results != 'posts' ? $user->lang['TOPICS'] : $user->lang['POSTS']) : $l_search_title;
+	// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
 	$template->assign_vars(array(
 		'SEARCH_TITLE'		=> $l_search_title,
 		'SEARCH_MATCHES'	=> $l_search_matches,
@@ -847,7 +930,10 @@
 			{
 				$u_forum_id = $forum_id;
 			}
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			$phpbb_seo->set_url($row['forum_name'], $u_forum_id, 'forum');
+			$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$u_forum_id]);
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			$view_topic_url_params = "f=$u_forum_id&amp;t=$result_topic_id" . (($u_hilit) ? "&amp;hilit=$u_hilit" : '');
 			$view_topic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", $view_topic_url_params);
 
@@ -1002,7 +1088,10 @@
 	}
 	unset($rowset);
 
-	page_header(($l_search_title) ? $l_search_title : $user->lang['SEARCH']);
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+	$extra_title = ($start > 0) ? ' - ' . $user->lang['Page'] . ( floor( $start / $per_page ) + 1 ) : '';
+	page_header( ( ($l_search_title) ? $l_search_title . (!empty($search->search_query) ? ' : ' . $search->search_query : '' ): $user->lang['SEARCH'] ) . $extra_title );
+	// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
 
 	$template->set_filenames(array(
 		'body' => 'search_results.html')
Index: viewtopic.php
===================================================================
--- viewtopic.php	(revision 1)
+++ viewtopic.php	(Premod 3.0.8)
@@ -17,7 +17,20 @@
 include($phpbb_root_path . 'common.' . $phpEx);
 include($phpbb_root_path . 'includes/functions_display.' . $phpEx);
 include($phpbb_root_path . 'includes/bbcode.' . $phpEx);
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+if (empty($_REQUEST['f'])) {
+	$phpbb_seo->get_forum_id($session_forum_id);
+	if ($session_forum_id > 0) {
+		$_REQUEST['f'] = (int) $session_forum_id;
+	}
+}
+if (!empty($_REQUEST['hilit'])) {
+	$_REQUEST['hilit'] = rawurldecode($_REQUEST['hilit']);
+	if (!$phpbb_seo->is_utf8($_REQUEST['hilit'])) {
+		$_REQUEST['hilit'] = utf8_normalize_nfc(utf8_recode($_REQUEST['hilit'], 'iso-8859-1'));
+	}
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 // Start session management
 $user->session_begin();
 $auth->acl($user->data);
@@ -330,6 +343,40 @@
 }
 
 $topic_id = (int) $topic_data['topic_id'];
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+$phpbb_seo->set_url($topic_data['forum_name'], $forum_id, 'forum');
+if ($topic_data['topic_type'] == POST_GLOBAL) {
+	// Let's make sure user will see global annoucements
+	$auth->cache[$forum_id]['f_read'] = 1;
+	$_parent = $phpbb_seo->seo_static['global_announce'];
+} else {
+	$_parent = $phpbb_seo->seo_url['forum'][$forum_id];
+}
+if (!empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+	if ( !$phpbb_seo->check_url('topic', $topic_data['topic_url'], $_parent)) {
+		if (!empty($topic_data['topic_url'])) {
+			// Here we get rid of the seo delim (-t) and put it back even in simple mod
+			// to be able to handle all cases at once
+			$_url = preg_replace('`' . $phpbb_seo->seo_delim['topic'] . '$`i', '', $topic_data['topic_url']);
+			$_title = $phpbb_seo->get_url_info('topic', $_url . $phpbb_seo->seo_delim['topic'] . $topic_id, 'title');
+		} else {
+			$_title = $phpbb_seo->modrtype > 2 ? censor_text($topic_data['topic_title']) : '';
+		}
+		unset($phpbb_seo->seo_url['topic'][$topic_id]);
+		$topic_data['topic_url'] = $phpbb_seo->get_url_info('topic', $phpbb_seo->prepare_url( 'topic', $_title, $topic_id, $_parent, (( empty($_title) || ($_title == $phpbb_seo->seo_static['topic']) ) ? true : false) ), 'url');
+		unset($phpbb_seo->seo_url['topic'][$topic_id]);
+		if ($topic_data['topic_url']) {
+			// Update the topic_url field for later re-use
+			$sql = "UPDATE " . TOPICS_TABLE . " SET topic_url = '" . $db->sql_escape($topic_data['topic_url']) . "'
+				WHERE topic_id = $topic_id";
+			$db->sql_query($sql);
+		}
+	}
+} else {
+	$topic_data['topic_url'] = '';
+}
+$phpbb_seo->prepare_iurl($topic_data, 'topic', $_parent);
+// www.phpBB-SEO.com SEO TOOLKIT END
 //
 $topic_replies = ($auth->acl_get('m_approve', $forum_id)) ? $topic_data['topic_replies_real'] : $topic_data['topic_replies'];
 
@@ -376,17 +423,23 @@
 {
 	$jump_to = request_var('e', 0);
 
-	$redirect_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id");
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	//$redirect_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id");
+	// www.phpBB-SEO.com SEO TOOLKIT END
 
 	if ($user->data['user_id'] == ANONYMOUS)
 	{
-		login_box($redirect_url . "&amp;p=$post_id&amp;e=$jump_to", $user->lang['LOGIN_NOTIFY_TOPIC']);
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		login_box(append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;p=$post_id&amp;e=$jump_to"), $user->lang['LOGIN_NOTIFY_TOPIC']);
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 
 	if ($jump_to > 0)
 	{
 		// We direct the already logged in user to the correct post...
-		redirect($redirect_url . ((!$post_id) ? "&amp;p=$jump_to" : "&amp;p=$post_id") . "#p$jump_to");
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		redirect(append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id" . ((!$post_id) ? "&amp;p=$jump_to" : "&amp;p=$post_id")) . "#p$jump_to");
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 }
 
@@ -475,7 +528,48 @@
 {
 	$start = ($start < 0) ? 0 : floor(($total_posts - 1) / $config['posts_per_page']) * $config['posts_per_page'];
 }
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+$phpbb_seo->seo_opt['zero_dupe']['start'] = $phpbb_seo->seo_chk_start( $start, $config['posts_per_page'] );
+if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+	$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;start=$start"));
+}
+if ( $post_id && !$view && !$phpbb_seo->set_do_redir_post()) {
+	$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+		'p' => array('val' => $post_id, 'keep' => true, 'force' => true, 'hash' => "p$post_id"),
+		'hilit' => array('val' => (($highlight_match) ? $highlight : ''), 'keep' => !empty($highlight_match)),
+	);
+} else {
+	$seo_watch = request_var('watch', '');
+	$seo_unwatch = request_var('unwatch', '');
+	$seo_bookmark = request_var('bookmark', 0);
+	$keep_watch = (boolean) ($seo_watch == 'topic' && $user->data['is_registered']);
+	$keep_unwatch = (boolean) ($seo_unwatch == 'topic' && $user->data['is_registered']);
+	$keep_hash = (boolean) ($keep_watch || $keep_unwatch || $seo_bookmark);
+	$seo_uid = max(0, request_var('uid', 0));
+	$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+		'uid' => array('val' => $seo_uid, 'keep' => (boolean) ($keep_hash && $seo_uid)),
+		'f' => array('val' => $forum_id, 'keep' => true, 'force' => true),
+		't' => array('val' => $topic_id, 'keep' => true, 'force' => true, 'hash' => $post_id ? "p$post_id" : ''),
+		'p' => array('val' => $post_id, 'keep' =>  ($post_id && $view == 'show' ? true : false), 'hash' => "p$post_id"),
+		'watch' => array('val' => $seo_watch, 'keep' => $keep_watch),
+		'unwatch' => array('val' => $seo_unwatch, 'keep' => $keep_unwatch),
+		'bookmark' => array('val' => $seo_bookmark, 'keep' => (boolean) ($user->data['is_registered'] && $config['allow_bookmarks'] && $seo_bookmark)),
+		'start' => array('val' => $phpbb_seo->seo_opt['zero_dupe']['start'], 'keep' => true, 'force' => true),
+		'hash' => array('val' => request_var('hash', ''), 'keep' => $keep_hash),
+		'st' => array('val' => $sort_days, 'keep' => true),
+		'sk' => array('val' => $sort_key, 'keep' => true),
+		'sd' => array('val' => $sort_dir, 'keep' => true),
+		'view' => array('val' => $view, 'keep' => $view == 'print' ? (boolean) $auth->acl_get('f_print', $forum_id) : (($view == 'viewpoll' || $view == 'show') ? true : false)),
+		'hilit' => array('val' => (($highlight_match) ? $highlight : ''), 'keep' => (boolean) !(!$user->data['is_registered'] && $phpbb_seo->seo_opt['rem_hilit'])),
+	);
+	if ($phpbb_seo->seo_opt['zero_dupe']['redir_def']['bookmark']['keep']) { // Prevent unessecary redirections
+		// Note : bookmark, watch and unwatch cases could just not be handled by the zero dupe (no redirect at all when used),
+		// but the handling as well acts as a poweful security shield so, it's worth it ;)
+		unset($phpbb_seo->seo_opt['zero_dupe']['redir_def']['start']);
+	}
+}
+$phpbb_seo->seo_chk_dupe();
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 // General Viewtopic URL for return links
 $viewtopic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id" . (($start == 0) ? '' : "&amp;start=$start") . ((strlen($u_sort_param)) ? "&amp;$u_sort_param" : '') . (($highlight_match) ? "&amp;hilit=$highlight" : ''));
 
@@ -642,20 +736,26 @@
 	'S_DISPLAY_REPLY_INFO'	=> ($topic_data['forum_type'] == FORUM_POST && ($auth->acl_get('f_reply', $forum_id) || $user->data['user_id'] == ANONYMOUS)) ? true : false,
 	'S_ENABLE_FEEDS_TOPIC'	=> ($config['feed_topic'] && !phpbb_optionget(FORUM_OPTION_FEED_EXCLUDE, $topic_data['forum_options'])) ? true : false,
 
-	'U_TOPIC'				=> "{$server_path}viewtopic.$phpEx?f=$forum_id&amp;t=$topic_id",
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	'U_TOPIC'				=> !empty($phpbb_seo->seo_opt['url_rewrite']) ? $phpbb_seo->drop_sid($viewtopic_url) : "{$server_path}viewtopic.$phpEx?f=$forum_id&amp;t=$topic_id",
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	'U_FORUM'				=> $server_path,
 	'U_VIEW_TOPIC' 			=> $viewtopic_url,
 	'U_VIEW_FORUM' 			=> append_sid("{$phpbb_root_path}viewforum.$phpEx", 'f=' . $forum_id),
 	'U_VIEW_OLDER_TOPIC'	=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;view=previous"),
 	'U_VIEW_NEWER_TOPIC'	=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;view=next"),
-	'U_PRINT_TOPIC'			=> ($auth->acl_get('f_print', $forum_id)) ? $viewtopic_url . '&amp;view=print' : '',
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	'U_PRINT_TOPIC'			=> ($auth->acl_get('f_print', $forum_id)) ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;start=$start" . ((strlen($u_sort_param)) ? "&amp;$u_sort_param" : '') . (($highlight_match) ? "&amp;hilit=$highlight" : '') . "&amp;view=print") : '',
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	'U_EMAIL_TOPIC'			=> ($auth->acl_get('f_email', $forum_id) && $config['email_enable']) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=email&amp;t=$topic_id") : '',
 
 	'U_WATCH_TOPIC' 		=> $s_watching_topic['link'],
 	'L_WATCH_TOPIC' 		=> $s_watching_topic['title'],
 	'S_WATCHING_TOPIC'		=> $s_watching_topic['is_watching'],
 
-	'U_BOOKMARK_TOPIC'		=> ($user->data['is_registered'] && $config['allow_bookmarks']) ? $viewtopic_url . '&amp;bookmark=1&amp;hash=' . generate_link_hash("topic_$topic_id") : '',
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	'U_BOOKMARK_TOPIC'		=> ($user->data['is_registered'] && $config['allow_bookmarks']) ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;bookmark=1&amp;hash=" . generate_link_hash("topic_$topic_id")) : '',
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	'L_BOOKMARK_TOPIC'		=> ($user->data['is_registered'] && $config['allow_bookmarks'] && $topic_data['bookmarked']) ? $user->lang['BOOKMARK_TOPIC_REMOVE'] : $user->lang['BOOKMARK_TOPIC'],
 
 	'U_POST_NEW_TOPIC' 		=> ($auth->acl_get('f_post', $forum_id) || $user->data['user_id'] == ANONYMOUS) ? append_sid("{$phpbb_root_path}posting.$phpEx", "mode=post&amp;f=$forum_id") : '',
@@ -884,7 +984,9 @@
 		'S_IS_MULTI_CHOICE'	=> ($topic_data['poll_max_options'] > 1) ? true : false,
 		'S_POLL_ACTION'		=> $viewtopic_url,
 
-		'U_VIEW_RESULTS'	=> $viewtopic_url . '&amp;view=viewpoll')
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		'U_VIEW_RESULTS'	=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;view=viewpoll") )
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	);
 
 	unset($poll_end, $poll_info, $voted_id);
@@ -998,7 +1100,9 @@
 	}
 
 	$poster_id = (int) $row['poster_id'];
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	$phpbb_seo->set_user_url( $row['username'], $poster_id );
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Does post have an attachment? If so, add it to the list
 	if ($row['post_attachment'] && $config['allow_attachments'])
 	{
@@ -1352,7 +1456,29 @@
 
 	// Parse the message and subject
 	$message = censor_text($row['post_text']);
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN  - META
+	if ($i == 0) {
+		$m_kewrd = '';
+		$seo_meta->collect('description', $message);
+		if ($seo_meta->mconfig['topic_sql']) {
+			$common_sql = $seo_meta->mconfig['bypass_common'] ? '' : 'AND w.word_common = 0';
+			// collect keywords from all post in page
+			$post_id_sql = $db->sql_in_set('m.post_id', $post_list, false, true);
+			$sql = "SELECT w.word_text
+				FROM " . SEARCH_WORDMATCH_TABLE . " m, " . SEARCH_WORDLIST_TABLE . " w
+				WHERE $post_id_sql
+					AND w.word_id = m.word_id
+					$common_sql
+				ORDER BY w.word_count DESC";
+			$result = $db->sql_query_limit($sql, min(25, (int) $seo_meta->mconfig['keywordlimit']));
+			while ( $meta_row = $db->sql_fetchrow($result) ) {
+				$m_kewrd .= ' ' . $meta_row['word_text'];
+			}
+			$db->sql_freeresult($result);
+		}
+		$seo_meta->collect('keywords', $topic_data['topic_title'] . ' ' . $row['post_subject'] . ' ' . (!empty($m_kewrd) ? $m_kewrd : $seo_meta->meta['description']));
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END  - META
 	// Second parse bbcode here
 	if ($row['bbcode_bitfield'])
 	{
@@ -1540,7 +1666,9 @@
 		'U_REPORT'			=> ($auth->acl_get('f_report', $forum_id)) ? append_sid("{$phpbb_root_path}report.$phpEx", 'f=' . $forum_id . '&amp;p=' . $row['post_id']) : '',
 		'U_MCP_REPORT'		=> ($auth->acl_get('m_report', $forum_id)) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=reports&amp;mode=report_details&amp;f=' . $forum_id . '&amp;p=' . $row['post_id'], true, $user->session_id) : '',
 		'U_MCP_APPROVE'		=> ($auth->acl_get('m_approve', $forum_id)) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=queue&amp;mode=approve_details&amp;f=' . $forum_id . '&amp;p=' . $row['post_id'], true, $user->session_id) : '',
-		'U_MINI_POST'		=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'p=' . $row['post_id']) . (($topic_data['topic_type'] == POST_GLOBAL) ? '&amp;f=' . $forum_id : '') . '#p' . $row['post_id'],
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+		'U_MINI_POST' => @$phpbb_seo->seo_opt['no_dupe']['on'] ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", 't=' . $topic_id . '&amp;f=' . $forum_id . '&amp;start=' . $start ) . '#p' . $row['post_id'] : append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'p=' . $row['post_id'] . (($topic_data['topic_type'] == POST_GLOBAL) ? '&amp;f=' . $forum_id : '')) . '#p' . $row['post_id'],
+		// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 		'U_NEXT_POST_ID'	=> ($i < $i_total && isset($rowset[$post_list[$i + 1]])) ? $rowset[$post_list[$i + 1]]['post_id'] : '',
 		'U_PREV_POST_ID'	=> $prev_post_id,
 		'U_NOTES'			=> ($auth->acl_getf_global('m_')) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=notes&amp;mode=user_notes&amp;u=' . $poster_id, true, $user->session_id) : '',
@@ -1560,7 +1688,9 @@
 		'S_TOPIC_POSTER'	=> ($topic_data['topic_poster'] == $poster_id) ? true : false,
 
 		'S_IGNORE_POST'		=> ($row['hide_post']) ? true : false,
-		'L_IGNORE_POST'		=> ($row['hide_post']) ? sprintf($user->lang['POST_BY_FOE'], get_username_string('full', $poster_id, $row['username'], $row['user_colour'], $row['post_username']), '<a href="' . $viewtopic_url . "&amp;p={$row['post_id']}&amp;view=show#p{$row['post_id']}" . '">', '</a>') : '',
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		'L_IGNORE_POST'		=> ($row['hide_post']) ? sprintf($user->lang['POST_BY_FOE'], get_username_string('full', $poster_id, $row['username'], $row['user_colour'], $row['post_username']), '<a href="' . append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;p={$row['post_id']}&amp;view=show") . '#p' . $row['post_id'] . '">', '</a>') : '',
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	);
 
 	if (isset($cp_row['row']) && sizeof($cp_row['row']))
@@ -1742,9 +1872,18 @@
 {
 	$_REQUEST['t'] = $topic_id;
 }
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Related Topics
+if (!empty($config['seo_related'])) {
+	require($phpbb_root_path . "phpbb_seo/phpbb_seo_related.$phpEx");
+	$seo_related = new seo_related();
+	$seo_related->get($topic_data, $forum_id);
+}
+// www.phpBB-SEO.com SEO TOOLKIT END - Related Topics
 // Output the page
-page_header($user->lang['VIEW_TOPIC'] . ' - ' . $topic_data['topic_title'], true, $forum_id);
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+$extra_title = ($start > 0) ? ' - ' . $user->lang['Page'] . ( floor( ($start / $config['posts_per_page']) ) + 1 ) : '';
+page_header($topic_data['topic_title'] . ' : ' .  $topic_data['forum_name'] . $extra_title, true, $forum_id);
+// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
 
 $template->set_filenames(array(
 	'body' => ($view == 'print') ? 'viewtopic_print.html' : 'viewtopic_body.html')
Index: gym_sitemaps/style/gym_google.css
===================================================================
--- gym_sitemaps/style/gym_google.css	(phpBB 3.0.8)
+++ gym_sitemaps/style/gym_google.css	(Premod 3.0.8)
@@ -0,0 +1,1547 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		proSilver
+	Based on style:	proSilver (this is the default phpBB 3 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		dcz phpBB SEO ( www.phpbb-seo.com )
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* General proSilver Markup Styles
+---------------------------------------- */
+
+* {/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+html { font-size: 100%;
+	/* Always show a scrollbar for short pages - stops the jump when the scrollbar appears. non-IE browsers */
+	height: 100%;
+	margin-bottom: 1px;
+}
+body { /* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	color: #828282;
+	background-color: #FFFFFF;
+	/*font-size: 62.5%;			 This sets the default font size to be equivalent to 10px */
+	font-size: 10px;
+	margin: 10px;
+	padding: 12px 0;
+}
+h1 { /* Forum name */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	margin-right: 200px;
+	color: #FFFFFF;
+	margin-top: 15px;
+	font-weight: bold;
+	font-size: 2em;
+}
+h2 { /* Forum header titles */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	font-weight: normal;
+	color: #3f3f3f;
+	font-size: 2em;
+	margin: 0.8em 0 0.2em 0;
+}
+h2.solo { margin-bottom: 1em; }
+
+h3 { /* Sub-headers (also used as post headers, but defined later) */
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	padding-bottom: 2px;
+	font-size: 1.05em;
+	color: #989898;
+	margin-top: 20px;
+}
+h4 { /* Forum and topic list titles */
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, Sans-serif;
+	font-size: 1.3em;
+}
+h5 { font-family: "Trebuchet MS",Verdana, Arial, Helvetica, sans-serif;
+	float: right;
+	font-weight:bold;
+	font-size:16px;
+	color:#707070;
+	margin-top:1px;
+}
+p { line-height: 1.3em;
+	font-size: 1.1em;
+	margin-bottom: 1.5em;
+}
+
+img {
+	border-width: 0;
+}
+
+hr { /* Also see tweaks.css */
+	border: 0 none #FFFFFF;
+	border-top: 1px solid #CCCCCC;
+	height: 1px;
+	margin: 5px 0;
+	display: block;
+	clear: both;
+}
+hr.dashed { border-top: 1px dashed #CCCCCC;
+	margin: 10px 0;
+}
+hr.divider { display: none;}
+p.right { text-align: right;}
+
+/* Main blocks
+---------------------------------------- */
+#simple-wrap { padding: 6px 10px; }
+#page-body { margin: 4px 0;
+	clear: both;
+}
+#page-footer { clear: both;
+}
+#page-footer h3 { margin-top: 20px;
+}
+#logo { float: left;
+	width: auto;
+	padding: 10px 13px 0 10px;
+}
+a#logo:hover { text-decoration: none;}
+/* Search box
+--------------------------------------------- */
+#search-box { color: #FFFFFF;
+	position: relative;
+	margin-top: 30px;
+	margin-right: 5px;
+	display: block;
+	float: right;
+	text-align: right;
+	white-space: nowrap; /* For Opera */
+}
+#search-box #keywords { width: 95px;
+	background-color: #FFF;
+}
+#search-box input { border: 1px solid #b0b0b0;
+}
+/* .button1 style defined later, just a few tweaks for the search button version */
+#search-box input.button1 { padding: 1px 5px;}
+#search-box li { text-align: right;
+	margin-top: 4px;
+}
+#search-box img {
+	vertical-align: middle;
+	margin-right: 3px;
+}
+/* Site description and logo */
+#site-description { float: left;
+	width: 70%;
+}
+
+#site-description h1 {	margin-right: 0;}
+
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar { background: #ebebeb none repeat-x 0 0;
+	color: #FFFFFF;
+	margin-bottom: 4px;
+	padding: 0 5px;
+}
+.navbar { background-color: #ebebeb;
+	padding: 0 10px;
+}
+.forabg { background: #b1b1b1 none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.forumbg { background: #ebebeb none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.panel { margin-bottom: 4px;
+	padding: 0 10px;
+	background-color: #f3f3f3;
+	color: #3f3f3f;
+}
+.post { padding: 0 10px;
+	margin-bottom: 4px;
+	background-repeat: no-repeat;
+	background-position: 100% 0;
+}
+.post:target .content { color: #000000;}
+.post:target h3 a { color: #000000;}
+.bg1	{ background-color: #f7f7f7;}
+.bg2	{ background-color: #f2f2f2; }
+.bg3	{ background-color: #ebebeb; }
+.rowbg { margin: 5px 5px 2px 5px;}
+.ucprowbg { background-color: #e2e2e2; }
+.fieldsbg { /*border: 1px #DBDEE2 solid;*/
+	background-color: #eaeaea;
+}
+span.corners-top, span.corners-bottom, span.corners-top span, span.corners-bottom span {
+	font-size: 1px;
+	line-height: 1px;
+	display: block;
+	height: 5px;
+	background-repeat: no-repeat;
+}
+span.corners-top { background-image: none;
+	background-position: 0 0;
+	margin: 0 -5px;
+}
+span.corners-top span { background-image: none;
+	background-position: 100% 0;
+}
+span.corners-bottom { background-image: none;
+	background-position: 0 100%;
+	margin: 0 -5px;
+	clear: both;
+}
+span.corners-bottom span { background-image: none;;
+	background-position: 100% 100%;
+}
+.headbg span.corners-bottom { margin-bottom: -1px; }
+.post span.corners-top, .post span.corners-bottom, .panel span.corners-top, .panel span.corners-bottom, .navbar span.corners-top, .navbar span.corners-bottom { margin: 0 -10px; }
+.rules span.corners-top { margin: 0 -10px 5px -10px;}
+.rules span.corners-bottom { margin: 5px -10px 0 -10px;}
+/* Horizontal lists
+----------------------------------------*/
+ul.linklist { display: block;
+	margin: 0;
+}
+ul.linklist li { display: block;
+	list-style-type: none;
+	float: left;
+	width: auto;
+	margin-right: 5px;
+	font-size: 1.1em;
+	line-height: 2.2em;
+}
+ul.linklist li.rightside, p.rightside { float: right;
+	margin-right: 0;
+	margin-left: 5px;
+	text-align: right;
+}
+ul.navlinks { padding-bottom: 1px;
+	margin-bottom: 1px;
+	border-bottom: 1px solid #FFFFFF;
+	font-weight: bold;
+}
+ul.leftside { float: left;
+	margin-left: 0;
+	margin-right: 5px;
+	text-align: left;
+}
+ul.rightside { float: right;
+	margin-left: 5px;
+	margin-right: -5px;
+	text-align: right;
+}
+/* Misc layout styles
+---------------------------------------- */
+dl.details {
+	/*font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;*/
+	font-size: 1.1em;
+}
+dl.details dt {
+	float: left;
+	clear: left;
+	width: 15em;
+	text-align: right;
+	color: #000000;
+	display: block;
+}
+dl.details dd {
+	margin-left: 0;
+	padding-left: 5px;
+	margin-bottom: 5px;
+	color: #828282;
+	float: left;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright { padding: 5px;
+	text-align: center;
+	color: #555555;
+}
+div.rules {
+	background-color: #ececec;
+	color: #bcbcbc;
+	padding: 0 10px;
+	margin: 10px 0;
+	font-size: 1.1em;
+}
+div.rules ul { margin-left: 20px; }
+p.rules { background-color: #ececec;
+	background-image: none;
+	padding: 5px;
+}
+p.rules img { vertical-align: middle; }
+p.rules a { vertical-align: middle;
+	clear: both;
+}
+#top { position: absolute;
+	top: -20px;
+}
+/* proSilver Link Styles
+---------------------------------------- */
+a:link	{ color: #898989; text-decoration: none; }
+a:visited	{ color: #898989; text-decoration: none; }
+a:hover	{ color: #d3d3d3; text-decoration: underline; }
+a:active	{ color: #d2d2d2; text-decoration: none; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {
+	color: #ffffff;
+	text-decoration: underline;
+}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {
+	color: #ffffff;
+	text-decoration: none;
+}
+/* Links for forum/topic lists */
+a.forumtitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.forumtitle:visited { color: #898989; } */
+a.forumtitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.forumtitle:active { color: #898989; }
+a.topictitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.topictitle:visited { color: #d2d2d2; } */
+a.topictitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.topictitle:active {
+	color: #898989;
+}
+/* Post body links */
+.postlink { text-decoration: none;
+	color: #d2d2d2;
+	border-bottom: 1px solid #d2d2d2;
+	padding-bottom: 0;
+}
+.postlink:visited { color: #bdbdbd;
+	border-bottom-style: dotted;
+	border-bottom-color: #666666;
+}
+.postlink:active { color: #d2d2d2; }
+.postlink:hover { background-color: #f6f6f6;
+	text-decoration: none;
+	color: #404040;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {
+	border: none;
+	text-decoration: underline;
+	background-color: transparent;
+}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a { font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+.postprofile a:hover, .postprofile dt.author a:hover { text-decoration: underline;
+	color: #d3d3d3;
+}
+/* Profile searchresults */	
+.search .postprofile a { color: #898989;
+	text-decoration: none; 
+	font-weight: normal;
+}
+.search .postprofile a:hover { color: #d3d3d3;
+	text-decoration: underline; 
+}
+/* Back to top of page */
+.back2top { clear: both;
+	height: 11px;
+	text-align: right;
+}
+a.top { background: none no-repeat top left;
+	text-decoration: none;
+	width: 11px;
+	height: 11px;
+	display: block;
+	float: right;
+	overflow: hidden;
+	letter-spacing: 1000px;
+	text-indent: 11px;
+}
+a.top2 {
+	background: none no-repeat 0 50%;
+	text-decoration: none;
+	padding-left: 15px;
+}
+/* Arrow links  */
+a.up		{ background: none no-repeat left center; }
+a.down		{ background: none no-repeat right center; }
+a.left		{ background: none no-repeat 3px 60%; }
+a.right		{ background: none no-repeat 95% 60%; }
+a.up, a.up:link, a.up:active, a.up:visited { padding-left: 10px;
+	text-decoration: none;
+	border-bottom-width: 0;
+}
+a.up:hover { background-position: left top;
+	background-color: transparent;
+}
+a.down, a.down:link, a.down:active, a.down:visited { padding-right: 10px; }
+a.down:hover { background-position: right bottom;
+	text-decoration: none;
+}
+a.left, a.left:active, a.left:visited { padding-left: 12px; }
+a.left:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 0 60%;
+}
+a.right, a.right:active, a.right:visited { padding-right: 12px;}
+a.right:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 100% 60%;
+}
+/* proSilver Content Styles
+---------------------------------------- */
+ul.topiclist { display: block;
+	list-style-type: none;
+	margin: 0;
+}
+ul.forums { background: #f9f9f9 none repeat-x 0 0;
+}
+ul.topiclist li { display: block;
+	list-style-type: none;
+	color: #777777;
+	margin: 0;
+}
+ul.topiclist dl { position: relative;}
+ul.topiclist li.row dl {padding: 2px 0;}
+ul.topiclist dt {display: block;
+	float: left;
+	width: 50%;
+	font-size: 1.1em;
+	padding-left: 5px;
+	padding-right: 5px;
+}
+ul.topiclist dd { display: block;
+	float: left;
+	border-left: 1px solid #FFFFFF;
+	padding: 4px 0;
+}
+ul.topiclist dfn { /* Labels for post/view counts */
+	display: none;
+}
+
+ul.topiclist li.row dt a.subforum { background-image: none;
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	position: relative;
+	white-space: nowrap;
+	padding: 0 0 0 12px;
+}
+.forum-image { float: left;
+	padding-top: 5px;
+	margin-right: 5px;
+}
+li.row { border-top: 1px solid #FFFFFF;
+	border-bottom: 1px solid #8f8f8f;
+}
+li.row strong { font-weight: normal;
+	color: #000000;
+}
+li.row:hover { background-color: #f6f6f6;
+}
+li.row:hover dd { border-left-color: #CCCCCC;
+}
+li.header dt, li.header dd { line-height: 1em;
+	border-left-width: 0;
+	margin: 2px 0 4px 0;
+	color: #FFFFFF;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	font-size: 1em;
+	font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+li.header dt { font-weight: bold;}
+li.header dd { margin-left: 1px;}
+li.header dl.icon { min-height: 0;}
+li.header dl.icon dt { /* Tweak for headers alignment when folder icon used */
+	padding-left: 0;
+	padding-right: 44px;
+}
+/* Forum list column styles */
+dl.icon { min-height: 35px;
+	background-position: 10px 50%;		/* Position of folder icon */
+	background-repeat: no-repeat;
+}
+dl.icon dt { padding-left: 45px;					/* Space for folder icon */
+	background-repeat: no-repeat;
+	background-position: 5px 95%;		/* Position of topic icon */
+}
+dd.posts, dd.topics, dd.views { width: 8%;
+	text-align: center;
+	line-height: 2.2em;
+	font-size: 1.2em;
+}
+dd.lastpost { width: 25%;
+	font-size: 1.1em;
+}
+dd.redirect { font-size: 1.1em;
+	line-height: 2.5em;
+}
+dd.moderation { font-size: 1.1em; }
+dd.lastpost span, ul.topiclist dd.searchby span, ul.topiclist dd.info span, ul.topiclist dd.time span, dd.redirect span, dd.moderation span { display: block;
+	padding-left: 5px;
+}
+dd.time { width: auto;
+	line-height: 200%;
+	font-size: 1.1em;
+}
+dd.extra { width: 65px;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.mark { float: right !important;
+	width: 9%;
+	text-align: center;
+	line-height: 200%;
+	font-size: 1.2em;
+}
+dd.info { width: 30%; }
+dd.option { width: 15%;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.searchby { width: 47%;
+	font-size: 1.1em;
+	line-height: 1em;
+}
+ul.topiclist dd.searchextra { margin-left: 5px;
+	padding: 0.2em 0;
+	font-size: 1.1em;
+	color: #333333;
+	border-left: none;
+	clear: both;
+	width: 98%;
+	overflow: hidden;
+}
+/* Container for post/reply buttons and pagination */
+.topic-actions { margin-bottom: 3px;
+	font-size: 1.1em;
+	height: 28px;
+	min-height: 28px;
+}
+div[class].topic-actions { height: auto; }
+/* Post body styles
+----------------------------------------*/
+.postbody { padding: 0;
+	line-height: 1.48em;
+	color: #333333;
+	width: 76%;
+	float: left;
+	clear: both;
+}
+.postbody .ignore { font-size: 1.1em; }
+.postbody h3.first { /* The first post on the page uses this */
+	font-size: 1.7em;
+}
+.postbody h3 { /* Postbody requires a different h3 format - so change it here */
+	font-size: 1.5em;
+	padding: 2px 0 0 0;
+	margin: 0 0 0.3em 0 !important;
+	text-transform: none;
+	border: none;
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	line-height: 125%;
+}
+.postbody h3 img { /* Also see tweaks.css */
+	vertical-align: bottom;
+}
+.postbody .content { font-size: 1.3em; }
+.search .postbody { width: 68% }
+/* Content container styles
+----------------------------------------*/
+.content { min-height: 3em;
+	overflow: hidden;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	color: #333333;
+}
+.content h2, .panel h2 { font-weight: normal;
+	color: #989898;
+	border-bottom: 1px solid #CCCCCC;
+	font-size: 1.6em;
+	margin-top: 0.5em;
+	margin-bottom: 0.5em;
+	padding-bottom: 0.5em;
+}
+.panel h3 { margin: 0.5em 0; }
+.panel p { font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+.content p { font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+dl.faq { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+	margin-top: 1em;
+	margin-bottom: 2em;
+	line-height: 1.4em;
+}
+dl.faq dt { font-weight: bold;
+	color: #333333;
+}
+.content dl.faq { font-size: 1.2em;
+	margin-bottom: 0.5em;
+}
+.content li { list-style-type: inherit; }
+.content ul, .content ol { margin-bottom: 1em;
+	margin-left: 3em;
+}
+.announce, .unreadpost {
+	/* Highlight the announcements & unread posts box */
+	border-left-color: #BCBCBC;
+	border-right-color: #BCBCBC;
+}
+/* Post author */
+p.author { margin: 0 15em 0.6em 0;
+	padding: 0 0 5px 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	line-height: 1.2em;
+}
+/* Post signature */
+.signature { margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1.1em;
+	border-top: 1px solid #CCCCCC;
+	clear: left;
+	line-height: 140%;
+	overflow: hidden;
+	width: 100%;
+}
+dd .signature { margin: 0;
+	padding: 0;
+	clear: none;
+	border: none;
+}
+/* Post noticies */
+.notice { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: auto;
+	margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1em;
+	border-top: 1px dashed #CCCCCC;
+	clear: left;
+	line-height: 130%;
+}
+/* Jump to post link for now */
+ul.searchresults {
+	list-style: none;
+	text-align: right;
+	clear: both;
+}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {
+	background: #ebebeb none 6px 8px no-repeat;
+	border: 1px solid #dbdbdb;
+	font-size: 0.95em;
+	margin: 0.5em 1px 0 25px;
+	overflow: hidden;
+	padding: 5px;
+}
+blockquote blockquote { /* Nested quotes */
+	background-color: #bababa;
+	font-size: 1em;
+	margin: 0.5em 1px 0 15px;	
+}
+blockquote blockquote blockquote { /* Nested quotes */
+	background-color: #e4e4e4;
+}
+blockquote cite { /* Username/source of quoter */
+	font-style: normal;
+	font-weight: bold;
+	margin-left: 20px;
+	display: block;
+	font-size: 0.9em;
+}
+blockquote cite cite { font-size: 1em; }
+blockquote.uncited { padding-top: 25px; }
+/* Code block */
+dl.codebox {
+	padding: 3px;
+	background-color: #FFFFFF;
+	border: 1px solid #d8d8d8;
+	font-size: 1em;
+}
+dl.codebox dt { text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	font-size: 0.8em;
+	font-weight: bold;
+	display: block;
+}
+blockquote dl.codebox { margin-left: 0; }
+dl.codebox code { /* Also see tweaks.css */
+	overflow: auto;
+	display: block;
+	height: auto;
+	max-height: 200px;
+	white-space: normal;
+	padding-top: 5px;
+	font: 0.9em Monaco, "Andale Mono","Courier New", Courier, mono;
+	line-height: 1.3em;
+	color: #8b8b8b;
+	margin: 2px 0;
+}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #000000; }
+.syntaxdefault	{ color: #bcbcbc; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #585858; }
+.syntaxstring	{ color: #a7a7a7; }
+/* Attachments
+----------------------------------------*/
+.attachbox { float: left;
+	width: auto; 
+	margin: 5px 5px 5px 0;
+	padding: 6px;
+	background-color: #FFFFFF;
+	border: 1px dashed #d8d8d8;
+	clear: left;
+}
+.pm-message .attachbox { background-color: #f3f3f3; }
+.attachbox dt { font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+.attachbox dd { margin-top: 4px;
+	padding-top: 4px;
+	clear: left;
+	border-top: 1px solid #d8d8d8;
+}
+.attachbox dd dd { border: none; }
+.attachbox p { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attachbox p.stats { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attach-image { margin: 3px 0;
+	width: 100%;
+	max-height: 350px;
+	overflow: auto;
+}
+.attach-image img { border: 1px solid #999999;
+/*	cursor: move; */
+	cursor: default;
+}
+/* Inline image thumbnails */
+div.inline-attachment dl.thumbnail, div.inline-attachment dl.file { display: block;
+	margin-bottom: 4px;
+}
+div.inline-attachment p { font-size: 100%; }
+dl.file { font-family: Verdana, Arial, Helvetica, sans-serif;
+	display: block;
+}
+dl.file dt { text-transform: none;
+	margin: 0;
+	padding: 0;
+	font-weight: bold;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+dl.file dd { color: #666666;
+	margin: 0;
+	padding: 0;	
+}
+dl.thumbnail img { padding: 3px;
+	border: 1px solid #666666;
+	display: block;
+	background-color: #FFF;
+}
+dl.thumbnail dd { color: #666666;
+	font-style: italic;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+.attachbox dl.thumbnail dd { font-size: 100%; }
+dl.thumbnail dt a:hover { background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img { border: 1px solid #d2d2d2; }
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls { font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif; }
+fieldset.polls dl { margin-top: 5px;
+	border-top: 1px solid #e2e2e2;
+	padding: 5px 0 0 0;
+	line-height: 120%;
+	color: #666666;
+}
+fieldset.polls dl.voted { font-weight: bold;
+	color: #000000;
+}
+fieldset.polls dt { text-align: left;
+	float: left;
+	display: block;
+	width: 30%;
+	border-right: none;
+	padding: 0;
+	margin: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd { float: left;
+	width: 10%;
+	border-left: none;
+	padding: 0 5px;
+	margin-left: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd.resultbar { width: 50%;}
+fieldset.polls dd input { margin: 2px 0; }
+fieldset.polls dd div { text-align: right;
+	font-family: Arial, Helvetica, sans-serif;
+	color: #FFFFFF;
+	font-weight: bold;
+	padding: 0 2px;
+	overflow: visible;
+	min-width: 2%;
+}
+.pollbar1 { background-color: #aaaaaa;
+	border-bottom: 1px solid #747474;
+	border-right: 1px solid #747474;
+}
+.pollbar2 { background-color: #bebebe;
+	border-bottom: 1px solid #8c8c8c;
+	border-right: 1px solid #8c8c8c;
+}
+.pollbar3 { background-color: #D1D1D1;
+	border-bottom: 1px solid #aaaaaa;
+	border-right: 1px solid #aaaaaa;
+}
+.pollbar4 { background-color: #e4e4e4;
+	border-bottom: 1px solid #bebebe;
+	border-right: 1px solid #bebebe;
+}
+.pollbar5 { background-color: #f8f8f8;
+	border-bottom: 1px solid #D1D1D1;
+	border-right: 1px solid #D1D1D1;
+}
+/* Poster profile block
+----------------------------------------*/
+.postprofile { /* Also see tweaks.css */
+	margin: 5px 0 10px 0;
+	min-height: 80px;
+	color: #666666;
+	border-left: 1px solid #FFFFFF;
+	width: 22%;
+	float: right;
+	display: inline;
+}
+.pm .postprofile { border-left: 1px solid #DDDDDD; }
+.postprofile dd, .postprofile dt { line-height: 1.2em;
+	margin-left: 8px;
+}
+.postprofile strong {font-weight: normal;
+	color: #000000;
+}
+.avatar { border: none;
+	margin-bottom: 3px;
+}
+.online { background-image: none;
+	background-position: 100% 0;
+	background-repeat: no-repeat;
+}
+/* Poster profile used by search*/
+.search .postprofile { width: 30%;}
+/* pm list in compose message if mass pm is enabled */
+dl.pmlist dt { width: 60% !important;}
+dl.pmlist dt textarea { width: 95%;}
+dl.pmlist dd { margin-left: 61% !important;
+	margin-bottom: 2px;
+}
+/* proSilver Button Styles
+---------------------------------------- */
+/* Rollover buttons
+   Based on: http://wellstyled.com/css-nopreload-rollovers.html
+----------------------------------------*/
+.buttons { float: left;
+	width: auto;
+	height: auto;
+}
+/* Rollover state */
+.buttons div { float: left;
+	margin: 0 5px 0 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+.buttons div a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+.buttons div span		{ display: none; }
+.buttons div a:hover	{ background-image: none; }
+/* Big button images */
+.reply-icon, .reply-icon a			{ background: transparent none 0 0 no-repeat; }
+.post-icon, .post-icon a				{ background: transparent none 0 0 no-repeat; }
+.locked-icon, .locked-icon a			{ background: transparent none 0 0 no-repeat; }
+.pmreply-icon, .pmreply-icon a		{ background: none 0 0 no-repeat; }
+.newpm-icon, .newpm-icon a			{ background: none 0 0 no-repeat; }
+.forwardpm-icon, .forwardpm-icon a 	{ background: none 0 0 no-repeat; }
+/* Set big button dimensions */
+.buttons div.reply-icon		{ width: 96px; height: 25px; }
+.buttons div.post-icon		{ width: 96px; height: 25px; }
+.buttons div.locked-icon	{ width: 96px; height: 25px; }
+.buttons div.pmreply-icon	{ width: 96px; height: 25px; }
+.buttons div.newpm-icon		{ width: 96px; height: 25px; }
+.buttons div.forwardpm-icon	{ width: 110px; height: 25px; }
+/* Sub-header (navigation bar)
+--------------------------------------------- */
+a.print, a.sendemail, a.fontsize { display: block;
+	overflow: hidden;
+	height: 18px;
+	text-indent: -5000px;
+	text-align: left;
+	background-repeat: no-repeat;
+}
+a.fontsize { background-image: none;
+	background-position: 0 -1px;
+	width: 29px;
+}
+a.fontsize:hover { background-position: 0 -20px;
+	text-decoration: none;
+}
+/* Icon images
+---------------------------------------- */
+.sitehome, .icon-faq, .icon-members, .icon-home, .icon-ucp, .icon-register, .icon-logout,
+.icon-bookmark, .icon-bump, .icon-subscribe, .icon-unsubscribe, .icon-pages, .icon-search {
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	background-image: none;
+	padding: 1px 0 0 17px;
+}
+/* Poster profile icons
+----------------------------------------*/
+ul.profile-icons { padding-top: 10px;
+	list-style: none;
+}
+/* Rollover state */
+ul.profile-icons li { float: left;
+	margin: 0 6px 3px 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+ul.profile-icons li a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+ul.profile-icons li span { display:none; }
+ul.profile-icons li a:hover { background: none; }
+/* Positioning of moderator icons */
+.postbody ul.profile-icons { float: right;
+	width: auto;
+	padding: 0;
+}
+.postbody ul.profile-icons li { margin: 0 3px;}
+/* Profile & navigation icons */
+.email-icon, .email-icon a		{ background: none top left no-repeat; }
+.aim-icon, .aim-icon a			{ background: none top left no-repeat; }
+.yahoo-icon, .yahoo-icon a		{ background: none top left no-repeat; }
+.web-icon, .web-icon a			{ background: none top left no-repeat; }
+.msnm-icon, .msnm-icon a			{ background: none top left no-repeat; }
+.icq-icon, .icq-icon a			{ background: none top left no-repeat; }
+.jabber-icon, .jabber-icon a		{ background: none top left no-repeat; }
+.pm-icon, .pm-icon a				{ background: none top left no-repeat; }
+.quote-icon, .quote-icon a		{ background: none top left no-repeat; }
+/* Moderator icons */
+.report-icon, .report-icon a		{ background: none top left no-repeat; }
+.warn-icon, .warn-icon a			{ background: none top left no-repeat; }
+.edit-icon, .edit-icon a			{ background: none top left no-repeat; }
+.delete-icon, .delete-icon a		{ background: none top left no-repeat; }
+.info-icon, .info-icon a			{ background: none top left no-repeat; }
+/* Set profile icon dimensions */
+ul.profile-icons li.email-icon		{ width: 20px; height: 20px; }
+ul.profile-icons li.aim-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.yahoo-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.web-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.msnm-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.icq-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.jabber-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.pm-icon		{ width: 28px; height: 20px; }
+ul.profile-icons li.quote-icon	{ width: 54px; height: 20px; }
+ul.profile-icons li.report-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.edit-icon	{ width: 58px; height: 20px; }
+ul.profile-icons li.delete-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.info-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.warn-icon	{ width: 20px; height: 20px; }
+/* Fix profile icon default margins */
+ul.profile-icons li.edit-icon	{ margin: 0 0 0 3px; }
+ul.profile-icons li.quote-icon	{ margin: 0 0 0 10px; }
+ul.profile-icons li.info-icon, ul.profile-icons li.report-icon	{ margin: 0 3px 0 0; }
+/* proSilver Form Styles
+---------------------------------------- */
+/* General form styles
+----------------------------------------*/
+fieldset { border-width: 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+}
+input { font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	padding: 0 3px;
+	font-size: 1em;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+}
+select {font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	border: 1px solid #666666;
+	padding: 1px;
+	background-color: #FAFAFA;
+}
+option { padding-right: 1em; }
+option.disabled-option { color: graytext; }
+textarea { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: 60%;
+	padding: 2px;
+	font-size: 1em;
+	line-height: 1.4em;
+}
+label { cursor: default;
+	padding-right: 5px;
+	color: #676767;
+}
+label input { vertical-align: middle;}
+label img { vertical-align: middle;}
+/* Definition list layout for forms
+---------------------------------------- */
+fieldset dl { padding: 4px 0;}
+fieldset dt { float: left;	
+	width: 40%;
+	text-align: left;
+	display: block;
+}
+fieldset dd { margin-left: 41%;
+	vertical-align: top;
+	margin-bottom: 3px;
+}
+/* Specific layout 1 */
+fieldset.fields1 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields1 dd { margin-left: 15em;
+	border-left-width: 0;
+}
+fieldset.fields1 { background-color: transparent; }
+fieldset.fields1 div { margin-bottom: 3px; }
+/* Specific layout 2 */
+fieldset.fields2 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields2 dd { margin-left: 16em;
+	border-left-width: 0;
+}
+/* Form elements */
+dt label { font-weight: bold;
+	text-align: left;
+}
+dd label { white-space: nowrap;
+	color: #333;
+}
+dd input, dd textarea { margin-right: 3px; }
+dd select { width: auto; }
+dd textarea { width: 85%; }
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label { color: inherit;}
+/* Submit button fieldset */
+fieldset.submit-buttons { text-align: center;
+	vertical-align: middle;
+	margin: 5px 0;
+}
+fieldset.submit-buttons input { vertical-align: middle;
+	padding-top: 3px;
+	padding-bottom: 3px;
+}
+/* Input field styles
+---------------------------------------- */
+.inputbox { background-color: #FFFFFF;
+	border: 1px solid #c0c0c0;
+	color: #333333;
+	padding: 2px;
+	cursor: text;
+}
+.inputbox:hover { border: 1px solid #eaeaea;}
+.inputbox:focus { border: 1px solid #eaeaea;
+	color: #4b4b4b;
+}
+input.inputbox	{ width: 85%; }
+input.medium	{ width: 50%; }
+input.narrow	{ width: 25%; }
+input.tiny	{ width: 125px; }
+textarea.inputbox { width: 85%; }
+.autowidth {width: auto !important;}
+/* Form button styles
+---------------------------------------- */
+input.button1, input.button2 {font-size: 1em;}
+a.button1, input.button1, input.button3, a.button2, input.button2 {
+	width: auto !important;
+	padding-top: 1px;
+	padding-bottom: 1px;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #000;
+	background: #FAFAFA none repeat-x top;
+}
+a.button1, input.button1 {font-weight: bold;
+	border: 1px solid #666666;
+}
+input.button3 {padding: 0;
+	margin: 0;
+	line-height: 5px;
+	height: 12px;
+	background-image: none;
+	font-variant: small-caps;
+}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border: 1px solid #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {
+	text-decoration: none;
+	color: #000000;
+	padding: 2px 8px;
+	line-height: 250%;
+	vertical-align: text-bottom;
+	background-position: 0 1px;
+}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {
+	border: 1px solid #BCBCBC;
+	background-position: 0 100%;
+	color: #BCBCBC;
+}
+
+/* Topic and forum Search */
+.search-box {margin-top: 3px;
+	margin-left: 5px;
+	float: left;
+}
+.search-box input {
+}
+input.search {background-image: none;
+	background-repeat: no-repeat;
+	background-position: left 1px;
+	padding-left: 17px;
+}
+/* proSilver Style Sheet Tweaks
+These style definitions are mainly IE specific 
+tweaks required due to its poor CSS support.
+-------------------------------------------------*/
+* html table, * html select, * html input { font-size: 100%; }
+* html hr { margin: 0; }
+* html span.corners-top, * html span.corners-bottom { background-image: url("{T_IMAGE_PATH}corners_left.gif"); }
+* html span.corners-top span, * html span.corners-bottom span { background-image: url("{T_IMAGE_PATH}corners_right.gif"); }
+table.table1 {width: 99%;		/* IE < 6 browsers */
+	/* Tantek hack */
+	voice-family: "\"}\"";
+	voice-family: inherit;
+	width: 100%;
+}
+html>body table.table1 { width: 100%; }	/* Reset 100% for opera */
+* html ul.topiclist li { position: relative; }
+* html .postbody h3 img { vertical-align: middle; }
+/* Form styles */
+html>body dd label input { vertical-align: text-bottom; }	/* Align checkboxes/radio buttons nicely */
+* html input.button1, * html input.button2 {
+	padding-bottom: 0;
+	margin-bottom: 1px;
+}
+/* Misc layout styles */
+* html .column1, * html .column2 { width: 45%; }
+/* Nice method for clearing floated blocks without having to insert any extra markup (like spacer above)
+   From http://www.positioniseverything.net/easyclearing.html 
+#tabs:after, #minitabs:after, .post:after, .navbar:after, fieldset dl:after, ul.topiclist dl:after, ul.linklist:after, dl.polls:after {
+	content: "."; 
+	display: block; 
+	height: 0; 
+	clear: both; 
+	visibility: hidden;
+}*/
+.clearfix, #tabs, #minitabs, .post, .navbar, fieldset dl, ul.topiclist dl, ul.linklist, dl.polls {
+	height: 1%;
+	overflow: hidden;
+}
+/* Simple fix so forum and topic lists always have a min-height set, even in IE6
+	From http://www.dustindiaz.com/min-height-fast-hack */
+dl.icon { min-height: 35px;
+	height: auto !important;
+	height: 35px;
+}
+* html #search-box {
+	margin-right: 35px;
+}
+/* Correctly clear floating for details on profile view */
+*:first-child+html dl.details dd { margin-left: 15em;
+	float: none;
+}
+* html dl.details dd { margin-left: 15em;
+	float: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for common.css
+-------------------------------------------------------------- */
+html, body { color: #536482;
+	background-color: #FFFFFF;
+}
+h1 { color: #FFFFFF;}
+h2 {color: #28313F;}
+h3 {border-bottom-color: #CCCCCC;
+	color: #115098;
+}
+hr {border-color: #FFFFFF;
+	border-top-color: #CCCCCC;
+}
+hr.dashed {border-top-color: #CCCCCC;}
+/* Search box
+--------------------------------------------- */
+#search-box {color: #FFFFFF;}
+#search-box #keywords {background-color: #FFF;}
+#search-box input {border-color: #0075B0;}
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+	color: #FFFFFF;
+}
+.navbar {background-color: #cadceb;}
+.forabg {background-color: #0076b1;
+	background-image: url("{T_IMAGE_PATH}bg_list.gif");
+}
+.forumbg {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+}
+.panel {background-color: #ECF1F3;
+	color: #28313F;
+}
+.post:target .content {color: #000000;}
+.post:target h3 a {color: #000000;}
+.bg1	{ background-color: #ECF3F7; }
+.bg2	{ background-color: #e1ebf2;  }
+.bg3	{ background-color: #cadceb; }
+.ucprowbg {background-color: #DCDEE2;}
+.fieldsbg {background-color: #E7E8EA;}
+span.corners-top {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-top span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+span.corners-bottom {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-bottom span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+/* Horizontal lists
+----------------------------------------*/
+ul.navlinks {border-bottom-color: #FFFFFF;}
+/* Misc layout styles
+---------------------------------------- */
+dl.details dt {
+	color: #000000;
+}
+
+dl.details dd {
+	color: #536482;
+}
+
+.sep {
+	color: #1198D9;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright {color: #555555;}
+.error {color: #BC2A4D;}
+.reported {background-color: #F7ECEF;}
+li.reported:hover {background-color: #ECD5D8 !important;}
+.sticky, .announce {/* you can add a background for stickies and announcements*/}
+div.rules {background-color: #ECD5D8;
+	color: #BC2A4D;
+}
+p.rules {background-color: #ECD5D8;
+	background-image: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for links.css
+-------------------------------------------------------------- */
+a:link	{ color: #105289; }
+a:visited	{ color: #105289; }
+a:hover	{ color: #D31141; }
+a:active	{ color: #368AD2; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {color: #FFFFFF;}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {color: #FFFFFF;}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {color: #A8D8FF;}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {color: #C8E6FF;}
+/* Links for forum/topic lists */
+a.forumtitle {color: #105289;}
+/* a.forumtitle:visited { color: #105289; } */
+a.forumtitle:hover {color: #BC2A4D;}
+a.forumtitle:active {color: #105289;}
+a.topictitle {color: #105289;}
+/* a.topictitle:visited { color: #368AD2; } */
+a.topictitle:hover {color: #BC2A4D;}
+a.topictitle:active {color: #105289;}
+/* Post body links */
+.postlink {color: #368AD2;
+	border-bottom-color: #368AD2;
+}
+.postlink:visited {color: #5D8FBD;
+	border-bottom-color: #666666;
+}
+.postlink:active {color: #368AD2;}
+.postlink:hover {background-color: #D0E4F6;
+	color: #0D4473;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {background-color: transparent;}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a {color: #105289;}
+.postprofile a:hover, .postprofile dt.author a:hover {color: #D31141;}
+/* Profile searchresults */	
+.search .postprofile a {color: #105289;}
+.search .postprofile a:hover {color: #D31141;}
+/* Back to top of page */
+a.top {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+a.top2 {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+/* Arrow links  */
+a.up		{ background-image: url("{T_IMAGE_PATH}arrow_up.gif") }
+a.down		{ background-image: url("{T_IMAGE_PATH}arrow_down.gif") }
+a.left		{ background-image: url("{T_IMAGE_PATH}arrow_left.gif") }
+a.right		{ background-image: url("{T_IMAGE_PATH}arrow_right.gif") }
+a.up:hover {background-color: transparent;}
+a.left:hover {color: #368AD2;}
+a.right:hover {color: #368AD2;}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for content.css
+-------------------------------------------------------------- */
+ul.forums {background-color: #eef5f9;
+	background-image: url("{T_IMAGE_PATH}gradient.gif");
+}
+ul.topiclist li {color: #4C5D77;}
+ul.topiclist dd {border-left-color: #FFFFFF;}
+.rtl ul.topiclist dd {border-right-color: #fff;
+	border-left-color: transparent;
+}
+ul.topiclist li.row dt a.subforum.read {background-image: url("{T_IMAGE_PATH}subforum_read.gif");}
+ul.topiclist li.row dt a.subforum.unread {background-image: url("{T_IMAGE_PATH}subforum_unread.gif");}
+li.row {border-top-color:  #FFFFFF;
+	border-bottom-color: #00608F;
+}
+li.row strong {color: #000000;}
+li.row:hover {background-color: #F6F4D0;}
+li.row:hover dd {border-left-color: #CCCCCC;}
+.rtl li.row:hover dd {border-right-color: #CCCCCC;
+	border-left-color: transparent;
+}
+li.header dt, li.header dd {color: #FFFFFF;}
+/* Forum list column styles */
+ul.topiclist dd.searchextra {color: #333333;}
+/* Post body styles
+----------------------------------------*/
+.postbody {color: #333333;}
+/* Content container styles
+----------------------------------------*/
+.content {color: #333333;}
+.content h2, .panel h2 {color: #115098;
+	border-bottom-color:  #CCCCCC;
+}
+dl.faq dt {color: #333333;}
+.posthilit {background-color: #F3BFCC;
+	color: #BC2A4D;
+}
+/* Post signature */
+.signature {border-top-color: #CCCCCC;}
+/* Post noticies */
+.notice {border-top-color:  #CCCCCC;}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {background-color: #EBEADD;
+	background-image: url("{T_IMAGE_PATH}quote.gif");
+	border-color:#DBDBCE;
+}
+blockquote blockquote {/* Nested quotes */
+	background-color:#EFEED9;
+}
+blockquote blockquote blockquote {/* Nested quotes */
+	background-color: #EBEADD;
+}
+/* Code block */
+dl.codebox {background-color: #FFFFFF;
+	border-color: #C9D2D8;
+}
+dl.codebox dt {border-bottom-color:  #CCCCCC;
+}
+dl.codebox code {color: #2E8B57;}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #FF8000; }
+.syntaxdefault	{ color: #0000BB; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #007700; }
+.syntaxstring	{ color: #DD0000; }
+/* Attachments
+----------------------------------------*/
+.attachbox {background-color: #FFFFFF;
+	border-color:  #C9D2D8;
+}
+.pm-message .attachbox {background-color: #F2F3F3;}
+.attachbox dd {border-top-color: #C9D2D8;}
+.attachbox p {color: #666666;}
+.attachbox p.stats {color: #666666;}
+.attach-image img {border-color: #999999;}
+/* Inline image thumbnails */
+dl.file dd {color: #666666;}
+dl.thumbnail img {border-color: #666666;
+	background-color: #FFFFFF;
+}
+dl.thumbnail dd {color: #666666;}
+dl.thumbnail dt a:hover {background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img {border-color: #368AD2;}
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls dl {border-top-color: #DCDEE2;
+	color: #666666;
+}
+fieldset.polls dl.voted {color: #000000;
+}
+fieldset.polls dd div {color: #FFFFFF;
+}
+.rtl .pollbar1, .rtl .pollbar2, .rtl .pollbar3, .rtl .pollbar4, .rtl .pollbar5 {border-right-color: transparent;
+}
+.pollbar1 {background-color: #AA2346;
+	border-bottom-color: #74162C;
+	border-right-color: #74162C;
+}
+.rtl .pollbar1 {border-left-color: #74162C;}
+.pollbar2 {background-color: #BE1E4A;
+	border-bottom-color: #8C1C38;
+	border-right-color: #8C1C38;
+}
+.rtl .pollbar2 {border-left-color: #8C1C38;}
+.pollbar3 {background-color: #D11A4E;
+	border-bottom-color: #AA2346;
+	border-right-color: #AA2346;
+}
+.rtl .pollbar3 {border-left-color: #AA2346;}
+.pollbar4 {background-color: #E41653;
+	border-bottom-color: #BE1E4A;
+	border-right-color: #BE1E4A;
+}
+.rtl .pollbar4 {border-left-color: #BE1E4A;}
+.pollbar5 {background-color: #F81157;
+	border-bottom-color: #D11A4E;
+	border-right-color: #D11A4E;
+}
+.rtl .pollbar5 {border-left-color: #D11A4E;}
+/* Poster profile block
+----------------------------------------*/
+.postprofile {color: #666666;
+	border-left-color: #FFFFFF;
+}
+.rtl .postprofile {border-right-color: #FFFFFF;
+	border-left-color: transparent;
+}
+.pm .postprofile {border-left-color: #DDDDDD;}
+.rtl .pm .postprofile {border-right-color: #DDDDDD;
+	border-left-color: transparent;
+}
+.postprofile strong {color: #000000;}
+.online {background-image: url("./styles/prosilver/imageset/fr/icon_user_online.gif");}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for buttons.css
+-------------------------------------------------------------- */
+a.fontsize {background-image: url("{T_IMAGE_PATH}icon_fontsize.gif");}
+/* Icon images
+---------------------------------------- */
+.sitehome						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-faq						{ background-image: url("{T_IMAGE_PATH}icon_faq.gif"); }
+.icon-ucp						{ background-image: url("{T_IMAGE_PATH}sitemap-icon.gif"); }
+.icon-members					{ background-image: url("{T_IMAGE_PATH}icon_members.gif"); }
+.icon-home						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-register					{ background-image: url("{T_IMAGE_PATH}icon_register.gif"); }
+.icon-logout					{ background-image: url("{T_IMAGE_PATH}icon_logout.gif"); }
+.icon-bookmark					{ background-image: url("{T_IMAGE_PATH}icon_bookmark.gif"); }
+.icon-subscribe					{ background-image: url("{T_IMAGE_PATH}icon_subscribe.gif"); }
+.icon-search					{ background-image: url("{T_IMAGE_PATH}icon_search.gif"); }
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for forms.css
+-------------------------------------------------------------- */
+/* General form styles
+----------------------------------------*/
+select {border-color: #666666;
+	background-color: #FAFAFA;
+}
+label {color: #425067;}
+option.disabled-option {color: graytext;}
+/* Definition list layout for forms
+---------------------------------------- */
+dd label {color: #333;}
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label {color: inherit;}
+/* Quick-login on index page */
+fieldset.quick-login input.inputbox {background-color: #F2F3F3;}
+/* Input field styles
+---------------------------------------- */
+.inputbox {background-color: #FFFFFF; 
+	border-color: #B4BAC0;
+	color: #333333;
+}
+.inputbox:hover {border-color: #11A3EA;}
+.inputbox:focus {border-color: #11A3EA;
+	color: #0F4987;
+}
+/* Form button styles
+---------------------------------------- */
+a.button1, input.button1, input.button3, a.button2, input.button2 {color: #000;
+	background-color: #FAFAFA;
+	background-image: url("{T_IMAGE_PATH}bg_button.gif");
+}
+a.button1, input.button1 {border-color: #666666;}
+input.button3 {background-image: none;}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border-color: #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {color: #000000;}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {border-color: #BC2A4D;
+	color: #BC2A4D;
+}
+input.search {background-image: url("{T_IMAGE_PATH}icon_textbox_search.gif");}
+#wrap {  
+   padding: 0 20px;
+}
Index: gym_sitemaps/style/normal.css
===================================================================
--- gym_sitemaps/style/normal.css	(phpBB 3.0.8)
+++ gym_sitemaps/style/normal.css	(Premod 3.0.8)
@@ -0,0 +1,3 @@
+body {
+	font-size: 10px;
+}
\ No newline at end of file
Index: gym_sitemaps/style/large.css
===================================================================
--- gym_sitemaps/style/large.css	(phpBB 3.0.8)
+++ gym_sitemaps/style/large.css	(Premod 3.0.8)
@@ -0,0 +1,3 @@
+body {
+	font-size: 12px;
+}
\ No newline at end of file
Index: gym_sitemaps/style/gym_js.js
===================================================================
--- gym_sitemaps/style/gym_js.js	(phpBB 3.0.8)
+++ gym_sitemaps/style/gym_js.js	(Premod 3.0.8)
@@ -0,0 +1,317 @@
+/*
+* New function for handling multiple calls to window.onload and window.unload by pentapenguin ( phpBB3 )
+*/
+var onload_functions = new Array();
+var onunload_functions = new Array();
+window.onload = function() {
+	BrowserDetect.init();
+	if (BrowserDetect.browser == 'Firefox') {
+		var elements = document.getElementsByTagName('span');
+		for (var i = 0; i < elements.length; i++) {
+			var el = elements[i];
+			if (el.className == 'html') {
+				el.innerHTML = el.firstChild.data;
+			}
+		}
+	} 
+	for (i = 0; i <= onload_functions.length; i++) {
+		eval(onload_functions[i]);
+	}
+}
+window.onunload = function() {
+	for (i = 0; i <= onunload_functions.length; i++) {
+		eval(onunload_functions[i]);
+	}
+}
+// phpBB3 bbcodes
+function selectCode(a) {
+	// Get ID of code block
+	var e = a.parentNode.parentNode.getElementsByTagName('CODE')[0];
+	if (window.getSelection) { // Not IE
+		var s = window.getSelection();
+		if (s.setBaseAndExtent) { // Safari
+			s.setBaseAndExtent(e, 0, e, e.innerText.length - 1);
+		} else { // Firefox and Opera
+			var r = document.createRange();
+			r.selectNodeContents(e);
+			s.removeAllRanges();
+			s.addRange(r);
+		}
+	} else if (document.getSelection) { // Some older browsers 
+		var s = document.getSelection();
+		var r = document.createRange();
+		r.selectNodeContents(e);
+		s.removeAllRanges();
+		s.addRange(r);
+	} else if (document.selection) { // IE 
+		var r = document.body.createTextRange();
+		r.moveToElementText(e);
+		r.select();
+	}
+}
+// phpBB3 styleswitcher.js
+function fontsizeup()
+{
+	var active = getActiveStyleSheet();
+
+	switch (active)
+	{
+		case 'A--':
+			setActiveStyleSheet('A-');
+		break;
+
+		case 'A-':
+			setActiveStyleSheet('A');
+		break;
+
+		case 'A':
+			setActiveStyleSheet('A+');
+		break;
+
+		case 'A+':
+			setActiveStyleSheet('A++');
+		break;
+
+		case 'A++':
+			setActiveStyleSheet('A');
+		break;
+
+		default:
+			setActiveStyleSheet('A');
+		break;
+	}
+}
+
+function fontsizedown()
+{
+	active = getActiveStyleSheet();
+
+	switch (active)
+	{
+		case 'A++' : 
+			setActiveStyleSheet('A+');
+		break;
+
+		case 'A+' : 
+			setActiveStyleSheet('A');
+		break;
+
+		case 'A' : 
+			setActiveStyleSheet('A-');
+		break;
+
+		case 'A-' : 
+			setActiveStyleSheet('A--');
+		break;
+
+		case 'A--' : 
+		break;
+
+		default :
+			setActiveStyleSheet('A--');
+		break;
+	}
+}
+
+function setActiveStyleSheet(title)
+{
+	var i, a, main;
+
+	for (i = 0; (a = document.getElementsByTagName('link')[i]); i++)
+	{
+		if (a.getAttribute('rel').indexOf('style') != -1 && a.getAttribute('title'))
+		{
+			a.disabled = true;
+			if (a.getAttribute('title') == title)
+			{
+				a.disabled = false;
+			}
+		}
+	}
+}
+
+function getActiveStyleSheet()
+{
+	var i, a;
+
+	for (i = 0; (a = document.getElementsByTagName('link')[i]); i++)
+	{
+		if (a.getAttribute('rel').indexOf('style') != -1 && a.getAttribute('title') && !a.disabled)
+		{
+			return a.getAttribute('title');
+		}
+	}
+
+	return null;
+}
+
+function getPreferredStyleSheet()
+{
+	return ('A-');
+}
+
+function createCookie(name, value, days)
+{
+	if (days)
+	{
+		var date = new Date();
+		date.setTime(date.getTime() + (days*24*60*60*1000));
+		var expires = '; expires=' + date.toGMTString();
+	}
+	else
+	{
+		expires = '';
+	}
+
+	document.cookie = name + '=' + value + expires + '; path=/';
+}
+
+function readCookie(name)
+{
+	var nameEQ = name + '=';
+	var ca = document.cookie.split(';');
+
+	for (var i = 0; i < ca.length; i++)
+	{
+		var c = ca[i];
+
+		while (c.charAt(0) == ' ')
+		{
+			c = c.substring(1, c.length);
+		}
+
+		if (c.indexOf(nameEQ) == 0)
+		{
+			return c.substring(nameEQ.length, c.length);
+		}
+	}
+
+	return null;
+}
+
+function load_cookie()
+{
+	var cookie = readCookie('style_cookie');
+	var title = cookie ? cookie : getPreferredStyleSheet();
+	setActiveStyleSheet(title);
+}
+
+function unload_cookie()
+{
+	var title = getActiveStyleSheet();
+	createCookie('style_cookie', title, 365);
+}
+// Browser detect http://www.quirksmode.org/js/detect.html
+var BrowserDetect = {
+	init: function () {
+		this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
+		this.version = this.searchVersion(navigator.userAgent)
+			|| this.searchVersion(navigator.appVersion)
+			|| "an unknown version";
+		this.OS = this.searchString(this.dataOS) || "an unknown OS";
+	},
+	searchString: function (data) {
+		for (var i=0;i<data.length;i++)	{
+			var dataString = data[i].string;
+			var dataProp = data[i].prop;
+			this.versionSearchString = data[i].versionSearch || data[i].identity;
+			if (dataString) {
+				if (dataString.indexOf(data[i].subString) != -1)
+					return data[i].identity;
+			}
+			else if (dataProp)
+				return data[i].identity;
+		}
+	},
+	searchVersion: function (dataString) {
+		var index = dataString.indexOf(this.versionSearchString);
+		if (index == -1) return;
+		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
+	},
+	dataBrowser: [
+		{ 	string: navigator.userAgent,
+			subString: "OmniWeb",
+			versionSearch: "OmniWeb/",
+			identity: "OmniWeb"
+		},
+		{
+			string: navigator.vendor,
+			subString: "Apple",
+			identity: "Safari"
+		},
+		{
+			prop: window.opera,
+			identity: "Opera"
+		},
+		{
+			string: navigator.vendor,
+			subString: "iCab",
+			identity: "iCab"
+		},
+		{
+			string: navigator.vendor,
+			subString: "KDE",
+			identity: "Konqueror"
+		},
+		{
+			string: navigator.userAgent,
+			subString: "Firefox",
+			identity: "Firefox"
+		},
+		{
+			string: navigator.vendor,
+			subString: "Camino",
+			identity: "Camino"
+		},
+		{		// for newer Netscapes (6+)
+			string: navigator.userAgent,
+			subString: "Netscape",
+			identity: "Netscape"
+		},
+		{
+			string: navigator.userAgent,
+			subString: "MSIE",
+			identity: "Explorer",
+			versionSearch: "MSIE"
+		},
+		{
+			string: navigator.userAgent,
+			subString: "Gecko",
+			identity: "Mozilla",
+			versionSearch: "rv"
+		},
+		{ 		// for older Netscapes (4-)
+			string: navigator.userAgent,
+			subString: "Mozilla",
+			identity: "Netscape",
+			versionSearch: "Mozilla"
+		}
+	],
+	dataOS : [
+		{
+			string: navigator.platform,
+			subString: "Win",
+			identity: "Windows"
+		},
+		{
+			string: navigator.platform,
+			subString: "Mac",
+			identity: "Mac"
+		},
+		{
+			string: navigator.platform,
+			subString: "Linux",
+			identity: "Linux"
+		}
+	]
+
+};
+// Browser detect http://www.quirksmode.org/js/detect.html
+onload_functions.push('load_cookie()');
+onunload_functions.push('unload_cookie()');
+
+
+var cookie = readCookie("style");
+var title = cookie ? cookie : getPreferredStyleSheet();
+setActiveStyleSheet(title);
+
Index: gym_sitemaps/style/medium.css
===================================================================
--- gym_sitemaps/style/medium.css	(phpBB 3.0.8)
+++ gym_sitemaps/style/medium.css	(Premod 3.0.8)
@@ -0,0 +1,3 @@
+body {
+	font-size: 11px;
+}
\ No newline at end of file
Index: gym_sitemaps/style/gym_rss.xsl
===================================================================
--- gym_sitemaps/style/gym_rss.xsl	(phpBB 3.0.8)
+++ gym_sitemaps/style/gym_rss.xsl	(Premod 3.0.8)
@@ -0,0 +1,197 @@
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+<xsl:output 
+	method="html" 
+	version="1.0" 
+	encoding="utf-8" 
+	omit-xml-declaration="yes"		
+	doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" 
+	doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
+	indent="yes" />
+<xsl:template match="/rss" >
+
+<xsl:variable name="rss_link">
+	<xsl:value-of select="channel/textInput/link" />
+</xsl:variable>
+<xsl:variable name="home_link">{ROOT_URL}</xsl:variable>
+<xsl:variable name="browser">
+	<xsl:choose><xsl:when test="system-property('xsl:vendor')='Transformiix'">mozilla</xsl:when>
+		<xsl:otherwise>other</xsl:otherwise>
+	</xsl:choose>
+</xsl:variable>
+<xsl:variable name="sorting">
+	<xsl:choose><xsl:when test="$browser='mozilla'">descending</xsl:when>
+		<xsl:otherwise>ascending</xsl:otherwise>
+	</xsl:choose>
+</xsl:variable>
+<html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
+<head>
+	<base href="{PHPBB_URL}"/>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
+	<title><xsl:value-of select="channel/title" /> -  {L_FEED}</title>
+	<link rel="alternate" type="application/rss+xml" title="{channel/title}" href="{$rss_link}" />
+	<link rel="stylesheet" href="{T_CSS_PATH}" type="text/css"  media="screen, projection"/>
+	<link href="{T_STYLE_PATH}normal.css" rel="stylesheet" type="text/css" title="A" />
+	<link href="{T_STYLE_PATH}medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
+	<link href="{T_STYLE_PATH}large.css" rel="alternate stylesheet" type="text/css" title="A++" />
+	<script type="text/javascript" src="{T_STYLE_PATH}gym_js.js"></script>
+</head>
+<body id="phpbb">
+<!--
+	GYM Sitemaps and RSS XSLTransform
+	(C) phpBB SEO - http://www.phpbb-seo.com/
+-->
+			<div id="wrap">
+				<a id="top" name="top" accesskey="t"></a>
+				<div id="page-header">
+					<div class="headerbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div id="site-description"><a href="{$home_link}" title="{L_HOME}" id="logo"><img src="{channel/image/url}" alt="{channel/image/title}" /></a>
+								<h1>{SITENAME}</h1>
+								<p>{SITE_DESCRIPTION}</p>
+								<p style="display: none;"><a href="#start_here">{L_SKIP}</a></p>
+							</div>
+							<div id="search-box">
+								<form action="{PHPBB_URL}search.php" method="post" id="search">
+								<fieldset>
+									<input name="keywords" id="keywords" type="text" maxlength="128" title="" class="inputbox search" value="" /> 
+									<input class="button2" value="{L_SEARCH}" type="submit" /><br />
+									<a href="{PHPBB_URL}search.php" title="{L_SEARCH_ADV_EXPLAIN}">{L_SEARCH_ADV}</a>
+								</fieldset>
+								</form>
+							</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<div class="navbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<ul class="linklist navlinks">
+								<li class="icon-home">
+									<a href="{$home_link}" accesskey="h">{L_HOME}</a>&#160;<strong>&#8249;</strong>&#160;
+									<xsl:if test="$home_link != '{PHPBB_URL}'">
+										<xsl:if test="'{PHPBB_URL}' != channel/link">
+											<a href="{PHPBB_URL}">{L_FORUM_INDEX}</a>&#160;<strong>&#8249;</strong>&#160;
+										</xsl:if>
+									</xsl:if>
+									<a href="{channel/link}" title="{channel/title}"><span class="html"><xsl:value-of select="channel/title" /></span></a>&#160;<strong>&#8249;</strong>&#160;<a href="{$rss_link}">{L_SOURCE}</a></li>
+								<li class="rightside"><a href="#" onclick="fontsizeup(); return false;" class="fontsize" title="{L_CHANGE_FONT_SIZE}">{L_CHANGE_FONT_SIZE}</a></li>
+							</ul>
+							<ul class="linklist leftside">
+								<li class="icon-ucp">
+									<a href="{$rss_link}" title="{channel/title}" accesskey="u"><span class="html"><xsl:value-of select="channel/title" />&#160;-&#160;{L_FEED}</span></a>
+								</li>
+							</ul>
+							<ul class="linklist rightside">
+								<li class="icon-faq"><a href="{PHPBB_URL}faq.php" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>
+								<li class="icon-register"><a href="{PHPBB_URL}ucp.php?mode=register">{L_REGISTER}</a></li>
+							</ul>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+				</div>
+				<a name="start_here"></a>
+				<div id="page-body"><br/>
+					<div class="clear"></div>
+					<xsl:for-each select="channel">
+					<div class="post bg3">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div class="postbody"><div class="html"><p><h2><a href="{link}" title="{title}"><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a></h2></p><hr/>
+
+								<p><span class="html"><xsl:call-template name="nl2br"><xsl:with-param name="input" select="description" /></xsl:call-template></span><br/><br/>
+{L_SUBSCRIBE}
+							<form action="" method="POST" >
+								<fieldset >
+									<label><a href="{$rss_link}" title="{title}"><img src="{T_IMAGE_PATH}feed-icon.png" alt="{L_2_LINK}" align="middle"/></a> {L_2_LINK}</label>
+									<input name="urlrss" type="text" value="{$rss_link}" size="80" maxlength="500"/>
+								</fieldset>
+							</form>
+							<br/>
+{L_LAST_UPDATE} : <xsl:value-of select="lastBuildDate"/><br/>
+{L_UPDATE} : <xsl:value-of select="ttl"/>&#160;{L_MINUTES}.<br/><br/>
+				<xsl:choose>
+					<xsl:when test="count(item) = 1">&#160;<b>{L_ITEM_LISTED}</b>
+						</xsl:when>
+					<xsl:otherwise>
+						<b><xsl:value-of select="count(item)"/>&#160;{L_ITEMS_LISTED}</b>
+					</xsl:otherwise>
+					</xsl:choose></p></div></div>
+							<dl class="postprofile">
+								<dt>{L_SUBSCRIBE_POD}<br/><br/>
+								<a href="http://fusion.google.com/add?feedurl={$rss_link}" target="_google"><img src="{T_IMAGE_PATH}addGoogle.gif" border="0" alt="Add to Google" title="Add to Google"/></a><br/>
+								<a href="http://add.my.yahoo.com/rss?url={$rss_link}" target="_yahoo"><img src="{T_IMAGE_PATH}addtomyyahoo.gif" border="0" alt="Add to My Yahoo" title="Add to My Yahoo"/></a><br/>
+								<a href="http://my.msn.com/addtomymsn.armx?id=rss&#038;ut={$rss_link}&#038;ru={$rss_link}" target="_msn"><img src="{T_IMAGE_PATH}MyMSN.gif" alt="Add to My MSN" title="Add to My MSN"/></a><br/>
+								<a href="http://feeds.my.aol.com/index.jsp?url={$rss_link}" target="_aol"><img alt="Add to MY AOL" src="{T_IMAGE_PATH}myaol.gif"  title="Add to My AOL" border="0"/></a><br/>
+								<a href="http://www.newsgator.com/ngs/subscriber/subext.aspx?url={$rss_link}" target="_newsgator"><img src="{T_IMAGE_PATH}newsgator.gif" alt="Subscribe in NewsGator Online" title="Subscribe in NewsGator Online" border="0"/></a><br/>
+								<a href="http://www.netvibes.com/subscribe.php?url={$rss_link}" target="_netvibes"><img src="{T_IMAGE_PATH}add2netvibes.gif" border="0" alt="Add to Netvibes" title="Add to Netvibes"/></a><br/>
+								<a href="http://www.pageflakes.com/subscribe.aspx?url={$rss_link}" target="_pageflakes"><img src="{T_IMAGE_PATH}pageflakes.gif" border="0" alt="Add to Page Flakes" title="Add to Page Flakes"/></a><br/>
+								</dt>
+							</dl>
+							
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<br/><br/>
+					<xsl:for-each select="item">
+						<xsl:sort select="substring(pubDate,12,string-length(pubDate))" order="{$sorting}" data-type="number"/> 
+					<div class="post bg2">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div class="postbody">
+								<div class="content"><p><h2><a href="{link}" title="{title}"><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a></h2></p>
+									<span class="html"><xsl:call-template name="nl2br"><xsl:with-param name="input" select="description" /></xsl:call-template></span>
+									<div class="signature">
+										<b>{L_BOOKMARK_THIS}</b>&#160;
+										<a href="http://www.scoopeo.com/scoop/new?newurl={link}&amp;title={title}" title="Scoopeo : {title}"><img src="{T_IMAGE_PATH}scoopeo.png" alt="Scoopeo" /></a>&#160;  
+										<a href="http://www.wikio.fr/publish?url={link}&amp;title={title}" title="Wikio : {title}"><img src="{T_IMAGE_PATH}wikio.gif" alt="Wikio" /></a>&#160;
+										<a href="http://digg.com/submit?phase=2&amp;url={link}&amp;title={title}" title="Digg : {title}"><img src="{T_IMAGE_PATH}digg.png" alt="Digg" /></a>&#160;
+										<a href="http://www.fuzz.fr/submit?url={link}&amp;title={title}" title="Fuzz : {title}"><img src="{T_IMAGE_PATH}fuzz.png" alt="Fuzz" /></a>&#160;
+										<a href="http://www.nuouz.com/addNews.aspx?url={link}&amp;title={title}" title="Nuouz : {title}"><img src="{T_IMAGE_PATH}nuouz.png" alt="Nuouz" /></a>&#160;
+										<a href="http://reddit.com/submit?url={link}&amp;title={title}" title="Reddit : {title}"><img src="{T_IMAGE_PATH}reddit.png" alt="Reddit" /></a>&#160;
+										<a href="http://www.addthis.com/bookmark.php" onclick="window.open('http://www.addthis.com/bookmark.php?wt=nw&amp;url={link}&amp;title={title}', 'addthis', 'scrollbars=yes,menubar=no,resizable=yes,toolbar=no,location=no,status=no,width=620,height=560,left=200,top=100'); return false;" title="addThis : {title}"><img src="{T_IMAGE_PATH}addthis.gif" alt="addThis" /></a>
+									</div>
+								</div>
+							</div>
+							<dl class="postprofile">
+								<dt><b>{L_LINK} :</b><br/> <a href="{link}" title="{title}" ><span class="html"><xsl:value-of select="title" disable-output-escaping="yes"/></span></a><br/>
+									<b>{L_SOURCE} :</b><br/> <a href="{source/@url}" title="{source}"><img src="{T_IMAGE_PATH}feed-icon.png" alt="{L_2_LINK}" align="middle"/>&#160;<span class="html"><xsl:value-of select="source" disable-output-escaping="yes"/></span></a><br/> 
+									<b>{L_LASTMOD_DATE} :</b><br/> <xsl:value-of select="pubDate" />
+								</dt>
+								<dd> </dd>
+							</dl>
+							<div class="back2top"><a href="{$rss_link}#wrap" class="top" title="{L_BACK_TO_TOP}"></a>{L_BACK_TO_TOP}&#160;</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<br/><hr class="divider" />
+					</xsl:for-each>
+				</xsl:for-each>
+				</div>
+			</div>
+
+<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &#169; 2000 - 2008 phpBB Group</div>
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team.
+-->
+<div class="copyright">{L_COPY}&#160;<a href="http://feedvalidator.org/check.cgi?url={$rss_link}"><img src="{T_IMAGE_PATH}rss-valid.gif" alt="{L_RSS_VALID}" title="{L_RSS_VALID}" /></a></div>
+</body>
+</html>
+</xsl:template>
+<!-- nl2br template for cleaner output, no brs in xml ! -->
+<xsl:template name="nl2br">
+	<xsl:param name="input" />
+		<xsl:choose>
+			<xsl:when test="contains($input,'&#xA;')">
+				<xsl:call-template name="nl2br"><xsl:with-param name="input" select="concat(substring-before($input,'&#xA;'), '&lt;br&gt;',substring-after($input,'&#xA;'))" />
+				</xsl:call-template>
+			</xsl:when>
+		<xsl:otherwise>
+			<xsl:value-of disable-output-escaping="yes" select="$input" />
+		</xsl:otherwise>
+		</xsl:choose>
+</xsl:template>
+</xsl:stylesheet>
Index: gym_sitemaps/style/gym_rss.css
===================================================================
--- gym_sitemaps/style/gym_rss.css	(phpBB 3.0.8)
+++ gym_sitemaps/style/gym_rss.css	(Premod 3.0.8)
@@ -0,0 +1,1547 @@
+/*  phpBB 3.0 Style Sheet
+    --------------------------------------------------------------
+	Style name:		proSilver
+	Based on style:	proSilver (this is the default phpBB 3 style)
+	Original author:	subBlue ( http://www.subBlue.com/ )
+	Modified by:		dcz phpBB SEO ( www.phpbb-seo.com )
+	
+	Copyright 2006 phpBB Group ( http://www.phpbb.com/ )
+    --------------------------------------------------------------
+*/
+
+/* General proSilver Markup Styles
+---------------------------------------- */
+
+* {/* Reset browsers default margin, padding and font sizes */
+	margin: 0;
+	padding: 0;
+}
+html { font-size: 100%;
+	/* Always show a scrollbar for short pages - stops the jump when the scrollbar appears. non-IE browsers */
+	height: 100%;
+	margin-bottom: 1px;
+}
+body { /* Text-Sizing with ems: http://www.clagnut.com/blog/348/ */
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	color: #828282;
+	background-color: #FFFFFF;
+	/*font-size: 62.5%;			 This sets the default font size to be equivalent to 10px */
+	font-size: 10px;
+	margin: 10px;
+	padding: 12px 0;
+}
+h1 { /* Forum name */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	margin-right: 200px;
+	color: #FFFFFF;
+	margin-top: 15px;
+	font-weight: bold;
+	font-size: 2em;
+}
+h2 { /* Forum header titles */
+	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
+	font-weight: normal;
+	color: #3f3f3f;
+	font-size: 2em;
+	margin: 0.8em 0 0.2em 0;
+}
+h2.solo { margin-bottom: 1em; }
+
+h3 { /* Sub-headers (also used as post headers, but defined later) */
+	font-family: Arial, Helvetica, sans-serif;
+	font-weight: bold;
+	text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	padding-bottom: 2px;
+	font-size: 1.05em;
+	color: #989898;
+	margin-top: 20px;
+}
+h4 { /* Forum and topic list titles */
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, Sans-serif;
+	font-size: 1.3em;
+}
+h5 { font-family: "Trebuchet MS",Verdana, Arial, Helvetica, sans-serif;
+	float: right;
+	font-weight:bold;
+	font-size:16px;
+	color:#707070;
+	margin-top:1px;
+}
+p { line-height: 1.3em;
+	font-size: 1.1em;
+	margin-bottom: 1.5em;
+}
+
+img {
+	border-width: 0;
+}
+
+hr { /* Also see tweaks.css */
+	border: 0 none #FFFFFF;
+	border-top: 1px solid #CCCCCC;
+	height: 1px;
+	margin: 5px 0;
+	display: block;
+	clear: both;
+}
+hr.dashed { border-top: 1px dashed #CCCCCC;
+	margin: 10px 0;
+}
+hr.divider { display: none;}
+p.right { text-align: right;}
+
+/* Main blocks
+---------------------------------------- */
+#simple-wrap { padding: 6px 10px; }
+#page-body { margin: 4px 0;
+	clear: both;
+}
+#page-footer { clear: both;
+}
+#page-footer h3 { margin-top: 20px;
+}
+#logo { float: left;
+	width: auto;
+	padding: 10px 13px 0 10px;
+}
+a#logo:hover { text-decoration: none;}
+/* Search box
+--------------------------------------------- */
+#search-box { color: #FFFFFF;
+	position: relative;
+	margin-top: 30px;
+	margin-right: 5px;
+	display: block;
+	float: right;
+	text-align: right;
+	white-space: nowrap; /* For Opera */
+}
+#search-box #keywords { width: 95px;
+	background-color: #FFF;
+}
+#search-box input { border: 1px solid #b0b0b0;
+}
+/* .button1 style defined later, just a few tweaks for the search button version */
+#search-box input.button1 { padding: 1px 5px;}
+#search-box li { text-align: right;
+	margin-top: 4px;
+}
+#search-box img {
+	vertical-align: middle;
+	margin-right: 3px;
+}
+/* Site description and logo */
+#site-description { float: left;
+	width: 70%;
+}
+
+#site-description h1 {	margin-right: 0;}
+
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar { background: #ebebeb none repeat-x 0 0;
+	color: #FFFFFF;
+	margin-bottom: 4px;
+	padding: 0 5px;
+}
+.navbar { background-color: #ebebeb;
+	padding: 0 10px;
+}
+.forabg { background: #b1b1b1 none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.forumbg { background: #ebebeb none repeat-x 0 0;
+	margin-bottom: 4px;
+	padding: 0 5px;
+	clear: both;
+}
+.panel { margin-bottom: 4px;
+	padding: 0 10px;
+	background-color: #f3f3f3;
+	color: #3f3f3f;
+}
+.post { padding: 0 10px;
+	margin-bottom: 4px;
+	background-repeat: no-repeat;
+	background-position: 100% 0;
+}
+.post:target .content { color: #000000;}
+.post:target h3 a { color: #000000;}
+.bg1	{ background-color: #f7f7f7;}
+.bg2	{ background-color: #f2f2f2; }
+.bg3	{ background-color: #ebebeb; }
+.rowbg { margin: 5px 5px 2px 5px;}
+.ucprowbg { background-color: #e2e2e2; }
+.fieldsbg { /*border: 1px #DBDEE2 solid;*/
+	background-color: #eaeaea;
+}
+span.corners-top, span.corners-bottom, span.corners-top span, span.corners-bottom span {
+	font-size: 1px;
+	line-height: 1px;
+	display: block;
+	height: 5px;
+	background-repeat: no-repeat;
+}
+span.corners-top { background-image: none;
+	background-position: 0 0;
+	margin: 0 -5px;
+}
+span.corners-top span { background-image: none;
+	background-position: 100% 0;
+}
+span.corners-bottom { background-image: none;
+	background-position: 0 100%;
+	margin: 0 -5px;
+	clear: both;
+}
+span.corners-bottom span { background-image: none;;
+	background-position: 100% 100%;
+}
+.headbg span.corners-bottom { margin-bottom: -1px; }
+.post span.corners-top, .post span.corners-bottom, .panel span.corners-top, .panel span.corners-bottom, .navbar span.corners-top, .navbar span.corners-bottom { margin: 0 -10px; }
+.rules span.corners-top { margin: 0 -10px 5px -10px;}
+.rules span.corners-bottom { margin: 5px -10px 0 -10px;}
+/* Horizontal lists
+----------------------------------------*/
+ul.linklist { display: block;
+	margin: 0;
+}
+ul.linklist li { display: block;
+	list-style-type: none;
+	float: left;
+	width: auto;
+	margin-right: 5px;
+	font-size: 1.1em;
+	line-height: 2.2em;
+}
+ul.linklist li.rightside, p.rightside { float: right;
+	margin-right: 0;
+	margin-left: 5px;
+	text-align: right;
+}
+ul.navlinks { padding-bottom: 1px;
+	margin-bottom: 1px;
+	border-bottom: 1px solid #FFFFFF;
+	font-weight: bold;
+}
+ul.leftside { float: left;
+	margin-left: 0;
+	margin-right: 5px;
+	text-align: left;
+}
+ul.rightside { float: right;
+	margin-left: 5px;
+	margin-right: -5px;
+	text-align: right;
+}
+/* Misc layout styles
+---------------------------------------- */
+dl.details {
+	/*font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;*/
+	font-size: 1.1em;
+}
+dl.details dt {
+	float: left;
+	clear: left;
+	width: 15em;
+	text-align: right;
+	color: #000000;
+	display: block;
+}
+dl.details dd {
+	margin-left: 0;
+	padding-left: 5px;
+	margin-bottom: 5px;
+	color: #828282;
+	float: left;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright { padding: 5px;
+	text-align: center;
+	color: #555555;
+}
+div.rules {
+	background-color: #ececec;
+	color: #bcbcbc;
+	padding: 0 10px;
+	margin: 10px 0;
+	font-size: 1.1em;
+}
+div.rules ul { margin-left: 20px; }
+p.rules { background-color: #ececec;
+	background-image: none;
+	padding: 5px;
+}
+p.rules img { vertical-align: middle; }
+p.rules a { vertical-align: middle;
+	clear: both;
+}
+#top { position: absolute;
+	top: -20px;
+}
+/* proSilver Link Styles
+---------------------------------------- */
+a:link	{ color: #898989; text-decoration: none; }
+a:visited	{ color: #898989; text-decoration: none; }
+a:hover	{ color: #d3d3d3; text-decoration: underline; }
+a:active	{ color: #d2d2d2; text-decoration: none; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {
+	color: #FFFFFF;
+	text-decoration: none;
+}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {
+	color: #ffffff;
+	text-decoration: underline;
+}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {
+	color: #ffffff;
+	text-decoration: none;
+}
+/* Links for forum/topic lists */
+a.forumtitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.forumtitle:visited { color: #898989; } */
+a.forumtitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.forumtitle:active { color: #898989; }
+a.topictitle { font-family: "Trebuchet MS", Helvetica, Arial, Sans-serif;
+	font-size: 1.2em;
+	font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+/* a.topictitle:visited { color: #d2d2d2; } */
+a.topictitle:hover { color: #bcbcbc;
+	text-decoration: underline;
+}
+a.topictitle:active {
+	color: #898989;
+}
+/* Post body links */
+.postlink { text-decoration: none;
+	color: #d2d2d2;
+	border-bottom: 1px solid #d2d2d2;
+	padding-bottom: 0;
+}
+.postlink:visited { color: #bdbdbd;
+	border-bottom-style: dotted;
+	border-bottom-color: #666666;
+}
+.postlink:active { color: #d2d2d2; }
+.postlink:hover { background-color: #f6f6f6;
+	text-decoration: none;
+	color: #404040;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {
+	border: none;
+	text-decoration: underline;
+	background-color: transparent;
+}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a { font-weight: bold;
+	color: #898989;
+	text-decoration: none;
+}
+.postprofile a:hover, .postprofile dt.author a:hover { text-decoration: underline;
+	color: #d3d3d3;
+}
+/* Profile searchresults */	
+.search .postprofile a { color: #898989;
+	text-decoration: none; 
+	font-weight: normal;
+}
+.search .postprofile a:hover { color: #d3d3d3;
+	text-decoration: underline; 
+}
+/* Back to top of page */
+.back2top { clear: both;
+	height: 11px;
+	text-align: right;
+}
+a.top { background: none no-repeat top left;
+	text-decoration: none;
+	width: 11px;
+	height: 11px;
+	display: block;
+	float: right;
+	overflow: hidden;
+	letter-spacing: 1000px;
+	text-indent: 11px;
+}
+a.top2 {
+	background: none no-repeat 0 50%;
+	text-decoration: none;
+	padding-left: 15px;
+}
+/* Arrow links  */
+a.up		{ background: none no-repeat left center; }
+a.down		{ background: none no-repeat right center; }
+a.left		{ background: none no-repeat 3px 60%; }
+a.right		{ background: none no-repeat 95% 60%; }
+a.up, a.up:link, a.up:active, a.up:visited { padding-left: 10px;
+	text-decoration: none;
+	border-bottom-width: 0;
+}
+a.up:hover { background-position: left top;
+	background-color: transparent;
+}
+a.down, a.down:link, a.down:active, a.down:visited { padding-right: 10px; }
+a.down:hover { background-position: right bottom;
+	text-decoration: none;
+}
+a.left, a.left:active, a.left:visited { padding-left: 12px; }
+a.left:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 0 60%;
+}
+a.right, a.right:active, a.right:visited { padding-right: 12px;}
+a.right:hover { color: #d2d2d2;
+	text-decoration: none;
+	background-position: 100% 60%;
+}
+/* proSilver Content Styles
+---------------------------------------- */
+ul.topiclist { display: block;
+	list-style-type: none;
+	margin: 0;
+}
+ul.forums { background: #f9f9f9 none repeat-x 0 0;
+}
+ul.topiclist li { display: block;
+	list-style-type: none;
+	color: #777777;
+	margin: 0;
+}
+ul.topiclist dl { position: relative;}
+ul.topiclist li.row dl {padding: 2px 0;}
+ul.topiclist dt {display: block;
+	float: left;
+	width: 50%;
+	font-size: 1.1em;
+	padding-left: 5px;
+	padding-right: 5px;
+}
+ul.topiclist dd { display: block;
+	float: left;
+	border-left: 1px solid #FFFFFF;
+	padding: 4px 0;
+}
+ul.topiclist dfn { /* Labels for post/view counts */
+	display: none;
+}
+
+ul.topiclist li.row dt a.subforum { background-image: none;
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	position: relative;
+	white-space: nowrap;
+	padding: 0 0 0 12px;
+}
+.forum-image { float: left;
+	padding-top: 5px;
+	margin-right: 5px;
+}
+li.row { border-top: 1px solid #FFFFFF;
+	border-bottom: 1px solid #8f8f8f;
+}
+li.row strong { font-weight: normal;
+	color: #000000;
+}
+li.row:hover { background-color: #f6f6f6;
+}
+li.row:hover dd { border-left-color: #CCCCCC;
+}
+li.header dt, li.header dd { line-height: 1em;
+	border-left-width: 0;
+	margin: 2px 0 4px 0;
+	color: #FFFFFF;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	font-size: 1em;
+	font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+li.header dt { font-weight: bold;}
+li.header dd { margin-left: 1px;}
+li.header dl.icon { min-height: 0;}
+li.header dl.icon dt { /* Tweak for headers alignment when folder icon used */
+	padding-left: 0;
+	padding-right: 44px;
+}
+/* Forum list column styles */
+dl.icon { min-height: 35px;
+	background-position: 10px 50%;		/* Position of folder icon */
+	background-repeat: no-repeat;
+}
+dl.icon dt { padding-left: 45px;					/* Space for folder icon */
+	background-repeat: no-repeat;
+	background-position: 5px 95%;		/* Position of topic icon */
+}
+dd.posts, dd.topics, dd.views { width: 8%;
+	text-align: center;
+	line-height: 2.2em;
+	font-size: 1.2em;
+}
+dd.lastpost { width: 25%;
+	font-size: 1.1em;
+}
+dd.redirect { font-size: 1.1em;
+	line-height: 2.5em;
+}
+dd.moderation { font-size: 1.1em; }
+dd.lastpost span, ul.topiclist dd.searchby span, ul.topiclist dd.info span, ul.topiclist dd.time span, dd.redirect span, dd.moderation span { display: block;
+	padding-left: 5px;
+}
+dd.time { width: auto;
+	line-height: 200%;
+	font-size: 1.1em;
+}
+dd.extra { width: 65px;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.mark { float: right !important;
+	width: 9%;
+	text-align: center;
+	line-height: 200%;
+	font-size: 1.2em;
+}
+dd.info { width: 30%; }
+dd.option { width: 15%;
+	line-height: 200%;
+	text-align: center;
+	font-size: 1.1em;
+}
+dd.searchby { width: 47%;
+	font-size: 1.1em;
+	line-height: 1em;
+}
+ul.topiclist dd.searchextra { margin-left: 5px;
+	padding: 0.2em 0;
+	font-size: 1.1em;
+	color: #333333;
+	border-left: none;
+	clear: both;
+	width: 98%;
+	overflow: hidden;
+}
+/* Container for post/reply buttons and pagination */
+.topic-actions { margin-bottom: 3px;
+	font-size: 1.1em;
+	height: 28px;
+	min-height: 28px;
+}
+div[class].topic-actions { height: auto; }
+/* Post body styles
+----------------------------------------*/
+.postbody { padding: 0;
+	line-height: 1.48em;
+	color: #333333;
+	width: 76%;
+	float: left;
+	clear: both;
+}
+.postbody .ignore { font-size: 1.1em; }
+.postbody h3.first { /* The first post on the page uses this */
+	font-size: 1.7em;
+}
+.postbody h3 { /* Postbody requires a different h3 format - so change it here */
+	font-size: 1.5em;
+	padding: 2px 0 0 0;
+	margin: 0 0 0.3em 0 !important;
+	text-transform: none;
+	border: none;
+	font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	line-height: 125%;
+}
+.postbody h3 img { /* Also see tweaks.css */
+	vertical-align: bottom;
+}
+.postbody .content { font-size: 1.3em; }
+.search .postbody { width: 68% }
+/* Content container styles
+----------------------------------------*/
+.content { min-height: 3em;
+	overflow: hidden;
+	line-height: 1.4em;
+	font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	color: #333333;
+}
+.content h2, .panel h2 { font-weight: normal;
+	color: #989898;
+	border-bottom: 1px solid #CCCCCC;
+	font-size: 1.6em;
+	margin-top: 0.5em;
+	margin-bottom: 0.5em;
+	padding-bottom: 0.5em;
+}
+.panel h3 { margin: 0.5em 0; }
+.panel p { font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+.content p { font-family: "Lucida Grande", "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.2em;
+	margin-bottom: 1em;
+	line-height: 1.4em;
+}
+dl.faq { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+	margin-top: 1em;
+	margin-bottom: 2em;
+	line-height: 1.4em;
+}
+dl.faq dt { font-weight: bold;
+	color: #333333;
+}
+.content dl.faq { font-size: 1.2em;
+	margin-bottom: 0.5em;
+}
+.content li { list-style-type: inherit; }
+.content ul, .content ol { margin-bottom: 1em;
+	margin-left: 3em;
+}
+.announce, .unreadpost {
+	/* Highlight the announcements & unread posts box */
+	border-left-color: #BCBCBC;
+	border-right-color: #BCBCBC;
+}
+/* Post author */
+p.author { margin: 0 15em 0.6em 0;
+	padding: 0 0 5px 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1em;
+	line-height: 1.2em;
+}
+/* Post signature */
+.signature { margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1.1em;
+	border-top: 1px solid #CCCCCC;
+	clear: left;
+	line-height: 140%;
+	overflow: hidden;
+	width: 100%;
+}
+dd .signature { margin: 0;
+	padding: 0;
+	clear: none;
+	border: none;
+}
+/* Post noticies */
+.notice { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: auto;
+	margin-top: 1.5em;
+	padding-top: 0.2em;
+	font-size: 1em;
+	border-top: 1px dashed #CCCCCC;
+	clear: left;
+	line-height: 130%;
+}
+/* Jump to post link for now */
+ul.searchresults {
+	list-style: none;
+	text-align: right;
+	clear: both;
+}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {
+	background: #ebebeb none 6px 8px no-repeat;
+	border: 1px solid #dbdbdb;
+	font-size: 0.95em;
+	margin: 0.5em 1px 0 25px;
+	overflow: hidden;
+	padding: 5px;
+}
+blockquote blockquote { /* Nested quotes */
+	background-color: #bababa;
+	font-size: 1em;
+	margin: 0.5em 1px 0 15px;	
+}
+blockquote blockquote blockquote { /* Nested quotes */
+	background-color: #e4e4e4;
+}
+blockquote cite { /* Username/source of quoter */
+	font-style: normal;
+	font-weight: bold;
+	margin-left: 20px;
+	display: block;
+	font-size: 0.9em;
+}
+blockquote cite cite { font-size: 1em; }
+blockquote.uncited { padding-top: 25px; }
+/* Code block */
+dl.codebox {
+	padding: 3px;
+	background-color: #FFFFFF;
+	border: 1px solid #d8d8d8;
+	font-size: 1em;
+}
+dl.codebox dt { text-transform: uppercase;
+	border-bottom: 1px solid #CCCCCC;
+	margin-bottom: 3px;
+	font-size: 0.8em;
+	font-weight: bold;
+	display: block;
+}
+blockquote dl.codebox { margin-left: 0; }
+dl.codebox code { /* Also see tweaks.css */
+	overflow: auto;
+	display: block;
+	height: auto;
+	max-height: 200px;
+	white-space: normal;
+	padding-top: 5px;
+	font: 0.9em Monaco, "Andale Mono","Courier New", Courier, mono;
+	line-height: 1.3em;
+	color: #8b8b8b;
+	margin: 2px 0;
+}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #000000; }
+.syntaxdefault	{ color: #bcbcbc; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #585858; }
+.syntaxstring	{ color: #a7a7a7; }
+/* Attachments
+----------------------------------------*/
+.attachbox { float: left;
+	width: auto; 
+	margin: 5px 5px 5px 0;
+	padding: 6px;
+	background-color: #FFFFFF;
+	border: 1px dashed #d8d8d8;
+	clear: left;
+}
+.pm-message .attachbox { background-color: #f3f3f3; }
+.attachbox dt { font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+}
+.attachbox dd { margin-top: 4px;
+	padding-top: 4px;
+	clear: left;
+	border-top: 1px solid #d8d8d8;
+}
+.attachbox dd dd { border: none; }
+.attachbox p { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attachbox p.stats { line-height: 110%;
+	color: #666666;
+	font-weight: normal;
+	clear: left;
+}
+.attach-image { margin: 3px 0;
+	width: 100%;
+	max-height: 350px;
+	overflow: auto;
+}
+.attach-image img { border: 1px solid #999999;
+/*	cursor: move; */
+	cursor: default;
+}
+/* Inline image thumbnails */
+div.inline-attachment dl.thumbnail, div.inline-attachment dl.file { display: block;
+	margin-bottom: 4px;
+}
+div.inline-attachment p { font-size: 100%; }
+dl.file { font-family: Verdana, Arial, Helvetica, sans-serif;
+	display: block;
+}
+dl.file dt { text-transform: none;
+	margin: 0;
+	padding: 0;
+	font-weight: bold;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+dl.file dd { color: #666666;
+	margin: 0;
+	padding: 0;	
+}
+dl.thumbnail img { padding: 3px;
+	border: 1px solid #666666;
+	display: block;
+	background-color: #FFF;
+}
+dl.thumbnail dd { color: #666666;
+	font-style: italic;
+	font-family: Verdana, Arial, Helvetica, sans-serif;
+}
+.attachbox dl.thumbnail dd { font-size: 100%; }
+dl.thumbnail dt a:hover { background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img { border: 1px solid #d2d2d2; }
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls { font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif; }
+fieldset.polls dl { margin-top: 5px;
+	border-top: 1px solid #e2e2e2;
+	padding: 5px 0 0 0;
+	line-height: 120%;
+	color: #666666;
+}
+fieldset.polls dl.voted { font-weight: bold;
+	color: #000000;
+}
+fieldset.polls dt { text-align: left;
+	float: left;
+	display: block;
+	width: 30%;
+	border-right: none;
+	padding: 0;
+	margin: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd { float: left;
+	width: 10%;
+	border-left: none;
+	padding: 0 5px;
+	margin-left: 0;
+	font-size: 1.1em;
+}
+fieldset.polls dd.resultbar { width: 50%;}
+fieldset.polls dd input { margin: 2px 0; }
+fieldset.polls dd div { text-align: right;
+	font-family: Arial, Helvetica, sans-serif;
+	color: #FFFFFF;
+	font-weight: bold;
+	padding: 0 2px;
+	overflow: visible;
+	min-width: 2%;
+}
+.pollbar1 { background-color: #aaaaaa;
+	border-bottom: 1px solid #747474;
+	border-right: 1px solid #747474;
+}
+.pollbar2 { background-color: #bebebe;
+	border-bottom: 1px solid #8c8c8c;
+	border-right: 1px solid #8c8c8c;
+}
+.pollbar3 { background-color: #D1D1D1;
+	border-bottom: 1px solid #aaaaaa;
+	border-right: 1px solid #aaaaaa;
+}
+.pollbar4 { background-color: #e4e4e4;
+	border-bottom: 1px solid #bebebe;
+	border-right: 1px solid #bebebe;
+}
+.pollbar5 { background-color: #f8f8f8;
+	border-bottom: 1px solid #D1D1D1;
+	border-right: 1px solid #D1D1D1;
+}
+/* Poster profile block
+----------------------------------------*/
+.postprofile { /* Also see tweaks.css */
+	margin: 5px 0 10px 0;
+	min-height: 80px;
+	color: #666666;
+	border-left: 1px solid #FFFFFF;
+	width: 22%;
+	float: right;
+	display: inline;
+}
+.pm .postprofile { border-left: 1px solid #DDDDDD; }
+.postprofile dd, .postprofile dt { line-height: 1.2em;
+	margin-left: 8px;
+}
+.postprofile strong {font-weight: normal;
+	color: #000000;
+}
+.avatar { border: none;
+	margin-bottom: 3px;
+}
+.online { background-image: none;
+	background-position: 100% 0;
+	background-repeat: no-repeat;
+}
+/* Poster profile used by search*/
+.search .postprofile { width: 30%;}
+/* pm list in compose message if mass pm is enabled */
+dl.pmlist dt { width: 60% !important;}
+dl.pmlist dt textarea { width: 95%;}
+dl.pmlist dd { margin-left: 61% !important;
+	margin-bottom: 2px;
+}
+/* proSilver Button Styles
+---------------------------------------- */
+/* Rollover buttons
+   Based on: http://wellstyled.com/css-nopreload-rollovers.html
+----------------------------------------*/
+.buttons { float: left;
+	width: auto;
+	height: auto;
+}
+/* Rollover state */
+.buttons div { float: left;
+	margin: 0 5px 0 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+.buttons div a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+.buttons div span		{ display: none; }
+.buttons div a:hover	{ background-image: none; }
+/* Big button images */
+.reply-icon, .reply-icon a			{ background: transparent none 0 0 no-repeat; }
+.post-icon, .post-icon a				{ background: transparent none 0 0 no-repeat; }
+.locked-icon, .locked-icon a			{ background: transparent none 0 0 no-repeat; }
+.pmreply-icon, .pmreply-icon a		{ background: none 0 0 no-repeat; }
+.newpm-icon, .newpm-icon a			{ background: none 0 0 no-repeat; }
+.forwardpm-icon, .forwardpm-icon a 	{ background: none 0 0 no-repeat; }
+/* Set big button dimensions */
+.buttons div.reply-icon		{ width: 96px; height: 25px; }
+.buttons div.post-icon		{ width: 96px; height: 25px; }
+.buttons div.locked-icon	{ width: 96px; height: 25px; }
+.buttons div.pmreply-icon	{ width: 96px; height: 25px; }
+.buttons div.newpm-icon		{ width: 96px; height: 25px; }
+.buttons div.forwardpm-icon	{ width: 110px; height: 25px; }
+/* Sub-header (navigation bar)
+--------------------------------------------- */
+a.print, a.sendemail, a.fontsize { display: block;
+	overflow: hidden;
+	height: 18px;
+	text-indent: -5000px;
+	text-align: left;
+	background-repeat: no-repeat;
+}
+a.fontsize { background-image: none;
+	background-position: 0 -1px;
+	width: 29px;
+}
+a.fontsize:hover { background-position: 0 -20px;
+	text-decoration: none;
+}
+/* Icon images
+---------------------------------------- */
+.sitehome, .icon-faq, .icon-members, .icon-home, .icon-ucp, .icon-register, .icon-logout,
+.icon-bookmark, .icon-bump, .icon-subscribe, .icon-unsubscribe, .icon-pages, .icon-search {
+	background-position: 0 50%;
+	background-repeat: no-repeat;
+	background-image: none;
+	padding: 1px 0 0 17px;
+}
+/* Poster profile icons
+----------------------------------------*/
+ul.profile-icons { padding-top: 10px;
+	list-style: none;
+}
+/* Rollover state */
+ul.profile-icons li { float: left;
+	margin: 0 6px 3px 0;
+	background-position: 0 100%;
+}
+/* Rolloff state */
+ul.profile-icons li a { display: block;
+	width: 100%;
+	height: 100%;
+	background-position: 0 0;
+}
+/* Hide <a> text and hide off-state image when rolling over (prevents flicker in IE) */
+ul.profile-icons li span { display:none; }
+ul.profile-icons li a:hover { background: none; }
+/* Positioning of moderator icons */
+.postbody ul.profile-icons { float: right;
+	width: auto;
+	padding: 0;
+}
+.postbody ul.profile-icons li { margin: 0 3px;}
+/* Profile & navigation icons */
+.email-icon, .email-icon a		{ background: none top left no-repeat; }
+.aim-icon, .aim-icon a			{ background: none top left no-repeat; }
+.yahoo-icon, .yahoo-icon a		{ background: none top left no-repeat; }
+.web-icon, .web-icon a			{ background: none top left no-repeat; }
+.msnm-icon, .msnm-icon a			{ background: none top left no-repeat; }
+.icq-icon, .icq-icon a			{ background: none top left no-repeat; }
+.jabber-icon, .jabber-icon a		{ background: none top left no-repeat; }
+.pm-icon, .pm-icon a				{ background: none top left no-repeat; }
+.quote-icon, .quote-icon a		{ background: none top left no-repeat; }
+/* Moderator icons */
+.report-icon, .report-icon a		{ background: none top left no-repeat; }
+.warn-icon, .warn-icon a			{ background: none top left no-repeat; }
+.edit-icon, .edit-icon a			{ background: none top left no-repeat; }
+.delete-icon, .delete-icon a		{ background: none top left no-repeat; }
+.info-icon, .info-icon a			{ background: none top left no-repeat; }
+/* Set profile icon dimensions */
+ul.profile-icons li.email-icon		{ width: 20px; height: 20px; }
+ul.profile-icons li.aim-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.yahoo-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.web-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.msnm-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.icq-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.jabber-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.pm-icon		{ width: 28px; height: 20px; }
+ul.profile-icons li.quote-icon	{ width: 54px; height: 20px; }
+ul.profile-icons li.report-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.edit-icon	{ width: 58px; height: 20px; }
+ul.profile-icons li.delete-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.info-icon	{ width: 20px; height: 20px; }
+ul.profile-icons li.warn-icon	{ width: 20px; height: 20px; }
+/* Fix profile icon default margins */
+ul.profile-icons li.edit-icon	{ margin: 0 0 0 3px; }
+ul.profile-icons li.quote-icon	{ margin: 0 0 0 10px; }
+ul.profile-icons li.info-icon, ul.profile-icons li.report-icon	{ margin: 0 3px 0 0; }
+/* proSilver Form Styles
+---------------------------------------- */
+/* General form styles
+----------------------------------------*/
+fieldset { border-width: 0;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-size: 1.1em;
+}
+input { font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	padding: 0 3px;
+	font-size: 1em;
+	font-family: Verdana, Helvetica, Arial, sans-serif;
+}
+select {font-family: Verdana, Helvetica, Arial, sans-serif;
+	font-weight: normal;
+	cursor: pointer;
+	vertical-align: middle;
+	border: 1px solid #666666;
+	padding: 1px;
+	background-color: #FAFAFA;
+}
+option { padding-right: 1em; }
+option.disabled-option { color: graytext; }
+textarea { font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	width: 60%;
+	padding: 2px;
+	font-size: 1em;
+	line-height: 1.4em;
+}
+label { cursor: default;
+	padding-right: 5px;
+	color: #676767;
+}
+label input { vertical-align: middle;}
+label img { vertical-align: middle;}
+/* Definition list layout for forms
+---------------------------------------- */
+fieldset dl { padding: 4px 0;}
+fieldset dt { float: left;	
+	width: 40%;
+	text-align: left;
+	display: block;
+}
+fieldset dd { margin-left: 41%;
+	vertical-align: top;
+	margin-bottom: 3px;
+}
+/* Specific layout 1 */
+fieldset.fields1 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields1 dd { margin-left: 15em;
+	border-left-width: 0;
+}
+fieldset.fields1 { background-color: transparent; }
+fieldset.fields1 div { margin-bottom: 3px; }
+/* Specific layout 2 */
+fieldset.fields2 dt { width: 15em;
+	border-right-width: 0;
+}
+fieldset.fields2 dd { margin-left: 16em;
+	border-left-width: 0;
+}
+/* Form elements */
+dt label { font-weight: bold;
+	text-align: left;
+}
+dd label { white-space: nowrap;
+	color: #333;
+}
+dd input, dd textarea { margin-right: 3px; }
+dd select { width: auto; }
+dd textarea { width: 85%; }
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label { color: inherit;}
+/* Submit button fieldset */
+fieldset.submit-buttons { text-align: center;
+	vertical-align: middle;
+	margin: 5px 0;
+}
+fieldset.submit-buttons input { vertical-align: middle;
+	padding-top: 3px;
+	padding-bottom: 3px;
+}
+/* Input field styles
+---------------------------------------- */
+.inputbox { background-color: #FFFFFF;
+	border: 1px solid #c0c0c0;
+	color: #333333;
+	padding: 2px;
+	cursor: text;
+}
+.inputbox:hover { border: 1px solid #eaeaea;}
+.inputbox:focus { border: 1px solid #eaeaea;
+	color: #4b4b4b;
+}
+input.inputbox	{ width: 85%; }
+input.medium	{ width: 50%; }
+input.narrow	{ width: 25%; }
+input.tiny	{ width: 125px; }
+textarea.inputbox { width: 85%; }
+.autowidth {width: auto !important;}
+/* Form button styles
+---------------------------------------- */
+input.button1, input.button2 {font-size: 1em;}
+a.button1, input.button1, input.button3, a.button2, input.button2 {
+	width: auto !important;
+	padding-top: 1px;
+	padding-bottom: 1px;
+	font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
+	color: #000;
+	background: #FAFAFA none repeat-x top;
+}
+a.button1, input.button1 {font-weight: bold;
+	border: 1px solid #666666;
+}
+input.button3 {padding: 0;
+	margin: 0;
+	line-height: 5px;
+	height: 12px;
+	background-image: none;
+	font-variant: small-caps;
+}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border: 1px solid #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {
+	text-decoration: none;
+	color: #000000;
+	padding: 2px 8px;
+	line-height: 250%;
+	vertical-align: text-bottom;
+	background-position: 0 1px;
+}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {
+	border: 1px solid #BCBCBC;
+	background-position: 0 100%;
+	color: #BCBCBC;
+}
+
+/* Topic and forum Search */
+.search-box {margin-top: 3px;
+	margin-left: 5px;
+	float: left;
+}
+.search-box input {
+}
+input.search {background-image: none;
+	background-repeat: no-repeat;
+	background-position: left 1px;
+	padding-left: 17px;
+}
+/* proSilver Style Sheet Tweaks
+These style definitions are mainly IE specific 
+tweaks required due to its poor CSS support.
+-------------------------------------------------*/
+* html table, * html select, * html input { font-size: 100%; }
+* html hr { margin: 0; }
+* html span.corners-top, * html span.corners-bottom { background-image: url("{T_IMAGE_PATH}corners_left.gif"); }
+* html span.corners-top span, * html span.corners-bottom span { background-image: url("{T_IMAGE_PATH}corners_right.gif"); }
+table.table1 {width: 99%;		/* IE < 6 browsers */
+	/* Tantek hack */
+	voice-family: "\"}\"";
+	voice-family: inherit;
+	width: 100%;
+}
+html>body table.table1 { width: 100%; }	/* Reset 100% for opera */
+* html ul.topiclist li { position: relative; }
+* html .postbody h3 img { vertical-align: middle; }
+/* Form styles */
+html>body dd label input { vertical-align: text-bottom; }	/* Align checkboxes/radio buttons nicely */
+* html input.button1, * html input.button2 {
+	padding-bottom: 0;
+	margin-bottom: 1px;
+}
+/* Misc layout styles */
+* html .column1, * html .column2 { width: 45%; }
+/* Nice method for clearing floated blocks without having to insert any extra markup (like spacer above)
+   From http://www.positioniseverything.net/easyclearing.html 
+#tabs:after, #minitabs:after, .post:after, .navbar:after, fieldset dl:after, ul.topiclist dl:after, ul.linklist:after, dl.polls:after {
+	content: "."; 
+	display: block; 
+	height: 0; 
+	clear: both; 
+	visibility: hidden;
+}*/
+.clearfix, #tabs, #minitabs, .post, .navbar, fieldset dl, ul.topiclist dl, ul.linklist, dl.polls {
+	height: 1%;
+	overflow: hidden;
+}
+/* Simple fix so forum and topic lists always have a min-height set, even in IE6
+	From http://www.dustindiaz.com/min-height-fast-hack */
+dl.icon { min-height: 35px;
+	height: auto !important;
+	height: 35px;
+}
+* html #search-box {
+	margin-right: 35px;
+}
+/* Correctly clear floating for details on profile view */
+*:first-child+html dl.details dd { margin-left: 15em;
+	float: none;
+}
+* html dl.details dd { margin-left: 15em;
+	float: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for common.css
+-------------------------------------------------------------- */
+html, body { color: #536482;
+	background-color: #FFFFFF;
+}
+h1 { color: #FFFFFF;}
+h2 {color: #28313F;}
+h3 {border-bottom-color: #CCCCCC;
+	color: #115098;
+}
+hr {border-color: #FFFFFF;
+	border-top-color: #CCCCCC;
+}
+hr.dashed {border-top-color: #CCCCCC;}
+/* Search box
+--------------------------------------------- */
+#search-box {color: #FFFFFF;}
+#search-box #keywords {background-color: #FFF;}
+#search-box input {border-color: #0075B0;}
+/* Round cornered boxes and backgrounds
+---------------------------------------- */
+.headerbar {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+	color: #FFFFFF;
+}
+.navbar {background-color: #cadceb;}
+.forabg {background-color: #0076b1;
+	background-image: url("{T_IMAGE_PATH}bg_list.gif");
+}
+.forumbg {background-color: #12A3EB;
+	background-image: url("{T_IMAGE_PATH}bg_header.gif");
+}
+.panel {background-color: #ECF1F3;
+	color: #28313F;
+}
+.post:target .content {color: #000000;}
+.post:target h3 a {color: #000000;}
+.bg1	{ background-color: #ECF3F7; }
+.bg2	{ background-color: #e1ebf2;  }
+.bg3	{ background-color: #cadceb; }
+.ucprowbg {background-color: #DCDEE2;}
+.fieldsbg {background-color: #E7E8EA;}
+span.corners-top {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-top span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+span.corners-bottom {background-image: url("{T_IMAGE_PATH}corners_left.png");}
+span.corners-bottom span {background-image: url("{T_IMAGE_PATH}corners_right.png");}
+/* Horizontal lists
+----------------------------------------*/
+ul.navlinks {border-bottom-color: #FFFFFF;}
+/* Misc layout styles
+---------------------------------------- */
+dl.details dt {
+	color: #000000;
+}
+
+dl.details dd {
+	color: #536482;
+}
+
+.sep {
+	color: #1198D9;
+}
+/* Miscellaneous styles
+---------------------------------------- */
+.copyright {color: #555555;}
+.error {color: #BC2A4D;}
+.reported {background-color: #F7ECEF;}
+li.reported:hover {background-color: #ECD5D8 !important;}
+.sticky, .announce {/* you can add a background for stickies and announcements*/}
+div.rules {background-color: #ECD5D8;
+	color: #BC2A4D;
+}
+p.rules {background-color: #ECD5D8;
+	background-image: none;
+}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for links.css
+-------------------------------------------------------------- */
+a:link	{ color: #105289; }
+a:visited	{ color: #105289; }
+a:hover	{ color: #D31141; }
+a:active	{ color: #368AD2; }
+/* Links on gradient backgrounds */
+#search-box a:link, .navbg a:link, .forumbg .header a:link, .forabg .header a:link, th a:link {color: #FFFFFF;}
+#search-box a:visited, .navbg a:visited, .forumbg .header a:visited, .forabg .header a:visited, th a:visited {color: #FFFFFF;}
+#search-box a:hover, .navbg a:hover, .forumbg .header a:hover, .forabg .header a:hover, th a:hover {color: #A8D8FF;}
+#search-box a:active, .navbg a:active, .forumbg .header a:active, .forabg .header a:active, th a:active {color: #C8E6FF;}
+/* Links for forum/topic lists */
+a.forumtitle {color: #105289;}
+/* a.forumtitle:visited { color: #105289; } */
+a.forumtitle:hover {color: #BC2A4D;}
+a.forumtitle:active {color: #105289;}
+a.topictitle {color: #105289;}
+/* a.topictitle:visited { color: #368AD2; } */
+a.topictitle:hover {color: #BC2A4D;}
+a.topictitle:active {color: #105289;}
+/* Post body links */
+.postlink {color: #368AD2;
+	border-bottom-color: #368AD2;
+}
+.postlink:visited {color: #5D8FBD;
+	border-bottom-color: #666666;
+}
+.postlink:active {color: #368AD2;}
+.postlink:hover {background-color: #D0E4F6;
+	color: #0D4473;
+}
+.signature a, .signature a:visited, .signature a:active, .signature a:hover {background-color: transparent;}
+/* Profile links */
+.postprofile a:link, .postprofile a:active, .postprofile a:visited, .postprofile dt.author a {color: #105289;}
+.postprofile a:hover, .postprofile dt.author a:hover {color: #D31141;}
+/* Profile searchresults */	
+.search .postprofile a {color: #105289;}
+.search .postprofile a:hover {color: #D31141;}
+/* Back to top of page */
+a.top {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+a.top2 {background-image: url("{T_IMAGE_PATH}icon_back_top.gif");}
+/* Arrow links  */
+a.up		{ background-image: url("{T_IMAGE_PATH}arrow_up.gif") }
+a.down		{ background-image: url("{T_IMAGE_PATH}arrow_down.gif") }
+a.left		{ background-image: url("{T_IMAGE_PATH}arrow_left.gif") }
+a.right		{ background-image: url("{T_IMAGE_PATH}arrow_right.gif") }
+a.up:hover {background-color: transparent;}
+a.left:hover {color: #368AD2;}
+a.right:hover {color: #368AD2;}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for content.css
+-------------------------------------------------------------- */
+ul.forums {background-color: #eef5f9;
+	background-image: url("{T_IMAGE_PATH}gradient.gif");
+}
+ul.topiclist li {color: #4C5D77;}
+ul.topiclist dd {border-left-color: #FFFFFF;}
+.rtl ul.topiclist dd {border-right-color: #fff;
+	border-left-color: transparent;
+}
+ul.topiclist li.row dt a.subforum.read {background-image: url("{T_IMAGE_PATH}subforum_read.gif");}
+ul.topiclist li.row dt a.subforum.unread {background-image: url("{T_IMAGE_PATH}subforum_unread.gif");}
+li.row {border-top-color:  #FFFFFF;
+	border-bottom-color: #00608F;
+}
+li.row strong {color: #000000;}
+li.row:hover {background-color: #F6F4D0;}
+li.row:hover dd {border-left-color: #CCCCCC;}
+.rtl li.row:hover dd {border-right-color: #CCCCCC;
+	border-left-color: transparent;
+}
+li.header dt, li.header dd {color: #FFFFFF;}
+/* Forum list column styles */
+ul.topiclist dd.searchextra {color: #333333;}
+/* Post body styles
+----------------------------------------*/
+.postbody {color: #333333;}
+/* Content container styles
+----------------------------------------*/
+.content {color: #333333;}
+.content h2, .panel h2 {color: #115098;
+	border-bottom-color:  #CCCCCC;
+}
+dl.faq dt {color: #333333;}
+.posthilit {background-color: #F3BFCC;
+	color: #BC2A4D;
+}
+/* Post signature */
+.signature {border-top-color: #CCCCCC;}
+/* Post noticies */
+.notice {border-top-color:  #CCCCCC;}
+/* BB Code styles
+----------------------------------------*/
+/* Quote block */
+blockquote {background-color: #EBEADD;
+	background-image: url("{T_IMAGE_PATH}quote.gif");
+	border-color:#DBDBCE;
+}
+blockquote blockquote {/* Nested quotes */
+	background-color:#EFEED9;
+}
+blockquote blockquote blockquote {/* Nested quotes */
+	background-color: #EBEADD;
+}
+/* Code block */
+dl.codebox {background-color: #FFFFFF;
+	border-color: #C9D2D8;
+}
+dl.codebox dt {border-bottom-color:  #CCCCCC;
+}
+dl.codebox code {color: #2E8B57;}
+.syntaxbg		{ color: #FFFFFF; }
+.syntaxcomment	{ color: #FF8000; }
+.syntaxdefault	{ color: #0000BB; }
+.syntaxhtml		{ color: #000000; }
+.syntaxkeyword	{ color: #007700; }
+.syntaxstring	{ color: #DD0000; }
+/* Attachments
+----------------------------------------*/
+.attachbox {background-color: #FFFFFF;
+	border-color:  #C9D2D8;
+}
+.pm-message .attachbox {background-color: #F2F3F3;}
+.attachbox dd {border-top-color: #C9D2D8;}
+.attachbox p {color: #666666;}
+.attachbox p.stats {color: #666666;}
+.attach-image img {border-color: #999999;}
+/* Inline image thumbnails */
+dl.file dd {color: #666666;}
+dl.thumbnail img {border-color: #666666;
+	background-color: #FFFFFF;
+}
+dl.thumbnail dd {color: #666666;}
+dl.thumbnail dt a:hover {background-color: #EEEEEE;}
+dl.thumbnail dt a:hover img {border-color: #368AD2;}
+/* Post poll styles
+----------------------------------------*/
+fieldset.polls dl {border-top-color: #DCDEE2;
+	color: #666666;
+}
+fieldset.polls dl.voted {color: #000000;
+}
+fieldset.polls dd div {color: #FFFFFF;
+}
+.rtl .pollbar1, .rtl .pollbar2, .rtl .pollbar3, .rtl .pollbar4, .rtl .pollbar5 {border-right-color: transparent;
+}
+.pollbar1 {background-color: #AA2346;
+	border-bottom-color: #74162C;
+	border-right-color: #74162C;
+}
+.rtl .pollbar1 {border-left-color: #74162C;}
+.pollbar2 {background-color: #BE1E4A;
+	border-bottom-color: #8C1C38;
+	border-right-color: #8C1C38;
+}
+.rtl .pollbar2 {border-left-color: #8C1C38;}
+.pollbar3 {background-color: #D11A4E;
+	border-bottom-color: #AA2346;
+	border-right-color: #AA2346;
+}
+.rtl .pollbar3 {border-left-color: #AA2346;}
+.pollbar4 {background-color: #E41653;
+	border-bottom-color: #BE1E4A;
+	border-right-color: #BE1E4A;
+}
+.rtl .pollbar4 {border-left-color: #BE1E4A;}
+.pollbar5 {background-color: #F81157;
+	border-bottom-color: #D11A4E;
+	border-right-color: #D11A4E;
+}
+.rtl .pollbar5 {border-left-color: #D11A4E;}
+/* Poster profile block
+----------------------------------------*/
+.postprofile {color: #666666;
+	border-left-color: #FFFFFF;
+}
+.rtl .postprofile {border-right-color: #FFFFFF;
+	border-left-color: transparent;
+}
+.pm .postprofile {border-left-color: #DDDDDD;}
+.rtl .pm .postprofile {border-right-color: #DDDDDD;
+	border-left-color: transparent;
+}
+.postprofile strong {color: #000000;}
+.online {background-image: url("./styles/prosilver/imageset/fr/icon_user_online.gif");}
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for buttons.css
+-------------------------------------------------------------- */
+a.fontsize {background-image: url("{T_IMAGE_PATH}icon_fontsize.gif");}
+/* Icon images
+---------------------------------------- */
+.sitehome						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-faq						{ background-image: url("{T_IMAGE_PATH}icon_faq.gif"); }
+.icon-ucp						{ background-image: url("{T_IMAGE_PATH}feed-icon.png"); }
+.icon-members					{ background-image: url("{T_IMAGE_PATH}icon_members.gif"); }
+.icon-home						{ background-image: url("{T_IMAGE_PATH}icon_home.gif"); }
+.icon-register					{ background-image: url("{T_IMAGE_PATH}icon_register.gif"); }
+.icon-logout					{ background-image: url("{T_IMAGE_PATH}icon_logout.gif"); }
+.icon-bookmark					{ background-image: url("{T_IMAGE_PATH}icon_bookmark.gif"); }
+.icon-subscribe					{ background-image: url("{T_IMAGE_PATH}icon_subscribe.gif"); }
+.icon-search					{ background-image: url("{T_IMAGE_PATH}icon_search.gif"); }
+/*  	
+--------------------------------------------------------------
+Colours and backgrounds for forms.css
+-------------------------------------------------------------- */
+/* General form styles
+----------------------------------------*/
+select {border-color: #666666;
+	background-color: #FAFAFA;
+}
+label {color: #425067;}
+option.disabled-option {color: graytext;}
+/* Definition list layout for forms
+---------------------------------------- */
+dd label {color: #333;}
+/* Hover effects */
+fieldset dl:hover dt label {color: #000000;}
+fieldset.fields2 dl:hover dt label {color: inherit;}
+/* Quick-login on index page */
+fieldset.quick-login input.inputbox {background-color: #F2F3F3;}
+/* Input field styles
+---------------------------------------- */
+.inputbox {background-color: #FFFFFF; 
+	border-color: #B4BAC0;
+	color: #333333;
+}
+.inputbox:hover {border-color: #11A3EA;}
+.inputbox:focus {border-color: #11A3EA;
+	color: #0F4987;
+}
+/* Form button styles
+---------------------------------------- */
+a.button1, input.button1, input.button3, a.button2, input.button2 {color: #000;
+	background-color: #FAFAFA;
+	background-image: url("{T_IMAGE_PATH}bg_button.gif");
+}
+a.button1, input.button1 {border-color: #666666;}
+input.button3 {background-image: none;}
+/* Alternative button */
+a.button2, input.button2, input.button3 {border-color: #666666;}
+/* <a> button in the style of the form buttons */
+a.button1, a.button1:link, a.button1:visited, a.button1:active, a.button2, a.button2:link, a.button2:visited, a.button2:active {color: #000000;}
+/* Hover states */
+a.button1:hover, input.button1:hover, a.button2:hover, input.button2:hover, input.button3:hover {border-color: #BC2A4D;
+	color: #BC2A4D;
+}
+input.search {background-image: url("{T_IMAGE_PATH}icon_textbox_search.gif");}
+#wrap {  
+   padding: 0 20px;
+}
Index: gym_sitemaps/style/gym_google.xsl
===================================================================
--- gym_sitemaps/style/gym_google.xsl	(phpBB 3.0.8)
+++ gym_sitemaps/style/gym_google.xsl	(Premod 3.0.8)
@@ -0,0 +1,238 @@
+<xsl:stylesheet version="2.0" 
+                xmlns:html="http://www.w3.org/TR/REC-html40"
+                xmlns:sitemap="http://www.sitemaps.org/schemas/sitemap/0.9"
+                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+  
+<xsl:output 
+	method="html" 
+	version="1.0" 
+	encoding="utf-8" 
+	omit-xml-declaration="yes"		
+	doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" 
+	doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
+	indent="yes" />
+
+<!-- Root template -->    
+<xsl:template match="/">
+	<!-- Store in $fileType if we are in a sitemap or in a SitemapIndex -->
+	<xsl:variable name="fileType">
+		<xsl:choose>
+			<xsl:when test="//sitemap:url">Sitemap</xsl:when>
+			<xsl:otherwise>SitemapIndex</xsl:otherwise>
+		</xsl:choose>      
+	</xsl:variable>
+	<xsl:variable name="browser">
+		<xsl:choose><xsl:when test="system-property('xsl:vendor')='Transformiix'">mozilla</xsl:when>
+			<xsl:otherwise>other</xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="sorting">
+		<xsl:choose><xsl:when test="$browser='mozilla'">descending</xsl:when>
+			<xsl:otherwise>ascending</xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="home_link">{ROOT_URL}</xsl:variable>
+
+	<xsl:variable name="sitemap_url">
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:urlset/sitemap:url/sitemap:loc" /></xsl:call-template></xsl:when>
+			<xsl:otherwise></xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>
+	<xsl:variable name="sitemap_title">
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:value-of select="substring-after($sitemap_url, '{ROOT_URL}')"/></xsl:when>
+			<xsl:otherwise></xsl:otherwise>
+		</xsl:choose>
+	</xsl:variable>	
+<html xmlns="http://www.w3.org/1999/xhtml" dir="{S_CONTENT_DIRECTION}" lang="{S_USER_LANG}" xml:lang="{S_USER_LANG}">
+<head>
+	<base href="{PHPBB_URL}"/>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
+	<title><xsl:choose>
+			<xsl:when test="$fileType='Sitemap'">{L_SITEMAP} : <xsl:value-of select="$sitemap_title"/></xsl:when>
+			<xsl:otherwise>{L_SITEMAPINDEX}</xsl:otherwise>
+	</xsl:choose></title>
+	<link rel="stylesheet" href="{T_CSS_PATH}" type="text/css"  media="screen, projection"/>
+	<link href="{T_STYLE_PATH}normal.css" rel="stylesheet" type="text/css" title="A" />
+	<link href="{T_STYLE_PATH}medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
+	<link href="{T_STYLE_PATH}large.css" rel="alternate stylesheet" type="text/css" title="A++" />
+	<script type="text/javascript" src="{T_STYLE_PATH}gym_js.js"></script>
+</head>
+      <!-- Body -->
+<body id="phpbb">
+<!--
+	GYM Sitemaps and RSS XSLTransform
+	(C) phpBB SEO - http://www.phpbb-seo.com/
+-->
+		<div id="wrap">
+			<a id="top" name="top" accesskey="t"></a>
+				<div id="page-header">
+					<div class="headerbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<div id="site-description"><a href="{$home_link}" title="{L_HOME}" id="logo"><img src="{T_IMAGE_PATH}site_logo.gif" alt="{SITENAME}" /></a>
+								<h1>{SITENAME}</h1>
+								<p>{SITE_DESCRIPTION}</p>
+								<p style="display: none;"><a href="#start_here">{L_SKIP}</a></p>
+							</div>
+							<div id="search-box">
+								<form action="{PHPBB_URL}search.php" method="post" id="search">
+								<fieldset>
+									<input name="keywords" id="keywords" type="text" maxlength="128" title="" class="inputbox search" value="" /> 
+									<input class="button2" value="{L_SEARCH}" type="submit" /><br />
+									<a href="{PHPBB_URL}search.php" title="{L_SEARCH_ADV_EXPLAIN}">{L_SEARCH_ADV}</a>
+								</fieldset>
+								</form>
+							</div>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+					<div class="navbar">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<ul class="linklist navlinks">
+								<li class="icon-home">
+									<a href="{$home_link}" accesskey="h">{L_HOME}</a>
+									<xsl:if test="$home_link != '{PHPBB_URL}'">&#160;<strong>&#8249;</strong>&#160;<a href="{PHPBB_URL}">{L_FORUM_INDEX}</a></xsl:if>
+									<xsl:if test="$fileType='Sitemap'">
+										<xsl:if test="'{PHPBB_URL}' != $sitemap_url">&#160;<strong>&#8249;</strong>&#160;<a href="{$sitemap_url}"><xsl:value-of select="$sitemap_title"/></a></xsl:if>
+									</xsl:if>
+								</li>
+								<li class="rightside"><a href="#" onclick="fontsizeup(); return false;" class="fontsize" title="{L_CHANGE_FONT_SIZE}">{L_CHANGE_FONT_SIZE}</a></li>
+							</ul>
+							<ul class="linklist leftside">
+								<li class="icon-ucp">
+								<xsl:choose>
+									<xsl:when test="$fileType='Sitemap'">{L_SITEMAP_OF} : <a href="{$sitemap_url}"><xsl:value-of select="$sitemap_title"/></a></xsl:when>
+									<xsl:otherwise>{L_SITEMAPINDEX}</xsl:otherwise>
+								</xsl:choose>
+								</li>
+							</ul>
+							<ul class="linklist rightside">
+								<li class="icon-faq"><a href="{PHPBB_URL}faq.php" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>
+								<li class="icon-register"><a href="{PHPBB_URL}ucp.php?mode=register">{L_REGISTER}</a></li>
+							</ul>
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div>
+				</div>
+				<a name="start_here"></a>
+				<div id="page-body"><br />
+					<div class="clear"></div>
+					<div class="post bg3">
+						<div class="inner"><span class="corners-top"><span></span></span>
+							<xsl:choose>
+								<xsl:when test="$fileType='Sitemap'"><h2><a href="{$sitemap_url}">{L_SITEMAP_OF} : <xsl:value-of select="$sitemap_title"/></a></h2><h4>{L_NUMBER_OF_URL} : <xsl:value-of select="count(sitemap:urlset/sitemap:url)"/></h4></xsl:when>
+								<xsl:otherwise><h2>{L_SITEMAPINDEX}</h2><h4>{L_NUMBER_OF_SITEMAP} : <xsl:value-of select="count(sitemap:sitemapindex/sitemap:sitemap)"/></h4></xsl:otherwise>
+  							</xsl:choose>
+							<br />
+							<span class="corners-bottom"><span></span></span>
+						</div>
+					</div><br />
+		<xsl:choose>
+			<xsl:when test="$fileType='Sitemap'"><xsl:call-template name="sitemapTable"/></xsl:when>
+			<xsl:otherwise><xsl:call-template name="siteindexTable"/></xsl:otherwise>
+		</xsl:choose>
+	</div>
+</div>
+<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &#169; 2000 - 2010 phpBB Group</div>
+<!--
+	We request you retain the full copyright notice below, as well as in all templates you may use,
+	including the link to www.phpbb-seo.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of www.phpBB-SEO.com
+	If you cannot (for good reason) retain the full copyright we request you at least leave in place the
+	"Copyright phpBB SEO" line, with "phpBB SEO" linked to www.phpbb-seo.com.
+	If you refuse to include even this, then support and further development on our forums may be affected.
+	The phpBB SEO Team.
+-->
+<div class="copyright">{L_COPY}</div>
+</body>
+</html>
+</xsl:template>
+
+<!-- siteindexTable template -->
+<xsl:template name="siteindexTable">
+		<div class="forumbg">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt>{L_SITEMAP_URL}</dt>
+						<dd class="lastpost"><span>{L_LASTMOD_DATE}</span></dd>
+					</dl>
+				</li>
+			</ul>
+			<xsl:apply-templates select="sitemap:sitemapindex/sitemap:sitemap"></xsl:apply-templates>  
+			<span class="corners-bottom"><span></span></span></div>
+		</div>       
+</xsl:template>  
+<!-- sitemapTable template -->  
+<xsl:template name="sitemapTable">
+		<div class="forumbg">
+			<div class="inner"><span class="corners-top"><span></span></span>
+			<ul class="topiclist">
+				<li class="header">
+					<dl class="icon">
+						<dt>{L_LINK}</dt>
+						<dd class="topics">{L_PRIORITY}</dd>
+						<dd class="posts">{L_CHANGEFREQ}</dd>
+						<dd class="lastpost"><span>{L_LASTMOD_DATE}</span></dd>
+					</dl>
+				</li>
+			</ul>
+			<xsl:apply-templates select="sitemap:urlset/sitemap:url"></xsl:apply-templates>
+			<span class="corners-bottom"><span></span></span></div>
+		</div>
+</xsl:template>
+<!-- sitemap:url template -->  
+<xsl:template match="sitemap:url">
+	<ul class="topiclist forums">
+		<li class="row">
+			<dl class="icon" style="background-image: url({T_IMAGE_PATH}forum_read.gif); background-repeat: no-repeat;">
+				<dt style="overflow:hidden">
+					<xsl:variable name="sitemapURL"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:loc" /></xsl:call-template></xsl:variable>
+					<a href="{$sitemapURL}" class="topictitle"><span><xsl:call-template name="hreftitle"><xsl:with-param name="input" select="$sitemapURL" /></xsl:call-template></span></a>
+				</dt>
+				<dd class="topics"><span><xsl:value-of select="sitemap:priority"/></span></dd>
+				<dd class="posts"><span><xsl:value-of select="sitemap:changefreq"/></span></dd>
+				<dd class="lastpost"><span><xsl:value-of select="sitemap:lastmod" /></span></dd>
+			</dl>
+		</li>
+	</ul>
+</xsl:template>
+<!-- sitemap:sitemap template -->
+<xsl:template match="sitemap:sitemap">
+	<ul class="topiclist forums">
+		<li class="row">
+			<dl class="icon" style="background-image: url({T_IMAGE_PATH}topic_read.gif); background-repeat: no-repeat;">
+				<dt style="overflow:hidden">
+					<xsl:variable name="sitemapURL"><xsl:call-template name="http"><xsl:with-param name="input" select="sitemap:loc" /></xsl:call-template></xsl:variable>
+					<a href="{$sitemapURL}" class="forumtitle"><span><xsl:call-template name="hreftitle"><xsl:with-param name="input" select="$sitemapURL" /></xsl:call-template></span></a>
+				</dt>
+				<dd class="lastpost"><span><xsl:value-of select="sitemap:lastmod" /></span></dd>
+			</dl>
+		</li>
+	</ul>
+</xsl:template>
+<!-- http template to preserve SSL navigation when ssl is not forced (if so, the xml source only uses http) -->
+<xsl:template name="http">
+	<xsl:param name="input" />
+	<xsl:choose>
+		<xsl:when test="contains($input, '{HTTP_PROTO_REQUEST}')"><xsl:value-of select="$input"/></xsl:when>
+		<xsl:otherwise>
+			<xsl:choose>
+				<xsl:when test="contains($input, 'http://')"><xsl:value-of select="concat('{HTTP_PROTO_REQUEST}', substring-after($input, 'http://'))"/></xsl:when>
+				<xsl:otherwise><xsl:value-of select="concat('{HTTP_PROTO_REQUEST}', substring-after($input, 'https://'))"/></xsl:otherwise>
+			</xsl:choose>
+		</xsl:otherwise>
+	</xsl:choose>
+</xsl:template>
+<!-- title template : use nicer titles in href links ! -->
+<xsl:template name="hreftitle">
+	<xsl:param name="input" />
+	<xsl:choose>
+		<xsl:when test="contains($input, '{ROOT_URL}')"><xsl:value-of select="substring-after($input, '{ROOT_URL}')"/></xsl:when>
+		<xsl:otherwise><xsl:value-of select="substring-after($input, '{HTTP_PROTO_REQUEST}')"/></xsl:otherwise>
+	</xsl:choose>
+</xsl:template>
+</xsl:stylesheet>
Index: gym_sitemaps/gym_style.php
===================================================================
--- gym_sitemaps/gym_style.php	(phpBB 3.0.8)
+++ gym_sitemaps/gym_style.php	(Premod 3.0.8)
@@ -0,0 +1,286 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_style.php 278 2010-11-25 15:28:16Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+
+
+define('IN_PHPBB', true);
+$phpbb_root_path = (defined('PHPBB_ROOT_PATH')) ? PHPBB_ROOT_PATH : './../';
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+$gym_cache_path = $phpbb_root_path . 'gym_sitemaps/cache/';
+
+// Report all errors, except notices and deprecation messages
+if (!defined('E_DEPRECATED'))
+{
+	define('E_DEPRECATED', 8192);
+}
+error_reporting(E_ALL ^ E_NOTICE ^ E_DEPRECATED);
+
+if (version_compare(PHP_VERSION, '6.0.0-dev', '<')) {
+	@set_magic_quotes_runtime(0);
+}
+// Load Extensions
+if (!empty($load_extensions) && function_exists('dl')) {
+	$load_extensions = explode(',', $load_extensions);
+	foreach ($load_extensions as $extension) {
+		@dl(trim($extension));
+	}
+}
+// Option, strip the white spaces in the output, saves a bit of bandwidth.
+$strip_spaces = true;
+// Option, grabb phpBB stylesheet if using prosilver, will adapt the styling
+$load_phpbb_css = false;
+// Will automatically update the cache in case the original files are modified.
+// Rss or google output
+$action_expected = array('rss', 'google');
+// CSS or XSLT stylsheet
+$type_expected = array('css', 'xsl');
+
+// Language
+$language = (isset($_GET['lang']) && !is_array($_GET['lang'])) ? htmlspecialchars(basename((string) $_GET['lang'])) : '';
+$action = isset($_GET['action']) && @in_array($_GET['action'], $action_expected) ? trim($_GET['action']) : '';
+$gym_style_type = isset($_GET['type']) && @in_array($_GET['type'], $type_expected) ? $_GET['type'] : '';
+$theme_id = isset($_GET['theme_id']) ? @intval($_GET['theme_id']) : '';
+
+if (empty($language) && empty($action) && empty($gym_style_type) && empty($theme_id)) {
+	// grabb vars like this because browser are not aggreeing on how to handle & in xml. FF only accpet & where IE and opera only accept &amp;
+	$qs = isset($_SERVER['QUERY_STRING']) ? trim($_SERVER['QUERY_STRING']) : '';
+	if ($qs && preg_match('`action-(rss|google),type-(xsl),lang-([a-z_]+),theme_id-([0-9]+)`i', $qs, $matches )) {
+		$language = $matches[3];
+		$action = in_array($matches[1], $action_expected) ? $matches[1] : '';
+		$gym_style_type = in_array($matches[2], $type_expected) ? $matches[2] : '';
+		$theme_id = intval($matches[4]);
+	}
+}
+$content_type = $gym_style_type == 'css' ? 'text/css' : 'text/xml';
+// Expire time of 15 days if not recached
+$cache_ttl = 15*86400;
+$recache = false;
+$theme = false;
+// Let's go
+if (!empty($action) && !empty($gym_style_type) && !empty($language) && !empty($theme_id)) {
+	// detect ssl
+	$ssl_requested = (bool) ((isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] === 'on' || $_SERVER['HTTPS'] === true)) || (isset($_SERVER['SERVER_PORT']) && (int) $_SERVER['SERVER_PORT'] === 443));
+	$ssl_bit = $ssl_requested ? 'ssl_' : '';
+	// build cache file name
+	$cached_file = "{$gym_cache_path}style_{$action}_{$ssl_bit}{$language}_$theme_id.$gym_style_type";
+	if (file_exists($cached_file)) {
+		$cached_time = filemtime($cached_file);
+		$expire_time = $cached_time + $cache_ttl;
+		$recache = $expire_time < time() ? true : /*(filemtime($style_file) > $cached_time ? true :*/ false/*)*/;
+	} else {
+		$recache = true;
+		$expire_time = time() + $cache_ttl;
+	}
+	if (!$recache) {
+		header('Expires: ' . gmdate('D, d M Y H:i:s \G\M\T', $expire_time));
+		header('Content-type: ' . $content_type . '; charset=UTF-8');
+		readfile($cached_file);
+		// We are done with this call
+		exit;
+	} else {
+		// Include files
+		require($phpbb_root_path . 'config.' . $phpEx);
+		if (empty($acm_type) || empty($dbms)) {
+			exit;
+		}
+		require($phpbb_root_path . 'includes/acm/acm_' . $acm_type . '.' . $phpEx);
+		require($phpbb_root_path . 'includes/cache.' . $phpEx);
+		require($phpbb_root_path . 'includes/db/' . $dbms . '.' . $phpEx);
+		require($phpbb_root_path . 'includes/constants.' . $phpEx);
+		require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+		$db = new $sql_db();
+		$cache = new cache();
+		// Connect to DB
+		if (!@$db->sql_connect($dbhost, $dbuser, $dbpasswd, $dbname, $dbport, false, false)) {
+			exit;
+		}
+		unset($dbhost, $dbuser, $dbpasswd, $dbname, $dbport);
+		$config = $cache->obtain_config();
+		$gym_config = array();
+		obtain_gym_config($action, $gym_config);
+		// Do we load phpbb css ?
+		$load_phpbb_css = isset($gym_config[$action .  '_load_phpbb_css']) ? $gym_config[$action .  '_load_phpbb_css'] : $load_phpbb_css;
+
+		// Check if requested style does exists
+		if ($theme_id > 0) {
+			$sql = 'SELECT s.style_id, c.theme_path, c.theme_name, t.template_path
+				FROM ' . STYLES_TABLE . ' s, ' . STYLES_TEMPLATE_TABLE . ' t, ' . STYLES_THEME_TABLE . ' c
+				WHERE s.style_id = ' . $theme_id . '
+					AND t.template_id = s.template_id
+					AND c.theme_id = s.theme_id';
+			$result = $db->sql_query($sql, 300);
+			$theme = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+		}
+		// Grabb the default one data instead
+		if (!$theme) {
+			// grabb the first available one
+			$theme_id = (int) $config['default_style'];
+			$sql = 'SELECT s.style_id, c.theme_path, c.theme_name, t.template_path
+				FROM ' . STYLES_TABLE . ' s, ' . STYLES_TEMPLATE_TABLE . ' t, ' . STYLES_THEME_TABLE . ' c
+				WHERE s.style_id = ' . $theme_id . '
+					AND t.template_id = s.template_id
+					AND c.theme_id = s.theme_id';
+			$result = $db->sql_query($sql, 300);
+			$theme = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+		}
+		$db->sql_close();
+		if (!empty($cache)) {
+			$cache->unload();
+		}
+		// Determine style file name
+		$tpath = $gym_style_type == 'xsl' ? $theme['template_path'] . '/template/gym_sitemaps' : $theme['theme_path'] . '/theme';
+		$style_file = $phpbb_root_path . "styles/$tpath/gym_{$action}.$gym_style_type";
+		if (!file_exists($style_file)) {
+			// Degrade to default styling
+			$style_file = $phpbb_root_path . "gym_sitemaps/style/gym_{$action}.$gym_style_type";
+			$load_phpbb_css = false;
+		}
+		// Load the language file
+		if (file_exists($phpbb_root_path . 'language/' . $language . '/gym_sitemaps/gym_common.' . $phpEx)) {
+			require($phpbb_root_path . 'language/' . $language . '/gym_sitemaps/gym_common.' . $phpEx);
+			require($phpbb_root_path . 'language/' . $language . '/common.' . $phpEx);
+		} else { // Try with the default language
+			$language = $config['default_lang'];
+			require($phpbb_root_path . 'language/' . $language . '/gym_sitemaps/gym_common.' . $phpEx);
+			require($phpbb_root_path . 'language/' . $language . '/common.' . $phpEx);
+		}
+		// Do not recache if up to date, recompile only if the source stylesheet was updated
+		$cached_file = "{$gym_cache_path}style_{$action}_{$ssl_bit}{$language}_$theme_id.$gym_style_type";
+		if (file_exists($cached_file)) {
+			$cached_time = filemtime($cached_file);
+			$expire_time = $cached_time + $cache_ttl;
+			$recache = $expire_time < time() ? true : (@filemtime($style_file) > $cached_time ? true : false);
+		} else {
+			$recache = true;
+			$expire_time = time() + $cache_ttl;
+		}
+		if (!$recache) {
+			header('Expires: ' . gmdate('D, d M Y H:i:s \G\M\T', $expire_time));
+			header('Content-type: ' . $content_type . '; charset=UTF-8');
+			readfile($cached_file);
+			exit;
+		}
+		// No available style
+		if (!$theme) {
+			exit;
+		}
+
+
+		// Path Settings
+		$ssl_forced = (bool) (($config['server_protocol'] === 'https//'));
+		$ssl_use = (bool) ($ssl_requested || $ssl_forced);
+		$server_protocol = $ssl_use ? 'https://' : 'http://';
+		$server_name = trim($config['server_name'], '/ ');
+		$server_port = max(0, (int) $config['server_port']);
+		$server_port = ($server_port && $server_port <> 80) ? ':' . $server_port . '/' : '/';
+		$script_path = trim($config['script_path'], '/ ');
+		$script_path = (empty($script_path) ) ? '' : $script_path . '/';
+		$root_url = strtolower($server_protocol . $server_name . $server_port);
+		// First grabb the online style
+		$phpbb_url = $root_url . $script_path;
+		// Parse Theme Data
+		$replace = array(
+			'{T_IMAGE_PATH}'	=> "{$phpbb_url}gym_sitemaps/images/",
+			'{T_STYLE_PATH}'	=> "{$phpbb_url}gym_sitemaps/style/",
+			'{S_CONTENT_DIRECTION}'	=> $lang['DIRECTION'],
+			'{S_USER_LANG}'		=> $language
+		);
+		if ($gym_style_type == 'xsl') {
+			$replace = array_merge($replace, array(
+				'{T_CSS_PATH}'		=> "{$phpbb_url}gym_sitemaps/gym_style.$phpEx?action=$action&amp;type=css&amp;lang={$language}&amp;theme_id={$theme_id}",
+				'{L_HOME}'		=> $lang['GYM_HOME'],
+				'{L_FORUM_INDEX}'	=> $lang['GYM_FORUM_INDEX'],
+				'{L_LINK}'		=> $lang['GYM_LINK'],
+				'{L_LASTMOD_DATE}'	=> $lang['GYM_LASTMOD_DATE'],
+				'{ROOT_URL}'		=> $root_url,
+				'{HTTP_PROTO_REQUEST}'	=> $server_protocol,
+				'{PHPBB_URL}'		=> $phpbb_url,
+				// Do not remove !
+				'{L_COPY}'		=>  '<a href="http://www.phpbb-seo.com/" title="GYM Sitemaps &amp; RSS &#169; 2006, ' . date('Y') . ' phpBB SEO" class="copyright"><img src="' . $phpbb_url . 'gym_sitemaps/images/phpbb-seo.png" alt="' . $lang['GYM_SEO'] . '"/></a>',
+				'{L_SEARCH_ADV_EXPLAIN}' => $lang['SEARCH_ADV_EXPLAIN'],
+				'{L_CHANGE_FONT_SIZE}'  => $lang['CHANGE_FONT_SIZE'],
+				'{L_SEARCH_ADV}' 	=> $lang['SEARCH_ADV'],
+				'{L_SEARCH}' 		=> $lang['SEARCH'],
+				'{L_BACK_TO_TOP}' 	=> $lang['BACK_TO_TOP'],
+				'{L_FAQ}' 		=> $lang['FAQ'],
+				'{L_FAQ_EXPLAIN}' 	=> $lang['FAQ_EXPLAIN'],
+				'{L_REGISTER}' 		=> $lang['REGISTER'],
+				'{L_SKIP}' 		=> $lang['SKIP'],
+				'{L_BOOKMARK_THIS}' 	=> $lang['GYM_BOOKMARK_THIS'],
+				'{SITENAME}' 		=> htmlspecialchars($config['sitename']),
+				'{SITE_DESCRIPTION}' 	=> $config['site_desc'],
+
+			));
+			if ($action == 'google') {
+				$replace = array_merge($replace, array(
+					'{L_SITEMAP}'		=> $lang['GOOGLE_SITEMAP'],
+					'{L_SITEMAP_OF}'	=> $lang['GOOGLE_SITEMAP_OF'],
+					'{L_SITEMAPINDEX}'	=> $lang['GOOGLE_SITEMAPINDEX'],
+					'{L_NUMBER_OF_SITEMAP}'	=> $lang['GOOGLE_NUMBER_OF_SITEMAP'],
+					'{L_SITEMAP_URL}'	=> $lang['GOOGLE_SITEMAP_URL'],
+					'{L_NUMBER_OF_URL}'	=> $lang['GOOGLE_NUMBER_OF_URL'],
+					'{L_CHANGEFREQ}'	=> $lang['GOOGLE_CHANGEFREQ'],
+					'{L_PRIORITY}'		=> $lang['GOOGLE_PRIORITY'],
+				));
+			} elseif ($action == 'rss') {
+				$replace = array_merge($replace, array(
+					'{L_UPDATE}'		=> $lang['RSS_UPDATE'],
+					'{L_LAST_UPDATE}'	=> $lang['RSS_LAST_UPDATE'],
+					'{L_MINUTES}'		=> $lang['GYM_MINUTES'],
+					'{L_SOURCE}'		=> $lang['GYM_SOURCE'],
+					'{L_SUBSCRIBE_POD}'	=> $lang['RSS_SUBSCRIBE_POD'],
+					'{L_SUBSCRIBE}'		=> $lang['RSS_SUBSCRIBE'],
+					'{L_2_LINK}'		=> $lang['RSS_2_LINK'],
+					'{L_FEED}'		=> $lang['RSS_FEED'],
+					'{L_ITEM_LISTED}'	=> $lang['RSS_ITEM_LISTED'],
+					'{L_ITEMS_LISTED}'	=> $lang['RSS_ITEMS_LISTED'],
+					'{L_RSS_VALID}'		=> $lang['RSS_VALID'],
+				));
+			}
+		}
+		// Load the required stylsheet template
+		if ( $load_phpbb_css && $gym_style_type == 'css' ) {
+			@ini_set('user_agent','GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+			@ini_set('default_socket_timeout', 10);
+			$phpbb_css = @file_get_contents("{$phpbb_url}style.php?id={$theme_id}&lang={$language}");
+			if ($phpbb_css) {
+				$output = str_replace('./styles/', "{$phpbb_url}styles/", $phpbb_css);
+			} else {
+				$style_tpl = @file_get_contents($style_file);
+				$output = str_replace(array_keys($replace), array_values($replace), $style_tpl);
+			}
+			unset($phpbb_css);
+		} else {
+			$style_tpl = @file_get_contents($style_file);
+			$output = str_replace(array_keys($replace), array_map('numeric_entify_utf8', array_values($replace)), $style_tpl);
+		}
+		if ($strip_spaces) {
+			if ($gym_style_type === 'xsl') {
+				$output = preg_replace(array('`<\!--.*-->`Us', '`[\s]+`'), ' ', $output);
+			} else {
+				$output = preg_replace(array('`/\*.*\*/`Us', '`[\s]+`'), ' ', $output);
+			}
+		}
+		$handle = @fopen($cached_file, 'wb');
+		@flock($handle, LOCK_EX);
+		@fwrite($handle, $output);
+		@flock($handle, LOCK_UN);
+		@fclose ($handle);
+		@chmod($cached_file, 0666);
+
+		header('Expires: ' . gmdate('D, d M Y H:i:s \G\M\T', $expire_time));
+		header('Content-type: ' . $content_type . '; charset=UTF-8');
+		echo $output;
+		exit;
+	}
+}
+exit;
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/google_txt.php
===================================================================
--- gym_sitemaps/acp/google_txt.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/google_txt.php	(Premod 3.0.8)
@@ -0,0 +1,117 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_txt.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_txt Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_txt {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function google_txt(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config, display vars + default values and select options
+	* @access private
+	*/
+	function acp_module() {
+		return array(
+			'cache' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'google_txt_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_txt_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_txt_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_txt_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_txt_cache_on' => 1,
+					'google_txt_cache_force_gzip' => 0,
+					'google_txt_cache_max_age' => 24,
+					'google_txt_showstats' => 1,
+				),
+			),
+			'gzip' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend1' => 'GYM_GZIP',
+						'google_txt_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_txt_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_txt_gzip' => 0,
+					'google_txt_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_LIMIT',
+						'google_txt_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_txt_url_limit' => 750,
+				),
+			),
+			// We always need a main
+			'main' => array(
+				'display_vars' => array(
+					'title'	=> 'GOOGLE_TXT_CONFIG',
+					'vars'	=> array(
+						'legend1' => 'GOOGLE_TXT_CONFIG',
+						'google_txt_randomize' => array('lang' => 'GOOGLE_TXT_RANDOMIZE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_txt_unique' => array('lang' => 'GOOGLE_TXT_UNIQUE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_txt_check_robots' => array('lang' => 'GYM_CHECK_ROBOTS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_txt_force_lastmod' => array('lang' => 'GOOGLE_TXT_FORCE_LASTMOD', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'legend2' => 'GOOGLE_PRIORITIES',
+						'google_txt_default_priority' => array('lang' => 'GOOGLE_DEFAULT_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true, 'overriding' => true),
+						'legend3' => 'GOOGLE_PING',
+						'google_txt_ping' => array('lang' => 'GOOGLE_PING', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_txt_randomize' => 0,
+					'google_txt_unique' => 0,
+					'google_txt_check_robots' => 0,
+					'google_txt_force_lastmod' => 0,
+					'google_txt_default_priority' => 1.0,
+					'google_txt_ping' => 0,
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GOOGLE_TXT',
+				'lang_file' => 'google_txt',
+				'actions' => array( 'main', 'cache', 'gzip', 'limit'),
+				'mode' => 'google',
+				'module' => 'txt'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/rss_main.php
===================================================================
--- gym_sitemaps/acp/rss_main.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/rss_main.php	(Premod 3.0.8)
@@ -0,0 +1,317 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: rss_main.php 134 2009-11-02 11:13:45Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* rss_main Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class rss_main {
+	var $gym_master;
+	var $dyn_select = array();
+	var $lang_iso639 = array();
+	var $rss_override = array();
+	/**
+	* constuctor
+	*/
+	function rss_main(&$gym_master) {
+		global $user;
+		$this->gym_master = &$gym_master;
+		// Load the language iso 639-1 code - http://www.loc.gov/standards/iso639-2/php/French_list.php
+		if ( !isset($user->lang['ISO_639_1'])) {
+			$user->add_lang('gym_sitemaps/gym_iso639');
+		}
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->rss_override = $this->gym_master->dyn_select['override'];
+			unset($this->rss_override[OVERRIDE_GLOBAL]);
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config
+	* @access private
+	*/
+	function acp_module() {
+		global $config, $phpbb_seo, $user;
+		$config['sitename'] = utf8_normalize_nfc($config['sitename']);
+		$config['site_desc'] = utf8_normalize_nfc($config['site_desc']);
+		return array(
+			'cache' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'rss_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_cache_auto_regen' => array('lang' => 'GYM_CACHE_AUTO_REGEN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'rss_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_cache_on'	=> 0,
+					'rss_cache_force_gzip' => 0,
+					'rss_cache_max_age' => 6,
+					'rss_cache_auto_regen'	=> 1,
+					'rss_showstats'	=> 1,
+				),
+			),
+			'modrewrite' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'rss_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'rss_1xredir' => array('lang' => 'RSS_1XREDIR', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'rss_modrewrite' => 0,
+					'rss_modrtype' => 0,
+					'rss_1xredir' => 0,
+				),
+				'select' => array(
+					'rss_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend4'	=> 'GYM_GZIP',
+						'rss_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_gzip' => 0,
+					'rss_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'RSS_LIMIT_GEN',
+						'rss_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_sql_limit' => array('lang' => 'GYM_SQL_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_time_limit' => array('lang' => 'GYM_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'legend2'	=> 'RSS_LIMIT_SPEC',
+						'rss_url_limit_long' => array('lang' => 'RSS_URL_LIMIT_LONG', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_sql_limit_long' => array('lang' => 'RSS_SQL_LIMIT_LONG', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_url_limit_short' => array('lang' => 'RSS_URL_LIMIT_SHORT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_sql_limit_short' => array('lang' => 'RSS_SQL_LIMIT_SHORT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_url_limit_msg' => array('lang' => 'RSS_URL_LIMIT_MSG', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_sql_limit_msg' => array('lang' => 'RSS_SQL_LIMIT_MSG', 'validate' => 'int:0:500', 'type' => 'text:4:4', 'explain' => true,),
+					),
+				),
+				'default' => array(
+ 					'rss_url_limit' => 50,
+					'rss_sql_limit' => 20,
+					'rss_time_limit' => 15,
+					'rss_url_limit_long' => 100,
+					'rss_sql_limit_long' => 25,
+					'rss_url_limit_short' => 10,
+					'rss_sql_limit_short' => 10,
+					'rss_url_limit_msg' => 15,
+					'rss_sql_limit_msg' => 15,
+				),
+			),
+			'sort' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'rss_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_sort' => 'DESC',
+				),
+				'select' => array(
+					'rss_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_PAGINATION',
+						'rss_pagination' => array('lang' => 'GYM_PAGINATION_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_limitdown' => array('lang' => 'GYM_LIMITDOWN', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_limitup' => array('lang' => 'GYM_LIMITUP', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_pagination' => 1,
+					'rss_limitdown' => 3,
+					'rss_limitup' => 5,
+				),
+			),
+			'override' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_OVERRIDE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_OVERRIDE',
+						'rss_override'	=> array('lang' => 'GYM_OVERRIDE_MAIN', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_cache'	=> array('lang' => 'GYM_OVERRIDE_CACHE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_modrewrite'	=> array('lang' => 'GYM_OVERRIDE_MODREWRITE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_gzip'	=> array('lang' => 'GYM_OVERRIDE_GZIP','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_limit'	=> array('lang' => 'GYM_OVERRIDE_LIMIT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_sort'	=> array('lang' => 'GYM_OVERRIDE_SORT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_override_pagination'	=> array('lang' => 'GYM_OVERRIDE_PAGINATION','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+					),
+				),
+				'default' => array(
+ 					'rss_override'	=> OVERRIDE_MODULE,
+					'rss_override_cache' => OVERRIDE_OTYPE,
+					'rss_override_modrewrite' => OVERRIDE_OTYPE,
+					'rss_override_gzip' => OVERRIDE_GLOBAL,
+					'rss_override_limit' => OVERRIDE_OTYPE,
+					'rss_override_sort' => OVERRIDE_MODULE,
+					'rss_override_pagination' => OVERRIDE_OTYPE,
+				),
+				'select' => array(
+					'rss_override' => $this->rss_override,
+					'rss_override_cache' => @$this->dyn_select['override'],
+					'rss_override_modrewrite' => @$this->dyn_select['override'],
+					'rss_override_gzip' => @$this->dyn_select['override'],
+					'rss_override_limit' => @$this->dyn_select['override'],
+					'rss_override_sort' => @$this->dyn_select['override'],
+					'rss_override_pagination' => @$this->dyn_select['override'],
+				),
+			),
+			'main' => array(
+ 				'display_vars' => array(
+					'title'	=> 'RSS_MAIN',
+					'vars'	=> array(
+						// URL Settings
+						'legend1'	=> 'RSS_URL',
+						'rss_url'	=> array('lang' => 'RSS_URL', 'validate' => 'string',	'type' => 'text:40:255', 'explain' => true),
+						// Link Settings
+						'legend2'	=> 'RSS_LINKS_ACTIVATION',
+						'rss_link_main'	=> array('lang' => 'RSS_LINKS_MAIN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'rss_link_index' => array('lang' => 'RSS_LINKS_INDEX', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'rss_link_cat' => array('lang' => 'RSS_LINKS_CAT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'rss_alternate'	=> array('lang' => 'RSS_ALTERNATE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_linking_type'	=> array('lang' => 'RSS_LINKING_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						// Settings
+						'legend3'	=> 'RSS_SETTINGS',
+						'rss_c_info' => array('lang' => 'RSS_C_INFO', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true),
+						'rss_sitename' => array('lang' => 'RSS_SITENAME', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true),
+						'rss_site_desc' => array('lang' => 'RSS_SITE_DESC', 'validate' => 'string', 'type' => 'textarea:6:50', 'explain' => true),
+						'rss_logo_url' => array('lang' => 'RSS_LOGO_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true),
+						'rss_image_url' => array('lang' => 'RSS_IMAGE_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true),
+						'rss_lang' => array('lang' => 'RSS_LANG', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						// Auth settings
+						'legend4'	=> 'RSS_AUTH_SETTINGS',
+						'rss_allow_auth' => array('lang' => 'RSS_ALLOW_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_cache_auth' => array('lang' => 'RSS_CACHE_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						// Notifications
+						'legend5'	=> 'RSS_NOTIFY',
+						'rss_yahoo_notify' => array('lang' => 'RSS_YAHOO_NOTIFY', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_yahoo_appid' => array('lang' => 'RSS_YAHOO_APPID', 'validate' => 'string',	'type' => 'text:25:200', 'explain' => true),
+						// Style
+						'legend6'	=> 'RSS_STYLE',
+						'rss_xslt'	=> array('lang' => 'RSS_XSLT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_force_xslt' => array('lang' => 'RSS_FORCE_XSLT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_load_phpbb_css' => array('lang' => 'RSS_LOAD_PHPBB_CSS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'rss_url' => $phpbb_seo->seo_path['phpbb_url'],
+					'rss_link_main' => 1,
+					'rss_link_index' => 1,
+					'rss_link_cat' => 1,
+					'rss_alternate' => 1,
+					'rss_linking_type' => 'n',
+ 					'rss_c_info' => $config['sitename'],
+					'rss_sitename' => $config['sitename'],
+					'rss_site_desc' => $config['site_desc'],
+					'rss_logo_url' => 'logo.gif',
+					'rss_image_url' => 'rss_forum_big.gif',
+					'rss_lang' => $config['default_lang'],
+					'rss_allow_auth' => 0,
+					'rss_cache_auth' => 1,
+					// Notifications
+					'rss_yahoo_notify' => 0,
+					'rss_yahoo_appid' => '',
+					// Style
+					'rss_xslt' => 1,
+					'rss_force_xslt' => 1,
+					'rss_load_phpbb_css' => 0,
+				),
+				'select' => array(
+					'rss_lang' => $user->lang['ISO_639_1'],
+					'rss_linking_type' => @$this->dyn_select['rss_linking_types'],
+
+				),
+			),
+			'content' => array(
+ 				'display_vars' => array(
+					'title'	=> 'RSS_CONTENT',
+					'vars'	=> array(
+						// Content
+						'legend1'	=> 'RSS_CONTENT',
+						'rss_allow_news' => array('lang' => 'RSS_ALLOW_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_news_update' => array('lang' => 'RSS_NEWS_UPDATE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true),
+						'rss_allow_short' => array('lang' => 'RSS_ALLOW_SHORT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_long' => array('lang' => 'RSS_ALLOW_LONG', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_content' => array('lang' => 'RSS_ALLOW_CONTENT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_profile' => array('lang' => 'RSS_ALLOW_PROFILE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_profile_links' => array('lang' => 'RSS_ALLOW_PROFILE_LINKS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_bbcode' => array('lang' => 'RSS_ALLOW_BBCODE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_strip_bbcode' => array('lang' => 'RSS_STRIP_BBCODE', 'validate' => 'string', 'type' => 'text:30:200', 'explain' => true),
+						'rss_allow_links' =>  array('lang' => 'RSS_ALLOW_LINKS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_emails' => array('lang' => 'RSS_ALLOW_EMAILS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_allow_smilies' => array('lang' => 'RSS_ALLOW_SMILIES', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_sumarize' => array('lang' => 'RSS_SUMARIZE', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'rss_sumarize_method' => array('lang' => 'RSS_SUMARIZE_METHOD', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'rss_nohtml' => array('lang' => 'RSS_NOHTML', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					// Content
+					'rss_allow_news' => 1,
+					'rss_news_update' => '',
+					'rss_allow_short' => 1,
+					'rss_allow_long' => 1,
+					'rss_allow_content' => 1,
+					'rss_allow_profile' => 1,
+					'rss_allow_profile_links' => 0,
+					'rss_allow_bbcode' => 1,
+					'rss_strip_bbcode' => '',
+					'rss_allow_links' =>  1,
+					'rss_allow_emails' => 0,
+					'rss_allow_smilies' => 1,
+					'rss_sumarize' => 50,
+					'rss_sumarize_method' => 'words',
+					'rss_nohtml' => 0,
+				),
+				'select' => array(
+					'rss_sumarize_method' => @$this->dyn_select['sumarize_method'],
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GYM_RSS',
+				'lang_file' => 'gym_rss',
+				'actions' => array('main', 'content', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination', 'override',),
+				'mode' => 'rss',
+				'module' => 'main',
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/google_xml.php
===================================================================
--- gym_sitemaps/acp/google_xml.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/google_xml.php	(Premod 3.0.8)
@@ -0,0 +1,119 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_xml.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_xml Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_xml {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function google_xml(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config, display vars + default values and select options
+	* @access private
+	*/
+	function acp_module() {
+		return array(
+			'cache' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'google_xml_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_xml_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_xml_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_xml_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_xml_cache_on' => 1,
+					'google_xml_cache_force_gzip' => 0,
+					'google_xml_cache_max_age' => 24,
+					'google_xml_showstats' => 1,
+				),
+			),
+			'gzip' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_GZIP',
+						'google_xml_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_xml_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_xml_gzip' => 0,
+					'google_xml_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_LIMIT',
+						'google_xml_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:10000', 'type' => 'text:8:8', 'explain' => true, 'overriding' => true),
+						'google_xml_force_limit' => array('lang' => 'GOOGLE_XML_FORCE_LIMIT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'google_xml_url_limit' => 750,
+					'google_xml_force_limit' => 0,
+				),
+			),
+			// We always need a main
+			'main' => array(
+				'display_vars' => array(
+					'title'	=> 'GOOGLE_XML_CONFIG',
+					'vars'	=> array(
+						'legend1' => 'GOOGLE_XML_CONFIG',
+						'google_xml_randomize' => array('lang' => 'GOOGLE_XML_RANDOMIZE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_xml_unique' => array('lang' => 'GOOGLE_XML_UNIQUE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_xml_check_robots' => array('lang' => 'GYM_CHECK_ROBOTS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_xml_force_lastmod' => array('lang' => 'GOOGLE_XML_FORCE_LASTMOD', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'legend2' => 'GOOGLE_PRIORITIES',
+						'google_xml_default_priority' => array('lang' => 'GOOGLE_DEFAULT_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true, 'overriding' => true),
+						'legend3' => 'GOOGLE_PING',
+						'google_xml_ping' => array('lang' => 'GOOGLE_PING', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_xml_randomize' => 0,
+					'google_xml_unique' => 0,
+					'google_xml_check_robots' => 0,
+					'google_xml_force_lastmod' => 0,
+					'google_xml_default_priority' => 1.0,
+					'google_xml_ping' => 0,
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GOOGLE_XML',
+				'lang_file' => 'google_xml',
+				'actions' => array( 'main', 'cache', 'gzip', 'limit'),
+				'mode' => 'google',
+				'module' => 'xml'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/html_forum.php
===================================================================
--- gym_sitemaps/acp/html_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/html_forum.php	(Premod 3.0.8)
@@ -0,0 +1,303 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: html_forum.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* html_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class html_forum {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function html_forum(&$gym_master) {
+		global $user;
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = &$this->gym_master->dyn_select;
+			$this->gym_master->forum_select();
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config
+	* @access private
+	*/
+	function acp_module() {
+		global $config, $phpbb_seo, $user;
+		$config['sitename'] = utf8_normalize_nfc($config['sitename']);
+		$config['site_desc'] = utf8_normalize_nfc($config['site_desc']);
+		return array(
+			'cache' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'HTML_CACHE',
+						'html_forum_main_cache_on'	=> array('lang' => 'HTML_MAIN_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_main_cache_ttl' => array('lang' => 'HTML_MAIN_CACHE_TTL', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_opt_cache_on'	=> array('lang' => 'HTML_OPT_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_opt_cache_ttl' => array('lang' => 'HTML_OPT_CACHE_TTL', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_forum_main_cache_on' => 0,
+					'html_forum_opt_cache_on' => 0,
+					'html_forum_main_cache_ttl' => 6,
+					'html_forum_opt_cache_ttl' => 6,
+				),
+			),
+			'modrewrite' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'html_forum_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_forum_modrewrite' => 0,
+					'html_forum_modrtype' => 0,
+				),
+				'select' => array(
+					'html_forum_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend4'	=> 'GYM_GZIP',
+						'html_forum_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'html_forum_gzip' => 0,
+				),
+			),
+			'limit' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_TIME_LIMIT',
+						'html_forum_map_time_limit' => array('lang' => 'HTML_MAP_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_cat_time_limit' => array('lang' => 'HTML_CAT_MAP_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_news_time_limit' => array('lang' => 'HTML_NEWS_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_cat_news_time_limit' => array('lang' => 'HTML_CAT_NEWS_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_forum_map_time_limit' => 0,
+					'html_forum_cat_time_limit' => 0,
+					'html_forum_news_time_limit' => 0,
+					'html_forum_cat_news_time_limit' => 0,
+				),
+			),
+			'sort' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'HTML_MAP_SORT_TITLE',
+						'html_forum_first' => array('lang' => 'HTML_FORUM_FIRST', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_forum_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_cat_sort' => array('lang' => 'HTML_CAT_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'legend2'	=> 'HTML_NEWS_SORT_TITLE',
+						'html_forum_news_first' => array('lang' => 'HTML_FORUM_NEWS_FIRST', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_forum_news_sort' => array('lang' => 'HTML_NEWS_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_cat_news_sort' => array('lang' => 'HTML_CAT_NEWS_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_forum_sort' => 'DESC',
+					'html_forum_cat_sort' => 'DESC',
+					'html_forum_news_sort' => 'DESC',
+					'html_forum_cat_news_sort' => 'DESC',
+					'html_forum_first' => 0,
+					'html_forum_news_first' => 1,
+				),
+				'select' => array(
+					'html_forum_sort' => @$this->dyn_select['sort'],
+					'html_forum_cat_sort' => @$this->dyn_select['sort'],
+					'html_forum_news_sort' => @$this->dyn_select['sort'],
+					'html_forum_cat_news_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'HTML_PAGINATION_GEN',
+						'html_forum_pagination' => array('lang' => 'HTML_FORUM_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_pagination_limit' => array('lang' => 'HTML_FORUM_PAGINATION_LIMIT', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_news_pagination' => array('lang' => 'HTML_NEWS_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_news_pagination_limit' => array('lang' => 'HTML_NEWS_PAGINATION_LIMIT', 'validate' => 'int:0:50', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'legend2'	=> 'HTML_PAGINATION_SPEC',
+						'html_forum_item_pagination' => array('lang' => 'HTML_ITEM_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_ltopic_pagination' => array('lang' => 'HTML_FORUM_LTOPIC_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'html_forum_pagination' => 1,
+					'html_forum_pagination_limit' => 50,
+					'html_forum_news_pagination' => 1,
+					'html_forum_news_pagination_limit' => 10,
+					'html_forum_item_pagination' => 0,
+					'html_forum_ltopic_pagination' => 0,
+				),
+			),
+			'main' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_MAIN',
+					'vars'	=> array(
+						// Settings
+						'legend1'	=> 'HTML_SETTINGS',
+						'html_forum_allow_map' => array('lang' => 'HTML_ALLOW_MAP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_cat_map' => array('lang' => 'HTML_ALLOW_CAT_MAP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_sitename' => array('lang' => 'HTML_SITENAME', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true, 'overriding' => true),
+						'html_forum_site_desc' => array('lang' => 'HTML_SITE_DESC', 'validate' => 'string', 'type' => 'textarea:6:50', 'explain' => true, 'overriding' => true),
+						'html_forum_c_info' => array('lang' => 'HTML_C_INFO', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true, 'overriding' => true),
+						'html_forum_logo_url' => array('lang' => 'HTML_LOGO_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true, 'overriding' => true),
+						'html_forum_stats_on_news' => array('lang' => 'HTML_STATS_ON_NEWS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_stats_on_map' => array('lang' => 'HTML_STATS_ON_MAP', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_birthdays_on_news' => array('lang' => 'HTML_BIRTHDAYS_ON_NEWS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_birthdays_on_map' => array('lang' => 'HTML_BIRTHDAYS_ON_MAP', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_disp_online' => array('lang' => 'HTML_DISP_ONLINE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_disp_tracking' => array('lang' => 'HTML_DISP_TRACKING', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_disp_status' => array('lang' => 'HTML_DISP_STATUS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_profile' => array('lang' => 'HTML_ALLOW_PROFILE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_profile_links' => array('lang' => 'HTML_ALLOW_PROFILE_LINKS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_exclude' => array('lang' => 'HTML_FORUM_EXCLUDE', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple_string', 'explain' => true),
+						// Auth settings
+						'legend2'	=> 'HTML_AUTH_SETTINGS',
+						'html_forum_allow_auth' => array('lang' => 'HTML_ALLOW_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						// Last topic list
+						'legend3'	=> 'HTML_FORUM_LTOPIC',
+						'html_forum_ltopic' => array('lang' => 'HTML_FORUM_INDEX_LTOPIC', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true),
+						'html_forum_cat_ltopic' => array('lang' => 'HTML_FORUM_CAT_LTOPIC', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true),
+						'html_forum_news_ltopic' => array('lang' => 'HTML_FORUM_NEWS_LTOPIC', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true),
+						'html_forum_cat_news_ltopic' => array('lang' => 'HTML_FORUM_CAT_NEWS_LTOPIC', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true),
+						'html_forum_ltopic_exclude' => array('lang' => 'HTML_FORUM_LTOPIC_EXCLUDE', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple_string', 'explain' => true),
+						// form specific
+						'legend4'	=> 'HTML_FORUM_CONTENT',
+						'html_forum_last_post' => array('lang' => 'HTML_FORUM_LAST_POST', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_forum_rules' => array('lang' => 'HTML_FORUM_RULES', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_forum_desc' => array('lang' => 'HTML_FORUM_DESC', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'html_forum_allow_map' => 1,
+					'html_forum_allow_cat_map' => 1,
+ 					'html_forum_c_info' => $config['sitename'],
+					'html_forum_sitename' => $config['sitename'],
+					'html_forum_site_desc' => $config['site_desc'],
+					'html_forum_logo_url' => '',
+					'html_forum_url' => $phpbb_seo->seo_path['phpbb_url'],
+					'html_forum_disp_online' => 'globalmod',
+					'html_forum_disp_tracking' => 'reg',
+					'html_forum_disp_status' => 'reg',
+					'html_forum_allow_auth' => 1,
+					'html_forum_ltopic' => 15,
+					'html_forum_cat_ltopic' => 15,
+					'html_forum_news_ltopic' => 10,
+					'html_forum_cat_news_ltopic' => 10,
+					'html_forum_allow_profile' => 'none',
+					'html_forum_allow_profile_links' => 'reg',
+					'html_forum_last_post' => 'reg',
+					'html_forum_rules' => 'all',
+					'html_forum_desc' => 'all',
+					'html_forum_stats_on_news' => 'all',
+					'html_forum_stats_on_map' => 'all',
+					'html_forum_birthdays_on_news' => 'reg',
+					'html_forum_birthdays_on_map' => 'reg',
+					// Exclusions
+					'html_forum_exclude' => '',
+					'html_forum_ltopic_exclude' => '',
+				),
+				'select' => array(
+					'html_forum_exclude' => @$this->dyn_select['forums'],
+					'html_forum_disp_online' => @$this->dyn_select['gym_auth'],
+					'html_forum_disp_tracking' => @$this->dyn_select['gym_auth'],
+					'html_forum_disp_status' => @$this->dyn_select['gym_auth'],
+					'html_forum_ltopic_exclude' => @$this->dyn_select['forums'],
+					'html_forum_allow_profile' => @$this->dyn_select['gym_auth'],
+					'html_forum_allow_profile_links' => @$this->dyn_select['gym_auth'],
+					'html_forum_last_post' => @$this->dyn_select['gym_auth'],
+					'html_forum_rules' => @$this->dyn_select['gym_auth'],
+					'html_forum_desc' => @$this->dyn_select['gym_auth'],
+					'html_forum_stats_on_news' => @$this->dyn_select['gym_auth'],
+					'html_forum_stats_on_map' => @$this->dyn_select['gym_auth'],
+					'html_forum_birthdays_on_news' => @$this->dyn_select['gym_auth'],
+					'html_forum_birthdays_on_map' => @$this->dyn_select['gym_auth'],
+				),
+			),
+			'content' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_NEWS',
+					'vars'	=> array(
+						// news
+						'legend1'	=> 'HTML_NEWS',
+						'html_forum_allow_news' => array('lang' => 'HTML_FORUM_ALLOW_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_cat_news' => array('lang' => 'HTML_FORUM_ALLOW_CAT_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_forum_news_ids' => array('lang' => 'HTML_FORUM_NEWS_IDS', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple_string', 'explain' => true),
+						// News content
+						'legend2'	=> 'HTML_NEWS_CONTENT',
+						'html_forum_post_buttons' => array('lang' => 'HTML_FORUM_POST_BUTTONS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_forum_allow_bbcode' => array('lang' => 'HTML_ALLOW_BBCODE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_strip_bbcode' => array('lang' => 'HTML_STRIP_BBCODE', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_links' =>  array('lang' => 'HTML_ALLOW_LINKS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_emails' => array('lang' => 'HTML_ALLOW_EMAILS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_smilies' => array('lang' => 'HTML_ALLOW_SMILIES', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_allow_sig' => array('lang' => 'HTML_ALLOW_SIG', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_forum_sumarize' => array('lang' => 'HTML_SUMARIZE', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'html_forum_sumarize_method' => array('lang' => 'HTML_SUMARIZE_METHOD', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					// Content
+					'html_forum_allow_news' => 1,
+					'html_forum_news_ids' => '',
+					'html_forum_allow_cat_news' => 1,
+					'html_forum_post_buttons' => 'none',
+					'html_forum_allow_bbcode' => 'all',
+					'html_forum_strip_bbcode' => '',
+					'html_forum_allow_links' =>  'all',
+					'html_forum_allow_emails' => 'none',
+					'html_forum_allow_smilies' => 'none',
+					'html_forum_allow_sig'  => 'none',
+					'html_forum_sumarize' => 75,
+					'html_forum_sumarize_method' => 'words',
+				),
+				'select' => array(
+					'html_forum_sumarize_method' => @$this->dyn_select['sumarize_method'],
+					'html_forum_post_buttons' => @$this->dyn_select['gym_auth'],
+					'html_forum_allow_bbcode' => @$this->dyn_select['gym_auth'],
+					'html_forum_allow_links' =>  @$this->dyn_select['gym_auth'],
+					'html_forum_allow_emails' => @$this->dyn_select['gym_auth'],
+					'html_forum_allow_smilies' => @$this->dyn_select['gym_auth'],
+					'html_forum_allow_sig' => @$this->dyn_select['gym_auth'],
+					'html_forum_news_ids' => @$this->dyn_select['forums'],
+				),
+			),
+			'info' => array(
+				'title_lang' => 'HTML_FORUM',
+				'lang_file' => 'html_forum',
+				'actions' => array( 'main', 'content', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination',),
+				'mode' => 'rss',
+				'module' => 'forum'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/rss_forum.php
===================================================================
--- gym_sitemaps/acp/rss_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/rss_forum.php	(Premod 3.0.8)
@@ -0,0 +1,263 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: rss_forum.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* rss_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class rss_forum {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function rss_forum(&$gym_master) {
+		global $user;
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = & $this->gym_master->dyn_select;
+			$this->gym_master->forum_select();
+		}
+		// Load the language iso 639-1 code - http://www.loc.gov/standards/iso639-2/php/French_list.php
+		if ( !isset($user->lang['ISO_639_1'])) {
+			$user->add_lang('gym_sitemaps/gym_iso639');
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config
+	* @access private
+	*/
+	function acp_module() {
+		global $config, $phpbb_seo, $user;
+		$config['sitename'] = utf8_normalize_nfc($config['sitename']);
+		$config['site_desc'] = utf8_normalize_nfc($config['site_desc']);
+		return array(
+			'cache' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'rss_forum_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_cache_on'	=> 0,
+					'rss_forum_cache_force_gzip' => 0,
+					'rss_forum_cache_max_age' => 6,
+					'rss_forum_showstats'	=> 1,
+				),
+			),
+			'modrewrite' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'rss_forum_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'rss_forum_modrewrite' => 0,
+					'rss_forum_modrtype' => 0,
+				),
+				'select' => array(
+					'rss_forum_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend4'	=> 'GYM_GZIP',
+						'rss_forum_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_gzip' => 0,
+					'rss_forum_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'RSS_LIMIT_GEN',
+						'rss_forum_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_sql_limit' => array('lang' => 'GYM_SQL_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_time_limit' => array('lang' => 'GYM_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'legend2'	=> 'RSS_LIMIT_SPEC',
+						'rss_forum_url_limit_long' => array('lang' => 'RSS_URL_LIMIT_LONG', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_sql_limit_long' => array('lang' => 'RSS_SQL_LIMIT_LONG', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_url_limit_short' => array('lang' => 'RSS_URL_LIMIT_SHORT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_sql_limit_short' => array('lang' => 'RSS_SQL_LIMIT_SHORT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_url_limit_msg' => array('lang' => 'RSS_URL_LIMIT_MSG', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_sql_limit_msg' => array('lang' => 'RSS_SQL_LIMIT_MSG', 'validate' => 'int:0:500', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_url_limit' => 50,
+					'rss_forum_sql_limit' => 20,
+					'rss_forum_time_limit' => 15,
+					'rss_forum_url_limit_long' => 100,
+					'rss_forum_sql_limit_long' => 25,
+					'rss_forum_url_limit_short' => 10,
+					'rss_forum_sql_limit_short' => 10,
+					'rss_forum_url_limit_msg' => 15,
+					'rss_forum_sql_limit_msg' => 15,
+				),
+			),
+			'sort' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'rss_forum_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_sort' => 'DESC',
+				),
+				'select' => array(
+					'rss_forum_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_PAGINATION',
+						'rss_forum_pagination' => array('lang' => 'GYM_PAGINATION_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_limitdown' => array('lang' => 'GYM_LIMITDOWN', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_limitup' => array('lang' => 'GYM_LIMITUP', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_pagination' => 1,
+					'rss_forum_limitdown' => 3,
+					'rss_forum_limitup' => 5,
+				),
+			),
+			'main' => array(
+ 				'display_vars' => array(
+					'title'	=> 'RSS_MAIN',
+					'vars'	=> array(
+						// Settings
+						'legend1'	=> 'RSS_SETTINGS',
+						'rss_forum_c_info' => array('lang' => 'RSS_C_INFO', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true, 'overriding' => true),
+						'rss_forum_sitename' => array('lang' => 'RSS_SITENAME', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true, 'overriding' => true),
+						'rss_forum_site_desc' => array('lang' => 'RSS_SITE_DESC', 'validate' => 'string', 'type' => 'textarea:6:50', 'explain' => true, 'overriding' => true),
+						'rss_forum_logo_url' => array('lang' => 'RSS_LOGO_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true, 'overriding' => true),
+						'rss_forum_image_url' => array('lang' => 'RSS_IMAGE_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true, 'overriding' => true),
+						'rss_forum_lang' => array('lang' => 'RSS_LANG', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'rss_forum_alternate'	=> array('lang' => 'RSS_FORUM_ALTERNATE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						// Auth settings
+						'legend2'	=> 'RSS_AUTH_SETTINGS',
+						'rss_forum_allow_auth' => array('lang' => 'RSS_ALLOW_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_cache_auth' => array('lang' => 'RSS_CACHE_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						// Notifications
+						'legend3'	=> 'RSS_NOTIFY',
+						'rss_forum_yahoo_notify' => array('lang' => 'RSS_YAHOO_NOTIFY', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						// Exclusions
+						'legend4' => 'RSS_FORUM_EXCLUDE',
+						'rss_forum_exclude' => array('lang' => 'RSS_FORUM_EXCLUDE', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple_string', 'explain' => true),
+					),
+				),
+				'default' => array(
+ 					'rss_forum_c_info' => $config['sitename'],
+					'rss_forum_sitename' => $config['sitename'],
+					'rss_forum_site_desc' => $config['site_desc'],
+					'rss_forum_logo_url' => 'logo.gif',
+					'rss_forum_image_url' => 'rss_forum_big.gif',
+					'rss_forum_lang' => $config['default_lang'],
+					'rss_forum_alternate' => 1,
+					'rss_forum_allow_auth' => 0,
+					'rss_forum_cache_auth' => 1,
+					// Exclusions
+					'rss_forum_exclude' => '',
+					// Notifications
+					'rss_forum_yahoo_notify' => 0,
+				),
+				'select' => array(
+					'rss_forum_lang' => $user->lang['ISO_639_1'],
+					'rss_forum_exclude' => @$this->dyn_select['forums'],
+
+				),
+			),
+			'content' => array(
+ 				'display_vars' => array(
+					'title'	=> 'RSS_CONTENT',
+					'vars'	=> array(
+						// Content
+						'legend1'	=> 'RSS_CONTENT',
+						'rss_forum_allow_news' => array('lang' => 'RSS_ALLOW_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_short' => array('lang' => 'RSS_ALLOW_SHORT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_long' => array('lang' => 'RSS_ALLOW_LONG', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_content' => array('lang' => 'RSS_ALLOW_CONTENT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_profile' => array('lang' => 'RSS_ALLOW_PROFILE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_profile_links' => array('lang' => 'RSS_ALLOW_PROFILE_LINKS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_bbcode' => array('lang' => 'RSS_ALLOW_BBCODE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_strip_bbcode' => array('lang' => 'RSS_STRIP_BBCODE', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_links' =>  array('lang' => 'RSS_ALLOW_LINKS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_emails' => array('lang' => 'RSS_ALLOW_EMAILS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_allow_smilies' => array('lang' => 'RSS_ALLOW_SMILIES', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'rss_forum_sumarize' => array('lang' => 'RSS_SUMARIZE', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'rss_forum_sumarize_method' => array('lang' => 'RSS_SUMARIZE_METHOD', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'rss_forum_nohtml' => array('lang' => 'RSS_NOHTML', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						// form specific
+						'legend2'	=> 'RSS_FORUM_CONTENT',
+						'rss_forum_first' => array('lang' => 'RSS_FORUM_FIRST', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_forum_last' => array('lang' => 'RSS_FORUM_LAST', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'rss_forum_rules' => array('lang' => 'RSS_FORUM_RULES', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					// Content
+					'rss_forum_allow_news' => 1,
+					'rss_forum_allow_short' => 1,
+					'rss_forum_allow_long' => 1,
+					'rss_forum_allow_content' => 1,
+					'rss_forum_allow_profile' => 1,
+					'rss_forum_allow_profile_links' => 0,
+					'rss_forum_allow_bbcode' => 1,
+					'rss_forum_strip_bbcode' => '',
+					'rss_forum_allow_links' =>  1,
+					'rss_forum_allow_emails' => 0,
+					'rss_forum_allow_smilies' => 1,
+					'rss_forum_sumarize' => 25,
+					'rss_forum_sumarize_method' => 'words',
+					'rss_forum_nohtml' => 0,
+					'rss_forum_first' =>  0,
+					'rss_forum_last' => 1,
+					'rss_forum_rules' => 0,
+				),
+				'select' => array(
+					'rss_forum_sumarize_method' => @$this->dyn_select['sumarize_method'],
+				),
+			),
+			'info' => array(
+				'title_lang' => 'RSS_FORUM',
+				'lang_file' => 'rss_forum',
+				'actions' => array( 'main', 'content', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination',),
+				'mode' => 'rss',
+				'module' => 'forum'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/google_main.php
===================================================================
--- gym_sitemaps/acp/google_main.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/google_main.php	(Premod 3.0.8)
@@ -0,0 +1,227 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_main.php 134 2009-11-02 11:13:45Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_main Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_main {
+	var $gym_master;
+	var $dyn_select = array();
+	var $google_override = array();
+	/**
+	* constuctor
+	*/
+	function google_main(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->google_override = $this->gym_master->dyn_select['override'];
+			unset($this->google_override[OVERRIDE_GLOBAL]);
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config
+	* @access private
+	*/
+	function acp_module() {
+		global $phpbb_seo;
+		return array(
+			'cache' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'google_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_cache_auto_regen' => array('lang' => 'GYM_CACHE_AUTO_REGEN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_cache_on' => 0,
+					'google_cache_force_gzip' => 0,
+					'google_cache_max_age' => 24,
+					'google_cache_auto_regen' => 1,
+					'google_showstats' => 1,
+				),
+			),
+			'modrewrite' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'google_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_modrewrite' => 0,
+					'google_modrtype' => 0,
+				),
+				'select' => array(
+					'google_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_GZIP',
+						'google_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_gzip' => 0,
+					'google_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_LIMIT',
+						'google_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:50000', 'type' => 'text:6:6', 'explain' => true, 'overriding' => true),
+						'google_sql_limit' => array('lang' => 'GYM_SQL_LIMIT', 'validate' => 'int:0:2500', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_url_limit' => 2500,
+					'google_sql_limit' => 150,
+				),
+			),
+			'sort' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'google_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_sort' => 'DESC',
+				),
+				'select' => array(
+					'google_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_PAGINATION',
+						'google_pagination' => array('lang' => 'GYM_PAGINATION_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_limitdown' => array('lang' => 'GYM_LIMITDOWN', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_limitup' => array('lang' => 'GYM_LIMITUP', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_pagination' => 1,
+					'google_limitdown' => 3,
+					'google_limitup' => 5,
+				),
+			),
+			'override' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_OVERRIDE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_OVERRIDE',
+						'google_override'	=> array('lang' => 'GYM_OVERRIDE_MAIN', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_cache'	=> array('lang' => 'GYM_OVERRIDE_CACHE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_modrewrite'	=> array('lang' => 'GYM_OVERRIDE_MODREWRITE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_gzip'	=> array('lang' => 'GYM_OVERRIDE_GZIP','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_limit'	=> array('lang' => 'GYM_OVERRIDE_LIMIT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_sort'	=> array('lang' => 'GYM_OVERRIDE_SORT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'google_override_pagination'	=> array('lang' => 'GYM_OVERRIDE_PAGINATION','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+
+					),
+				),
+				'default' => array(
+					'google_override' => OVERRIDE_MODULE,
+					'google_override_cache'	=> OVERRIDE_OTYPE,
+					'google_override_modrewrite' => OVERRIDE_OTYPE,
+					'google_override_gzip'	=> OVERRIDE_GLOBAL,
+					'google_override_limit'	=> OVERRIDE_OTYPE,
+					'google_override_sort'	=> OVERRIDE_MODULE,
+					'google_override_pagination' => OVERRIDE_OTYPE,
+				),
+				'select' => array(
+					'google_override' => $this->google_override,
+					'google_override_cache' => @$this->dyn_select['override'],
+					'google_override_modrewrite' => @$this->dyn_select['override'],
+					'google_override_gzip' => @$this->dyn_select['override'],
+					'google_override_limit' => @$this->dyn_select['override'],
+					'google_override_sort' => @$this->dyn_select['override'],
+					'google_override_pagination' => @$this->dyn_select['override'],
+				),
+			),
+			'main' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GOOGLE_MAIN',
+					'vars'	=> array(
+						// URL Settings
+						'legend1'	=> 'GOOGLE_URL',
+						'google_url'	=> array('lang' => 'GOOGLE_URL', 'validate' => 'string', 'type' => 'text:35:200', 'explain' => true),
+						// Link Settings
+						'legend2'	=> 'GOOGLE_LINKS_ACTIVATION',
+						'google_link_main'	=> array('lang' => 'GOOGLE_LINKS_MAIN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_link_index' => array('lang' => 'GOOGLE_LINKS_INDEX', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'google_link_cat' => array('lang' => 'GOOGLE_LINKS_CAT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						// Auth settings
+						'legend3'	=> 'GOOGLE_AUTH_SETTINGS',
+						'google_allow_auth' => array('lang' => 'GOOGLE_ALLOW_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'google_cache_auth' => array('lang' => 'GOOGLE_CACHE_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						// Ping
+						'legend4' => 'GOOGLE_PING',
+						'google_ping' => array('lang' => 'GOOGLE_PING', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						// Styling
+						'legend5' => 'GYM_STYLE',
+						'google_xslt'	=> array('lang' => 'GOOGLE_XSLT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'google_load_phpbb_css' => array('lang' => 'GOOGLE_LOAD_PHPBB_CSS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						// Threshold
+						'legend6' => 'GOOGLE_THRESHOLD',
+						'google_threshold' => array('lang' => 'GOOGLE_THRESHOLD', 'validate' => 'int:1:100', 'type' => 'text:4:4', 'explain' => true),
+						// Priorities
+						'legend7' => 'GOOGLE_PRIORITIES',
+						'google_default_priority' => array('lang' => 'GOOGLE_DEFAULT_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true,),
+					)
+				),
+				'default' => array(
+					'google_url' => $phpbb_seo->seo_path['phpbb_url'],
+					'google_link_main' => 1,
+					'google_link_index' => 1,
+					'google_link_cat' => 1,
+					'google_allow_auth' => 0,
+					'google_cache_auth' => 1,
+					'google_ping' => 0,
+					'google_xslt'	=> 1,
+					'google_load_phpbb_css'	=> 0,
+					'google_threshold' => 10,
+					'google_default_priority' => 1.0,
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GYM_GOOGLE',
+				'lang_file' => 'gym_google',
+				'actions' => array( 'main', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination', 'override',),
+				'mode' => 'google',
+				'module' => 'main'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/google_forum.php
===================================================================
--- gym_sitemaps/acp/google_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/google_forum.php	(Premod 3.0.8)
@@ -0,0 +1,170 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_forum.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_forum {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function google_forum(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = & $this->gym_master->dyn_select;
+			$this->gym_master->forum_select();
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config, display vars + default values and select options
+	* @access private
+	*/
+	function acp_module() {
+		return array(
+			'cache' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_CACHE',
+						'google_forum_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_forum_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_forum_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_forum_showstats'	=> array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_cache_on' => 0,
+					'google_forum_cache_force_gzip' => 0,
+					'google_forum_cache_max_age' => 24,
+					'google_forum_showstats' => 1,
+				),
+			),
+			'modrewrite' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'google_forum_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_forum_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_modrewrite' => 0,
+					'google_forum_modrtype' => 0,
+				),
+				'select' => array(
+					'google_forum_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_GZIP',
+						'google_forum_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_forum_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_gzip' => 0,
+					'google_forum_gzip_ext' => 1,
+				),
+			),
+			'limit' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_LIMIT',
+						'google_forum_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:50000', 'type' => 'text:6:6', 'explain' => true, 'overriding' => true),
+						'google_forum_sql_limit' => array('lang' => 'GYM_SQL_LIMIT', 'validate' => 'int:0:2500', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_url_limit' => 2500,
+					'google_forum_sql_limit' => 150,
+				),
+			),
+			'sort' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'google_forum_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_sort' => 'DESC',
+				),
+				'select' => array(
+					'google_forum_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_PAGINATION',
+						'google_forum_pagination' => array('lang' => 'GYM_PAGINATION_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'google_forum_limitdown' => array('lang' => 'GYM_LIMITDOWN', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+						'google_forum_limitup' => array('lang' => 'GYM_LIMITUP', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_pagination' => 1,
+					'google_forum_limitdown' => 3,
+					'google_forum_limitup' => 5,
+				),
+			),
+			'main' => array(
+				'display_vars' => array(
+					'title'	=> 'GOOGLE_FORUM_SETTINGS',
+					'vars'	=> array(
+						'legend1' => 'GOOGLE_PRIORITIES',
+						'google_forum_sticky_priority' => array('lang' => 'GOOGLE_FORUM_STICKY_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true,),
+						'google_forum_announce_priority' => array('lang' => 'GOOGLE_FORUM_ANNOUCE_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true,),
+						'google_forum_global_priority' => array('lang' => 'GOOGLE_FORUM_GLOBAL_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true,),
+						'google_forum_default_priority' => array('lang' => 'GOOGLE_DEFAULT_PRIORITY', 'type' => 'custom', 'validate' => 'string', 'method' => 'validate_num', 'params' => array('{CONFIG_VALUE}', '{KEY}', 2, 0, 1),  'explain' => true, 'overriding' => true),
+						'legend2' => 'GOOGLE_FORUM_EXCLUDE',
+						'google_forum_exclude' => array('lang' => 'GOOGLE_FORUM_EXCLUDE', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple_string', 'explain' => true),
+						'legend3' => 'GOOGLE_PING',
+						'google_forum_ping' => array('lang' => 'GOOGLE_PING', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'google_forum_sticky_priority' => 0.75,
+					'google_forum_announce_priority' => 0.75,
+					'google_forum_global_priority' => 0.75,
+					'google_forum_default_priority' => 1.0,
+					'google_forum_exclude' => '',
+					'google_forum_ping' => 0,
+				),
+				'select' => array(
+					'google_forum_exclude' => @$this->dyn_select['forums'],
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GOOGLE_FORUM',
+				'lang_file' => 'google_forum',
+				'actions' => array( 'main', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination',),
+				'mode' => 'google',
+				'module' => 'forum'
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/.htaccess
===================================================================
--- gym_sitemaps/acp/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/acp/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/acp/html_main.php
===================================================================
--- gym_sitemaps/acp/html_main.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/html_main.php	(Premod 3.0.8)
@@ -0,0 +1,314 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: html_main.php 134 2009-11-02 11:13:45Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* html_main Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class html_main {
+	var $gym_master;
+	var $dyn_select = array();
+	var $lang_iso639 = array();
+	var $html_override = array();
+	/**
+	* constuctor
+	*/
+	function html_main(&$gym_master) {
+		global $user;
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->html_override = $this->gym_master->dyn_select['override'];
+			unset($this->html_override[OVERRIDE_GLOBAL]);
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* retunrs the acp config
+	* @access private
+	*/
+	function acp_module() {
+		global $config, $phpbb_seo, $user, $phpEx;
+		$config['sitename'] = utf8_normalize_nfc($config['sitename']);
+		$config['site_desc'] = utf8_normalize_nfc($config['site_desc']);
+		return array(
+			'cache' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_CACHE',
+					'vars'	=> array(
+						'legend1'	=> 'HTML_CACHE',
+						'html_main_cache_on'	=> array('lang' => 'HTML_MAIN_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_main_cache_ttl' => array('lang' => 'HTML_MAIN_CACHE_TTL', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true),
+						'html_opt_cache_on'	=> array('lang' => 'HTML_OPT_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_opt_cache_ttl' => array('lang' => 'HTML_OPT_CACHE_TTL', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'html_main_cache_on'	=> 0,
+					'html_opt_cache_on'	=> 0,
+					'html_opt_cache_ttl' => 6,
+					'html_main_cache_ttl'	=> 6,
+				),
+			),
+			'modrewrite' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_MODREWRITE',
+						'html_modrewrite'	=> array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+						'html_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_modrewrite' => 0,
+					'html_modrtype' => 0,
+				),
+				'select' => array(
+					'html_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend4'	=> 'GYM_GZIP',
+						'html_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+ 					'html_gzip' => 0,
+				),
+			),
+			'limit' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_URL_LIMIT',
+						'html_rss_news_limit' => array('lang' => 'HTML_RSS_NEWS_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true),
+						'legend2'	=> 'GYM_TIME_LIMIT',
+						'html_map_time_limit' => array('lang' => 'HTML_MAP_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true),
+						'html_cat_time_limit' => array('lang' => 'HTML_CAT_MAP_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true),
+						'html_news_time_limit' => array('lang' => 'HTML_NEWS_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true),
+						'html_cat_news_time_limit' => array('lang' => 'HTML_CAT_NEWS_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'html_rss_news_limit' => 10,
+					'html_map_time_limit' => 0,
+					'html_cat_time_limit' => 0,
+					'html_news_time_limit' => 0,
+					'html_cat_news_time_limit' => 0,
+				),
+			),
+			'sort' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'html_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_cat_sort' => array('lang' => 'HTML_CAT_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_news_sort' => array('lang' => 'HTML_NEWS_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+						'html_cat_news_sort' => array('lang' => 'HTML_CAT_NEWS_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'overriding' => true),
+					),
+				),
+				'default' => array(
+					'html_sort' => 'DESC',
+					'html_cat_sort' => 'DESC',
+					'html_news_sort' => 'DESC',
+					'html_cat_news_sort' => 'DESC',
+				),
+				'select' => array(
+					'html_sort' => @$this->dyn_select['sort'],
+					'html_cat_sort' => @$this->dyn_select['sort'],
+					'html_news_sort' => @$this->dyn_select['sort'],
+					'html_cat_news_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'HTML_PAGINATION_GEN',
+						'html_pagination' => array('lang' => 'HTML_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'html_pagination_limit' => array('lang' => 'HTML_PAGINATION_LIMIT', 'validate' => 'int:0:100', 'type' => 'text:4:4', 'explain' => true, ),
+						'html_news_pagination' => array('lang' => 'HTML_NEWS_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'html_news_pagination_limit' => array('lang' => 'HTML_NEWS_PAGINATION_LIMIT', 'validate' => 'int:0:50', 'type' => 'text:4:4', 'explain' => true,),
+						'legend2' => 'HTML_PAGINATION_SPEC',
+						'html_item_pagination' => array('lang' => 'HTML_ITEM_PAGINATION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'html_pagination' => 1,
+					'html_pagination_limit' => 25,
+					'html_news_pagination' => 1,
+					'html_news_pagination_limit' => 10,
+					'html_item_pagination' => 0,
+				),
+			),
+			'override' => array(
+ 				'display_vars' => array(
+					'title'	=> 'GYM_OVERRIDE',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_OVERRIDE',
+						'html_override'	=> array('lang' => 'GYM_OVERRIDE_MAIN', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_cache'	=> array('lang' => 'GYM_OVERRIDE_CACHE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_modrewrite'	=> array('lang' => 'GYM_OVERRIDE_MODREWRITE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_gzip'	=> array('lang' => 'GYM_OVERRIDE_GZIP','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_limit'	=> array('lang' => 'GYM_OVERRIDE_LIMIT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_sort'	=> array('lang' => 'GYM_OVERRIDE_SORT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_override_pagination'	=> array('lang' => 'GYM_OVERRIDE_PAGINATION','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+					),
+				),
+				'default' => array(
+ 					'html_override'	=> OVERRIDE_MODULE,
+					'html_override_cache' => OVERRIDE_OTYPE,
+					'html_override_modrewrite' => OVERRIDE_OTYPE,
+					'html_override_gzip' => OVERRIDE_GLOBAL,
+					'html_override_limit' => OVERRIDE_OTYPE,
+					'html_override_sort' => OVERRIDE_MODULE,
+					'html_override_pagination' => OVERRIDE_OTYPE,
+				),
+				'select' => array(
+					'html_override' => $this->html_override,
+					'html_override_cache' => $this->html_override,
+					'html_override_modrewrite' => @$this->dyn_select['override'],
+					'html_override_gzip' => @$this->dyn_select['override'],
+					'html_override_limit' => $this->html_override,
+					'html_override_sort' => @$this->dyn_select['override'],
+					'html_override_pagination' => $this->html_override,
+				),
+			),
+			'main' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_MAIN',
+					'vars'	=> array(
+						// URL Settings
+						'legend1'	=> 'HTML_URL',
+						'html_url'	=> array('lang' => 'HTML_URL', 'validate' => 'string',	'type' => 'text:40:255', 'explain' => true),
+						// Link Settings
+						'legend2'	=> 'HTML_LINKS_ACTIVATION',
+						'html_link_main'	=> array('lang' => 'HTML_LINKS_MAIN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'html_link_index' => array('lang' => 'HTML_LINKS_INDEX', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'html_link_cat' => array('lang' => 'HTML_LINKS_CAT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						// Settings
+						'legend3'	=> 'HTML_SETTINGS',
+						'html_allow_map' => array('lang' => 'HTML_ALLOW_MAP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_allow_cat_map' => array('lang' => 'HTML_ALLOW_CAT_MAP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_sitename' => array('lang' => 'HTML_SITENAME', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true),
+						'html_site_desc' => array('lang' => 'HTML_SITE_DESC', 'validate' => 'string', 'type' => 'textarea:6:50', 'explain' => true),
+						'html_c_info' => array('lang' => 'HTML_C_INFO', 'validate' => 'string', 'type' => 'text:40:255', 'explain' => true),
+						'html_logo_url' => array('lang' => 'HTML_LOGO_URL', 'validate' => 'string', 'type' => 'text:25:200', 'explain' => true),
+						'html_stats_on_news' => array('lang' => 'HTML_STATS_ON_NEWS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_stats_on_map' => array('lang' => 'HTML_STATS_ON_MAP', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_birthdays_on_news' => array('lang' => 'HTML_BIRTHDAYS_ON_NEWS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_birthdays_on_map' => array('lang' => 'HTML_BIRTHDAYS_ON_MAP', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_disp_online' => array('lang' => 'HTML_DISP_ONLINE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_disp_tracking' => array('lang' => 'HTML_DISP_TRACKING', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_disp_status' => array('lang' => 'HTML_DISP_STATUS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true),
+						'html_allow_profile' => array('lang' => 'HTML_ALLOW_PROFILE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_allow_profile_links' => array('lang' => 'HTML_ALLOW_PROFILE_LINKS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						// Auth settings
+						'legend4'	=> 'HTML_AUTH_SETTINGS',
+						'html_allow_auth' => array('lang' => 'HTML_ALLOW_AUTH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'html_url' => $phpbb_seo->seo_path['phpbb_url'],
+					'html_link_main' => 1,
+					'html_link_index' => 1,
+					'html_link_cat' => 1,
+					'html_allow_map' => 1,
+					'html_allow_cat_map' => 1,
+ 					'html_c_info' => $config['sitename'],
+					'html_sitename' => $config['sitename'],
+					'html_site_desc' => $config['site_desc'],
+					'html_logo_url' => '',
+					'html_disp_online' => 'globalmod',
+					'html_disp_tracking' => 'reg',
+					'html_disp_status' => 'reg',
+					'html_allow_profile' => 'none',
+					'html_allow_profile_links' => 'reg',
+					'html_allow_auth' => 1,
+					'html_stats_on_news' => 'all',
+					'html_stats_on_map' => 'all',
+					'html_birthdays_on_news' => 'reg',
+					'html_birthdays_on_map' => 'reg',
+				),
+				'select' => array(
+					'html_disp_online' => @$this->dyn_select['gym_auth'],
+					'html_disp_tracking' => @$this->dyn_select['gym_auth'],
+					'html_disp_status' => @$this->dyn_select['gym_auth'],
+					'html_allow_profile' => @$this->dyn_select['gym_auth'],
+					'html_allow_profile_links' => @$this->dyn_select['gym_auth'],
+					'html_stats_on_news' => @$this->dyn_select['gym_auth'],
+					'html_stats_on_map' => @$this->dyn_select['gym_auth'],
+					'html_birthdays_on_news' => @$this->dyn_select['gym_auth'],
+					'html_birthdays_on_map' => @$this->dyn_select['gym_auth'],
+				),
+			),
+			'content' => array(
+ 				'display_vars' => array(
+					'title'	=> 'HTML_NEWS',
+					'vars'	=> array(
+						// News
+						'legend1'	=> 'HTML_NEWS',
+						'html_allow_news' => array('lang' => 'HTML_ALLOW_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_allow_cat_news' => array('lang' => 'HTML_ALLOW_CAT_NEWS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'html_rss_news_url'	=> array('lang' => 'HTML_RSS_NEWS_URL', 'validate' => 'string',	'type' => 'text:40:255', 'explain' => true),
+						// News content
+						'legend2'	=> 'HTML_NEWS_CONTENT',
+						'html_allow_bbcode' => array('lang' => 'HTML_ALLOW_BBCODE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_strip_bbcode' => array('lang' => 'HTML_STRIP_BBCODE', 'validate' => 'string', 'type' => 'text:30:200', 'explain' => true),
+						'html_allow_links' =>  array('lang' => 'HTML_ALLOW_LINKS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_allow_emails' => array('lang' => 'HTML_ALLOW_EMAILS', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_allow_smilies' => array('lang' => 'HTML_ALLOW_SMILIES', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_allow_sig' => array('lang' => 'HTML_ALLOW_SIG', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'html_sumarize' => array('lang' => 'HTML_SUMARIZE', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'html_sumarize_method' => array('lang' => 'HTML_SUMARIZE_METHOD', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					// Content
+					'html_allow_news' => 1,
+					'html_allow_cat_news' => 1,
+					'html_rss_news_url' => (!empty($this->gym_master->gym_config['rss_url']) ? $this->gym_master->gym_config['rss_url'] : $phpbb_seo->seo_path['phpbb_url']) . "gymrss.$phpEx?news&amp;digest",
+					'html_allow_bbcode' => 'all',
+					'html_strip_bbcode' => '',
+					'html_allow_links' =>  'all',
+					'html_allow_emails' => 'none',
+					'html_allow_smilies' => 'all',
+					'html_allow_sig' => 'reg',
+					'html_sumarize' => 75,
+					'html_sumarize_method' => 'words',
+				),
+				'select' => array(
+					'html_sumarize_method' => @$this->dyn_select['sumarize_method'],
+					'html_allow_bbcode' => @$this->dyn_select['gym_auth'],
+					'html_allow_links' =>  @$this->dyn_select['gym_auth'],
+					'html_allow_emails' => @$this->dyn_select['gym_auth'],
+					'html_allow_smilies' => @$this->dyn_select['gym_auth'],
+					'html_allow_sig' => @$this->dyn_select['gym_auth'],
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GYM_HTML',
+				'lang_file' => 'gym_html',
+				'actions' => array('main', 'content', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination', 'override',),
+				'mode' => 'rss',
+				'module' => 'main',
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/acp/main_main.php
===================================================================
--- gym_sitemaps/acp/main_main.php	(phpBB 3.0.8)
+++ gym_sitemaps/acp/main_main.php	(Premod 3.0.8)
@@ -0,0 +1,216 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: main_main.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* main_main Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class main_main {
+	var $gym_master;
+	var $dyn_select = array();
+	/**
+	* constuctor
+	*/
+	function main_main(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		if (isset($this->gym_master->dyn_select) ) {
+			$this->dyn_select = $this->gym_master->dyn_select;
+		}
+	}
+	/**
+	* acp_module()
+	* returns the acp config
+	* @access private
+	*/
+	function acp_module() {
+		return array(
+			'cache' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_CACHE',
+					'vars'	=> array(
+						'legend1' => 'GYM_CACHE',
+						'gym_mod_since'	=> array('lang' => 'GYM_MOD_SINCE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_cache_on'	=> array('lang' => 'GYM_CACHE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_cript_cache' => array('lang' => 'GYM_CRITP_CACHE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_cache_force_gzip' => array('lang' => 'GYM_CACHE_FORCE_GZIP', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_cache_max_age' => array('lang' => 'GYM_CACHE_MAX_AGE', 'validate' => 'string', 'type' => 'text:4:4', 'explain' => true,),
+						'gym_cache_auto_regen' => array('lang' => 'GYM_CACHE_AUTO_REGEN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'gym_showstats' => array('lang' => 'GYM_SHOWSTATS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'gym_mod_since'	=> 0,
+					'gym_cache_on'	=> 0,
+					'gym_cript_cache' => 1,
+					'gym_cache_force_gzip' => 0,
+					'gym_cache_max_age' => 24,
+					'gym_cache_auto_regen' => 1,
+					'gym_showstats' => 1,
+				),
+			),
+			'modrewrite' => array(
+			       	'display_vars' => array(
+					'title'	=> 'GYM_MODREWRITE',
+					'vars'	=> array(
+						'legend1' => 'GYM_MODREWRITE',
+						'gym_modrewrite' => array('lang' => 'GYM_MODREWRITE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_modrtype' => array('lang' => 'GYM_MODRTYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_zero_dupe' => array('lang' => 'GYM_ZERO_DUPE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'gym_modrewrite' => 0,
+					'gym_modrtype' => 0,
+					'gym_zero_dupe' => 0,
+				),
+				'select' => array(
+					'gym_modrtype' => @$this->dyn_select['modrtype'],
+				),
+			),
+			'gzip' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_GZIP',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_GZIP',
+						'gym_gzip' => array('lang' => 'GYM_GZIP_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_gzip_level' => array('lang' => 'GYM_GZIP_LEVEL', 'validate' => 'int:1:9', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_gzip_ext' => array('lang' => 'GYM_GZIP_EXT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+					),
+				),
+				'default' => array(
+					'gym_gzip' => 0,
+					'gym_gzip_level' => 6,
+					'gym_gzip_ext' => 1,
+				),
+				'select' => array(
+					'gym_gzip_level' => array(1 => 1, 2 => 2, 3 => 3, 4 => 4, 5 => 5, 6 => 6, 7 => 7, 8 => 8, 9 => 9),
+				),
+			),
+			'limit' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_LIMIT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_LIMIT',
+						'gym_url_limit' => array('lang' => 'GYM_URL_LIMIT', 'validate' => 'int:0:5000', 'type' => 'text:4:4', 'explain' => true,),
+						'gym_sql_limit' => array('lang' => 'GYM_SQL_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+						'gym_time_limit' => array('lang' => 'GYM_TIME_LIMIT', 'validate' => 'int:0:1000', 'type' => 'text:4:4', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'gym_url_limit' => 150,
+					'gym_sql_limit' => 25,
+					'gym_time_limit' => 60,
+				),
+			),
+			'sort' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_SORT',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_SORT',
+						'gym_sort' => array('lang' => 'GYM_SORT_TYPE', 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'gym_sort' => 'DESC',
+				),
+				'select' => array(
+					'gym_sort' => @$this->dyn_select['sort'],
+				),
+			),
+			'pagination' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_PAGINATION',
+					'vars'	=> array(
+						'legend1'	=> 'GYM_PAGINATION',
+						'gym_pagination' => array('lang' => 'GYM_PAGINATION_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+						'gym_limitdown' => array('lang' => 'GYM_LIMITDOWN', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true,),
+						'gym_limitup' => array('lang' => 'GYM_LIMITUP', 'validate' => 'int:0', 'type' => 'text:4:4', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'gym_pagination' => 1,
+					'gym_limitdown' => 3,
+					'gym_limitup' => 5,
+				),
+			),
+			'override' => array(
+				'display_vars' => array(
+					'title'	=> 'GYM_OVERRIDE',
+					'vars'	=> array(
+						'legend'	=> 'GYM_OVERRIDE',
+						'gym_override'	=> array('lang' => 'GYM_OVERRIDE_ON', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'gym_override_cache'	=> array('lang' => 'GYM_OVERRIDE_CACHE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_override_modrewrite'	=> array('lang' => 'GYM_OVERRIDE_MODREWRITE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_override_gzip'	=> array('lang' => 'GYM_OVERRIDE_GZIP','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_override_limit'	=> array('lang' => 'GYM_OVERRIDE_LIMIT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_override_sort'	=> array('lang' => 'GYM_OVERRIDE_SORT','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+						'gym_override_pagination'	=> array('lang' => 'GYM_OVERRIDE_PAGINATION','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'gym_override' => 1,
+					'gym_override_cache' => OVERRIDE_OTYPE,
+					'gym_override_modrewrite' => OVERRIDE_GLOBAL,
+					'gym_override_gzip' => OVERRIDE_GLOBAL,
+					'gym_override_limit' => OVERRIDE_OTYPE,
+					'gym_override_sort' => OVERRIDE_OTYPE,
+					'gym_override_pagination' => OVERRIDE_OTYPE,
+				),
+				'select' => array(
+					'gym_override_cache' => @$this->dyn_select['override'],
+					'gym_override_modrewrite' => @$this->dyn_select['override'],
+					'gym_override_gzip' => @$this->dyn_select['override'],
+					'gym_override_limit' => @$this->dyn_select['override'],
+					'gym_override_sort' => @$this->dyn_select['override'],
+					'gym_override_pagination' => @$this->dyn_select['override'],
+				),
+			),
+			'main' => array(
+				'display_vars' => array(
+					'title'	=> 'MAIN_MAIN',
+					'vars'	=> array(
+						'legend'	=> 'GYM_LINKS_ACTIVATION',
+						'gym_link_main'	=> array('lang' => 'GYM_LINKS_MAIN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'gym_link_index' => array('lang' => 'GYM_LINKS_INDEX', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+						'gym_link_cat' => array('lang' => 'GYM_LINKS_CAT', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,),
+					),
+				),
+				'default' => array(
+					'gym_link_main' => 1,
+					'gym_link_index' => 1,
+					'gym_link_cat' => 1,
+				),
+			),
+			'info' => array(
+				'title_lang' => 'GYM_MAIN',
+				'lang_file' => '',
+				'actions' => array('main', 'cache', 'modrewrite', 'gzip', 'limit', 'sort', 'pagination', 'override'),
+				'mode' => 'main',
+				'module' => 'main',
+				'select' => array(
+					'gym_override_cache' => @$this->dyn_select['override'],
+					'gym_override_modrewrite' => @$this->dyn_select['override'],
+					'gym_override_gzip' => @$this->dyn_select['override'],
+					'gym_override_limit' => @$this->dyn_select['override'],
+					'gym_override_sort' => @$this->dyn_select['override'],
+					'gym_override_pagination' => @$this->dyn_select['override'],
+					'gym_sort' => @$this->dyn_select['sort'],
+					'gym_modrtype' => @$this->dyn_select['modrtype'],
+					'gym_gzip_level' => @$this->dyn_select['gzip_level'],
+				),
+			),
+		);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/cache/.htaccess
===================================================================
--- gym_sitemaps/cache/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/cache/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/sources/xml_google_external.php
===================================================================
--- gym_sitemaps/sources/xml_google_external.php	(phpBB 3.0.8)
+++ gym_sitemaps/sources/xml_google_external.php	(Premod 3.0.8)
@@ -0,0 +1,40 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: xml_google_external.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+ * Please note :
+ *
+ * 	If you want to include here sitemaps from a different domain than
+ * 	the one used by GYM, you will have to declare it in the source domain's
+ * 	robots.txt.
+ *
+ * Example :
+ *
+ *	www.host1.com with Sitemap file sitemap-host1.xml
+ *	To include the sitemaps in GYM's one (http://www.sitemaphost.com/sitemap-host1.xml)
+ *	you need to add :
+ *
+ *		Sitemap: http://www.sitemaphost.com/sitemap-host1.xml
+ *
+ *	In www.host1.com's robots.txt.
+ *
+ * Otherwise, the sitemap will be refused.
+ *
+ * http://www.sitemaps.org/protocol.php#sitemaps_cross_submits
+ */
+$external_setup = array(
+	// Pattern : name => url
+	// Each name must be unique and must not match an .xml file name (google_(name).xml)
+	// 'site-map_name' => 'http://www.example.com/sitemap.xml',
+);
+?>
\ No newline at end of file
Index: gym_sitemaps/sources/.htaccess
===================================================================
--- gym_sitemaps/sources/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/sources/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/display/display_posts.php
===================================================================
--- gym_sitemaps/display/display_posts.php	(phpBB 3.0.8)
+++ gym_sitemaps/display/display_posts.php	(Premod 3.0.8)
@@ -0,0 +1,656 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: display_posts.php 254 2010-03-12 15:08:58Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* display_posts Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class display_posts {
+	function display_posts(&$master) {
+		global $user, $template, $config, $phpEx, $db, $auth, $phpbb_root_path, $cache;
+		static $bbcode;
+		static $display_orders = array('first' => 't.topic_id', 'last' => 't.topic_last_post_time');
+		global $phpbb_seo;
+		// Usefull for multi bb topic & forum tracking
+		// Leave default for single forum eg : '_track'
+		$tracking_cookie_name = (defined('XLANG_AKEY') ? XLANG_AKEY : '') . '_track';
+		$forum_read_auth = & $master->actions['auth_view_read'];
+		// Specific options
+		$display_file = &$master->call['display_file'];
+		$display_user_info = &$master->call['display_user_info'];
+		$display_user_link = !empty($master->call['display_user_link']) ? true : false;
+		$display_user_link_key = $display_user_link ? 'full' : 'no_profile';
+		$display_link = &$master->call['display_link'];
+		$display_pagination = &$master->call['display_pagination'];
+		$display_tracking = &$master->call['display_tracking'];
+		$display_sig = !empty($master->call['display_sig']) ? (boolean) ($config['allow_sig'] && $user->optionget('viewsigs')) : false;
+		$display_order = isset($display_orders[$master->call['display_order']]) ? $display_orders[$master->call['display_order']] : $display_orders['first'];
+		$display_post_buttons = &$master->call['display_post_buttons'];
+		$display_sumarize = &$master->call['display_sumarize'];
+		$limit_time_sql = !empty($master->call['limit_time']) ? ' AND t.topic_last_post_time > ' . ($user->time_now - $master->call['limit_time']) : '';
+		$order_sql = @$master->call['sort'] == 'ASC' ? ' ASC' : ' DESC';
+		if (!$display_tracking) {
+			$load_db_lastread = $load_anon_lastread = false;
+		} else {
+			$load_db_lastread = (boolean) ($config['load_db_lastread'] && $user->data['is_registered']);
+			$load_anon_lastread = (boolean) ($config['load_anon_lastread'] || $user->data['is_registered']);
+		}
+		// hanlde options
+		$limit = $master->call['limit'] >= 1 ? (int) $master->call['limit'] : 5;
+		$start = &$master->start;
+		if (!$display_pagination || empty($display_file)) {
+			$start = 0;
+			$display_pagination = false;
+		}
+		$total_topics = 0;
+		$topic_sql = $master->call['topic_sql'];
+		$forum_sql = $master->call['forum_sql'];
+		$s_global = $master->call['s_global'];
+		$bbcode_bitfield = '';
+		// Do some reset
+		$topic_datas = $topic_ids = $forum_ids = $user_cache = $id_cache = $post_datas = $forum_datas = array();
+		$forum_id = $master->call['forum_id'];
+		$now = getdate(time() + $user->timezone + $user->dst - date('Z'));
+		// Get The Data, first forums
+		if ((!$s_global && !$master->call['single_forum']) || ($master->call['single_forum'] && empty($master->forum_datas[$master->call['forum_id']])) ) {
+			$sql_array = array(
+				'SELECT'	=> 'f.*',
+				'FROM'		=> array(
+					FORUMS_TABLE	=> 'f',
+				),
+				'LEFT_JOIN' => array(),
+			);
+			if ($load_db_lastread) {
+				$sql_array['SELECT'] .= ', ft.mark_time as forum_mark_time';
+				$sql_array['LEFT_JOIN'][] = array(
+					'FROM'	=> array(FORUMS_TRACK_TABLE => 'ft'),
+					'ON'	=> 'ft.user_id = ' . $user->data['user_id'] . ' AND ft.forum_id = f.forum_id'
+				);
+			}
+			$sql_array['WHERE'] = $forum_sql ? str_replace('t.forum_id', 'f.forum_id', $forum_sql) : '';
+			$sql = $db->sql_build_query('SELECT', $sql_array);
+			unset($sql_array);
+			$result = $db->sql_query($sql);
+			while ($row = $db->sql_fetchrow($result)) {
+				$forum_id = (int) $row['forum_id'];
+				$forum_datas[$forum_id] = $row;
+			}
+			$db->sql_freeresult($result);
+		}
+		// Now the topics
+		$sql_array = array(
+			'SELECT'	=> 't.*',
+			'FROM'		=> array(
+				TOPICS_TABLE	=> 't',
+			),
+			'LEFT_JOIN' => array(),
+		);
+		if ($load_db_lastread) {
+			$sql_array['SELECT'] .= ', tt.mark_time';
+			$sql_array['LEFT_JOIN'][] = array(
+				'FROM'	=> array(TOPICS_TRACK_TABLE => 'tt'),
+				'ON'	=> 'tt.user_id = ' . $user->data['user_id'] . ' AND tt.topic_id = t.topic_id'
+			);
+		} elseif ($load_anon_lastread && empty($master->tracking_topics)) {
+			$master->tracking_topics = (isset($_COOKIE[$config['cookie_name'] . $tracking_cookie_name])) ? ((STRIP) ? stripslashes($_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : $_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : '';
+			$master->tracking_topics = ($master->tracking_topics) ? tracking_unserialize($master->tracking_topics) : array();
+			if (!$user->data['is_registered']) {
+				$user->data['user_lastmark'] = (isset($master->tracking_topics['l'])) ? (int) (base_convert($master->tracking_topics['l'], 36, 10) + $config['board_startdate']) : 0;
+			}
+		}
+		$sql_where = ($forum_sql ? $forum_sql : '') . $limit_time_sql;
+		$sql_where .= $topic_sql ? ($sql_where ? ' AND ' : '') . $topic_sql : '';
+		$sql_where .= ($sql_where ? ' AND ' : '') . 't.topic_status <> ' . ITEM_MOVED;
+		if ($master->call['single_forum']) {
+			$sql_where .= $auth->acl_get('m_approve', $master->call['forum_id']) ? '' : ' AND t.topic_approved = 1';
+		} else {
+			// only admins and global moderators will see un-approved topics
+			// in the forum they have access to.
+			$sql_where .= ($auth->acl_gets('a_') || $auth->acl_getf_global('m_')) ? '' : ' AND t.topic_approved = 1';
+		}
+		// obtain correct topic count if we display pagination
+		if ($display_pagination) {
+			$sql = "SELECT COUNT(t.topic_id) AS num_topics
+				FROM " . TOPICS_TABLE . " t
+				WHERE $sql_where";
+			$result = $db->sql_query($sql);
+			$total_topics = (int) $db->sql_fetchfield('num_topics');
+			$db->sql_freeresult($result);
+			// Make sure $start is set to the last page if it exceeds the amount
+			if ($start < 0 || $start > $total_topics) {
+				$start = ($start < 0) ? 0 : floor(($total_topics - 1) / $limit) * $limit;
+				// Since we've reached here, $start is not set proper, kill the dupe!
+				$url = $display_file . $master->gym_master->html_add_start($start);
+				$master->gym_master->seo_kill_dupes($url);
+			}
+		}
+		$sql_array['WHERE'] = $sql_where;
+		$sql_array['ORDER_BY'] = $display_order . $order_sql;
+		$sql = $db->sql_build_query('SELECT', $sql_array);
+		unset($sql_array);
+		$result = $db->sql_query_limit($sql, $limit, $start);
+		// First we parse the basic data
+		while ($row = $db->sql_fetchrow($result)) {
+			$forum_id = (int) $row['forum_id'];
+			$topic_id = (int) $row['topic_id'];
+			// Start with the forum
+			if (!$s_global && empty($master->forum_datas[$forum_id])) {
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				$phpbb_seo->set_url($forum_datas[$forum_id]['forum_name'], $forum_id, 'forum');
+				// www.phpBB-SEO.com SEO TOOLKIT END
+				$master->forum_datas[$forum_id] = array_merge($forum_datas[$forum_id],  array(
+					'forum_url' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+					'm_approve' => $auth->acl_get('m_approve', $forum_id),
+				));
+				if ($load_db_lastread) {
+					$master->forum_tracking_info[$forum_id] = !empty($forum_datas[$forum_id]['forum_mark_time']) ? $forum_datas[$forum_id]['forum_mark_time'] : $user->data['user_lastmark'];
+				} elseif ($load_anon_lastread) {
+					$master->forum_tracking_info[$forum_id] = isset($master->tracking_topics['f'][$forum_id]) ? (int) (base_convert($master->tracking_topics['f'][$forum_id], 36, 10) + $config['board_startdate']) : $user->data['user_lastmark'];
+				}
+			}
+			if (empty($master->forum_tracking_info[$forum_id])) {
+				if ($load_db_lastread) {
+					$master->topic_tracking_info[$topic_id] = !empty($row['mark_time']) ? $row['mark_time'] : $user->data['user_lastmark'];
+				} else if ($load_anon_lastread) {
+					$topic_id36 = base_convert($topic_id, 10, 36);
+					if (isset($master->tracking_topics['t'][$topic_id36])) {
+						$master->tracking_topics['t'][$topic_id] = base_convert($master->tracking_topics['t'][$topic_id36], 36, 10) + $config['board_startdate'];
+					}
+					$master->topic_tracking_info[$topic_id] = isset($master->tracking_topics['t'][$topic_id]) ? $master->tracking_topics['t'][$topic_id] : $user->data['user_lastmark'];
+				}
+			} else {
+				$master->topic_tracking_info[$topic_id] = $master->forum_tracking_info[$forum_id];
+			}
+			// Topic post count
+			$row['replies'] = !empty($master->forum_datas[$forum_id]['m_approve']) ? $row['topic_replies_real'] : $row['topic_replies'];
+			$row['enable_icons'] = !empty($master->forum_datas[$forum_id]['enable_icons']);
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id]);
+			// www.phpBB-SEO.com SEO TOOLKIT END
+			$topic_datas[$forum_id][$topic_id] = $row;
+			// @TODO deal with last post case ?
+			$topic_ids[$topic_id] = /*$master->call['display_order'] == 'first' ?*/ $row['topic_first_post_id'] /*: $row['topic_last_post_id']*/;
+			$forum_ids[$topic_id] = $forum_id;
+		}
+		$db->sql_freeresult($result);
+		unset($forum_datas);
+		// Let's go
+		$has_result = false;
+		if (!empty($topic_datas)) {
+			$has_result = true;
+			$bbcode_filter = false;
+			if (!class_exists('bbcode')) {
+				global $phpbb_root_path, $phpEx;
+				include_once($phpbb_root_path . 'includes/bbcode.' . $phpEx);
+			}
+			$patterns = $replaces = array();
+			if ( !empty($master->module_config['html_msg_filters']['pattern']) ) {
+				$patterns = $master->module_config['html_msg_filters']['pattern'];
+				$replaces = $master->module_config['html_msg_filters']['replace'];
+				$bbcode_filter = true;
+			}
+			// Grab ranks
+			$ranks = $cache->obtain_ranks();
+			// Grab icons
+			if (empty($master->icons)) {
+				$master->icons = $cache->obtain_icons();
+			}
+			// Go ahead and pull all data for these topics
+			$sql_array = array();
+			$sql_array['SELECT'] = $sql_array['WHERE'] = '';
+			if ($display_user_info) {
+				$sql_array['SELECT'] = 'u.*, z.friend, z.foe, ';
+				$sql_array['FROM'] = array(USERS_TABLE => 'u');
+				$sql_array['LEFT_JOIN'] = array(
+					array(
+						'FROM'	=> array(ZEBRA_TABLE => 'z'),
+						'ON'	=> 'z.user_id = ' . $user->data['user_id'] . ' AND z.zebra_id = p.poster_id'
+					)
+				);
+				$sql_array['WHERE'] = 'AND u.user_id = p.poster_id';
+			}
+			$sql_array['SELECT'] .= 'p.*';
+			$sql_array['FROM'][POSTS_TABLE] = 'p';
+			$sql_array['WHERE'] = $db->sql_in_set('p.post_id', $topic_ids) . $sql_array['WHERE'];
+			$sql = $db->sql_build_query('SELECT', $sql_array);
+			$result = $db->sql_query($sql);
+			while ($row = $db->sql_fetchrow($result)) {
+				$forum_id = (int) $row['forum_id'];
+				$topic_id = (int) $row['topic_id'];
+				// Define the global bbcode bitfield, will be used to load bbcodes
+				$bbcode_bitfield = $bbcode_bitfield | base64_decode($row['bbcode_bitfield']);
+				// Only compute profile data if required
+				if ($display_user_info) {
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					$phpbb_seo->set_user_url( $row['username'], $row['poster_id'] );
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					// Is a signature attached? Are we going to display it?
+					if ($display_sig && $row['enable_sig']) {
+						$bbcode_bitfield = $bbcode_bitfield | base64_decode($row['user_sig_bbcode_bitfield']);
+					}
+				} else {
+					// @TODO deal with last post case ?
+					$row['user_id'] = $row['poster_id'];
+					$row['username'] = $topic_datas[$forum_id][$topic_id]['topic_first_poster_name'];
+					$row['user_colour'] = $topic_datas[$forum_id][$topic_id]['topic_first_poster_colour'];
+				}
+				$poster_id = (int) $row['poster_id'];
+				$post_datas[$forum_id][$topic_id] = array(
+						'hide_post' => false,
+						'post_id' => $row['post_id'],
+						'post_time' => $row['post_time'],
+						'user_id' => $row['user_id'],
+						'username' => $row['username'],
+						'user_colour' => $row['user_colour'],
+						'topic_id' => $row['topic_id'],
+						'forum_id' => $row['forum_id'],
+						'post_subject' => $row['post_subject'],
+						'post_edit_count' => $row['post_edit_count'],
+						'post_edit_time' => $row['post_edit_time'],
+						'post_edit_reason' => $row['post_edit_reason'],
+						'post_edit_user' => $row['post_edit_user'],
+						// Make sure the icon actually exists
+						'icon_id' => (isset($master->icons[$row['icon_id']]['img'], $master->icons[$row['icon_id']]['height'], $master->icons[$row['icon_id']]['width'])) ? $row['icon_id'] : 0,
+						'post_attachment' => $row['post_attachment'],
+						'post_approved' => $row['post_approved'],
+						'post_reported' => $row['post_reported'],
+						'post_username' => $row['post_username'],
+						'post_text' => $row['post_text'],
+						'bbcode_uid' => $row['bbcode_uid'],
+						'bbcode_bitfield' => $row['bbcode_bitfield'],
+						'enable_smilies' => $row['enable_smilies'],
+						'enable_sig' => $row['enable_sig'],
+						'friend' => false,
+						'foe' => false,
+				);
+				// Cache various user specific data ... so we don't have to recompute
+				// this each time the same user appears on this page
+				if (!isset($user_cache[$poster_id])) {
+					if ($poster_id == ANONYMOUS || !$display_user_info) {
+						$user_cache[$poster_id] = array(
+							'joined' => '',
+							'posts' => '',
+							'from' => '',
+							'sig' => '',
+							'sig_bbcode_uid' => '',
+							'sig_bbcode_bitfield' => '',
+							'online' => false,
+							'avatar' => '',
+							'rank_title' => '',
+							'rank_image' => '',
+							'rank_image_src' => '',
+							'profile' => '',
+							'pm' => '',
+							'email' => '',
+							'www' => '',
+							'icq_status_img' => '',
+							'icq' => '',
+							'aim' => '',
+							'msn' => '',
+							'yim' => '',
+							'jabber' => '',
+							'search' => '',
+							'age' => '',
+							'username' => $row['username'],
+							'user_colour' => $row['user_colour'],
+							'warnings' => 0,
+							'allow_pm' => 0,
+						);
+					} else {
+						$user_sig = '';
+						// We add the signature to every posters entry because enable_sig is post dependant
+						if ($display_sig && $row['user_sig'] ) {
+							$user_sig = $row['user_sig'];
+						}
+						$id_cache[] = $poster_id;
+						$user_cache[$poster_id] = array(
+							'joined' => $user->format_date($row['user_regdate']),
+							'posts' => $row['user_posts'],
+							'warnings' => (isset($row['user_warnings'])) ? $row['user_warnings'] : 0,
+							'from' => (!empty($row['user_from'])) ? $row['user_from'] : '',
+							'sig' => $user_sig,
+							'sig_bbcode_uid' => (!empty($row['user_sig_bbcode_uid'])) ? $row['user_sig_bbcode_uid'] : '',
+							'sig_bbcode_bitfield' => (!empty($row['user_sig_bbcode_bitfield'])) ? $row['user_sig_bbcode_bitfield'] : '',
+							'viewonline' => $row['user_allow_viewonline'],
+							'allow_pm' => $row['user_allow_pm'],
+							'avatar' => ($user->optionget('viewavatars')) ? $master->gym_master->get_user_avatar($row['user_avatar'], $row['user_avatar_type'], $row['user_avatar_width'], $row['user_avatar_height']) : '',
+							'age' => '',
+							'rank_title' => '',
+							'rank_image' => '',
+							'rank_image_src' => '',
+							'username' => $row['username'],
+							'user_colour' => $row['user_colour'],
+							'online' => false,
+							'profile' => append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=viewprofile&amp;u=$poster_id"),
+							'www' => $row['user_website'],
+							'aim' => ($row['user_aim'] && $auth->acl_get('u_sendim')) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=contact&amp;action=aim&amp;u=$poster_id") : '',
+							'msn' => ($row['user_msnm'] && $auth->acl_get('u_sendim')) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=contact&amp;action=msnm&amp;u=$poster_id") : '',
+							'yim' => ($row['user_yim']) ? 'http://edit.yahoo.com/config/send_webmesg?.target=' . urlencode($row['user_yim']) . '&amp;.src=pg' : '',
+							'jabber' => ($row['user_jabber'] && $auth->acl_get('u_sendim')) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=contact&amp;action=jabber&amp;u=$poster_id") : '',
+							'search' => ($auth->acl_get('u_search')) ? append_sid("{$phpbb_root_path}search.$phpEx", "author_id=$poster_id&amp;sr=posts") : '',
+						);
+						$master->gym_master->get_user_rank($row['user_rank'], $row['user_posts'], $user_cache[$poster_id]['rank_title'], $user_cache[$poster_id]['rank_image'], $user_cache[$poster_id]['rank_image_src']);
+						if (!empty($row['user_allow_viewemail']) || $auth->acl_get('a_email')) {
+							$user_cache[$poster_id]['email'] = ($config['board_email_form'] && $config['email_enable']) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=email&amp;u=$poster_id") : (($config['board_hide_emails'] && !$auth->acl_get('a_email')) ? '' : 'mailto:' . $row['user_email']);
+						} else {
+							$user_cache[$poster_id]['email'] = '';
+						}
+						if (!empty($row['user_icq'])) {
+							$user_cache[$poster_id]['icq'] = 'http://www.icq.com/people/webmsg.php?to=' . $row['user_icq'];
+							$user_cache[$poster_id]['icq_status_img'] = '<img src="http://web.icq.com/whitepages/online?icq=' . $row['user_icq'] . '&amp;img=5" width="18" height="18" alt="" />';
+						} else {
+							$user_cache[$poster_id]['icq_status_img'] = '';
+							$user_cache[$poster_id]['icq'] = '';
+						}
+						if ($config['allow_birthdays'] && !empty($row['user_birthday'])) {
+							list($bday_day, $bday_month, $bday_year) = array_map('intval', explode('-', $row['user_birthday']));
+							if ($bday_year) {
+								$diff = $now['mon'] - $bday_month;
+								if ($diff == 0) {
+									$diff = ($now['mday'] - $bday_day < 0) ? 1 : 0;
+								} else {
+									$diff = ($diff < 0) ? 1 : 0;
+								}
+								$user_cache[$poster_id]['age'] = (int) ($now['year'] - $bday_year - $diff);
+							}
+						}
+					}
+					$user_cache[$poster_id]['post_author_full'] = get_username_string($display_user_link_key, $poster_id, $row['username'], $row['user_colour'], $row['post_username']);
+					$user_cache[$poster_id]['post_author_colour'] = get_username_string('colour', $poster_id, $row['username'], $row['user_colour'], $row['post_username']);
+					$user_cache[$poster_id]['post_author'] = get_username_string('username', $poster_id, $row['username'], $row['user_colour'], $row['post_username']);
+					$user_cache[$poster_id]['u_post_author'] = $display_user_link ? get_username_string('profile', $poster_id, $row['username'], $row['user_colour'], $row['post_username']) : '';
+				}
+			}
+			$db->sql_freeresult($result);
+			// Load custom profile fields
+			if ($display_user_info && $config['load_cpf_viewtopic']) {
+				include($phpbb_root_path . 'includes/functions_profile_fields.' . $phpEx);
+				$cp = new custom_profile();
+				// Grab all profile fields from users in id cache for later use - similar to the poster cache
+				$profile_fields_cache = $cp->generate_profile_fields_template('grab', $id_cache);
+			}
+			// Generate online information for user
+			if (@$master->call['display_online'] && sizeof($id_cache)) {
+				$sql = 'SELECT session_user_id, MAX(session_time) as online_time, MIN(session_viewonline) AS viewonline
+					FROM ' . SESSIONS_TABLE . '
+					WHERE ' . $db->sql_in_set('session_user_id', $id_cache) . '
+					GROUP BY session_user_id';
+				$result = $db->sql_query($sql);
+				$update_time = $config['load_online_time'] * 60;
+				while ($row = $db->sql_fetchrow($result)) {
+					$user_cache[$row['session_user_id']]['online'] = (time() - $update_time < $row['online_time'] && (($row['viewonline']) || $auth->acl_get('u_viewonline'))) ? true : false;
+				}
+				$db->sql_freeresult($result);
+			}
+			unset($id_cache);
+			// Instantiate BBCode
+			if (empty($bbcode)) {
+				$bbcode = new bbcode(base64_encode($bbcode_bitfield));
+			} else {
+				$bbcode->bbcode(base64_encode($bbcode_bitfield));
+			}
+			$prev_post_id = '';
+			// Parse messages
+			foreach ($forum_ids as $topic_id => $forum_id) {
+				if (!isset($post_datas[$forum_id][$topic_id])) {
+					continue;
+				}
+				$row =& $post_datas[$forum_id][$topic_id];
+				$topic_data =& $topic_datas[$forum_id][$topic_id];
+				$poster_id = (int) $row['user_id'];
+				$l_edited_by = $l_bumped_by = '';
+				$s_first_unread = false;
+				// End signature parsing, only if needed
+				if (@$user_cache[$poster_id]['sig'] && $row['enable_sig'] && empty($user_cache[$poster_id]['sig_parsed'])) {
+					$user_cache[$poster_id]['sig'] = censor_text($user_cache[$poster_id]['sig']);
+					if ($user_cache[$poster_id]['sig_bbcode_bitfield']) {
+						if ( $bbcode_filter ) {
+							$user_cache[$poster_id]['sig'] = preg_replace($patterns, $replaces, $user_cache[$poster_id]['sig']);
+						}
+						$bbcode->bbcode_second_pass($user_cache[$poster_id]['sig'], $user_cache[$poster_id]['sig_bbcode_uid'], $user_cache[$poster_id]['sig_bbcode_bitfield']);
+					}
+					$user_cache[$poster_id]['sig'] = bbcode_nl2br($user_cache[$poster_id]['sig']);
+					$user_cache[$poster_id]['sig'] = $master->gym_master->smiley_text($user_cache[$poster_id]['sig'], !$master->module_config['html_allow_smilies']);
+					$user_cache[$poster_id]['sig_parsed'] = true;
+				} else { // Remove sig
+					$user_cache[$poster_id]['sig'] = '';
+				}
+				// Parse the message and subject
+				$message = &$row['post_text'];
+				if ( $bbcode_filter ) {
+					$message = preg_replace($patterns, $replaces, $message);
+				}
+				if ($display_sumarize > 0 ) {
+					$message = $master->gym_master->summarize( $message, $display_sumarize, $master->call['display_sumarize_method'] );
+					// Clean broken tag at the end of the message
+					$message = preg_replace('`\<[^\<\>]*$`i', ' ...', $message);
+					// Close broken bbcode tags requiring it, only quotes for now
+					$master->gym_master->close_bbcode_tags($message, $row['bbcode_uid']);
+				}
+				// Parse the message and subject
+				$message = censor_text($message);
+				// Second parse bbcode here
+				if ($row['bbcode_bitfield']) {
+					$bbcode->bbcode_second_pass($message, $row['bbcode_uid'], $row['bbcode_bitfield']);
+				}
+				$message = bbcode_nl2br($message);
+				$message = $master->gym_master->smiley_text($message, !$master->module_config['html_allow_smilies']);
+				if ($display_sumarize > 0 ) { // Clean up
+					static $find = array('`\<\!--[^\<\>]+--\>`Ui', '`\[\/?[^\]\[]*\]`Ui');
+					$message = preg_replace($find, '', $message);
+				}
+				// Replace naughty words such as farty pants
+				$row['post_subject'] = censor_text(!empty($row['post_subject']) ? $row['post_subject'] : $topic_data['topic_title']);
+				// custom profile fields
+				$cp_row = array();
+				if ($display_user_info && $config['load_cpf_viewtopic']) {
+					$cp_row = (isset($profile_fields_cache[$poster_id])) ? $cp->generate_profile_fields_template('show', false, $profile_fields_cache[$poster_id]) : array();
+				}
+				$post_unread = (isset($topic_tracking_info[$topic_id]) && $row['post_time'] > $topic_tracking_info[$topic_id]) ? true : false;
+				// Generate all the URIs ...
+				if (!$s_global && !isset($master->module_config['global_exclude_list'][$forum_id])) {
+					$view_topic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id") . '#p' . $row['post_id'];
+					$view_forum_url = $master->forum_datas[$forum_id]['forum_url'];
+				} else {
+					$view_topic_url = $view_forum_url = '';
+				}
+				$postrow = array(
+					'FORUM_NAME' => !$s_global ? $master->forum_datas[$forum_id]['forum_name'] : '',
+					'U_VIEW_FORUM' => $view_forum_url,
+					'VIEWS' => $topic_data['topic_views'],
+					'POST_DATE' => $user->format_date($row['post_time']),
+					'POST_SUBJECT' => $row['post_subject'],
+					'MESSAGE' => $message,
+					'EDITED_MESSAGE' => $l_edited_by,
+					'EDIT_REASON' => $row['post_edit_reason'],
+					'BUMPED_MESSAGE' => $l_bumped_by,
+					'MINI_POST_IMG' => ($post_unread) ? $user->img('icon_post_target_unread', 'NEW_POST') : $user->img('icon_post_target', 'POST'),
+					'POST_ICON_IMG' => ($topic_data['enable_icons'] && !empty($row['icon_id'])) ? $master->icons[$row['icon_id']]['img'] : '',
+					'POST_ICON_IMG_WIDTH' => ($topic_data['enable_icons'] && !empty($row['icon_id'])) ? $master->icons[$row['icon_id']]['width'] : '',
+					'POST_ICON_IMG_HEIGHT' => ($topic_data['enable_icons'] && !empty($row['icon_id'])) ? $master->icons[$row['icon_id']]['height'] : '',
+					'U_MCP_REPORT' => ($auth->acl_get('m_report', $forum_id)) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=reports&amp;mode=report_details&amp;f=' . $forum_id . '&amp;p=' . $row['post_id'], true, $user->session_id) : '',
+					'U_MCP_APPROVE' => ($auth->acl_get('m_approve', $forum_id)) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=queue&amp;mode=approve_details&amp;f=' . $forum_id . '&amp;p=' . $row['post_id'], true, $user->session_id) : '',
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					'U_MINI_POST' => $view_topic_url,
+					'U_NEWEST_POST' => $post_unread ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' .  $forum_id . '&amp;t=' . $topic_id . '&amp;view=unread#unread') : '',
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					//'U_NEXT_POST_ID' => ($i < $i_total && isset($rowset[$post_list[$i + 1]])) ? $rowset[$post_list[$i + 1]]['post_id'] : '',
+					//'U_PREV_POST_ID' => $prev_post_id,
+
+					'POST_ID' => $row['post_id'],
+					'POSTER_ID' => $poster_id,
+					'S_HAS_ATTACHMENTS' => (!empty($attachments[$row['post_id']])) ? true : false,
+					'S_POST_UNAPPROVED' => ($row['post_approved']) ? false : true,
+					'S_POST_REPORTED' => ($row['post_reported'] && $auth->acl_get('m_report', $forum_id)) ? true : false,
+					'S_DISPLAY_NOTICE' => 0 /*$display_notice && $row['post_attachment']*/,
+					'S_FRIEND' => ($row['friend']) ? true : false,
+					'S_UNREAD_POST' => $post_unread,
+					//'S_FIRST_UNREAD' => $s_first_unread,
+					'S_CUSTOM_FIELDS' => (isset($cp_row['row']) && sizeof($cp_row['row'])) ? true : false,
+					'S_TOPIC_POSTER' => ($topic_data['topic_poster'] == $poster_id) ? true : false,
+					'S_IGNORE_POST' => ($row['hide_post']) ? true : false,
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					'L_IGNORE_POST' => ($row['hide_post']) ? sprintf($user->lang['POST_BY_FOE'], get_username_string('full', $poster_id, $row['username'], $row['user_colour'], $row['post_username']), '<a href="' . append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;p={$row['post_id']}&amp;view=show") . '#p' . $row['post_id'] . '">', '</a>') : '',
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					'REPLIES' => $topic_datas[$forum_id][$topic_id]['replies'],
+				);
+				if ($display_user_info) {
+					$postrow += array(
+						'POST_AUTHOR_FULL' => $user_cache[$poster_id]['post_author_full'],
+						'POST_AUTHOR_COLOUR' => $user_cache[$poster_id]['post_author_colour'],
+						'POST_AUTHOR' => $user_cache[$poster_id]['post_author'],
+						'U_POST_AUTHOR' => $user_cache[$poster_id]['u_post_author'],
+						'SIGNATURE' => $user_cache[$poster_id]['sig'],
+						'RANK_TITLE' => $user_cache[$poster_id]['rank_title'],
+						'RANK_IMG' => $user_cache[$poster_id]['rank_image'],
+						'RANK_IMG_SRC' => $user_cache[$poster_id]['rank_image_src'],
+						'POSTER_JOINED' => $user_cache[$poster_id]['joined'],
+						'POSTER_POSTS' => $user_cache[$poster_id]['posts'],
+						'POSTER_FROM' => $user_cache[$poster_id]['from'],
+						'POSTER_AVATAR' => $user_cache[$poster_id]['avatar'],
+						'POSTER_WARNINGS' => $user_cache[$poster_id]['warnings'],
+						'POSTER_AGE' => $user_cache[$poster_id]['age'],
+						'ICQ_STATUS_IMG' => $user_cache[$poster_id]['icq_status_img'],
+						'ONLINE_IMG' => ($poster_id == ANONYMOUS || !$config['load_onlinetrack']) ? '' : (($user_cache[$poster_id]['online']) ? $user->img('icon_user_online', 'ONLINE') : $user->img('icon_user_offline', 'OFFLINE')),
+						'S_ONLINE' => ($poster_id == ANONYMOUS || !$config['load_onlinetrack']) ? false : (($user_cache[$poster_id]['online']) ? true : false),
+						'U_PROFILE' => $user_cache[$poster_id]['profile'],
+						'U_SEARCH' => $user_cache[$poster_id]['search'],
+						'U_PM' => ($poster_id != ANONYMOUS && $config['allow_privmsg'] && $auth->acl_get('u_sendpm') && ($user_cache[$poster_id]['allow_pm'] || $auth->acl_gets('a_', 'm_') || $auth->acl_getf_global('m_'))) ? append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;mode=compose&amp;action=quotepost&amp;p=' . $row['post_id']) : '',
+						'U_EMAIL' => $user_cache[$poster_id]['email'],
+						'U_WWW' => $user_cache[$poster_id]['www'],
+						'U_ICQ' => $user_cache[$poster_id]['icq'],
+						'U_AIM' => $user_cache[$poster_id]['aim'],
+						'U_MSN' => $user_cache[$poster_id]['msn'],
+						'U_YIM' => $user_cache[$poster_id]['yim'],
+						'U_JABBER' => $user_cache[$poster_id]['jabber'],
+
+					);
+				}
+				if ($display_post_buttons) {
+					$postrow += array(
+						'U_EDIT' => (!$user->data['is_registered']) ? '' : ((($user->data['user_id'] == $poster_id && $auth->acl_get('f_edit', $forum_id) && ($row['post_time'] > time() - ($config['edit_time'] * 60) || !$config['edit_time'])) || $auth->acl_get('m_edit', $forum_id)) ? append_sid("{$phpbb_root_path}posting.$phpEx", "mode=edit&amp;f=$forum_id&amp;p={$row['post_id']}") : ''),
+						'U_QUOTE' => ($auth->acl_get('f_reply', $forum_id)) ? append_sid("{$phpbb_root_path}posting.$phpEx", "mode=quote&amp;f=$forum_id&amp;p={$row['post_id']}") : '',
+						'U_INFO' => ($auth->acl_get('m_info', $forum_id)) ? append_sid("{$phpbb_root_path}mcp.$phpEx", "i=main&amp;mode=post_details&amp;f=$forum_id&amp;p=" . $row['post_id'], true, $user->session_id) : '',
+						'U_DELETE' => (!$user->data['is_registered']) ? '' : ((($user->data['user_id'] == $poster_id && $auth->acl_get('f_delete', $forum_id) && $topic_data['topic_last_post_id'] == $row['post_id'] && ($row['post_time'] > time() - ($config['edit_time'] * 60) || !$config['edit_time'])) || $auth->acl_get('m_delete', $forum_id)) ? append_sid("{$phpbb_root_path}posting.$phpEx", "mode=delete&amp;f=$forum_id&amp;p={$row['post_id']}") : ''),
+						'U_REPORT' => ($auth->acl_get('f_report', $forum_id)) ? append_sid("{$phpbb_root_path}report.$phpEx", 'f=' . $forum_id . '&amp;p=' . $row['post_id']) : '',
+						'U_NOTES' => ($auth->acl_getf_global('m_')) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=notes&amp;mode=user_notes&amp;u=' . $poster_id, true, $user->session_id) : '',
+						'U_WARN' => ($auth->acl_get('m_warn') && $poster_id != $user->data['user_id'] && $poster_id != ANONYMOUS) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=warn&amp;mode=warn_post&amp;f=' . $forum_id . '&amp;p=' . $row['post_id'], true, $user->session_id) : '',
+					);
+				}
+				if (isset($cp_row['row']) && sizeof($cp_row['row'])) {
+					$postrow = array_merge($postrow, $cp_row['row']);
+				}
+				// Dump vars into template
+				$template->assign_block_vars('postrow', $postrow);
+				if (!empty($cp_row['blockrow'])) {
+					foreach ($cp_row['blockrow'] as $field_data) {
+						$template->assign_block_vars('postrow.custom_fields', $field_data);
+					}
+				}
+				// Display not already displayed Attachments for this post, we already parsed them. ;)
+				if (!empty($attachments[$row['post_id']])) {
+					foreach ($attachments[$row['post_id']] as $attachment) {
+						$template->assign_block_vars('postrow.attachment', array(
+							'DISPLAY_ATTACHMENT'	=> $attachment)
+						);
+					}
+				}
+				$prev_post_id = $row['post_id'];
+				unset($topic_datas[$forum_id][$topic_id]);
+			}
+			unset($topic_datas, $user_cache);
+		}
+		$news_desc = false;
+		$rules_info = array('forum_rules' => false, 'forum_rules_link' => false);
+		// In case we are listing category's children
+		if ($master->call['cat_forum']) {
+			$forum_id = $master->call['cat_forum'];
+		}
+		if ($master->call['display_desc']) {
+			$news_desc = !empty($master->module_config['html_site_desc']) ? $master->module_config['html_site_desc'] : '';
+			if ($master->call['single_forum'] || $master->call['cat_forum']) {
+				$news_desc = $master->generate_forum_info($master->forum_datas[$forum_id]);
+			}
+		}
+		if ($master->call['display_rules'] && ($master->call['single_forum'] || $master->call['cat_forum']) ) {
+			$rules_info = $master->generate_forum_info($master->forum_datas[$forum_id], 'rules');
+		}
+		$tpl_vars = array(
+			'H1_POSTS' => $master->outputs['page_title'],
+			'DISPLAY_POSTS_H1' => $display_link,
+			'U_POSTS' => $display_link ? append_sid($display_file) : false,
+			'DISPLAY_USER_INFO' => $display_user_info,
+			'DISPLAY_POSTS' => $has_result,
+			'DISPLAY_POST_BUTTONS' => $display_post_buttons,
+			'NEWS_DESC' => $news_desc,
+			'NEWS_RULES' => $rules_info['forum_rules'],
+			'NEWS_RULES_LINK' => $rules_info['forum_rules_link'],
+			'REPORTED_IMG' => $user->img('icon_topic_reported', 'POST_REPORTED'),
+			'UNAPPROVED_IMG' => $user->img('icon_topic_unapproved', 'POST_UNAPPROVED'),
+			'T_ICONS_PATH' => "{$phpbb_root_path}{$config['icons_path']}/",
+			'NEWS_IMG_SRC' => $master->gym_master->path_config['gym_img_url'] . 'html_news.gif',
+		);
+		if ($master->call['single_forum'] || $master->call['cat_forum']) {
+			$tpl_vars += array(
+				'FORUM_MAP_URL' => $master->module_config['html_allow_cat_map'] ? append_sid($master->gym_master->html_build_url('html_forum_cat_map', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)) : '',
+				'FORUM_MAP' => sprintf($user->lang['HTML_MAP_OF'], $master->forum_datas[$forum_id]['forum_name']),
+				'FORUM_URL' => $master->forum_datas[$forum_id]['forum_url'],
+				'FORUM_NAME' => $master->forum_datas[$forum_id]['forum_name'],
+				'S_SINGLE_FORUM' => $master->call['cat_forum'] ? false : true,
+			);
+		} else {
+			$tpl_vars += array(
+				'FORUM_MAP' => sprintf($user->lang['HTML_MAP_OF'], $master->module_config['html_sitename']),
+				'FORUM_MAP_URL' => $master->module_config['html_allow_map'] ? append_sid($master->module_config['html_url'] . $master->url_settings['html_forum_map']) : '',
+				'FORUM_URL' => append_sid("{$phpbb_root_path}index.$phpEx"),
+				'FORUM_NAME' => $master->module_config['html_sitename'],
+			);
+		}
+		if ($display_user_info) {
+			$tpl_vars += array(
+				'PROFILE_IMG' => $user->img('icon_user_profile', 'READ_PROFILE'),
+				'SEARCH_IMG' => $user->img('icon_user_search', 'SEARCH_USER_POSTS'),
+				'PM_IMG' => $user->img('icon_contact_pm', 'SEND_PRIVATE_MESSAGE'),
+				'EMAIL_IMG' => $user->img('icon_contact_email', 'SEND_EMAIL'),
+				'WWW_IMG' => $user->img('icon_contact_www', 'VISIT_WEBSITE'),
+				'ICQ_IMG' => $user->img('icon_contact_icq', 'ICQ'),
+				'AIM_IMG' => $user->img('icon_contact_aim', 'AIM'),
+				'MSN_IMG' => $user->img('icon_contact_msnm', 'MSNM'),
+				'YIM_IMG' => $user->img('icon_contact_yahoo', 'YIM'),
+				'JABBER_IMG' => $user->img('icon_contact_jabber', 'JABBER'),
+			);
+		}
+		if ($display_post_buttons) {
+			$tpl_vars += array(
+				'QUOTE_IMG' => $user->img('icon_post_quote', 'REPLY_WITH_QUOTE'),
+				'EDIT_IMG' => $user->img('icon_post_edit', 'EDIT_POST'),
+				'DELETE_IMG' => $user->img('icon_post_delete', 'DELETE_POST'),
+				'INFO_IMG' => $user->img('icon_post_info', 'VIEW_INFO'),
+				'REPORT_IMG' => $user->img('icon_post_report', 'REPORT_POST'),
+				'WARN_IMG' => $user->img('icon_user_warn', 'WARN_USER'),
+			);
+		}
+		if ($display_pagination) {
+			$l_total_topic_s = ($total_topics == 0) ? 'TOTAL_TOPICS_ZERO' : 'TOTAL_TOPICS_OTHER';
+			$tpl_vars += array(
+				'DISPLAY_PAGINATION'	=> generate_pagination(append_sid($display_file), $total_topics, $limit, $start),
+				'DISPLAY_PAGE_NUMBER'	=> on_page($total_topics, $limit, $start),
+				'DISPLAY_TOTAL_TOPICS' => sprintf($user->lang[$l_total_topic_s], $total_topics),
+			);
+		}
+		$template->assign_vars($tpl_vars);
+		unset($tpl_vars);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/display/display_forums.php
===================================================================
--- gym_sitemaps/display/display_forums.php	(phpBB 3.0.8)
+++ gym_sitemaps/display/display_forums.php	(Premod 3.0.8)
@@ -0,0 +1,343 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: display_forums.php 254 2010-03-12 15:08:58Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* display_forums Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class display_forums {
+	function display_forums(&$master) {
+		global $user, $template, $config, $phpEx, $db, $auth, $cache, $phpbb_root_path;
+		global $phpbb_seo;
+		static $tpl = array(
+			'link' => '<a href="%1$s" title="%3$s">%2$s</a>',
+			'img' => '<img src="%1$s" alt="%2$s"/>'
+		);
+		// Usefull for multi bb topic & forum tracking
+		// Leave default for single forum eg : '_track'
+		$tracking_cookie_name = (defined('XLANG_AKEY') ? XLANG_AKEY : '') . '_track';
+		// Specific options
+		$display_file = &$master->call['display_file'];
+		$display_user_info = &$master->call['display_user_info'];
+		$display_link = &$master->call['display_link'];
+		$display_pagination = &$master->call['display_pagination'];
+		$display_tracking = &$master->call['display_tracking'];
+		$display_topic_status = &$master->call['display_topic_status'];
+		$display_user_link = !empty($master->call['display_user_link']) ? true : false;
+		$display_user_link_key = $display_user_link ? 'full' : 'no_profile';
+		$display_last_post = &$master->call['display_last_post'];
+		$forum_sql = &$master->call['forum_sql'];
+		$forum_read_auth = & $master->actions['auth_view_read'];
+		$forum_list_auth = & $master->actions['auth_view_list'];
+		if (!$display_tracking) {
+			$load_db_lastread = $load_anon_lastread = false;
+		} else {
+			$load_db_lastread = (boolean) ($config['load_db_lastread'] && $user->data['is_registered']);
+			$load_anon_lastread = (boolean) ($config['load_anon_lastread'] || $user->data['is_registered']);
+		}
+		// Do some reset
+		$forum_datas = $forum_ids = $sub_forums = array();
+		$sql_array = array(
+			'SELECT'	=> 'f.*',
+			'FROM'		=> array(
+				FORUMS_TABLE	=> 'f',
+			),
+			'LEFT_JOIN' => array(),
+			'WHERE' => $forum_sql,
+			'ORDER_BY' => 'f.left_id ASC',
+		);
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+		if (!empty($phpbb_seo->seo_opt['no_dupe']['on'])) {
+			$sql_array['SELECT'] .= ', t.topic_id, t.topic_title, t.topic_replies, t.topic_replies_real, t.topic_status, t.topic_type, t.topic_moved_id' . (!empty($phpbb_seo->seo_opt['sql_rewrite']) ? ', t.topic_url ' : ' ');
+			$sql_array['LEFT_JOIN'][] = array(
+				'FROM'	=> array(TOPICS_TABLE => 't'),
+				'ON'	=> "t.topic_last_post_id = f.forum_last_post_id"
+			);
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
+		if ($load_db_lastread) {
+			$sql_array['SELECT'] .= ', ft.mark_time as forum_mark_time';
+			$sql_array['LEFT_JOIN'][] = array(
+				'FROM'	=> array(FORUMS_TRACK_TABLE => 'ft'),
+				'ON'	=> 'ft.user_id = ' . $user->data['user_id'] . ' AND ft.forum_id = f.forum_id'
+			);
+		} elseif ($load_anon_lastread && empty($master->tracking_topics)) {
+			$master->tracking_topics = (isset($_COOKIE[$config['cookie_name'] . $tracking_cookie_name])) ? ((STRIP) ? stripslashes($_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : $_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : '';
+			$master->tracking_topics = ($master->tracking_topics) ? tracking_unserialize($master->tracking_topics) : array();
+			if (!$user->data['is_registered']) {
+				$user->data['user_lastmark'] = (isset($master->tracking_topics['l'])) ? (int) (base_convert($master->tracking_topics['l'], 36, 10) + $config['board_startdate']) : 0;
+			}
+		}
+		$right = 0;
+		$level_store = array(0 => 0);
+		$processed = array();
+		$level = $last_level = 0;
+		$html = $html_before = $html_after = '';
+		$separator = ' &nbsp; ';
+		$news_img = sprintf($tpl['img'], $master->gym_master->path_config['gym_img_url'] . 'html_news.gif', $user->lang['HTML_NEWS']);
+		$map_img = sprintf($tpl['img'], $master->gym_master->path_config['gym_img_url'] . 'maps-icon.gif', $user->lang['HTML_MAP']);
+		$subf_img = $user->img('subforum_read', 'NO_NEW_POSTS');
+		$sql = $db->sql_build_query('SELECT', $sql_array);
+		unset($sql_array);
+		$result = $db->sql_query_limit($sql, 600);
+		while ($row = $db->sql_fetchrow($result)) {
+			$forum_id = (int) $row['forum_id'];
+			//@TODO Find why in hell the above query could return more than one row per forum
+			if (isset($processed[$forum_id])) {
+				continue;
+			}
+			$processed[$forum_id] = $forum_id;
+			$is_cat = $row['parent_id'] == 0 ? true : false;
+			if (empty($master->forum_datas[$forum_id])) {
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				$phpbb_seo->seo_url['forum'][$forum_id] = $phpbb_seo->set_url($row['forum_name'], $forum_id, 'forum');
+				// www.phpBB-SEO.com SEO TOOLKIT END
+				$master->forum_datas[$forum_id] = array_merge($row,
+					array(
+						'm_approve' => $auth->acl_get('m_approve', $forum_id),
+						'forum_name' => !empty($row['forum_name']) ? $row['forum_name'] : '',
+						'forum_status' => !empty($row['forum_status']) ? $row['forum_status'] : '',
+						'forum_last_post_time' => !empty($row['forum_last_post_time']) ? $row['forum_last_post_time'] : 0,
+						'enable_icons' => !empty($row['enable_icons']) ? $row['enable_icons'] : 0,
+						'forum_url' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+					)
+				);
+				if ($load_db_lastread) {
+					$master->forum_tracking_info[$forum_id] = !empty($row['forum_mark_time']) ? $row['forum_mark_time'] : $user->data['user_lastmark'];
+				} elseif ($load_anon_lastread) {
+					$master->forum_tracking_info[$forum_id] = isset($master->tracking_topics['f'][$forum_id]) ? (int) (base_convert($master->tracking_topics['f'][$forum_id], 36, 10) + $config['board_startdate']) : $user->data['user_lastmark'];
+				}
+			}
+			$master->forum_datas[$forum_id]['forum_news_url'] = $master->forum_datas[$forum_id]['forum_map_url'] = '';
+			if (!isset($root_forum_id)) {
+				$root_forum_id = $forum_id;
+				$sub_forums[$root_forum_id] = '';
+			}
+			$parent_id = (int) $row['parent_id'];
+			if ($row['left_id'] < $right) {
+				$level++;
+				$level_store[$parent_id] = $level;
+			} else if ($row['left_id'] > $right + 1) {
+				if (isset($level_store[$parent_id])) {
+					$level = $level_store[$parent_id];
+				} else {
+					$level = 0;
+				}
+			}
+			$right = (int) $row['right_id'];
+			if ($level > 1) { // sub forums
+				if ($level > $last_level) { // going one or several level down
+					$diff = $level - $last_level;
+					$html_before = str_repeat("\n<ul><li>", $diff );
+					$html_after = "";
+				}
+				if ($level < $last_level) { // Going one or several level up
+					$diff = $last_level - $level;
+					$html_before = str_repeat("</li></ul>\n", $diff ) . "</li>\n<li>";
+					$html_after = "";
+				}
+				if ($level == $last_level) { // Adding a link at the same level
+					$html_before = isset($forum_list_auth[$forum_id]) ? "</li>\n<li>" : '';
+					$html_after = "";
+				}
+				if ($display_tracking) {
+					$forum_unread = (isset($master->forum_tracking_info[$forum_id]) && $master->forum_datas[$forum_id]['forum_last_post_time'] > $master->forum_tracking_info[$forum_id]) ? true : false;
+					if ($forum_unread) {
+						$folder_image = 'subforum_unread';
+						$folder_alt = 'NEW_POSTS';
+					} else {
+						$folder_image = 'subforum_read';
+						$folder_alt = 'NO_NEW_POSTS';
+					}
+					$subf_img = $user->img($folder_image, $folder_alt);
+				}
+				$link = '';
+				if (isset($forum_list_auth[$forum_id])) {
+					if (!empty($row['forum_topics']) && (isset($forum_read_auth[$forum_id]) || $is_cat)) {
+						if ($master->module_config['html_allow_cat_news']) {
+							$title = sprintf($user->lang['HTML_NEWS_OF'], $row['forum_name']);
+							$link = isset($forum_read_auth[$forum_id]) ? sprintf($tpl['link'], append_sid($master->module_config['html_url'] . $master->gym_master->html_build_url('html_forum_cat_news', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)), $news_img . ' ' . $title, $title) : $title;
+						}
+						if ($master->module_config['html_allow_cat_map']) {
+							$title = sprintf($user->lang['HTML_MAP_OF'], $row['forum_name']);
+							$link .= $separator . (isset($forum_read_auth[$forum_id]) ? sprintf($tpl['link'], append_sid($master->module_config['html_url'] . $master->gym_master->html_build_url('html_forum_cat_map', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)), $map_img . ' ' . $title, $title) : $title);
+						}
+					} else {
+						$title = $link = '<b>' . $row['forum_name'] . '</b>';
+					}
+				}
+				$sub_forums[$root_forum_id] .= $html_before . $link . $html_after;
+
+			} else {
+				$forum_datas[$forum_id] = array_merge(array('level' => $level), $row);
+				$forum_ids[$forum_id] = $forum_id;
+				if (($level < $last_level)) { // We went up in this root forum
+					$_level = $level > 0 ? 0 : 1;
+					$sub_forums[$root_forum_id] .= str_repeat("</li></ul>\n", ($last_level - $level - $_level));
+				}
+				if ($level == 1) { // next root forum
+					$root_forum_id = $forum_id;
+					$sub_forums[$root_forum_id] = '';
+				}
+			}
+			$last_level = $level;
+		}
+		unset($processed);
+		if (!empty($sub_forums[$root_forum_id]) && ($last_level > 1)) { // In case we need to close the last sub forum tag
+			$sub_forums[$root_forum_id] .= str_repeat("</li></ul>\n", ($last_level - 1));
+		}
+		$db->sql_freeresult($result);
+		// Let's go
+		$has_result = false;
+		if (!empty($forum_datas)) {
+			$has_result = true;
+			// Grab icons
+			if (empty($master->icons)) {
+				$master->icons = $cache->obtain_icons();
+			}
+			$s_type_switch = 0;
+			$last_catless = true;
+			$root_data = array('forum_id' => 0);
+			$s_is_cat = true;
+			$level = 0;
+			$folder_alt = 'NO_NEW_POSTS';
+			$folder_image = 'forum_read';
+			$forum_folder_img = $user->img($folder_image, $folder_alt);
+			$forum_folder_img_src = $user->img($folder_image, $folder_alt, false, '', 'src');
+			// Let's go
+			foreach($forum_ids as $forum_id) {
+				$row = &$forum_datas[$forum_id];
+				$catless = $row['level'] == 0 ? true : false;
+				$is_cat = $row['parent_id'] == 0 ? true : false;
+				if (!isset($forum_list_auth[$forum_id]) || $row['forum_type'] == FORUM_LINK) {
+					continue;
+				}
+				$forum_map_link = $forum_news_link = $forum_map_title = $forum_news_title = '';
+				if (!empty($row['forum_topics']) && (isset($forum_read_auth[$forum_id]) || $is_cat)) {
+					if ($master->module_config['html_allow_cat_map']) {
+						$forum_map_title = sprintf($user->lang['HTML_MAP_OF'], $row['forum_name']);
+						$forum_map_link = sprintf($tpl['link'], append_sid($master->module_config['html_url'] . $master->gym_master->html_build_url('html_forum_cat_map', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)), $map_img . ' ' . $forum_map_title, $forum_map_title);
+					}
+					if ($master->module_config['html_allow_cat_news']) {
+						$forum_news_title = sprintf($user->lang['HTML_NEWS_OF'], $row['forum_name']);
+						$forum_news_link = sprintf($tpl['link'], append_sid($master->module_config['html_url'] . $master->gym_master->html_build_url('html_forum_cat_news', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)), $news_img . ' ' . $forum_news_title, $forum_news_title);
+					}
+				} else {
+					$forum_news_title = $forum_news_link = '<b>' . $row['forum_name'] . '</b>';
+					$forum_news_link .= '<br/>';
+				}
+				$forum_unread = (isset($master->forum_tracking_info[$forum_id]) && $master->forum_datas[$forum_id]['forum_last_post_time'] > $master->forum_tracking_info[$forum_id]) ? true : false;
+				if ($display_topic_status) {
+					// Which folder should we display?
+					$folder_alt = ($forum_unread) ? 'NEW_POSTS' : 'NO_NEW_POSTS';
+					if (!empty($sub_forums[$forum_id])) {
+						$folder_image = ($forum_unread) ? 'forum_unread_subforum' : 'forum_read_subforum';
+					} else {
+						if ($row['forum_status'] == ITEM_LOCKED) {
+							$folder_image = ($forum_unread) ? 'forum_unread_locked' : 'forum_read_locked';
+							$folder_alt = 'FORUM_LOCKED';
+						} else if ($row['forum_type'] == FORUM_POST) {
+							$folder_image = ($forum_unread) ? 'forum_unread' : 'forum_read';
+						} else {
+							$folder_image = 'forum_link';
+						}
+
+					}
+					$forum_folder_img = $user->img($folder_image, $folder_alt);
+					$forum_folder_img_src = $user->img($folder_image, $folder_alt, false, '', 'src');
+				}
+				$tpl_data = array(
+					'S_IS_CAT' => $is_cat,
+					'S_NO_CAT' => $catless && !$last_catless ? true : false,
+					'FORUM_ID' => $forum_id,
+					'FORUM_NAME' => $forum_map_title,
+					'FORUM_NEWS' => $forum_news_title,
+					'FORUM_MAP_LINK' => $forum_map_link,
+					'FORUM_NEWS_LINK' => $forum_news_link,
+				);
+				if (!$is_cat) {
+					$tpl_data += array(
+						'FORUM_DESC' => ($master->call['display_desc'] && !$is_cat) ? $master->generate_forum_info($row) : '',
+						'FORUM_FOLDER_IMG' => $forum_folder_img,
+						'FORUM_FOLDER_IMG_SRC' => $forum_folder_img_src,
+						'FORUM_FOLDER_IMG_ALT' => $user->lang[$folder_alt],
+						'FORUM_IMAGE' => ($row['forum_image']) ? '<img src="' . $phpbb_root_path . $row['forum_image'] . '" alt="' . $user->lang[$folder_alt] . '" />' : '',
+						'FORUM_IMAGE_SRC' => ($row['forum_image']) ? $phpbb_root_path . $row['forum_image'] : '',
+						'SUBFORUMS' => !empty($sub_forums[$forum_id]) ? $sub_forums[$forum_id] : '',
+					);
+					if ($display_last_post) {
+						// Create last post link information, if appropriate
+						if ($row['forum_last_post_id']) {
+							$last_post_subject = $row['forum_last_post_subject'];
+							$last_post_time = $user->format_date($row['forum_last_post_time']);
+							if (!empty($phpbb_seo->seo_opt['no_dupe']['on']) && !empty($row['topic_id']) && !$row['forum_password']) {
+								if ($row['topic_status'] == ITEM_MOVED) {
+									$row['topic_id'] = $row['topic_moved_id'];
+								}
+								$topic_id = (int) $row['topic_id'];
+								$row['topic_title'] = censor_text($row['topic_title']);
+								// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+								$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id]);
+								// www.phpBB-SEO.com SEO TOOLKIT END
+								$last_post_url =  append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;start=" . @intval($phpbb_seo->seo_opt['topic_last_page'][$topic_id]) ) . '#p' . $row['forum_last_post_id'];
+								$last_post_link = '<a href="' . append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id") . '" title="' . $row['topic_title'] . ' : ' . $row['forum_name'] . '">' . $row['topic_title'] . '</a>';
+							} else {
+								$last_post_url =  append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;p=" . $row['forum_last_post_id']) . '#p' . $row['forum_last_post_id'];
+								$last_post_link = '';
+							}
+						} else {
+							$last_post_subject = $last_post_time = $last_post_url = $last_post_link = '';
+						}
+						$tpl_data += array(
+							'LAST_POST_SUBJECT' => censor_text($last_post_subject),
+							'LAST_POST_TIME' => $last_post_time,
+							'LAST_POST_LINK' => $last_post_link,
+							'U_LAST_POST' => $last_post_url,
+						);
+						if ($display_user_info) {
+							$tpl_data += array(
+								'LAST_POSTER' => get_username_string('username', $row['forum_last_poster_id'], $row['forum_last_poster_name'], $row['forum_last_poster_colour']),
+								'LAST_POSTER_COLOUR' => get_username_string('colour', $row['forum_last_poster_id'], $row['forum_last_poster_name'], $row['forum_last_poster_colour']),
+								'LAST_POSTER_FULL' => get_username_string($display_user_link_key, $row['forum_last_poster_id'], $row['forum_last_poster_name'], $row['forum_last_poster_colour']),
+							);
+						}
+					}
+				}
+				$template->assign_block_vars('forumrow', $tpl_data);
+				$last_catless = $catless;
+				unset($forum_datas[$forum_id]);
+			}
+		}
+		$map_desc = false;
+		if ($master->call['display_desc']) {
+			$map_desc = !empty($master->module_config['html_site_desc']) ? $master->module_config['html_site_desc'] : '';
+		}
+		$template->assign_vars(array(
+			'H1_FORUMS' => $master->module_config['html_sitename'],
+			'DISPLAY_FORUMS_H1' => $display_link,
+			'U_FORUMS' => $display_link ? append_sid("{$phpbb_root_path}index.$phpEx") : false,
+			'FORUM_MAP_URL' => $master->module_config['html_allow_map'] ? append_sid($master->module_config['html_url'] . $master->url_settings['html_forum_map']) : '',
+			'FORUM_NEWS' => sprintf($user->lang['HTML_NEWS_OF'], $master->module_config['html_sitename']),
+			'NEWS_IMG_SRC' => $master->gym_master->path_config['gym_img_url'] . 'html_news.gif',
+			'FORUM_NEWS_URL' => $master->module_config['html_allow_news'] ? append_sid($master->module_config['html_url'] . $master->url_settings['html_forum_news']) : '',
+			'DISPLAY_FORUMS' => $has_result,
+			'DISPLAY_USER_INFO' => $display_user_info,
+			'DISPLAY_LAST_POST' => $display_last_post,
+			'NEWEST_POST_IMG' => $user->img('icon_topic_newest', 'VIEW_NEWEST_POST'),
+			'LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST'),
+			'MAP_DESC' => $map_desc,
+		));
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/display/.htaccess
===================================================================
--- gym_sitemaps/display/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/display/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/display/display_topics.php
===================================================================
--- gym_sitemaps/display/display_topics.php	(phpBB 3.0.8)
+++ gym_sitemaps/display/display_topics.php	(Premod 3.0.8)
@@ -0,0 +1,342 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: display_topics.php 254 2010-03-12 15:08:58Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* display_topics Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class display_topics {
+	function display_topics(&$master) {
+		global $user, $template, $config, $phpEx, $db, $auth, $cache, $phpbb_root_path;
+		static $display_orders = array('first' => 't.topic_id', 'last' => 't.topic_last_post_time');
+		global $phpbb_seo;
+		// Usefull for multi bb topic & forum tracking
+		// Leave default for single forum eg : '_track'
+		$tracking_cookie_name = (defined('XLANG_AKEY') ? XLANG_AKEY : '') . '_track';
+		// Specific options
+		$display_file = &$master->call['display_file'];
+		$display_user_info = &$master->call['display_user_info'];
+		$display_link = &$master->call['display_link'];
+		$display_pagination = &$master->call['display_pagination'];
+		$display_tracking = &$master->call['display_tracking'];
+		$display_topic_status = &$master->call['display_topic_status'];
+		$display_user_link = !empty($master->call['display_user_link']) ? true : false;
+		$display_user_link_key = $display_user_link ? 'full' : 'no_profile';
+		$display_last_post = &$master->call['display_last_post'];
+		$display_order = isset($display_orders[$master->call['display_order']]) ? $display_orders[$master->call['display_order']] : $display_orders['first'];
+		$limit_time_sql = !empty($master->call['limit_time']) ? ' AND t.topic_last_post_time > ' . ($user->time_now - $master->call['limit_time']) : '';
+		$order_sql = @$master->call['sort'] == 'ASC' ? ' ASC' : ' DESC';
+		if (!$display_tracking) {
+			$load_db_lastread = $load_anon_lastread = false;
+		} else {
+			$load_db_lastread = (boolean) ($config['load_db_lastread'] && $user->data['is_registered']);
+			$load_anon_lastread = (boolean) ($config['load_anon_lastread'] || $user->data['is_registered']);
+		}
+		// hanlde options
+		$limit = $master->call['limit'] >= 1 ? (int) $master->call['limit'] : 5;
+		$start = &$master->start;
+		if (!$display_pagination || empty($display_file)) {
+			$start = 0;
+			$display_pagination = false;
+		}
+		$total_topics = 0;
+		$topic_sql = $master->call['topic_sql'];
+		$forum_sql = $master->call['forum_sql'];
+		$s_global = $master->call['s_global'];
+		// Do some reset
+		$topic_datas = $topic_ids = $forum_ids = $user_cache = $id_cache = $post_datas = $forum_datas = array();
+		$forum_id = $master->call['forum_id'];
+		// Get The Data, first forums
+		if ((!$s_global && !$master->call['single_forum']) || ($master->call['single_forum'] && empty($master->forum_datas[$master->call['forum_id']])) ) {
+			$sql_array = array(
+				'SELECT'	=> 'f.*',
+				'FROM'		=> array(
+					FORUMS_TABLE	=> 'f',
+				),
+				'LEFT_JOIN' => array(),
+			);
+			if ($load_db_lastread) {
+				$sql_array['SELECT'] .= ', ft.mark_time as forum_mark_time';
+				$sql_array['LEFT_JOIN'][] = array(
+					'FROM'	=> array(FORUMS_TRACK_TABLE => 'ft'),
+					'ON'	=> 'ft.user_id = ' . $user->data['user_id'] . ' AND ft.forum_id = f.forum_id'
+				);
+			}
+			$sql_array['WHERE'] = $forum_sql ? str_replace('t.forum_id', 'f.forum_id', $forum_sql) : '';
+			$sql = $db->sql_build_query('SELECT', $sql_array);
+			unset($sql_array);
+			$result = $db->sql_query($sql);
+			while ($row = $db->sql_fetchrow($result)) {
+				$forum_id = (int) $row['forum_id'];
+				$forum_datas[$forum_id] = $row;
+			}
+			$db->sql_freeresult($result);
+		}
+		// Now the topics
+		$sql_array = array(
+			'SELECT'	=> 't.*',
+			'FROM'		=> array(
+				TOPICS_TABLE	=> 't',
+			),
+			'LEFT_JOIN' => array(),
+		);
+		if ($load_db_lastread) {
+			$sql_array['SELECT'] .= ', tt.mark_time';
+			$sql_array['LEFT_JOIN'][] = array(
+				'FROM'	=> array(TOPICS_TRACK_TABLE => 'tt'),
+				'ON'	=> 'tt.user_id = ' . $user->data['user_id'] . ' AND tt.topic_id = t.topic_id'
+			);
+		} elseif ($load_anon_lastread && empty($master->tracking_topics)) {
+			$master->tracking_topics = (isset($_COOKIE[$config['cookie_name'] . $tracking_cookie_name])) ? ((STRIP) ? stripslashes($_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : $_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : '';
+			$master->tracking_topics = ($master->tracking_topics) ? tracking_unserialize($master->tracking_topics) : array();
+			if (!$user->data['is_registered']) {
+				$user->data['user_lastmark'] = (isset($master->tracking_topics['l'])) ? (int) (base_convert($master->tracking_topics['l'], 36, 10) + $config['board_startdate']) : 0;
+			}
+		}
+		$sql_where = ($forum_sql ? $forum_sql : '') . $limit_time_sql;
+		$sql_where .= $topic_sql ? ($sql_where ? ' AND ' : '') . $topic_sql : '';
+		$sql_where .= ($sql_where ? ' AND ' : '') . 't.topic_status <> ' . ITEM_MOVED;
+		if ($master->call['single_forum']) {
+			$sql_where .= $auth->acl_get('m_approve', $master->call['forum_id']) ? '' : ' AND t.topic_approved = 1';
+		} else {
+			// only admins and global moderators will see un-approved topics
+			// in the forum they have access to.
+			$sql_where .= ($auth->acl_gets('a_') || $auth->acl_getf_global('m_')) ? '' : ' AND t.topic_approved = 1';
+		}
+		// obtain correct topic count if we display pagination
+		if ($display_pagination) {
+			$sql = "SELECT COUNT(t.topic_id) AS num_topics
+				FROM " . TOPICS_TABLE . " t
+				WHERE $sql_where";
+			$result = $db->sql_query($sql);
+			$total_topics = (int) $db->sql_fetchfield('num_topics');
+			$db->sql_freeresult($result);
+			// Make sure $start is set to the last page if it exceeds the amount
+			if ($start < 0 || $start > $total_topics) {
+				$start = ($start < 0) ? 0 : floor(($total_topics - 1) / $limit) * $limit;
+				// Since we've reached here, $start is not set proper, kill the dupe!
+				$url = $display_file . $master->gym_master->html_add_start($start);
+				$master->gym_master->seo_kill_dupes($url);
+			}
+		}
+		$sql_array['WHERE'] = $sql_where;
+		$sql_array['ORDER_BY'] = $display_order . $order_sql;
+		$sql = $db->sql_build_query('SELECT', $sql_array);
+		unset($sql_array);
+		$result = $db->sql_query_limit($sql, $limit, $start);
+		while ($row = $db->sql_fetchrow($result)) {
+			$topic_id = (int) $row['topic_id'];
+			$forum_id = (int) $row['forum_id'];
+			// Start with the forum
+			if (!$s_global && empty($master->forum_datas[$forum_id])) {
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				$phpbb_seo->set_url($forum_datas[$forum_id]['forum_name'], $forum_id, 'forum');
+				// www.phpBB-SEO.com SEO TOOLKIT END
+				$master->forum_datas[$forum_id] = array_merge($forum_datas[$forum_id],  array(
+					'forum_url' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+					'm_approve' => $auth->acl_get('m_approve', $forum_id),
+				));
+				if ($load_db_lastread) {
+					$master->forum_tracking_info[$forum_id] = !empty($forum_datas[$forum_id]['forum_mark_time']) ? $forum_datas[$forum_id]['forum_mark_time'] : $user->data['user_lastmark'];
+				} elseif ($load_anon_lastread) {
+					$master->forum_tracking_info[$forum_id] = isset($master->tracking_topics['f'][$forum_id]) ? (int) (base_convert($master->tracking_topics['f'][$forum_id], 36, 10) + $config['board_startdate']) : $user->data['user_lastmark'];
+				}
+			}
+			$topic_datas[$topic_id] = $row;
+			$topic_ids[$topic_id] = $topic_id;
+		}
+		$db->sql_freeresult($result);
+		// Let's go
+		$has_result = false;
+		if (!empty($topic_datas)) {
+			$has_result = true;
+			// Grab icons
+			if (empty($master->icons)) {
+				$master->icons = $cache->obtain_icons();
+			}
+			$s_type_switch = 0;
+			$folder_alt = 'NO_NEW_POSTS';
+			$topic_type = '';
+			$folder_img = 'topic_read';
+			$topic_folder_img = $user->img($folder_img, $folder_alt);
+			$topic_folder_img_src = $user->img($folder_img, $folder_alt, false, '', 'src');
+			foreach ($topic_ids as $topic_id) {
+				$topic_id = (int) $topic_id;
+				$row = &$topic_datas[$topic_id];
+				$forum_id = (int) $row['forum_id'];
+				if (empty($master->forum_tracking_info[$forum_id])) {
+					if ($load_db_lastread) {
+						$master->topic_tracking_info[$topic_id] = !empty($row['mark_time']) ? $row['mark_time'] : $user->data['user_lastmark'];
+					} else if ($load_anon_lastread) {
+						$topic_id36 = base_convert($topic_id, 10, 36);
+						if (isset($master->tracking_topics['t'][$topic_id36])) {
+							$master->tracking_topics['t'][$topic_id] = base_convert($master->tracking_topics['t'][$topic_id36], 36, 10) + $config['board_startdate'];
+						}
+						$master->topic_tracking_info[$topic_id] = isset($master->tracking_topics['t'][$topic_id]) ? $master->tracking_topics['t'][$topic_id] : $user->data['user_lastmark'];
+					}
+				} else {
+					$master->topic_tracking_info[$topic_id] = $master->forum_tracking_info[$forum_id];
+				}
+				$row['topic_title'] = censor_text($row['topic_title']);
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id]);
+				// www.phpBB-SEO.com SEO TOOLKIT END
+				// This will allow the style designer to output a different header
+				// or even separate the list of announcements from sticky and normal topics
+				$s_type_switch_test = /*($row['topic_type'] == POST_ANNOUNCE || $row['topic_type'] == POST_GLOBAL) ? 1 :*/ 0;
+				// Replies
+				$replies = !empty($master->forum_datas[$forum_id]['m_approve']) ? $row['topic_replies_real'] : $row['topic_replies'];
+				$unread_topic = (isset($master->topic_tracking_info[$topic_id]) && $row['topic_last_post_time'] > $master->topic_tracking_info[$topic_id]) ? true : false;
+				// Get folder img, topic status/type related information
+				if ($display_topic_status) {
+					$master->gym_master->topic_status($row, $replies, $unread_topic, $folder_img, $folder_alt, $topic_type);
+					$topic_folder_img = $user->img($folder_img, $folder_alt);
+					$topic_folder_img_src = $user->img($folder_img, $folder_alt, false, '', 'src');
+				}
+				// Generate all the URIs ...
+				$view_topic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id");
+				$view_forum_url = !$s_global ? $master->forum_datas[$forum_id]['forum_url'] : '';
+				$topic_unapproved = (!$row['topic_approved'] && $auth->acl_get('m_approve', $forum_id)) ? true : false;
+				$posts_unapproved = ($row['topic_approved'] && $row['topic_replies'] < $row['topic_replies_real'] && $auth->acl_get('m_approve', $forum_id)) ? true : false;
+				$u_mcp_queue = ($topic_unapproved || $posts_unapproved) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=queue&amp;mode=' . (($topic_unapproved) ? 'approve_details' : 'unapproved_posts') . "&amp;t=$topic_id", true, $user->session_id) : '';
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+				if (!empty($phpbb_seo->seo_opt['no_dupe']['on'])) {
+					if (($replies + 1) > $phpbb_seo->seo_opt['topic_per_page']) {
+						$phpbb_seo->seo_opt['topic_last_page'][$topic_id] = floor($replies / $phpbb_seo->seo_opt['topic_per_page']) * $phpbb_seo->seo_opt['topic_per_page'];
+					}
+				}
+				// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
+				$tpl_data = array(
+					'FORUM_ID' => $forum_id,
+					'TOPIC_ID' => $topic_id,
+					'PAGINATION' => $master->call['display_topic_pagination'] ? $master->gym_master->topic_generate_pagination($replies, $view_topic_url) : '',
+					'REPLIES' => $replies,
+					'VIEWS' => $row['topic_views'],
+					'TOPIC_TITLE' => $row['topic_title'],
+					'FORUM_NAME' => !$s_global ? $master->forum_datas[$forum_id]['forum_name'] : '',
+					'TOPIC_TYPE' => $topic_type,
+					'TOPIC_FOLDER_IMG' => $topic_folder_img,
+					'TOPIC_FOLDER_IMG_SRC' => $topic_folder_img_src,
+					'TOPIC_FOLDER_IMG_ALT' => $user->lang[$folder_alt],
+					'TOPIC_ICON_IMG' => (!empty($master->icons[$row['icon_id']])) ? $master->icons[$row['icon_id']]['img'] : '',
+					'TOPIC_ICON_IMG_WIDTH' => (!empty($master->icons[$row['icon_id']])) ? $master->icons[$row['icon_id']]['width'] : '',
+					'TOPIC_ICON_IMG_HEIGHT' => (!empty($master->icons[$row['icon_id']])) ? $master->icons[$row['icon_id']]['height'] : '',
+					'ATTACH_ICON_IMG' => ($auth->acl_get('u_download') && $auth->acl_get('f_download', $forum_id) && $row['topic_attachment']) ? $user->img('icon_topic_attach', $user->lang['TOTAL_ATTACHMENTS']) : '',
+					'UNAPPROVED_IMG' => ($topic_unapproved || $posts_unapproved) ? $user->img('icon_topic_unapproved', ($topic_unapproved) ? 'TOPIC_UNAPPROVED' : 'POSTS_UNAPPROVED') : '',
+					'FIRST_POST_TIME' => $user->format_date($row['topic_time']),
+					'LAST_POST_TIME' => $user->format_date($row['topic_last_post_time']),
+					'LAST_VIEW_TIME' => $user->format_date($row['topic_last_view_time']),
+					'S_TOPIC_TYPE' => $row['topic_type'],
+					'S_USER_POSTED' => (isset($row['topic_posted']) && $row['topic_posted']) ? true : false,
+					'S_UNREAD_TOPIC' => $unread_topic,
+					'S_TOPIC_REPORTED' => (!empty($row['topic_reported']) && $auth->acl_get('m_report', $forum_id)) ? true : false,
+					'S_TOPIC_UNAPPROVED' => $topic_unapproved,
+					'S_POSTS_UNAPPROVED' => $posts_unapproved,
+					'S_HAS_POLL' => ($row['poll_start']) ? true : false,
+					'S_POST_ANNOUNCE' => ($row['topic_type'] == POST_ANNOUNCE) ? true : false,
+					'S_POST_GLOBAL' => ($row['topic_type'] == POST_GLOBAL) ? true : false,
+					'S_POST_STICKY' => ($row['topic_type'] == POST_STICKY) ? true : false,
+					'S_TOPIC_LOCKED' => ($row['topic_status'] == ITEM_LOCKED) ? true : false,
+					'S_TOPIC_MOVED' => ($row['topic_status'] == ITEM_MOVED) ? true : false,
+					'U_NEWEST_POST' => $unread_topic ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' .  $forum_id . '&amp;t=' . $topic_id . '&amp;view=unread#unread') : '',
+
+					'U_VIEW_TOPIC' => $view_topic_url,
+					'U_VIEW_FORUM' => $view_forum_url,
+					'U_MCP_REPORT' => append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=reports&amp;mode=reports&amp;f=' . $forum_id . '&amp;t=' . $topic_id, true, $user->session_id),
+					'U_MCP_QUEUE' => $u_mcp_queue,
+					'S_TOPIC_TYPE_SWITCH' => ($s_type_switch == $s_type_switch_test) ? -1 : $s_type_switch_test,
+				);
+				if ($display_last_post) {
+					$tpl_data += array(
+						'TOPIC_LAST_POST_TITLE' => !empty($row['topic_last_post_subject']) ? censor_text($row['topic_last_post_subject']) :  $row['topic_title'],
+						// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+						'U_MINI_POST' => !empty($phpbb_seo->seo_opt['no_dupe']['on']) ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id&amp;start=" . @intval($phpbb_seo->seo_opt['topic_last_page'][$topic_id]) ) . '#p' . $row['topic_last_post_id'] : append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'p=' . $row['topic_last_post_id'] . (($row['topic_type'] == POST_GLOBAL) ? '&amp;f=' . $forum_id : '')) . '#p' . $row['topic_last_post_id'],
+						// www.phpBB-SEO.com SEO TOOLKIT END
+					);
+				}
+				if ($display_user_info) {
+					$tpl_data += array(
+						'TOPIC_AUTHOR_FULL' => get_username_string($display_user_link_key, $row['topic_poster'], $row['topic_first_poster_name'], $row['topic_first_poster_colour']),
+						'LAST_POST_SUBJECT' => censor_text($row['topic_last_post_subject']),
+						'LAST_POST_AUTHOR' => get_username_string('username', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),
+						'LAST_POST_AUTHOR_COLOUR' => get_username_string('colour', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),
+						'LAST_POST_AUTHOR_FULL' => get_username_string($display_user_link_key, $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),
+						'U_LAST_POST_AUTHOR' => $display_user_link ? get_username_string('profile', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']) : '',
+						'U_TOPIC_AUTHOR' => $display_user_link ? get_username_string('profile', $row['topic_poster'], $row['topic_first_poster_name'], $row['topic_first_poster_colour']) : '',
+					);
+				}
+				$template->assign_block_vars('topicrow', $tpl_data);
+				unset($tpl_data);
+				$s_type_switch = /*($row['topic_type'] == POST_ANNOUNCE || $row['topic_type'] == POST_GLOBAL) ? 1 :*/ 0;
+			}
+			unset($topic_datas);
+		}
+		$map_desc = false;
+		$rules_info = array('forum_rules' => false, 'forum_rules_link' => false);
+		// In case we are listing category's children
+		if ($master->call['cat_forum']) {
+			$forum_id = $master->call['cat_forum'];
+		}
+		if ($master->call['display_desc']) {
+			$map_desc = !empty($master->module_config['html_site_desc']) ? $master->module_config['html_site_desc'] : '';
+			if ($master->call['single_forum'] || $master->call['cat_forum']) {
+				$map_desc = $master->generate_forum_info($master->forum_datas[$forum_id]);
+			}
+		}
+		if ($master->call['display_rules'] && ($master->call['single_forum'] || $master->call['cat_forum']) ) {
+			$rules_info = $master->generate_forum_info($master->forum_datas[$forum_id], 'rules');
+		}
+		$tpl_data = array(
+			'H1_TOPICS' => $master->outputs['page_title'],
+			'DISPLAY_TOPICS_H1' => $display_link,
+			'U_TOPICS' => $display_link ? append_sid($display_file) : false,
+			'DISPLAY_TOPICS' => $has_result,
+			'DISPLAY_LAST_POST' => $display_last_post,
+			'NEWEST_POST_IMG' => $user->img('icon_topic_newest', 'VIEW_NEWEST_POST'),
+			'LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST'),
+			'MAP_DESC' => $map_desc,
+			'MAP_RULES' => $rules_info['forum_rules'],
+			'MAP_RULES_LINK' => $rules_info['forum_rules_link'],
+			'T_ICONS_PATH' => "{$phpbb_root_path}{$config['icons_path']}/",
+			'NEWS_IMG_SRC' => $master->gym_master->path_config['gym_img_url'] . 'html_news.gif',
+		);
+		if ($master->call['single_forum'] || $master->call['cat_forum']) {
+			$tpl_data += array(
+				'FORUM_NEWS' => sprintf($user->lang['HTML_NEWS_OF'], $master->forum_datas[$forum_id]['forum_name']),
+				'FORUM_NEWS_URL' => $master->module_config['html_allow_cat_news'] ? append_sid($master->gym_master->html_build_url('html_forum_cat_news', $phpbb_seo->seo_url['forum'][$forum_id], $forum_id)) : '',
+				'FORUM_URL' => $master->forum_datas[$forum_id]['forum_url'],
+				'FORUM_NAME' => $master->forum_datas[$forum_id]['forum_name'],
+				'S_SINGLE_FORUM' => $master->call['cat_forum'] ? false : true,
+			);
+		} else {
+			$tpl_data += array(
+				'FORUM_NEWS' => sprintf($user->lang['HTML_NEWS_OF'], $master->module_config['html_sitename']),
+				'FORUM_NEWS_URL' => $master->module_config['html_allow_news'] ? append_sid($master->module_config['html_url'] . $master->url_settings['html_forum_news']) : '',
+				'FORUM_URL' => append_sid("{$phpbb_root_path}index.$phpEx"),
+				'FORUM_NAME' => $master->module_config['html_sitename'],
+			);
+		}
+		$template->assign_vars($tpl_data);
+		unset($tpl_data);
+		if ($display_pagination) {
+			$l_total_topic_s = ($total_topics == 0) ? 'TOTAL_TOPICS_ZERO' : 'TOTAL_TOPICS_OTHER';
+			$template->assign_vars(array(
+				'DISPLAY_PAGINATION'	=> generate_pagination(append_sid($display_file), $total_topics, $limit, $start),
+				'DISPLAY_PAGE_NUMBER'	=> on_page($total_topics, $limit, $start),
+				'DISPLAY_TOTAL_TOPICS' => sprintf($user->lang[$l_total_topic_s], $total_topics),
+			));
+		}
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/images/fuzz.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\fuzz.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_faq.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_faq.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/addthis.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\addthis.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_button.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_button.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_headers.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_headers.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/addGoogle.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\addGoogle.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/maps-icon.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\maps-icon.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/scoopeo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\scoopeo.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/corners_right.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\corners_right.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/arrow_right.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\arrow_right.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/sitemap-icon.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\sitemap-icon.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_back_top.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_back_top.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/reddit.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\reddit.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/quote.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\quote.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/arrow_up.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\arrow_up.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/logo.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\logo.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/rss-valid.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\rss-valid.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/corners_left.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\corners_left.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_print.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_print.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/topic_read.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\topic_read.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/newsgator.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\newsgator.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/add2netvibes.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\add2netvibes.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/logo_phpBB.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\logo_phpBB.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/myaol.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\myaol.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/arrow_down.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\arrow_down.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/wikio.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\wikio.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_list.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_list.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/forum_read.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\forum_read.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/site_logo.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\site_logo.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_footers.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_footers.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/digg.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\digg.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_textbox_search.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_textbox_search.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_register.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_register.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/gradient.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\gradient.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/phpbb-seo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\phpbb-seo.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/nuouz.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\nuouz.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/rss_board_big.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\rss_board_big.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_home.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_home.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/html_news.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\html_news.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_header.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_header.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/rss_forum_big.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\rss_forum_big.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/addtomyyahoo.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\addtomyyahoo.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/pageflakes.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\pageflakes.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/MyMSN.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\MyMSN.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/arrow_left.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\arrow_left.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/bg_body.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\bg_body.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/feed-icon.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\feed-icon.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/images/icon_fontsize.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\gym_sitemaps\images\icon_fontsize.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: gym_sitemaps/includes/gym_rss_functions.php
===================================================================
--- gym_sitemaps/includes/gym_rss_functions.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_rss_functions.php	(Premod 3.0.8)
@@ -0,0 +1,435 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_rss_functions.php 275 2010-11-21 17:48:06Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+define('GYM_RSS_FUNC_INC', true);
+/**
+* get_gym_links($gym_config).
+* retunrs the link array
+*/
+function get_gym_links($gym_config) {
+	global $phpbb_root_path, $config, $phpEx, $user, $cache, $db, $phpbb_seo;
+	$links = array();
+	$_phpbb_seo = !empty($phpbb_seo);
+	$board_url = $_phpbb_seo ? $phpbb_seo->seo_path['phpbb_url'] : generate_board_url() . '/';
+	$gym_link_tpl = '<a href="%1$s" title="%3$s" class="gym"><img src="' . $board_url . 'gym_sitemaps/images/%2$s" alt="%3$s" width="14", height="14"/>&nbsp;%3$s</a>';
+	$google_threshold = max(1, (int) $gym_config['google_threshold']);
+	//compute guest auth
+	$cache_file = '_gym_auth_guests_forum';
+	if (($auth_guest_list = $cache->get($cache_file)) === false) {
+		$auth_guest_list = array('list' => array(), 'read' => array(), 'list_post' => array(), 'read_post' => array(), 'skip_pass' => array(), 'skip_cat' => array(), 'skip_all' => array(), 'skip_link' => array(), 'thresholded' => array(), 'empty' => array());
+		$guest_data = array('user_id' => ANONYMOUS,
+			'user_type' => USER_IGNORE,
+			'user_permissions' . (defined('XLANG_AKEY') ? XLANG_AKEY : '') => '',
+		);
+		$g_auth = new auth();
+		$g_auth->acl($guest_data);
+		// the forum id array
+		$forum_list_ary = $g_auth->acl_getf('f_list', true);
+		foreach ($forum_list_ary as $forum_id => $null) {
+			$auth_guest_list['list'][$forum_id] = (int) $forum_id;
+		}
+		$forum_read_ary = $g_auth->acl_getf('f_read', true);
+		foreach ($forum_read_ary as $forum_id => $null) {
+			$auth_guest_list['read'][$forum_id] = (int) $forum_id;
+		}
+		ksort($auth_guest_list['list']);
+		ksort($auth_guest_list['read']);
+		$sql = "SELECT forum_id, forum_type, forum_password
+			FROM " . FORUMS_TABLE . "
+			WHERE	forum_type <> " . FORUM_POST . " OR forum_password <> ''";
+		$result = $db->sql_query($sql);
+		while ( $row = $db->sql_fetchrow($result) ) {
+			$forum_id = (int) $row['forum_id'];
+			if ($row['forum_password']) {
+				$auth_guest_list['skip_pass'][$forum_id] = $forum_id;
+			}
+			if ($row['forum_type'] == FORUM_CAT) {
+				$auth_guest_list['skip_cat'][$forum_id] = $forum_id;
+			} else if ($row['forum_type'] == FORUM_LINK) {
+				$auth_guest_list['skip_link'][$forum_id] = $forum_id;
+			}
+			$auth_guest_list['skip_all'][$forum_id] = $forum_id;
+		}
+		$db->sql_freeresult($result);
+		// Now let's grabb the list of forum with not enough topics to have a sitemap
+		// Only care about postable forum ;-)
+		$sql = "SELECT forum_id, forum_topics
+			FROM " . FORUMS_TABLE . "
+			WHERE	forum_type = " . FORUM_POST . "
+				AND forum_topics < $google_threshold";
+		$result = $db->sql_query($sql);
+		while ( $row = $db->sql_fetchrow($result) ) {
+			$forum_id = (int) $row['forum_id'];
+			$auth_guest_list['thresholded'][$forum_id] = $forum_id;
+			if (empty($row['forum_topics'])) {
+				$auth_guest_list['empty'][$forum_id] = $forum_id;
+			}
+		}
+		ksort($auth_guest_list['skip_pass']);
+		ksort($auth_guest_list['skip_all']);
+		ksort($auth_guest_list['skip_link']);
+		ksort($auth_guest_list['skip_cat']);
+		// Never mind about forum links
+		$auth_guest_list['read'] = array_diff_assoc($auth_guest_list['read'], $auth_guest_list['skip_link']);
+		$auth_guest_list['list'] = array_diff_assoc($auth_guest_list['list'], $auth_guest_list['skip_link']);
+		ksort($auth_guest_list['read']);
+		ksort($auth_guest_list['list']);
+		$auth_guest_list['list_post'] = array_diff_assoc($auth_guest_list['list'], $auth_guest_list['skip_all']);
+		$auth_guest_list['read_post'] = array_diff_assoc($auth_guest_list['read'], $auth_guest_list['skip_all']);
+		$cache->put($cache_file, $auth_guest_list);
+	}
+	$links = array();
+	$links['main'] = $links['setup']['google'] = $links['setup']['rss'] = $links['setup']['html'] = array();
+	// Find out about active modes
+	$google_active = $rss_active = $html_active = false;
+	$gym_modules = array(
+		'google' => array('forum', 'xml', 'txt'),
+		'rss' => array('forum'),
+		'html' => array('forum'),
+	);
+	foreach ($gym_modules as $type => $modules) {
+		foreach ($modules as $module) {
+			if (!empty($gym_config[$type . '_' . $module . '_installed'])) {
+				${$type . '_active'} = true;
+				break;
+			}
+		}
+	}
+	$do_display_cat = $do_display_main = $do_display_index = false;
+	// Google sitemaps
+	if ($google_active) {
+		$display_google_main_links = (boolean) get_gym_option('google', 'gym', 'link_main', OVERRIDE_MODULE, $gym_config);
+		$display_google_index_links = (boolean) get_gym_option('google', 'gym', 'link_index', OVERRIDE_MODULE, $gym_config);
+		$display_google_cat_links = (boolean) get_gym_option('google', 'gym', 'link_cat', OVERRIDE_MODULE, $gym_config);
+		$override_google_mod_rewrite = get_override('google', 'modrewrite', $gym_config);
+		$google_mod_rewrite = (boolean) get_gym_option('google', 'gym', 'modrewrite', $override_google_mod_rewrite, $gym_config);
+		$override_google_gzip = get_override('google', 'gzip', $gym_config);
+		$google_gzip = (boolean) get_gym_option('google', 'forum', 'gzip', $override_google_gzip, $gym_config);
+		$google_gzip_ext = ($google_gzip || $config['gzip_compress']) ? (get_gym_option('google', 'forum', 'gzip_ext', $override_google_gzip, $gym_config) ? '.gz' : '') : '';
+		$google_url = $_phpbb_seo ? $phpbb_seo->sslify($gym_config['google_url'], $phpbb_seo->ssl['use'], false) : $gym_config['google_url'];
+		$sitemap_url = $google_url . ($google_mod_rewrite ? 'sitemapindex.xml' . $google_gzip_ext : "sitemap.$phpEx");
+		$links['setup']['google'] = array(
+			'override_mod_rewrite' => $override_google_mod_rewrite,
+			'mod_rewrite' => $google_mod_rewrite,
+			'override_gzip' => $override_google_gzip,
+			'link_main' => $display_google_main_links,
+			'link_index' => $display_google_index_links,
+			'link_cat' => $display_google_cat_links,
+			'gzip' => $google_gzip,
+			'gzip_ext' => $google_gzip_ext,
+			'google_url' => $google_url,
+			'threshold' => max(1, (int) $gym_config['google_threshold']),
+			'l_google_sitemap' => $user->lang['GOOGLE_SITEMAP'],
+			'l_google_sitemap_of' => $user->lang['GOOGLE_MAP_OF'],
+		);
+		// only publicly readable and not thresholded forums will be listed
+		if (!empty($gym_config['google_forum_installed'])) {
+			$google_forum_mod_rewrite = (boolean) get_gym_option('google', 'forum', 'modrewrite', $override_google_mod_rewrite, $gym_config);
+			$google_auth_guest = array_diff_assoc($auth_guest_list['read_post'], set_exclude_list($gym_config['google_forum_exclude']), $auth_guest_list['thresholded']);
+			$google_forum_exclude = set_exclude_list($gym_config['google_forum_exclude']) + $auth_guest_list['skip_all'];
+			$links['setup']['google'] = array_merge( $links['setup']['google'],
+				array(
+					'forum_google' => true,
+					'forum_cat_google' => $google_url . ($google_forum_mod_rewrite && $_phpbb_seo ? "%1\$s.xml$google_gzip_ext" : "sitemap.$phpEx?forum=%2\$s"),
+					'auth_guest' => $google_auth_guest,
+					'forum_exclude' => $google_forum_exclude,
+			));
+		}
+		$links['main'] = array_merge( $links['main'],
+			array(
+				'GYM_GOOGLE_TITLE' => $user->lang['GOOGLE_SITEMAPINDEX'],
+				'GYM_GOOGLE_URL' => $sitemap_url,
+				'GYM_GOOGLE_LINK' => $display_google_main_links ? sprintf($gym_link_tpl, $sitemap_url, 'sitemap-icon.gif', $user->lang['GOOGLE_SITEMAPINDEX']) : '',
+				'GYM_GOOGLE_THRESOLD' => (int) $links['setup']['google']['threshold'],
+		));
+		$do_display_main = $display_google_main_links ? true : $do_display_main;
+		$do_display_index = $display_google_index_links ? true : $do_display_index;
+		$do_display_cat = $display_google_cat_links ? true : $do_display_cat;
+	}
+	// RSS
+	if ($rss_active) {
+		$display_rss_main_links = (boolean) get_gym_option('rss', 'gym', 'link_main', OVERRIDE_MODULE, $gym_config);
+		$display_rss_index_links = (boolean) get_gym_option('rss', 'gym', 'link_index', OVERRIDE_MODULE, $gym_config);
+		$display_rss_cat_links = (boolean) get_gym_option('rss', 'gym', 'link_cat', OVERRIDE_MODULE, $gym_config);
+		$override_rss_mod_rewrite = get_override('rss', 'modrewrite', $gym_config);
+		$rss_mod_rewrite = (boolean) get_gym_option('rss', 'gym', 'modrewrite', $override_rss_mod_rewrite, $gym_config);
+		$rss_modrtype = max(0, (int) get_gym_option('rss', 'gym', 'modrtype', $override_rss_mod_rewrite, $gym_config));
+		$override_rss_gzip = get_override('rss', 'gzip', $gym_config);
+		$rss_gzip = (boolean) get_gym_option('rss', 'forum', 'gzip', $override_rss_gzip, $gym_config);
+		$rss_gzip_ext = ($rss_gzip || $config['gzip_compress']) ? (get_gym_option('rss', 'forum', 'gzip_ext', $override_rss_gzip, $gym_config) ? '.gz' : '') : '';
+		// Take car of linking type
+		$link_type_sep = $rss_mod_rewrite ? '/' : '&amp;';
+		$link_type_to_options = array('n' => 'news', 'nd' => 'news'. $link_type_sep . 'digest', 'r' => '', 'rd' => 'digest');
+		$link_type_bit = isset($link_type_to_options[$gym_config['rss_linking_type']]) ? $link_type_to_options[$gym_config['rss_linking_type']] : '';
+		$rss_url = $_phpbb_seo ? $phpbb_seo->sslify($gym_config['rss_url'], $phpbb_seo->ssl['use'], false) : $gym_config['rss_url'];
+		$rss_main_url = $rss_url . ($rss_mod_rewrite ? 'rss/' . ($link_type_bit ? $link_type_bit . '/' : '') . 'rss.xml' . $rss_gzip_ext : "gymrss.$phpEx" . ($link_type_bit ? '?' . $link_type_bit : ''));
+		$rss_chan_url = $rss_url . ($rss_mod_rewrite ? 'rss/' . ($link_type_bit ? $link_type_bit . '/' : '') : "gymrss.$phpEx?channels" . ($link_type_bit ? '&amp;' . $link_type_bit : ''));
+		$links['setup']['rss'] = array(
+			'display_alternate' => (int) $gym_config['rss_alternate'],
+			'link_main' => $display_rss_main_links,
+			'link_index' => $display_rss_index_links,
+			'link_cat' => $display_rss_cat_links,
+			'override_mod_rewrite' => $override_rss_mod_rewrite,
+			'mod_rewrite' => $rss_mod_rewrite,
+			'override_gzip' => $override_rss_gzip,
+			'gzip' => $rss_gzip,
+			'gzip_ext' => $rss_gzip_ext,
+			'rss_url' => $rss_url,
+			'l_rss_feed' => $user->lang['RSS_FEED'],
+			'l_rss_feed_of' => $user->lang['RSS_FEED_OF'],
+		);
+		if (!empty($gym_config['rss_forum_installed'])) {
+			$rss_forum_allow_auth = (boolean) get_gym_option('rss', 'forum', 'allow_auth', $gym_config['rss_override'], $gym_config);
+			// only readable forums can be listed
+			$rss_auth_guest = array_diff_assoc($auth_guest_list['read_post'], set_exclude_list($gym_config['rss_forum_exclude']), $auth_guest_list['empty']);
+			$rss_forum_exclude = set_exclude_list($gym_config['rss_forum_exclude']) + $auth_guest_list['skip_all'] + $auth_guest_list['empty'];
+			$rss_forum_mod_rewrite = (boolean) get_gym_option('rss', 'forum', 'modrewrite', $override_rss_mod_rewrite, $gym_config);
+			$rss_forum_modrtype = max(0, (int) get_gym_option('rss', 'forum', 'modrtype', $override_rss_mod_rewrite, $gym_config));
+
+			$links['setup']['rss'] = array_merge( $links['setup']['rss'],
+				array(
+					'display_forum_alternate' => (int) $gym_config['rss_forum_alternate'],
+					'forum_rss' => !empty($gym_config['rss_forum_installed']),
+					'forum_cat_rss' => $rss_url . ($rss_forum_mod_rewrite && $_phpbb_seo ? ($rss_forum_modrtype > 1 ? "%1\$s/" . ($link_type_bit ? $link_type_bit . '/' : '') . "forum.xml$rss_gzip_ext" : "forum" . $phpbb_seo->seo_delim['forum'] . "%2\$s/" . ($link_type_bit ? $link_type_bit . '/' : '') . "forum.xml$rss_gzip_ext") : "gymrss.$phpEx?forum=%2\$s" . ($link_type_bit ? '&amp;' . $link_type_bit : '')),
+					'auth_guest' => $rss_auth_guest,
+					'forum_exclude' => $rss_forum_exclude,
+					'forum_allow_auth' => $rss_forum_allow_auth,
+			));
+		}
+		$links['main'] = array_merge( $links['main'],
+			array(
+				'GYM_RSS_TITLE' => $user->lang['RSS_FEED'],
+				'GYM_RSS_URL' => $rss_main_url,
+				'GYM_RSS_LINK' => $display_rss_main_links ? sprintf($gym_link_tpl, $rss_main_url, 'feed-icon.png', $user->lang['RSS_FEED']) : '',
+				'GYM_RSS_CHAN_TITLE' => $user->lang['RSS_CHAN_LIST_TITLE'],
+				'GYM_RSS_CHAN_URL' => $rss_chan_url,
+				'GYM_RSS_CHAN_LINK' => $display_rss_main_links ? sprintf($gym_link_tpl, $rss_chan_url, 'feed-icon.png', $user->lang['RSS_CHAN_LIST_TITLE']) : '',
+		));
+		$do_display_main = $display_rss_main_links ? true : $do_display_main;
+		$do_display_index = $display_rss_index_links ? true : $do_display_index;
+		$do_display_cat = $display_rss_cat_links ? true : $do_display_cat;
+	}
+	// HTML
+	if ($html_active) {
+		$display_html_main_links = (boolean) get_gym_option('html', 'gym', 'link_main', OVERRIDE_MODULE, $gym_config);
+		$display_html_index_links = (boolean) get_gym_option('html', 'gym', 'link_index', OVERRIDE_MODULE, $gym_config);
+		$display_html_cat_links = (boolean) get_gym_option('html', 'gym', 'link_cat', OVERRIDE_MODULE, $gym_config);
+		$override_html_mod_rewrite = get_override('html', 'modrewrite', $gym_config);
+		$html_mod_rewrite = (boolean) get_gym_option('html', 'gym', 'modrewrite', $override_html_mod_rewrite, $gym_config);
+		$html_allow_map = (boolean) $gym_config['html_allow_map'];
+		$html_allow_cat_map = (boolean) $gym_config['html_allow_cat_map'];
+		$html_allow_news = (boolean) $gym_config['html_allow_news'];
+		$html_allow_cat_news = (boolean) $gym_config['html_allow_cat_news'];
+		$html_url = $_phpbb_seo ? $phpbb_seo->sslify($gym_config['html_url'], $phpbb_seo->ssl['use'], false) : $gym_config['html_url'];
+		$html_map_url = $gym_config['html_allow_map'] ? $html_url . ($html_mod_rewrite ? 'maps/' : "map.$phpEx") : '';
+		$html_news_url = $gym_config['html_allow_news'] ? $html_url . ($html_mod_rewrite ? 'news/' : "map.$phpEx?news") : '';
+		$links['setup']['html'] = array(
+			'link_main' => $display_html_main_links,
+			'link_index' => $display_html_index_links,
+			'link_cat' => $display_html_cat_links,
+			'override_mod_rewrite' => $override_html_mod_rewrite,
+			'mod_rewrite' => $html_mod_rewrite,
+			'html_url' => $html_url,
+			'allow_map' => $html_allow_map,
+			'allow_news' => $html_allow_news,
+			'allow_cat_map' => $html_allow_cat_map,
+			'allow_cat_news' => $html_allow_cat_news,
+			'l_html_news' => $user->lang['HTML_NEWS'],
+			'l_html_map' => $user->lang['HTML_MAP'],
+			'l_html_news_of' => $user->lang['HTML_NEWS_OF'],
+			'l_html_map_of' => $user->lang['HTML_MAP_OF'],
+		);
+		if (!empty($gym_config['html_forum_installed'])) {
+			$html_forum_mod_rewrite = (boolean) get_gym_option('html', 'forum', 'modrewrite', $override_html_mod_rewrite, $gym_config);
+			$html_forum_allow_map = (boolean) get_gym_option('html', 'forum', 'allow_map', $gym_config['html_override'], $gym_config);
+			$html_forum_allow_cat_map = (boolean) get_gym_option('html', 'forum', 'allow_cat_map', $gym_config['html_override'], $gym_config);
+			$html_forum_allow_news = (boolean) get_gym_option('html', 'forum', 'allow_news', $gym_config['html_override'], $gym_config);
+			$html_forum_allow_cat_news = (boolean) get_gym_option('html', 'forum', 'allow_cat_news', $gym_config['html_override'], $gym_config);
+			$html_auth_guest = array_diff_assoc($auth_guest_list['list'], set_exclude_list($gym_config['html_forum_exclude']), $auth_guest_list['empty']);
+			$html_forum_allow_auth = (boolean) get_gym_option('html', 'forum', 'allow_auth', $gym_config['html_override'], $gym_config);
+			$html_forum_exclude = set_exclude_list($gym_config['html_forum_exclude']) + $auth_guest_list['skip_link'] + $auth_guest_list['empty'];
+			$links['setup']['html'] = array_merge( $links['setup']['html'],
+				array(
+					'forum_allow_map' => $html_forum_allow_map,
+					'forum_map_url' => $html_allow_map ? $html_url . ($html_forum_mod_rewrite ? 'maps/forum/' : "map.$phpEx?forum") : '',
+					'forum_allow_news' => $html_forum_allow_news,
+					'forum_news_url' => $html_allow_news ? $html_url . ($html_forum_mod_rewrite ? 'news/forum/' : "map.$phpEx?forum=news") : '',
+					'forum_allow_cat_map' => $html_forum_allow_cat_map,
+					'forum_cat_map' => $html_url . ($html_forum_mod_rewrite && $_phpbb_seo ? 'maps/forum/%1$s/' : "map.$phpEx?forum=%2\$s"),
+					'forum_allow_cat_news' => $html_forum_allow_cat_news,
+					'forum_cat_news' => $html_url . ($html_forum_mod_rewrite && $_phpbb_seo ? 'news/forum/%1$s/' : "map.$phpEx?forum=%2\$s&amp;news"),
+					'auth_guest' => $html_auth_guest,
+					'forum_exclude' => $html_forum_exclude,
+					'forum_allow_auth' => $html_forum_allow_auth,
+			));
+		}
+		$links['main'] = array_merge( $links['main'],
+			array(
+				'GYM_HTML_NEWS_TITLE' => $user->lang['HTML_NEWS'],
+				'GYM_HTML_NEWS_URL' => $html_news_url,
+				'GYM_HTML_NEWS_LINK' => $display_html_main_links ? sprintf($gym_link_tpl, $html_news_url, 'html_news.gif', $user->lang['HTML_NEWS']) : '',
+				'GYM_HTML_MAP_TITLE' => $user->lang['HTML_MAP'],
+				'GYM_HTML_MAP_URL' => $html_map_url,
+				'GYM_HTML_MAP_LINK' => $display_html_main_links ? sprintf($gym_link_tpl, $html_map_url, 'maps-icon.gif', $user->lang['HTML_MAP']) : '',
+				'GYM_HTML_THEFORUM_NEWS_TITLE' => $user->lang['HTML_FORUM_NEWS'],
+				'GYM_HTML_THEFORUM_NEWS_URL' => $links['setup']['html']['forum_news_url'],
+				'GYM_HTML_THEFORUM_NEWS_LINK' => sprintf($gym_link_tpl, $links['setup']['html']['forum_news_url'], 'html_news.gif', $user->lang['HTML_FORUM_NEWS']),
+				'GYM_HTML_THEFORUM_MAP_TITLE' => $user->lang['HTML_FORUM_MAP'],
+				'GYM_HTML_THEFORUM_MAP_URL' => $links['setup']['html']['forum_map_url'],
+				'GYM_HTML_THEFORUM_MAP_LINK' => sprintf($gym_link_tpl, $links['setup']['html']['forum_map_url'], 'maps-icon.gif', $user->lang['HTML_FORUM_MAP']),
+		));
+		$do_display_main = $display_html_main_links ? true : $do_display_main;
+		$do_display_index = $display_html_index_links ? true : $do_display_index;
+		$do_display_cat = $display_html_cat_links ? true : $do_display_cat;
+	}
+	$links['setup']['main'] = array(
+		'link_main' => ($gym_config['gym_link_main'] && $do_display_main) ? 1 : 0,
+		'link_index' => ($gym_config['gym_link_index'] && $do_display_index) ? 1 : 0,
+		'link_cat' => ($gym_config['gym_link_cat'] && $do_display_cat) ? 1 : 0,
+		'f_public_read' => array_diff_assoc($auth_guest_list['read'], $auth_guest_list['skip_pass']) + array_intersect_assoc($auth_guest_list['skip_cat'], $auth_guest_list['list']),
+	);
+	$links['main'] = array_merge( $links['main'],
+		array(
+			'GYM_LINKS' => $links['setup']['main']['link_main'],
+			'GYM_LINKS_CAT' => $links['setup']['main']['link_cat'],
+	));
+	$links['alternate'] = array();
+	if (!empty($links['setup']['rss']['display_alternate'])) {
+		$links['alternate'] = array(
+			array(
+				'TITLE' => $user->lang['RSS_FEED'],
+				'URL' => $rss_main_url
+			),
+			array(
+				'TITLE' => $user->lang['RSS_CHAN_LIST_TITLE'],
+				'URL' => $rss_chan_url
+			),
+		);
+	}
+	return $links;
+}
+/**
+* get_feed_data($_params)
+* returns the parsed feed.
+* */
+function get_feed_data($_params) {
+	global $user, $config;
+	$feed_data = array(
+		'items' => array(),
+		'setup' => array('date' => false, 'author' => false, 'desclen' => 0, 'chantitle' => '', 'chanlink' => ''),
+	);
+	@ini_set('user_agent','GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+	@ini_set('default_socket_timeout', 5);
+	$xml = @file_get_contents($_params['url']);
+	if ($xml) {
+		// Get encoding
+		$encoding = get_match('`encoding=[\'"]([a-z0-9_-]+)[\'"]`Usi', $xml);
+		$encoding = !empty($encoding) ? strtolower($encoding) : detect_encoding($xml);
+		if(preg_match('`<item>(.*)</item>`si', $xml, $matches)){
+			// Get chan info
+			$feed_data['setup']['chantitle'] = get_match('`<title>(.*)</title>`Usi', $xml, $encoding);
+			$feed_data['setup']['chanlink'] = get_match('`<link>(.*)</link>`Usi', $xml, $encoding);
+			$xml = trim($matches[0]);
+			unset($matches);
+			preg_match_all('`<item>(.*)</item>`Usi', $xml, $matches);
+			unset($matches[0]);
+			if (!empty($matches[1]) && is_array($matches[1])) {
+				$i = 1;
+				foreach($matches[1] as $key => $item) {
+					if ($i > $_params['limit']) {
+						break;
+					}
+					if ($title = get_match('`<title>(.*)</title>`Usi', $item, $encoding)) {
+						if ($link = get_match('`<link>(.*)</link>`Usi', $item, $encoding)) {
+							$feed_data['items'][$i]['PUBDATE'] = false;
+							if ($pubdate = get_match('`<pubDate>(.*)</pubDate>`Usi', $item, $encoding)) {
+								if (($pubdate = strtotime($pubdate, $user->time_now)) > 0) {
+									$feed_data['items'][$i]['PUBDATE'] = $user->format_date($pubdate, $config['default_dateformat']);
+									$feed_data['setup']['date'] = true;
+								}
+							}
+							$feed_data['items'][$i]['DESC'] = false;
+							if ($_params['desc'] && $description = get_match('`<description>(.*)</description>`Usi', $item, $encoding)) {
+								if (empty($_params['html'])) {
+									$description = htmlspecialchars($_params['striptags'] ? strip_tags($description) : $description, ENT_COMPAT, 'UTF-8');
+								}
+								$feed_data['items'][$i]['DESC'] = str_replace(array("\r", "\n"), '<br />', $description);
+								$feed_data['setup']['desclen'] += utf8_strlen($feed_data['items'][$i]['DESC']);
+							}
+							$feed_data['items'][$i]['SOURCE'] = false;
+							if ($source = get_match('`<source[\s]+url="(.*)">(.*)</source>`Usi', $item, $encoding)) {
+								$feed_data['items'][$i]['SOURCE'] = htmlspecialchars($source, ENT_COMPAT, 'UTF-8');
+							}
+							$feed_data['items'][$i]['TITLE'] = htmlspecialchars($title, ENT_COMPAT, 'UTF-8');
+							$feed_data['items'][$i]['LINK'] = htmlspecialchars($link, ENT_COMPAT, 'UTF-8');
+							$feed_data['items'][$i]['IMG'] = $user->img('topic_read', $feed_data['items'][$i]['TITLE'], false, '', 'src');
+							$i++;
+						}
+					}
+					unset($matches[1][$key]);
+				}
+			}
+			unset($matches);
+		}
+	}
+	unset($xml);
+	return $feed_data;
+}
+/**
+* detect_encoding($string)
+* Inspired from php.net : http://www.php.net/mb_detect_encoding
+*/
+function detect_encoding($string) {
+	if (function_exists('mb_detect_encoding')) {
+		if ($encoding = @mb_detect_encoding($string . 'a')) {
+			return strtolower($encoding);
+		}
+	}
+	// Else at least try to see if utf-8, otherwise fall back to iso-8859-1
+	// non-overlong 2-byte|excluding overlongs|straight 3-byte|excluding surrogates|planes 1-3|planes 4-15|plane 16
+	return preg_match('%(?:[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF] |\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})+%xs', $string) ? 'utf-8' : 'iso-8859-1';
+}
+/**
+* get_match($pattern, $string, $encoding)
+* returns properly encoded match from feed
+*/
+function get_match($pattern, $string, $encoding = 'utf-8') {
+	static $filters = array('<![CDATA['=>'', ']]>'=>'');
+	$string = strtr($string, $filters);
+	preg_match($pattern, $string, $out);
+	if(!empty($out[1])) {
+  		// cdata
+  		$out[1] = strtr($out[1], $filters);
+  		if( strtolower($encoding) != 'utf-8') {
+			$out[1] = utf8_recode($out[1], $encoding);
+		}
+  		return @html_entity_decode(trim($out[1]), ENT_COMPAT, 'UTF-8');
+	} else {
+		return '';
+	}
+}
+/**
+* set_exclude_list($id_list) will build up the public unauthed ids
+*/
+function set_exclude_list($id_list) {
+	$exclude_list = empty($id_list) ? array() : explode(',', $id_list);
+	$ret = array();
+	foreach ($exclude_list as $value ) {
+		$value = (int) trim($value);
+		if (!empty($value)) {
+			$ret[$value] = $value;
+		}
+	}
+	return $ret;
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/gym_common_admin.php
===================================================================
--- gym_sitemaps/includes/gym_common_admin.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_common_admin.php	(Premod 3.0.8)
@@ -0,0 +1,15 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_common_admin.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/gym_output.php
===================================================================
--- gym_sitemaps/includes/gym_output.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_output.php	(Premod 3.0.8)
@@ -0,0 +1,374 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_output.php 262 2010-04-20 11:06:58Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+* gym_sitemaps Class
+* www.phpBB-SEO.com
+* @package GYM Sitemaps & RSS
+*/
+class gym_output {
+	var $options = array();
+	var $outputs = array();
+	var $cache = array();
+	var $gzip_config = array();
+	/**
+	* constuctor
+	*/
+	function gym_output(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		$this->options = &$this->gym_master->actions;
+		$this->outputs = &$this->gym_master->output_data;
+		$this->cache = &$this->gym_master->cache_config;
+		// Set up and check gzip handling
+		$this->init_gzip();
+		if ($this->outputs['showstats']) {
+			if ( @function_exists('memory_get_usage') ) {
+				$this->outputs['mem_usage'] = memory_get_usage();
+			}
+		}
+		// used to skip cache when auth items are not cached
+		// initialized after thanks to the &
+		$this->cache['do_cache'] = true;
+	}
+	/**
+	* do_output() is called when no cache file is available for the request
+	* Will filter cases, call function to build output and cache on the fly
+	* @access private
+	*/
+	function do_output() {
+		global $config, $phpEx, $phpbb_seo, $db;
+		if ($this->outputs['showstats']) {
+			$this->outputs['gen_data'] = sprintf('%.5f', $phpbb_seo->microtime_float() - $this->outputs['microtime']);
+			$mem_stats = $this->mem_usage();
+			$this->outputs['data'] .= "\n" . sprintf($this->gym_master->style_config['stats_genlist'], $this->outputs['gen_data'], $mem_stats, $db->sql_num_queries(), $this->outputs['url_sofar']);
+		}
+		if ($this->cache['cache_enable']) {
+			$this->write_cache();
+			if ($this->check_cache($this->cache['file'])) {
+				$this->cache_output();
+			} else {
+				$this->otf_output();
+			}
+		} else {
+			$this->otf_output();
+		}
+		return;
+	}
+	/**
+	* cache_output() is called to output from a cached file
+	* Build the last stats, send the header and output the cached file
+	* @access private
+	*/
+	function cache_output() {
+		global $phpbb_seo, $db;
+		if ($this->outputs['showstats']) {
+			$this->outputs['gen_out'] = sprintf('%.5f', $phpbb_seo->microtime_float() - $this->outputs['microtime']);
+			$genstats = sprintf($this->gym_master->style_config['stats_start'], $this->outputs['gen_out'], $db->sql_num_queries());
+		} else {
+			$genstats = '';
+		}
+		if ($this->gzip_config['gzip']) {
+			$this->send_header();
+			readfile($this->cache['file']);
+		} else {
+			$this->send_header();
+			if ($this->cache['cache_force_gzip']) {
+				readgzfile($this->cache['file']);
+				if ($this->outputs['showstats']) {
+					$this->outputs['gen_out'] = sprintf('%.5f', $phpbb_seo->microtime_float() - $this->outputs['microtime']);
+					$genstat2 = sprintf($this->gym_master->style_config['stats_end'], $this->outputs['gen_out'], $db->sql_num_queries());
+					echo $genstats . $genstat2;
+				}
+			} else {
+				readfile($this->cache['file']);
+				if ($this->outputs['showstats']) {
+					$this->outputs['gen_out'] = sprintf('%.5f', $phpbb_seo->microtime_float() - $this->outputs['microtime']);
+					$genstat2 = sprintf($this->gym_master->style_config['stats_end'], $this->outputs['gen_out'], $db->sql_num_queries());
+					echo $genstats . $genstat2;
+				}
+			}
+		}
+		$this->gym_master->safe_exit();
+		return;
+	}
+	/**
+	* otf_output() will do the output on the fly
+	* when cache disabled or caching failed
+	* @access private
+	*/
+	function otf_output() {
+		global $lang,$phpbb_seo;
+		// Unset lang array before output
+		unset($lang);
+		if ($this->gzip_config['gzip']) {
+			$this->outputs['data'] = gzencode($this->outputs['data'], $this->gym_master->gzip_config['gzip_level']);
+			$this->send_header();
+			echo $this->outputs['data'];
+			unset($this->outputs['data']);
+
+		} else {
+			$this->send_header();
+			echo $this->outputs['data'];
+			if ($this->outputs['showstats']) {
+				$mem_stats = $this->mem_usage();
+				$this->outputs['gen_out'] = sprintf('%.5f', $phpbb_seo->microtime_float() - $this->outputs['microtime']);
+				$genstats = sprintf($this->gym_master->style_config['stats_nocache'], $this->outputs['gen_out'], $mem_stats);
+				echo $genstats;
+			}
+			unset($this->outputs['data']);
+		}
+		$this->gym_master->safe_exit();
+		return;
+	}
+	/**
+	* send_header() takes care about headers
+	* @access private
+	*/
+	function send_header() {
+		global $user;
+		if (!empty($_SERVER['SERVER_SOFTWARE']) && strstr($_SERVER['SERVER_SOFTWARE'], 'Apache/2')) {
+			header ('Cache-Control: no-cache, pre-check=0, post-check=0, max-age=0');
+		} else {
+			header ('Cache-Control: private, pre-check=0, post-check=0, max-age=0');
+		}
+		$content_types = array('rss' => 'application/rss+xml', 'google' => 'text/xml', 'yahoo' => 'text/plain');
+		if (stripos($user->browser, 'YahooFeedSeeker') === false) {
+			if ($this->gym_master->actions['action_type'] === 'rss' && ( $this->gym_master->gym_config['rss_xslt'] && $this->gym_master->gym_config['rss_force_xslt'] ) ) {
+				$content_types['rss'] = 'text/xml';
+			}
+		}
+		header('Expires: '. $this->outputs['expires_time']);
+		header('Last-Modified: ' . gmdate('D, d M Y H:i:s \G\M\T', $this->outputs['last_mod_time']));
+		if (!empty($this->outputs['etag'])) {
+			header('Etag: ' . $this->outputs['etag']);
+		}
+		header('Accept-Ranges: bytes');
+		header('Content-type: ' . $content_types[$this->gym_master->actions['action_type']] . '; charset=UTF-8');
+		if ($this->gzip_config['gzip']) {
+			header('Content-Encoding: ' . $this->check_gzip_type());
+		}
+		return;
+	}
+
+	// --> RSS functions <--
+
+	// --> Cache function <--
+	/**
+	* setup_cache Check and cache set up
+	* @access private
+	*/
+	function setup_cache() {
+		global $phpbb_seo;
+		// For module inclusion in ACP : No cache
+		if ( defined('ADMIN_START') ) {
+			return;
+		}
+		// build cache file name
+		$ssl_bit = $phpbb_seo->ssl['use'] ? 'ssl_' : '';
+		$file_name = ( !empty($this->options['module_sub']) ?  $this->options['module_sub'] : '' ) . trim(str_replace(array('&amp;', '/'), '-', $this->options['extra_params_full']),'-') . '-a' . $this->options['auth_param'];
+		if ($this->gym_master->gym_config['gym_cript_cache']) {
+			$file_name = md5( $file_name );
+		}
+		$file_name = $this->gym_master->actions['action_type'] . '_' . ( ( !empty($this->options['module_main']) ) ?  $this->options['module_main'] . '_' : 'main_' ) . $ssl_bit . $file_name . $this->cache['cache_file_ext'];
+		$this->cache['file'] = $this->gym_master->path_config['gym_path'] . 'cache/' . $file_name;
+		// Output, first check cache
+		if ($this->cache['do_cache'] && $this->check_cache($this->cache['file'])) {
+			// Check expiration
+			$this->cache['cache_born'] = filemtime($this->cache['file']);
+			$this->cache['cache_too_old'] = ($this->cache['cache_born'] + $this->cache['cache_max_age']) <= $this->outputs['time'] ? true : false;
+			if ($this->cache['cache_too_old'] && $this->cache['cache_auto_regen']) {
+				@unlink($this->cache['file']);
+				$this->cache['cached'] = false;
+			}
+		}
+		// Expiration time & Etags
+		if (!$this->cache['cached'] || !$this->cache['do_cache']) {
+			// Take care about lastmod when not cached
+			if (($this->outputs['last_mod_time'] + $this->cache['cache_max_age']) <= $this->outputs['time']) {
+				$this->outputs['last_mod_time'] = $this->outputs['time'];
+				$this->outputs['expires_time'] = gmdate('D, d M Y H:i:s \G\M\T', ($this->outputs['time'] + $this->cache['cache_max_age']));
+				$this->outputs['etag'] = md5($this->outputs['expires_time'] . $this->cache['file']);
+				$this->update_lastmod();
+			} else {
+				$this->outputs['expires_time'] = gmdate('D, d M Y H:i:s \G\M\T', ($this->outputs['last_mod_time'] + $this->cache['cache_max_age']));
+				$this->outputs['etag'] = md5($this->outputs['expires_time'] . $this->cache['file']);
+			}
+			$this->check_mod_since();
+		} else {
+			$this->outputs['last_mod_time'] = $this->cache['cache_born'];
+			$this->outputs['expires_time'] = gmdate('D, d M Y H:i:s \G\M\T', ($this->outputs['last_mod_time'] + $this->cache['cache_max_age']));
+			$this->outputs['etag'] = md5($this->outputs['expires_time'] . $this->cache['file']);
+			$this->check_mod_since();
+			$this->cache_output();
+		}
+
+		return;
+	}
+	/**
+	* update_lastmod Update the lastmod date, used when cache is not actvated.
+	* @access private
+	*/
+	function update_lastmod() {
+		global $config;
+		$config_name = $this->options['action_type'] . '_' . (!empty($this->options['module_main']) ? $this->options['module_main'] . '_' : '') . 'last_mod_time';
+		$config_value = $this->outputs['last_mod_time'] > $config['board_startdate'] ? $this->outputs['last_mod_time'] : $this->outputs['time'];
+		set_config($config_name, $config_value, 1);
+
+		return;
+	}
+	/**
+	* mem_usage()
+	* @access private
+	*/
+	function mem_usage() {
+		if (function_exists('memory_get_usage')) {
+			if ($memory_usage = memory_get_usage()) {
+				$memory_usage -= $this->outputs['mem_usage'];
+				$memory_usage = ($memory_usage >= 1048576) ? round((round($memory_usage / 1048576 * 100) / 100), 2) . ' MB' : (($memory_usage >= 1024) ? round((round($memory_usage / 1024 * 100) / 100), 2) . ' Kb' : $memory_usage . ' b');
+				return "( Mem Usage : $memory_usage )";
+			}
+		}
+		return '';
+	}
+	/**
+	* check_mod_since() will exit with 304 Not Modified header
+	* and exit upon HTTP_IF_MODIFIED_SINCE or HTTP_IF_NONE_MATCH Checks
+	* @access private
+	*/
+	function check_mod_since() {
+		if ($this->cache['mod_since']) {
+			$http = 'HTTP/1.1 ';
+			if (isset($_SERVER['HTTP_IF_NONE_MATCH'])) {
+				if ($_SERVER['HTTP_IF_NONE_MATCH'] == $this->outputs['etag']) {
+					header($http . ' 304 Not Modified');
+					$this->gym_master->safe_exit();
+				}
+			}
+			if(isset($_SERVER['HTTP_IF_MODIFIED_SINCE'])) {
+				if (strtotime($_SERVER['HTTP_IF_MODIFIED_SINCE']) == $this->outputs['last_mod_time']) {
+					header($http . ' 304 Not Modified');
+					$this->gym_master->safe_exit();
+				}
+			}
+		}
+		return;
+	}
+	/**
+	* check_cache($file) will tell if the required file exists.
+	* @access private
+	*/
+	function check_cache($file) {
+		if(!$this->cache['cache_enable']) {
+			$this->cache['cached'] = false;
+			return false;
+		}
+		if(!@file_exists($file)) {
+			$this->cache['cached'] = false;
+			return false;
+		}
+		$this->cache['cached'] = true;
+		return true;
+	}
+	/**
+	* write_cache( $action, $id = 0 ) will write the cached file.
+	* @access private
+	*/
+	function write_cache() {
+		if(!$this->cache['cache_enable'] or !$this->cache['do_cache']) {
+			return false;
+		}
+		$file = $this->cache['file'];
+		if ($this->gzip_config['gzip'] || $this->cache['cache_force_gzip']) {
+			$handle = @gzopen($file, 'wb');
+			@flock($handle, LOCK_EX);
+			@gzwrite($handle, $this->outputs['data']);
+			@flock($handle, LOCK_UN);
+			@gzclose ($handle);
+		} else {
+			$handle = @fopen($file, 'wb');
+			@flock($handle, LOCK_EX);
+			@fwrite($handle, $this->outputs['data']);
+			@flock($handle, LOCK_UN);
+			@fclose ($handle);
+		}
+		$this->update_lastmod();
+		@umask(0000);
+		@chmod($file, 0666);
+		return true;
+	}
+	// --> Gun-Zip handeling <--
+	/**
+	* init_gzip ().
+	* Check if gzip is available and set proper values for this event
+	* if phpBB gun-zip is acvtivated, then it must be in the module
+	* @access private
+	*/
+	function init_gzip() {
+		global $config;
+		$this->gzip_config['gzip'] = $config['gzip_compress'] ? 1 : intval($this->gym_master->set_module_option('gzip', $this->gym_master->override['gzip']));
+		// if gunzip is only activated for GYM, we turn it on for phpBB also
+		if ($this->gzip_config['gzip'] && !$config['gzip_compress']) {
+			$config['gzip_compress'] = 1;
+		}
+		if (!$this->check_gzip() && $this->gzip_config['gzip']) {
+			$this->gzip_config['gzip'] = false;
+		}
+		$this->gym_master->url_config['gzip_ext_out'] = $this->gzip_config['gzip'] ? '.gz' : '';
+		$this->gym_master->url_config['gzip_ext_out'] = (intval($this->gym_master->set_module_option('gzip_ext', $this->gym_master->override['gzip'])) > 0) ? $this->gym_master->url_config['gzip_ext_out'] : '';
+		$this->check_requested_ext();
+		return;
+	}
+	/**
+	* check_gzip() tells is Gun-Zip is available
+	* @access private
+	*/
+	function check_gzip() {
+		if (headers_sent()) {
+			return false;
+		}
+		if (!empty($_SERVER['HTTP_ACCEPT_ENCODING']) && ( (strpos($_SERVER['HTTP_ACCEPT_ENCODING'], 'gzip') !==false ) || strpos($_SERVER['HTTP_ACCEPT_ENCODING'], 'x-gzip') !==false ) ) {
+			return true;
+		} else {
+			return false;
+		}
+		return;
+	}
+	/**
+	* check_gzip_type() return the user's Gun-Zip type
+	* @access private
+	*/
+	function check_gzip_type() {
+		if (strpos($_SERVER['HTTP_ACCEPT_ENCODING'],'gzip') !==false ) {
+			return 'gzip';
+		} elseif (strpos($_SERVER['HTTP_ACCEPT_ENCODING'], 'x-gzip') !==false ) {
+			return 'x-gzip';
+		}
+		return 'gzip';
+	}
+	/**
+	* check_requested_ext($uri) will force the .gz extention if required
+	* @access private
+	*/
+	function check_requested_ext() {
+		global $phpbb_seo, $phpEx;
+		return;
+		$uri = $phpbb_seo->seo_path['uri'];
+		if ( ( strpos($phpbb_seo->seo_path['uri'], '.gz') !== false ) && ($this->ext_config['gzip_ext_out'] == '') && !strpos($uri, $phpEx)) {
+			$uri = str_replace ('.gz', "", $uri);
+			$url= $this->path_config['root_url'] . ltrim($uri, '/');
+			$this->gym_master->gym_redirect($url);
+		} elseif ( ( strpos($uri, '.gz') === false ) && ($this->ext_config['gzip_ext_out'] != '') && !strpos($uri, $phpEx)) {
+			$uri = $uri . '.gz';
+			$url= $this->path_config['root_url'] . ltrim($uri, '/');
+			$this->gym_master->gym_redirect($url);
+		}
+		return;
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/phpbb_seo_class_light.php
===================================================================
--- gym_sitemaps/includes/phpbb_seo_class_light.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/phpbb_seo_class_light.php	(Premod 3.0.8)
@@ -0,0 +1,252 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: phpbb_seo_class_light.php 264 2010-06-02 07:13:08Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+/**
+* phpBB_SEO Class lite
+* For Compatibility with the phpBB SEO mod rewrites
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+//
+
+class phpbb_seo {
+	var	$modrtype = -1;
+	var	$seo_path = array();
+	var	$seo_url = array( 'forum' =>  array(), 'topic' =>  array(), 'user' => array(), 'username' => array(), 'group' => array(), 'file' => array() );
+	var	$seo_delim = array( 'forum' => '-f', 'topic' => '-t', 'user' => '-u', 'group' => '-g', 'start' => '-', 'sr' => '-', 'file' => '/');
+	var	$seo_ext = array( 'forum' => '.html', 'topic' => '.html', 'post' => '.html', 'user' => '.html', 'group' => '.html',  'index' => '', 'global_announce' => '/', 'leaders' => '.html', 'atopic' => '.html', 'utopic' => '.html', 'npost' => '.html', 'pagination' => '.html', 'gz_ext' => '');
+	var	$seo_static = array( 'forum' => 'forum', 'topic' => 'topic', 'post' => 'post', 'user' => 'member', 'group' => 'group', 'index' => '', 'global_announce' => 'announces', 'leaders' => 'the-team', 'atopic' => 'active-topics', 'utopic' => 'unanswered', 'npost' => 'newposts', 'pagination' => 'page', 'gz_ext' => '.gz' );
+	var	$seo_opt = array();
+	var	$seo_cache = array();
+	var	$RegEx = array();
+	var	$sftpl = array();
+	var	$url_replace = array();
+	var	$ssl = array('requested' => false, 'forced' => false);
+	var	$light = true;
+	/**
+	* constuctor
+	*/
+	function phpbb_seo() {
+		global $config, $phpEx;
+		// fix for an interesting bug with parse_str http://bugs.php.net/bug.php?id=48697
+		// and apparently, the bug is still here in php5.3
+		@ini_set("mbstring.internal_encoding", 'UTF-8');
+		// URL Settings
+		$this->seo_opt = array(
+			'profile_inj' => false,
+			'rem_small_words' => false,
+			'virtual_folder' => false,
+			'virtual_root' => false,
+		);
+		// --> DOMAIN SETTING <-- //
+		// SSL, beware with cookie secure, it won't force ssl here,
+		// so you will need to switch to ssl for your user to use cookie based session (no sid)
+		// could be done by using an https link to login form (or within the redirect after login)
+		$this->ssl['requested'] = (bool) ((isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] === 'on' || $_SERVER['HTTPS'] === true)) || (isset($_SERVER['SERVER_PORT']) && (int) $_SERVER['SERVER_PORT'] === 443));
+		$this->ssl['forced'] = (bool) (($config['server_protocol'] === 'https//'));
+		$this->ssl['use'] = (bool) ($this->ssl['requested'] || $this->ssl['forced']);
+		// Server Settings, rely on DB
+		$server_protocol = $this->ssl['use'] ? 'https://' : 'http://';
+		$server_name = trim($config['server_name'], '/ ');
+		$server_port = max(0, (int) $config['server_port']);
+		$server_port = ($server_port && $server_port <> 80) ? ':' . $server_port : '';
+		$script_path = trim($config['script_path'], '/ ');
+		$script_path = (empty($script_path) ) ? '' : $script_path . '/';
+		$this->seo_path['root_url'] = utf8_strtolower($server_protocol . $server_name . $server_port . '/');
+		$this->seo_path['phpbb_urlR'] = $this->seo_path['phpbb_url'] =  $this->seo_path['root_url'] . $script_path;
+		$this->seo_path['phpbb_script'] = $script_path;
+		$this->seo_path['canonical'] = '';
+		// File setting
+		$this->seo_req_uri();
+		$this->seo_opt['seo_base_href'] = $this->seo_opt['req_file'] = $this->seo_opt['req_self'] = '';
+		if ($script_name = (!empty($_SERVER['PHP_SELF'])) ? $_SERVER['PHP_SELF'] : getenv('PHP_SELF')) {
+			// From session.php
+			// Replace backslashes and doubled slashes (could happen on some proxy setups)
+			$this->seo_opt['req_self'] = str_replace(array('\\', '//'), '/', $script_name);
+			// basenamed page name (for example: index)
+			$this->seo_opt['req_file'] = urlencode(htmlspecialchars(str_replace(".$phpEx", '', basename($this->seo_opt['req_self']))));
+		}
+		// see if we have some custom replacement
+		if (!empty($this->url_replace)) {
+			$this->url_replace = array(
+				'find' => array_keys($this->url_replace),
+				'replace' => array_values($this->url_replace)
+			);
+		}
+		// preg_replace() patterns for format_url()
+		// One could want to add |th|horn after |slash, but I'm not sure that  should be replaced with t and  with e
+		$this->RegEx['url_find'] = array('`&([a-z]+)(acute|grave|circ|cedil|tilde|uml|lig|ring|caron|slash);`i', '`&(amp;)?[^;]+;`i', '`[^a-z0-9]`i'); // Do not remove : deaccentuation, html/xml entities & non a-z chars
+		$this->RegEx['url_replace'] = array('\1', '-', '-');
+		if ($this->seo_opt['rem_small_words']) {
+			$this->RegEx['url_find'][] = '`(^|-)[a-z0-9]{1,2}(?=-|$)`i';
+			$this->RegEx['url_replace'][] = '-';
+		}
+		$this->RegEx['url_find'][] ='`[-]+`'; // Do not remove : multi hyphen reduction
+		$this->RegEx['url_replace'][] = '-';
+		// $1 parent : string/
+		// $2 title / url : topic-title / forum-url-fxx
+		// $3 id
+		$this->sftpl = array(
+			'topic' => ($this->seo_opt['virtual_folder'] ? '%1$s/' : '') . '%2$s' . $this->seo_delim['topic'] . '%3$s',
+			'topic_smpl' => ($this->seo_opt['virtual_folder'] ? '%1$s/' : '') . $this->seo_static['topic'] . '%3$s',
+			'forum' => $this->modrtype >= 2 ? '%2$s' : $this->seo_static['forum'] . '%3$s',
+			'group' => $this->seo_opt['profile_inj'] ? '%2$s' . $this->seo_delim['group'] . '%3$s' : $this->seo_static['group'] . '%3$s',
+		);
+		return;
+	}
+	// --> Gen stats
+	/**
+	* Returns microtime
+	* Borrowed from php.net
+	*/
+	function microtime_float() {
+		return array_sum(explode(' ', microtime()));
+	}
+	// --> URL rewriting functions <--
+	/**
+	* format_url( $url, $type = 'topic' )
+	* Prepare Titles for URL injection
+	*/
+	function format_url( $url, $type = 'topic' ) {
+		$url = preg_replace('`\[.*\]`U','',$url);
+		if (isset($this->url_replace['find'])) {
+			$url = str_replace($this->url_replace['find'], $this->url_replace['replace'], $url);
+		}
+		$url = htmlentities($url, ENT_COMPAT, 'UTF-8');
+		$url = preg_replace($this->RegEx['url_find'] , $this->RegEx['url_replace'], $url);
+		$url = strtolower(trim($url, '-'));
+		return empty($url) ? $type : $url;
+	}
+	/**
+	* set_url( $url, $id = 0, $type = 'forum', $parent = '' )
+	* Prepare url first part and checks cache
+	*/
+	function set_url( $url, $id = 0, $type = 'forum',  $parent = '') {
+		if ( empty($this->seo_url[$type][$id]) ) {
+			return ( $this->seo_url[$type][$id] = !empty($this->cache_config[$type][$id]) ? $this->cache_config[$type][$id] : sprintf($this->sftpl[$type], $parent, $this->format_url($url, $this->seo_static[$type]) . $this->seo_delim[$type] . $id, $id) );
+		}
+		return $this->seo_url[$type][$id];
+	}
+	/**
+	* prepare_url( $type, $title, $id, $parent = '', $smpl = false )
+	* Prepare url first part
+	*/
+	function prepare_url( $type, $title, $id, $parent = '', $smpl = false ) {
+		return empty($this->seo_url[$type][$id]) ? ($this->seo_url[$type][$id] = sprintf($this->sftpl[$type . ($smpl ? '_smpl' : '')], $parent, !$smpl ? $this->format_url($title, $this->seo_static[$type]) : '', $id)) : $this->seo_url[$type][$id];
+	}
+	/**
+	* set_title( $type, $title, $id, $parent = '' )
+	* Set title for url injection
+	*/
+	function set_title( $type, $title, $id, $parent = '' ) {
+		return empty($this->seo_url[$type][$id]) ? ($this->seo_url[$type][$id] = ($parent ? $parent . '/' : '') . $this->format_url($title, $this->seo_static[$type])) : $this->seo_url[$type][$id];
+	}
+	/**
+	* prepare_iurl( $data, $type, $parent = '' )
+	* Prepare url first part (not for forums) with SQL based URL rewriting
+	*/
+	function prepare_iurl( $data, $type, $parent = '' ) {
+		$id = max(0, (int) $data[$type . '_id']);
+		if ( empty($this->seo_url[$type][$id]) ) {
+			if (!empty($data[$type . '_url'])) {
+				return ($this->seo_url[$type][$id] = $data[$type . '_url'] . $id);
+			} else {
+				return ($this->seo_url[$type][$id] = sprintf($this->sftpl[$type . ($this->modrtype > 2 ? '' : '_smpl')], $parent, $this->modrtype > 2 ? $this->format_url($data[$type . '_title'], $this->seo_static[$type]) : '', $id));
+			}
+		}
+		return $this->seo_url[$type][$id];
+	}
+	/**
+	* drop_sid( $url )
+	* drop the sid's in url
+	*/
+	function drop_sid( $url ) {
+		return (strpos($url, 'sid=') !== false) ? trim(preg_replace(array('`&(amp;)?sid=[a-z0-9]*(&amp;|&)?`', '`(\?)sid=[a-z0-9]*`'), array('\2', '\1'), $url), '?') : $url;
+	}
+	/**
+	* set_user_url( $username, $user_id = 0 )
+	* Prepare profile url
+	*/
+	function set_user_url( $username, $user_id = 0 ) {
+		if (empty($this->seo_url['user'][$user_id])) {
+			$username = strip_tags($username);
+			$this->seo_url['username'][$username] = $user_id;
+			if ( $this->seo_opt['profile_inj'] ) {
+				if ( $this->seo_opt['profile_noids'] ) {
+					$this->seo_url['user'][$user_id] = $this->seo_static['user'] . '/' . $this->seo_url_encode($username);
+				} else {
+					$this->seo_url['user'][$user_id] = $this->format_url($username,  $this->seo_delim['user']) . $this->seo_delim['user'] . $user_id;
+				}
+			} else {
+				$this->seo_url['user'][$user_id] = $this->seo_static['user'] . $user_id;
+			}
+		}
+	}
+	/**
+	* seo_url_encode( $url )
+	* custom urlencoding
+	*/
+	function seo_url_encode( $url ) {
+		// can be faster to return $url directly if you do not allow more chars than
+		// [a-zA-Z0-9_\.-] in your usernames
+		// return $url;
+		// Here we hanlde the "&", "/", "+" and "#" case proper ( http://www.php.net/urlencode => http://issues.apache.org/bugzilla/show_bug.cgi?id=34602 )
+		static $find = array('&', '/', '#', '+');
+		static $replace = array('%26', '%2F', '%23', '%2b');
+		return rawurlencode(str_replace( $find, $replace, utf8_normalize_nfc(htmlspecialchars_decode(str_replace('&amp;amp;', '%26', rawurldecode($url))))));
+	}
+	/**
+	* Returns the full REQUEST_URI
+	*/
+	function seo_req_uri() {
+		if ( !empty($_SERVER['HTTP_X_REWRITE_URL']) ) { // IIS  isapi_rewrite
+			$this->seo_path['uri'] = ltrim($_SERVER['HTTP_X_REWRITE_URL'], '/');
+		} elseif ( !empty($_SERVER['REQUEST_URI']) ) { // Apache mod_rewrite
+			$this->seo_path['uri'] = ltrim($_SERVER['REQUEST_URI'], '/');
+		} else { // no mod rewrite
+			$this->seo_path['uri'] =  ltrim($_SERVER['SCRIPT_NAME'], '/') . ( ( !empty($_SERVER['QUERY_STRING']) ) ? '?'.$_SERVER['QUERY_STRING'] : '' );
+		}
+		$this->seo_path['uri'] = str_replace( '%26', '&', rawurldecode($this->seo_path['uri']));
+		// workaround for FF default iso encoding
+		if (!$this->is_utf8($this->seo_path['uri'])) {
+			$this->seo_path['uri'] = utf8_normalize_nfc(utf8_recode($this->seo_path['uri'], 'iso-8859-1'));
+		}
+		$this->seo_path['uri'] = $this->seo_path['root_url'] . $this->seo_path['uri'];
+		return $this->seo_path['uri'];
+	}
+	/**
+	* sslify($url, $ssl = true,  $proto_check = true)
+	* properly set http protocol (eg http or https)
+	* if no protocol is specified, will return false with $proto_check set to true
+	*/
+	function sslify($url, $ssl = true, $proto_check = true) {
+		static $mask = '`^https?://`i';
+		$url = trim($url);
+		if ($url && preg_match($mask, $url)) {
+			$replace = $ssl ? 'https://' : 'http://';
+			return preg_replace($mask, $replace, $url);
+		}
+		return $proto_check ? false : $url;
+	}
+	/**
+	* is_utf8($string)
+	* Borrowed from php.net : http://www.php.net/mb_detect_encoding (detectUTF8)
+	*/
+	function is_utf8($string) {
+		// non-overlong 2-byte|excluding overlongs|straight 3-byte|excluding surrogates|planes 1-3|planes 4-15|plane 16
+		return preg_match('%(?:[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF] |\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})+%xs', $string);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/gym_html.php
===================================================================
--- gym_sitemaps/includes/gym_html.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_html.php	(Premod 3.0.8)
@@ -0,0 +1,833 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_html.php 262 2010-04-20 11:06:58Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_sitemaps.' . $phpEx);
+/**
+* gym_html Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class gym_html extends gym_sitemaps {
+	var	$html_config = array();
+	var	$start = 0;
+	/**
+	* constuctor
+	*/
+	function gym_html($standalone = false) {
+		global $phpbb_seo, $config;
+		$this->gym_sitemaps('html');
+		// Check the main vars
+		$this->init_get_vars();
+		if (empty($this->actions['action_modules'])) {
+			$this->gym_error(404, '', __FILE__, __LINE__);
+		}
+		$this->output_data['tpl'] = $this->output_data['page_title'] = '';
+		// Used to store module data upon index calls
+		$this->output_data['module_data'] = array();
+		$this->actions['pagination_limit'] = 0;
+		// Setup the output
+		$this->cache_config = array_merge(
+			// Global
+			$this->cache_config,
+			// Other stuff required here
+			array(
+				'main_cache_on' => (boolean) $this->set_module_option('main_cache_on', $this->override['cache']),
+				'opt_cache_on' => (boolean) $this->set_module_option('opt_cache_on', $this->override['cache']),
+				'main_cache_ttl' => round($this->set_module_option('main_cache_ttl', $this->override['cache']),2) * 3600,
+				'opt_cache_ttl' => round($this->set_module_option('opt_cache_ttl', $this->override['cache']),2) * 3600,
+			)
+		);
+		$this->html_config = array(
+			'html_c_info' => $this->gym_config['html_c_info'],
+			'html_url' => $phpbb_seo->sslify($this->gym_config['html_url'], $phpbb_seo->ssl['use'], false),
+			'html_pagination' => (int) $this->set_module_option('pagination', $this->override['pagination']),
+			'html_item_pagination' => (int) $this->set_module_option('item_pagination', $this->override['pagination']),
+			'html_pagination_limit' => (int) max(1, $this->set_module_option('pagination_limit', $this->override['pagination'])),
+			'html_news_pagination' => $this->set_module_option('news_pagination', $this->override['pagination']),
+			'html_news_pagination_limit' => (int) max(1, $this->set_module_option('news_pagination_limit', $this->override['pagination'])),
+			'html_map_time_limit' => (int) max(0, $this->set_module_option('map_time_limit', $this->override['limit'])*3600*24),
+			'html_cat_time_limit' => (int) max(0, $this->set_module_option('cat_time_limit', $this->override['limit'])*3600*24),
+			'html_news_time_limit' => (int) max(0, $this->set_module_option('news_time_limit', $this->override['limit'])*3600*24),
+			'html_cat_news_time_limit' => (int) max(0, $this->set_module_option('cat_news_time_limit', $this->override['limit'])*3600*24),
+			'html_modrewrite' => (boolean) $this->set_module_option('modrewrite', $this->override['modrewrite']),
+			'html_modrtype' => (int) $this->set_module_option('modrtype', $this->override['modrewrite']),
+			'html_stats_on_news' => (boolean) $this->gym_auth_value($this->set_module_option('stats_on_news', $this->gym_config['html_override'])),
+			'html_stats_on_map' => (boolean) $this->gym_auth_value($this->set_module_option('stats_on_map', $this->gym_config['html_override'])),
+			'html_birthdays_on_news' => (boolean) $this->gym_auth_value($this->set_module_option('birthdays_on_news', $this->gym_config['html_override'])),
+			'html_birthdays_on_map' => (boolean) $this->gym_auth_value($this->set_module_option('html_birthdays_on_map', $this->gym_config['html_override'])),
+			'html_sitename' => $this->set_module_option('sitename'),
+			'html_site_desc' => $this->set_module_option('site_desc'),
+			'html_logo_url' => trim($this->set_module_option('logo_url'), '/'),
+			'html_sort' => $this->set_module_option('sort', $this->override['sort']),
+			'html_cat_sort' => $this->set_module_option('cat_sort', $this->override['sort']),
+			'html_news_sort' => $this->set_module_option('news_sort', $this->override['sort']),
+			'html_cat_news_sort' => $this->set_module_option('cat_news_sort', $this->override['sort']),
+			'html_allow_auth' => (boolean) $this->set_module_option('allow_auth', $this->gym_config['html_override']),
+			'html_disp_online' => (boolean) $this->gym_auth_value($this->set_module_option('disp_online', $this->gym_config['html_override'])),
+			'html_disp_tracking' => (boolean) $this->gym_auth_value($this->set_module_option('disp_tracking', $this->gym_config['html_override'])),
+			'html_disp_status' => (boolean) $this->gym_auth_value($this->set_module_option('disp_status', $this->gym_config['html_override'])),
+			'html_allow_profile' => (boolean) $this->gym_auth_value($this->set_module_option('allow_profile', $this->gym_config['html_override'])),
+			'html_allow_profile_links' => (boolean) $this->gym_auth_value($this->set_module_option('allow_profile_links', $this->gym_config['html_override'])),
+			'html_allow_map' => (boolean) $this->set_module_option('allow_map', $this->gym_config['html_override']),
+			'html_allow_cat_map' => (boolean) $this->set_module_option('allow_cat_map', $this->gym_config['html_override']),
+			'html_allow_news' => (boolean) $this->set_module_option('allow_news', $this->gym_config['html_override']),
+			'html_allow_cat_news' => (boolean) $this->set_module_option('allow_cat_news', $this->gym_config['html_override']),
+			'html_sumarize' => (int) $this->set_module_option('sumarize', $this->gym_config['html_override']),
+			'html_sumarize_method' => trim($this->set_module_option('sumarize_method', $this->gym_config['html_override'])),
+			'html_allow_bbcode' => (boolean) $this->gym_auth_value($this->set_module_option('allow_bbcode', $this->gym_config['html_override'])),
+			'html_strip_bbcode' => trim($this->set_module_option('strip_bbcode', $this->gym_config['html_override'])),
+			'html_allow_links' => (boolean) $this->gym_auth_value($this->set_module_option('allow_links', $this->gym_config['html_override'])),
+			'html_allow_emails' => (boolean) $this->set_module_option('allow_emails', $this->gym_config['html_override']),
+			'html_allow_smilies' => (boolean) $this->gym_auth_value($this->set_module_option('allow_smilies', $this->gym_config['html_override'])),
+			'html_allow_sig' => (boolean) $this->gym_auth_value($this->set_module_option('allow_sig', $this->gym_config['html_override'])),
+			'html_msg_filters' => array(),
+			'html_auth_msg' => '',
+			'html_do_explain' => false,
+		);
+		$config['gzip_compress'] = $config['gzip_compress'] ? 1 : (boolean) $this->set_module_option('gzip', $this->override['gzip']);
+		$this->html_config['html_auth_guest'] = ($this->html_config['html_allow_auth'] && $this->gym_auth['reg']) ? false : true;
+		$this->cache_config['do_cache_main'] = (boolean) ($this->html_config['html_auth_guest'] && $this->cache_config['main_cache_on']);
+		$this->cache_config['do_cache_opt'] = (boolean) ($this->html_config['html_auth_guest'] && $this->cache_config['opt_cache_on']);
+		$this->output_data['left_col_cache_file'] = $this->output_data['right_col_cache_file'] = '';
+		$this->actions['is_auth'] = $this->actions['is_active'] = $this->actions['is_public'] = false;
+
+		if (!$standalone) {
+			// Check the rss specific vars and do basic set_up for msg output
+			$this->init_html_vars();
+			$this->html_output();
+		}
+		return;
+	}
+	/**
+	* init_html_vars()
+	* Set up the specific rss modules GET vars.
+	* @access private
+	*/
+	function init_html_vars() {
+		global $user, $phpEx, $phpbb_seo;
+		// Take care about module categorie urls, assuming that they are of the proper form
+		// news|map/module_main/module_sub/
+		// this code will filter in between special map|news and categroy map and news
+		// assuming that the cat urls will be of the following form title-sepXX (forum-title-fxx.html or /)
+		// or without ID, if the phpbb_seo cache array is properly set.
+		if (!empty($this->actions['module_main']) && !empty($this->actions['module_sub']) && $this->actions['module_sub'] != 'map' && $this->actions['module_sub'] != 'news') {
+			if (preg_match('`^[a-z0-9_-]*-[a-z]{1}+([0-9]+)`', $this->actions['module_sub'], $match)) {
+				$this->actions['module_sub'] = $match[1];
+			} else if ($id = @array_search($this->actions['module_sub'], $phpbb_seo->cache_config[$this->actions['module_main']]) ) {
+				$this->actions['module_sub'] = (int) $id;
+			}
+		}
+		$this->start = max(0, request_var('start', 0));
+		$this->actions['html_news_list'] = $this->actions['html_map_list'] = false;
+		$this->html_config['extra_title'] = $this->url_config['extra_params_full'] = $this->url_config['extra_params'] = '';
+		if ( isset($_GET['news']) && ($this->html_config['html_allow_cat_news'] || $this->html_config['html_allow_news'])) {
+			$this->actions['html_news_list'] = true;
+			if (empty($this->actions['module_sub']) && $this->html_config['html_allow_news']) {
+				$this->actions['module_sub'] = 'news';
+			}
+		} else if (@$this->actions['module_sub'] == 'news' && $this->html_config['html_allow_news']) {
+			$this->actions['html_news_list'] = true;
+		} else if (!empty($this->actions['module_sub']) && $this->html_config['html_allow_cat_map']) {
+			$this->actions['html_map_list'] = true;
+		} else if (!empty($this->actions['module_main']) && (empty($this->actions['module_sub']) || $this->actions['module_sub'] == 'map' ) && $this->html_config['html_allow_map']) {
+			$this->actions['html_map_list'] = true;
+		}
+		if ($this->actions['html_news_list']) {
+			$this->actions['html_type'] = 'news';
+			$this->actions['display_stats'] = $this->html_config['html_stats_on_news'];
+			$this->actions['display_birthdays'] = $this->html_config['html_birthdays_on_news'];
+
+		} else {
+			$this->actions['html_type'] = 'map';
+			$this->actions['display_stats'] = $this->html_config['html_stats_on_map'];
+			$this->actions['display_birthdays'] = $this->html_config['html_birthdays_on_map'];
+		}
+		// Adjust variable a bit
+		if ($this->actions['html_news_list']) { // requested and auth
+			$this->html_config['html_msg_filters'] = $this->set_msg_strip($this->html_config['html_strip_bbcode']);
+		}
+		// Set up module's urls : Pagination
+		$this->url_config['html_start_ext'] = '';
+		if ($this->html_config['html_modrewrite']) {
+			$page = !empty($phpbb_seo->seo_static['page']) ? $phpbb_seo->seo_static['page'] : 'page';
+			$html = !empty($phpbb_seo->seo_ext['page']) ? $phpbb_seo->seo_ext['page'] : '.html';
+			$this->url_config['html_start'] = "$page%1\$s$html";
+			$this->url_config['html_default'] = 'maps/';
+			$this->url_config['html_news_default'] = 'news/';
+		} else {
+			$this->url_config['html_start'] = '&amp;start=%1$s';
+			$this->url_config['html_news_default'] = $this->url_config['html_default'] . '?news';
+		}
+	}
+	/**
+	* html_add_start($start, $tpl_start_key) builds the pagination bit
+	* @access private
+	*/
+	function html_add_start($start, $tpl_start_key = 'html_start') {
+		return $start > 0 ? sprintf($this->url_config[$tpl_start_key], $start) : @$this->url_config[$tpl_start_key . '_ext'];
+	}
+	/**
+	* html_build_url($tpl_key, $title, $id, $start = 0, $tpl_start_key) builds the url
+	* $title must be properly formated prior to injection
+	* @access private
+	*/
+	function html_build_url($tpl_key, $title = '', $id = 0, $start = 0, $tpl_start_key = 'html_start') {
+		return sprintf($this->url_config[$tpl_key], $title, $id) . $this->html_add_start($start, $tpl_start_key);
+	}
+	/**
+	* html_output() will build all html output
+	* @access private
+	*/
+	function html_output() {
+		global $phpEx, $db, $config, $phpbb_root_path, $user, $template, $cache, $phpbb_seo;
+		$module_obj = null;
+		$left_col = $right_col = false;
+		// Set up the base href tag, could be done better but saves a file edit this way ( and works too ;-) )
+		// Assuming that map.php is either in phpBB's dir or above (not under).
+		$bhref_ulr = ($phpbb_root_path === './') ? $phpbb_seo->seo_path['phpbb_url'] : str_replace(ltrim($phpbb_root_path, './'), '', $phpbb_seo->seo_path['phpbb_url']);
+		$template->assign_vars(array(
+			'META' => '<base href="' . $bhref_ulr . '"/>' . "\n",
+			'S_CONTENT_DIRECTION'	=> $user->lang['DIRECTION'],
+			'S_CONTENT_FLOW_BEGIN'	=> ($user->lang['DIRECTION'] == 'ltr') ? 'left' : 'right',
+			'S_CONTENT_FLOW_END'	=> ($user->lang['DIRECTION'] == 'ltr') ? 'right' : 'left',
+			'NEWEST_POST_IMG' => $user->img('icon_topic_newest', 'VIEW_NEWEST_POST'),
+			'LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST'),
+		));
+		// module action
+		if (in_array($this->actions['module_main'], $this->actions['action_modules'])) { // List item from the module
+			// Add index page in navigation links
+			$template->assign_block_vars('navlinks', array(
+				'FORUM_NAME' => $user->lang['HTML_MAP'],
+				'U_VIEW_FORUM'	=> append_sid($this->html_config['html_url']. $this->url_config['html_default']))
+			);
+			$module_class = $this->actions['action_type'] . '_' . $this->actions['module_main'];
+			$module_obj = $this->load_module($module_class, 'html_init', true);
+		} else { // sitemap index
+			// We are working on all available modules
+			$left_col = $this->html_index();
+		}
+		$page_title = (!empty($this->output_data['page_title']) ? $this->output_data['page_title'] : $user->lang['HTML_' . strtoupper($this->actions['html_type'])]) . $this->html_config['extra_title'];
+		// Add current page in navigation links
+		$template->assign_block_vars('navlinks', array(
+			'FORUM_NAME' => $page_title,
+			'U_VIEW_FORUM'	=> append_sid($this->url_config['current']))
+		);
+		if (!$this->actions['is_active']) {
+			header('HTTP/1.1 404 Not Found');
+			global $msg_title;
+			$msg_title = $user->lang['GYM_ERROR_404'];
+			trigger_error('GYM_ERROR_404_EXPLAIN');
+		}
+		if (!$this->actions['is_auth']) {
+			header('HTTP/1.1 401 Unauthorized');
+			if ($user->data['user_id'] != ANONYMOUS) {
+				trigger_error('GYM_ERROR_401');
+			}
+			login_box('', $user->lang['GYM_LOGIN']);
+		}
+		// Let's kill duplicate now !
+		if (!empty($this->url_config['current'])) {
+			$this->seo_kill_dupes(append_sid($this->url_config['current']));
+		}
+		$template->set_filenames(array('body' => 'gym_sitemaps/index_body.html'));
+		$this->cache_config['do_cache_main'] = (boolean) ($this->cache_config['do_cache_main'] && $this->actions['is_public']);
+		$this->cache_config['do_cache_opt'] = (boolean) ($this->cache_config['do_cache_opt'] && $this->actions['is_public']);
+		$cache_find = array('`(\?|&amp;|&)sid\=[a-z0-9]+`i', '`[\s]+`');
+		$cache_replace = array('',' ');
+		$ssl_bit = $phpbb_seo->ssl['use'] ? 'ssl_' : '';
+		// Main output
+		if (!empty($this->output_data['left_col_tpl'])) {
+			$template->set_filenames(array('left_col' => $this->output_data['left_col_tpl']));
+			if ($this->cache_config['do_cache_main'] && !empty($this->output_data['left_col_cache_file'])) {
+				$cache_file = '_gym_html_' . $this->output_data['left_col_cache_file'] . '_' . $ssl_bit . $user->data['user_lang'] . '_' . $this->start;
+				if (($left_col = $cache->get($cache_file)) === false) {
+					$module_obj->html_main();
+					$left_col = $template->assign_display('left_col', '', true);
+					// Strip whitespaces and sids
+					$left_col = preg_replace($cache_find, $cache_replace, $left_col );
+					$cache->put($cache_file, $left_col, $this->cache_config['main_cache_ttl']);
+				}
+			}
+			if (!$left_col) {
+				$module_obj->html_main();
+				$left_col = $template->assign_display('left_col', '', true);
+			}
+		}
+		// Optional output
+		if (!empty($this->output_data['right_col'])) {
+			if ($this->cache_config['do_cache_opt'] && !empty($this->output_data['right_col_cache_file'])) {
+				$cache_file = '_gym_html_' . $this->output_data['right_col_cache_file'] . '_' . $ssl_bit . $user->data['user_lang'];
+				if (($right_col = $cache->get($cache_file)) === false) {
+					$module_obj->html_module();
+					$template->set_filenames(array('right_col' => $this->output_data['right_col_tpl']));
+					$right_col = $template->assign_display('right_col', '', true);
+					// Strip whitespaces and sids
+					$right_col = preg_replace($cache_find, $cache_replace, $right_col );
+					$cache->put($cache_file, $right_col, $this->cache_config['opt_cache_ttl']);
+				}
+			}
+			if (!$right_col) {
+				$module_obj->html_module();
+				$template->set_filenames(array('right_col' => $this->output_data['right_col_tpl']));
+				$right_col = $template->assign_display('right_col', '', true);
+			}
+		}
+		unset($module_obj);
+		$tpl_data = array();
+		if ($this->actions['display_stats']) {
+			// Set some stats, get posts count from forums data if we... hum... retrieve all forums data
+			$total_posts	= $config['num_posts'];
+			$total_topics	= $config['num_topics'];
+			$total_users	= $config['num_users'];
+			$l_total_user_s = ($total_users == 0) ? 'TOTAL_USERS_ZERO' : 'TOTAL_USERS_OTHER';
+			$l_total_post_s = ($total_posts == 0) ? 'TOTAL_POSTS_ZERO' : 'TOTAL_POSTS_OTHER';
+			$l_total_topic_s = ($total_topics == 0) ? 'TOTAL_TOPICS_ZERO' : 'TOTAL_TOPICS_OTHER';
+			$tpl_data += array(
+				'TOTAL_POSTS'	=> sprintf($user->lang[$l_total_post_s], $total_posts),
+				'TOTAL_TOPICS'	=> sprintf($user->lang[$l_total_topic_s], $total_topics),
+				'TOTAL_USERS'	=> sprintf($user->lang[$l_total_user_s], $total_users),
+			);
+			if ($this->html_config['html_allow_profile']) {
+				$tpl_data += array(
+					'NEWEST_USER'	=> sprintf($user->lang['NEWEST_USER'], get_username_string( $this->html_config['html_allow_profile_links'] ? 'full' : 'no_profile', $config['newest_user_id'], $config['newest_username'], $config['newest_user_colour'])),
+				);
+			}
+		}
+		// Generate birthday list if required ...
+		if ($this->actions['display_birthdays']) {
+			$birthday_list = '';
+			$now = getdate(time() + $user->timezone + $user->dst - date('Z'));
+			$sql = 'SELECT u.user_id, u.username, u.user_colour, u.user_birthday
+				FROM ' . USERS_TABLE . ' u
+				LEFT JOIN ' . BANLIST_TABLE . " b ON (u.user_id = b.ban_userid)
+				WHERE (b.ban_id IS NULL
+					OR b.ban_exclude = 1)
+					AND u.user_birthday LIKE '" . $db->sql_escape(sprintf('%2d-%2d-', $now['mday'], $now['mon'])) . "%'
+					AND u.user_type IN (" . USER_NORMAL . ', ' . USER_FOUNDER . ')';
+			$result = $db->sql_query($sql);
+			while ($row = $db->sql_fetchrow($result)) {
+				$birthday_list .= (($birthday_list != '') ? ', ' : '') . get_username_string('full', $row['user_id'], $row['username'], $row['user_colour']);
+				if ($age = (int) substr($row['user_birthday'], -4)) {
+					$birthday_list .= ' (' . ($now['year'] - $age) . ')';
+				}
+			}
+			$db->sql_freeresult($result);
+			$tpl_data += array(
+				'BIRTHDAY_LIST'	=> $birthday_list,
+				'S_DISPLAY_BIRTHDAY_LIST' => !empty($birthday_list),
+			);
+		}
+		$template->assign_vars($tpl_data + array(
+				'S_SINGLE_TRAKING' => !empty($this->output_data['single_traking']) ? true : false,
+				'S_LOGIN_ACTION' => append_sid("{$phpbb_root_path}ucp.$phpEx", 'mode=login'),
+				'S_SEO_FORUM' => strpos($config['default_lang'], 'fr') !== false ? 'fr/' : 'en/',
+				'LEFT_COL' => $left_col,
+				'RIGHT_COL' => $right_col,
+			)
+		);
+		if ($this->actions['pagination_limit'] > 0) { // Add page number to title
+			$page_title .= $this->start > 0 ? ' - ' . $user->lang['HTML_PAGE'] . ' ' . ( floor( $this->start / $this->actions['pagination_limit'] ) + 1 ) : '';
+		}
+		page_header($page_title, $this->html_config['html_disp_online']);
+		if (!empty($this->html_config['html_logo_url'])) {
+			$template->assign_vars(array(
+					'SITE_LOGO_IMG' => '<img src="' . $this->path_config['gym_img_url'] . $this->html_config['html_logo_url'] . '" alt="' . $this->output_data['page_title'] . '" />',
+				)
+			);
+		}
+		page_footer();
+		return;
+	}
+	/**
+	* html_index()
+	* Builds the site map index
+	* @access private
+	*/
+	function html_index() {
+		global $phpEx, $phpbb_root_path, $user, $template, $cache, $phpbb_seo, $config;
+		if ($this->actions['html_news_list']) {
+			// Add index page in navigation links
+			$template->assign_block_vars('navlinks', array(
+				'FORUM_NAME' => $user->lang['HTML_MAP'],
+				'U_VIEW_FORUM'	=> append_sid($this->html_config['html_url']. $this->url_config['html_default']),
+			));
+			$this->url_config['current'] = $this->html_config['html_url'] . $this->url_config['html_news_default'];
+			$this->actions['is_auth'] = true;
+			$src_url = $this->gym_config['html_rss_news_url'];
+			// if the source is set on the same domain, hanlde ssl properly
+			if (strpos($src_url, $config['server_name']) !== false) {
+				$src_url = $phpbb_seo->sslify($src_url, $phpbb_seo->ssl['use']);
+			}
+			$this->actions['is_active'] = $src_url ? 1 : 0;
+			$params = array(
+				// Full URL to the RSS 2.0 feed
+				'url' => str_replace('&amp;', '&', $src_url),
+				'desc' => true,
+				'html' => true,
+				'limit' => (int) $this->gym_config['html_rss_news_limit'],
+			);
+			display_feed($params);
+			$template->assign_vars(array('GYM_RSS_SLIDE_SP' => false));
+			$template->set_filenames(array('index_data' => 'gym_sitemaps/gym_link_body.html'));
+		} else {
+			$ssl_bit = $phpbb_seo->ssl['use'] ? 'ssl_' : '';
+			$cache_file = '_gym_html_map_' . $ssl_bit . $user->data['user_lang'];
+			if (($this->output_data['module_data'] = $cache->get($cache_file)) === false) {
+				$this->load_modules('html_index');
+				$cache->put($cache_file, $this->output_data['module_data']);
+			}
+			$this->output_data['page_title'] = sprintf($user->lang['HTML_MAP_OF'], $this->html_config['html_sitename']);
+			$this->actions['is_active'] = $this->actions['is_auth'] = true;
+			$this->url_config['current'] = $this->html_config['html_url'] . $this->url_config['html_default'];
+			$template->set_filenames(array('index_data' => 'gym_sitemaps/index_list.html'));
+			if (!empty($this->output_data['module_data'])) {
+				foreach ($this->output_data['module_data'] as $module_name => $module_data) {
+					// First modules
+					$template->assign_block_vars('module', array(
+						'TITLE' => $module_data['title'],
+						'NEWS_TITLE' => sprintf($user->lang['HTML_NEWS_OF'], $module_data['title']),
+						'MAP_TITLE' => sprintf($user->lang['HTML_MAP_OF'], $module_data['title']),
+						'DESC' => $module_data['desc'],
+						'IMG' => $module_data['img'],
+						'MAP_URL' => append_sid($module_data['map_url']),
+						'NEWS_URL' => append_sid($module_data['news_url']),
+					));
+					// Then the module maps & news pages
+					foreach ($module_data['links'] as $data) {
+						$template->assign_block_vars('module.links', array(
+							'MAP_TITLE' => $data['map_title'],
+							'MAP_URL' => append_sid($data['map_url']),
+							'NEWS_TITLE' => $data['news_title'],
+							'NEWS_URL' => append_sid($data['news_url']),
+						));
+					}
+				}
+			}
+		}
+		$template->assign_vars(array(
+			'HTML_SITENAME' => $this->html_config['html_sitename'],
+			'HTML_SITEDESC' => $this->html_config['html_site_desc'],
+			'HTML_URL' => $this->html_config['html_allow_map'] ? append_sid($this->html_config['html_url'] . $this->url_config['html_default']) : '',
+			'HTML_NEWS_TITLE' => sprintf($user->lang['HTML_NEWS_OF'], $this->html_config['html_sitename']),
+			'HTML_NEWS_URL' => $this->html_config['html_allow_news'] ? append_sid($this->html_config['html_url'] . $this->url_config['html_news_default']) : '',
+			'NEWS_IMG_SRC' => $this->path_config['gym_img_url'] . 'html_news.gif',
+			'ROOT_PATH' => $phpbb_root_path,
+		));
+		$return = $template->assign_display('index_data', '', true);
+		return $return;
+	}
+	/**
+	* prepare_message($message, $bbcode_uid, $bbcode_bitfield, $patterns = array(), $replaces = array())
+	* will put together BBcodes and smilies before the output
+	* @access private
+	*/
+	function prepare_message(&$message, $bbcode_uid, $bitfield, $patterns = array(), $replaces = array()) {
+		global $config, $user, $phpbb_root_path;
+		static $bbcode;
+		if (!empty($patterns)) {
+			$message = preg_replace($patterns, $replaces, $message);
+		}
+		if ($this->html_config['html_sumarize'] > 0 ) {
+			$message = $this->summarize( $message, $this->html_config['html_sumarize'], $this->html_config['html_sumarize_method'] );
+			// Clean broken tag at the end of the message
+			$message = preg_replace('`\<[^\<\>]*$`i', ' ...', $message);
+			// Close broken bbcode tags requiring it, only quotes for now
+			$this->close_bbcode_tags($message, $bbcode_uid);
+		}
+		$message = censor_text($message);
+		if ($bitfield && $this->html_config['html_allow_bbcode']) {
+			if (!class_exists('bbcode')) {
+				global $phpbb_root_path, $phpEx;
+				include_once($phpbb_root_path . 'includes/bbcode.' . $phpEx);
+			}
+			if (empty($bbcode)) {
+				$bbcode = new bbcode($bitfield);
+			} else {
+				$bbcode->bbcode($bitfield);
+			}
+			$bbcode->bbcode_second_pass($message, $bbcode_uid);
+		}
+		$message = bbcode_nl2br($message);
+		// Parse smilies
+		$message = $this->smiley_text($message, !$this->html_config['html_allow_smilies']);
+		if ($this->html_config['html_sumarize'] > 0 ) {
+			// last clean up
+			static $_find = array('`\<\!--[^\<\>]+--\>`Ui', '`\[\/?[^\]\[]*\]`Ui');
+			$message = preg_replace($_find, '', $message);
+		}
+		return true;
+	}
+	/**
+	* close_bbcode_tags(&$message, $uid, $bbcodelist)
+	* will tend to do it nicely ;-)
+	* Will close the bbcode tags requiring it in the list (quote|b|u|i|color|*|list)
+	* Beware, bo not reduce $bbcodelist without knowing what you are doing
+	*/
+	function close_bbcode_tags(&$message, $uid, $bbcodelist = 'quote|b|u|i|color|*|list') {
+		global $config, $user, $phpbb_seo;
+		$open_lists = $close_lists = array();
+		$bbcodelist = str_replace('|*', '|\*', $bbcodelist);
+		$open_count = preg_match_all('`\[(' . $bbcodelist . ')(\=([a-z0-9]{1}))?[^\]\[]*\:' . $uid . '\]`i', $message, $open_matches);
+		$close_count = preg_match_all('`\[/(' . $bbcodelist . ')(\:([a-z]{1}))?[^\]\[]*\:' . $uid . '\]`i', $message, $close_matches);
+		if ($open_count == $close_count) { // No need to go further
+			return;
+		}
+		if (!empty($open_matches[1])) {
+			$open_list = array_count_values($open_matches[1]);
+			$close_list = !empty($close_matches[1]) ? array_count_values($close_matches[1]) : array();
+			$list_to_close = array();
+			if (isset($open_list['list'])) {
+				foreach ($open_matches[1] as $k => $v) {
+					if ($v == 'list') {
+						$open_lists[] = !empty($open_matches[3][$k]) ? 'o' : 'u';
+					}
+				}
+				if (!empty($close_matches[1])) {
+					foreach ($close_matches[1] as $k => $v) {
+						if ($v == 'list') {
+							$close_lists[] = !empty($close_matches[3][$k]) ? 'o' : 'u';
+						}
+					}
+				}
+				$list_to_close = array_reverse(array_diff_assoc($open_lists, $close_lists));
+			}
+			unset($open_list['*'], $open_list['list'], $open_matches, $close_matches);
+			foreach ($open_list as $bbcode => $total) {
+				if (empty($close_list[$bbcode]) || $close_list[$bbcode] < $total) {
+					// close the tags
+					$diff = empty($close_list[$bbcode]) ? $total : $total - $close_list[$bbcode];
+					$message .= str_repeat("[/$bbcode:$uid]", $diff);
+				}
+			}
+			// Close the lists if required
+			foreach ($list_to_close as $ltype) {
+				$message .= "[/*:m:$uid][/list:$ltype:$uid]";
+			}
+		}
+		return;
+	}
+	/**
+	* set_msg_strip($bbcode_list) will build up the unauthed bbcode list
+	* $bbcode_list = 'code:0,img:1,quote';
+	* $bbcode_list = 'all';
+	* 1 means the bbcode and it's content will be striped.
+	* all means all bbcodes.
+	* $returned_list = array('patern' => $matching_patterns, 'replace' => $replace_patterns);
+	* @access private
+	*/
+	function set_msg_strip($bbcode_list) {
+		$patterns = $replaces = array();
+		// Now the bbcodes
+		if (!$this->html_config['html_allow_bbcode'] || preg_match('`all\:?([0-1]*)`i', $bbcode_list, $matches)) {
+			if ( (@$matches[1] != 1 ) ) {
+				$patterns[] = '`\[\/?[a-z0-9\*\+\-]+(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})\]`i';
+				$replaces[] = '';
+			} else {
+				$patterns[] = '`\[([a-z0-9\*\+\-]+)((=|:)[^\:\]]*)?\:[0-9a-z]{5,}\].*\[/(?1)(:?[^\:\]]*)?\:[0-9a-z]{5,}\]`Usi';
+				$replaces[] = "{ \\1 }";
+			}
+			$patterns[] = '`<[^>]*>(.*<[^>]*>)?`Usi'; // All html
+			$replaces[] = '';
+		} else {
+			// Take care about links & emails
+			if ( !$this->html_config['html_allow_links'] ) {
+				if ( !$this->html_config['html_allow_emails'] ) { // Saves couple RegEx
+					$email_find = '[a-z0-9&\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+';
+					$email_replace = 'str_replace(array("@", "."), array("  AT  ", " DOT "),"\\1")';
+					$email_option = 'e';
+				} else {
+					$email_find = '.*?';
+					$email_replace = "\\1";
+					$email_option = '';
+				}
+				$patterns[] = '`<!\-\- ([lmw]+) \-\-><a (?:class="[\w-]+" )?href="(.*?)">.*?</a><!\-\- \1 \-\->`i';
+				$replaces[] = "\\2";
+				$patterns[] = '`\[/?url[^\]\[]*\]`i';
+				$replaces[] = '';
+				$patterns[] = '`<!\-\- e \-\-><a href="mailto:(' . $email_find . ')">.*?</a><!\-\- e \-\->`i' . $email_option;
+				$replaces[] = $email_replace;
+			}
+			if ( !$this->html_config['html_allow_emails'] && $this->html_config['html_allow_links'] ) {
+				$patterns[] = '`<!\-\- e \-\-><a href="mailto:([a-z0-9&\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+)">.*?</a><!\-\- e \-\->`ei';
+				$replaces[] = 'str_replace(array("@", "."), array("  AT  ", " DOT "),"\\1")';
+			}
+			$exclude_list =  ( empty($bbcode_list) ? array() : explode(',', trim($bbcode_list, ', ')) );
+			$RegEx_unset = $RegEx_remove = '';
+			foreach ($exclude_list as $key => $value ) { // Group the RegEx
+				$value = trim($value, ', ');
+				if (preg_match("`[a-z0-9]+(\:([0-1]*))?`i", $value, $matches) ) {
+					$values = (strpos($value, ':') !== false) ?  explode(':', $value) : array($value);
+					if ( (@$matches[2] != 1 ) ) {
+						$RegEx_unset .= (!empty($RegEx_unset) ? '|' : '' ) . $values[0];
+					} else {
+						$RegEx_remove .= (!empty($RegEx_remove) ? '|' : '' ) . $values[0];
+					}
+				}
+			}
+			if (!empty($RegEx_remove) ) {
+				$patterns[] =  '`\[(' . $RegEx_remove . ')((=|:)[^\:\]]*)?\:[0-9a-z]{5,}\].*\[/(?1)(:?[^\:\]]*)?\:[0-9a-z]{5,}\]`Usi';
+				$replaces[] = "{ \\1 }";
+			}
+			if (!empty($RegEx_unset) ) {
+				$patterns[] =  '`\[/?(' . $RegEx_unset . ')(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})?\]`i';
+				$replaces[] = '';
+			}
+		}
+		return  array('pattern' => $patterns, 'replace' => $replaces);
+	}
+	/**
+	* Summarize method selector
+	* @access private
+	*/
+	function summarize($string, $limit, $method = 'lines') {
+		switch ($method) {
+			case 'words':
+				return $this->word_limit($string, $limit);
+				break;
+			case 'chars':
+				return $this->char_limit($string, $limit);
+				break;
+			case 'lines':
+			default:
+				return $this->line_limit($string, $limit);
+				break;
+		}
+	}
+	/**
+	* Cut the text by lines
+	* @access private
+	*/
+	function line_limit($string, $limit = 10, $ellipsis = ' ...') {
+		return count($lines = preg_split("`[\n\r]+`", ltrim($string), $limit + 1)) > $limit ? rtrim(utf8_substr($string, 0, utf8_strlen($string) - utf8_strlen(end($lines)))) . $ellipsis : $string;
+	}
+	/**
+	* Cut the text according to the number of words.
+	* Borrowed from www.php.net http://www.php.net/preg_replace
+	* @access private
+	*/
+	function word_limit($string, $limit = 50, $ellipsis = ' ...') {
+		return count($words = preg_split('`\s+`', ltrim($string), $limit + 1)) > $limit ? rtrim(utf8_substr($string, 0, utf8_strlen($string) - utf8_strlen(end($words)))) . $ellipsis : $string;
+	}
+	/**
+	* Cut the text according to the number of characters.
+	* Borrowed from www.php.net http://www.php.net/preg_replace
+	* @access private
+	*/
+	function char_limit($string, $limit = 100, $ellipsis = ' ...') {
+		return utf8_strlen($fragment = utf8_substr($string, 0, $limit + 1 - utf8_strlen($ellipsis))) < utf8_strlen($string) + 1 ? preg_replace('`\s*\S*$`', '', $fragment) . $ellipsis : $string;
+	}
+	/**
+	* Get forum children (one level or all, with or without info)
+	* @access private
+	*/
+	function get_forum_children($forum_id, $skip_pass = true, $only_post = true, $ids_only = true, $one_lvl = true) {
+		global $db, $auth;
+		$rows = array();
+		$_sql_pre = $one_lvl ? 'f1' : 'f2';
+		$sql_sel = $ids_only ? "$_sql_pre.forum_id, $_sql_pre.forum_type, $_sql_pre.forum_password" : "$_sql_pre.*";
+		$sql_where = $only_post ? " AND $_sql_pre.forum_type = " . FORUM_POST : '';
+		if (!$one_lvl) {
+			$sql = "SELECT $sql_sel
+				FROM " . FORUMS_TABLE . " f1
+				LEFT JOIN " . FORUMS_TABLE . " f2 ON (f2.left_id BETWEEN f1.left_id AND f1.right_id)
+				WHERE f1.forum_id = $forum_id
+				$sql_where
+				ORDER BY f2.left_id ASC";
+		} else {
+			$sql = "SELECT $sql_sel
+				FROM " . FORUMS_TABLE . " f1
+				WHERE f1.parent_id = $forum_id
+				$sql_where
+				ORDER BY f1.left_id ASC";
+		}
+		$result = $db->sql_query($sql);
+		while ($row = $db->sql_fetchrow($result)) {
+			if ($skip_pass && $row['forum_password']) {
+				continue;
+			}
+			$rows[$row['forum_id']] = $row;
+		}
+
+		$db->sql_freeresult($result);
+		// Do not return this forum info
+		if (!$one_lvl) {
+			unset($rows[$forum_id]);
+		}
+		// only keep authed forum
+		foreach ($rows as $_forum_id => $null) {
+			if (!$auth->acl_get('f_read', $_forum_id)) {
+				unset($rows[$_forum_id]);
+			}
+		}
+		return !empty($rows) ? $rows : false;
+	}
+	/**
+	* Generate topic status
+	*/
+	function topic_status(&$topic_row, $replies, $unread_topic, &$folder_img, &$folder_alt, &$topic_type) {
+		global $user, $config;
+		$folder = $folder_new = '';
+		if ($topic_row['topic_status'] == ITEM_MOVED) {
+			$topic_type = $user->lang['VIEW_TOPIC_MOVED'];
+			$folder_img = 'topic_moved';
+			$folder_alt = 'TOPIC_MOVED';
+		} else {
+			switch ($topic_row['topic_type']) {
+				case POST_GLOBAL:
+					$topic_type = $user->lang['VIEW_TOPIC_GLOBAL'];
+					$folder = 'global_read';
+					$folder_new = 'global_unread';
+				break;
+				case POST_ANNOUNCE:
+					$topic_type = $user->lang['VIEW_TOPIC_ANNOUNCEMENT'];
+					$folder = 'announce_read';
+					$folder_new = 'announce_unread';
+				break;
+				case POST_STICKY:
+					$topic_type = $user->lang['VIEW_TOPIC_STICKY'];
+					$folder = 'sticky_read';
+					$folder_new = 'sticky_unread';
+				break;
+				default:
+					$topic_type = '';
+					$folder = 'topic_read';
+					$folder_new = 'topic_unread';
+					if ($config['hot_threshold'] && $replies >= $config['hot_threshold'] && $topic_row['topic_status'] != ITEM_LOCKED) {
+						$folder .= '_hot';
+						$folder_new .= '_hot';
+					}
+				break;
+			}
+			if ($topic_row['topic_status'] == ITEM_LOCKED) {
+				$topic_type = $user->lang['VIEW_TOPIC_LOCKED'];
+				$folder .= '_locked';
+				$folder_new .= '_locked';
+			}
+			$folder_img = ($unread_topic) ? $folder_new : $folder;
+			$folder_alt = ($unread_topic) ? 'NEW_POSTS' : (($topic_row['topic_status'] == ITEM_LOCKED) ? 'TOPIC_LOCKED' : 'NO_NEW_POSTS');
+			// Posted image?
+			if (!empty($topic_row['topic_posted']) && $topic_row['topic_posted']) {
+				$folder_img .= '_mine';
+			}
+		}
+		if ($topic_row['poll_start'] && $topic_row['topic_status'] != ITEM_MOVED) {
+			$topic_type = $user->lang['VIEW_TOPIC_POLL'];
+		}
+	}
+	/**
+	* Generate topic pagination
+	* Duplicated here to prevent from including functions_display.php
+	*/
+	function topic_generate_pagination($replies, $url) {
+		global $config, $user;
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		global $phpbb_seo, $phpEx;
+		// www.phpBB-SEO.com SEO TOOLKIT END
+		// Make sure $per_page is a valid value
+		$per_page = ($config['posts_per_page'] <= 0) ? 1 : $config['posts_per_page'];
+		if (($replies + 1) > $per_page) {
+			$total_pages = ceil(($replies + 1) / $per_page);
+			$pagination = '';
+			$times = 1;
+			for ($j = 0; $j < $replies + 1; $j += $per_page) {
+				$pagination .= '<a href="' . $url . '&amp;start=' . $j . '">' . $times . '</a>';
+				if ($times == 1 && $total_pages > 5) {
+					$pagination .= ' ... ';
+					// Display the last three pages
+					$times = $total_pages - 3;
+					$j += ($total_pages - 4) * $per_page;
+				} else if ($times < $total_pages) {
+					$pagination .= '<span class="page-sep">' . $user->lang['COMMA_SEPARATOR'] . '</span>';
+				}
+				$times++;
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+				static $pagin_find = array();
+				static $pagin_replace = array();
+				if (empty($pagin_find)) {
+					$pagin_find = array( '`(\.(?!' . $phpEx . ')[a-z0-9]+)([\w\#$%&~\-;:=,?@+]*)&amp;start=([0-9]+)`i', '`/([\w\#$%&~\-;:=,?@+]*)&amp;start=([0-9]+)`i' );
+					$pagin_replace = array( $phpbb_seo->seo_delim['start'] . '\\3\\1\\2', '/' . $phpbb_seo->seo_static['pagination'] . '\\2' . $phpbb_seo->seo_ext['pagination'] .'\\1' );
+				}
+				$pagination = str_replace( '&amp;start=0', '', $pagination );
+				$pagination = preg_replace( $pagin_find, $pagin_replace, $pagination );
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT END
+		} else {
+			$pagination = '';
+		}
+		return $pagination;
+	}
+	/**
+	* Get user rank title and image
+	*
+	* @param int $user_rank the current stored users rank id
+	* @param int $user_posts the users number of posts
+	* @param string &$rank_title the rank title will be stored here after execution
+	* @param string &$rank_img the rank image as full img tag is stored here after execution
+	* @param string &$rank_img_src the rank image source is stored here after execution
+	*
+	*/
+	function get_user_rank($user_rank, $user_posts, &$rank_title, &$rank_img, &$rank_img_src) {
+		global $ranks, $config, $phpbb_root_path;
+		if (empty($ranks)) {
+			global $cache;
+			$ranks = $cache->obtain_ranks();
+		}
+		if (!empty($user_rank)) {
+			$rank_title = (isset($ranks['special'][$user_rank]['rank_title'])) ? $ranks['special'][$user_rank]['rank_title'] : '';
+			$rank_img = (!empty($ranks['special'][$user_rank]['rank_image'])) ? '<img src="' . $phpbb_root_path . $config['ranks_path'] . '/' . $ranks['special'][$user_rank]['rank_image'] . '" alt="' . $ranks['special'][$user_rank]['rank_title'] . '" title="' . $ranks['special'][$user_rank]['rank_title'] . '" />' : '';
+			$rank_img_src = (!empty($ranks['special'][$user_rank]['rank_image'])) ? $phpbb_root_path . $config['ranks_path'] . '/' . $ranks['special'][$user_rank]['rank_image'] : '';
+		} else {
+			if (!empty($ranks['normal'])) {
+				foreach ($ranks['normal'] as $rank) {
+					if ($user_posts >= $rank['rank_min']) {
+						$rank_title = $rank['rank_title'];
+						$rank_img = (!empty($rank['rank_image'])) ? '<img src="' . $phpbb_root_path . $config['ranks_path'] . '/' . $rank['rank_image'] . '" alt="' . $rank['rank_title'] . '" title="' . $rank['rank_title'] . '" />' : '';
+						$rank_img_src = (!empty($rank['rank_image'])) ? $phpbb_root_path . $config['ranks_path'] . '/' . $rank['rank_image'] : '';
+						break;
+					}
+				}
+			}
+		}
+	}
+	/**
+	* Get user avatar
+	*
+	* @param string $avatar Users assigned avatar name
+	* @param int $avatar_type Type of avatar
+	* @param string $avatar_width Width of users avatar
+	* @param string $avatar_height Height of users avatar
+	* @param string $alt Optional language string for alt tag within image, can be a language key or text
+	*
+	* @return string Avatar image
+	*/
+	function get_user_avatar($avatar, $avatar_type, $avatar_width, $avatar_height, $alt = 'USER_AVATAR') {
+	global $user, $config, $phpbb_root_path, $phpEx;
+		if (empty($avatar) || !$avatar_type) {
+			return '';
+		}
+		$avatar_img = '';
+			switch ($avatar_type) {
+			case AVATAR_UPLOAD:
+				$avatar_img = $phpbb_root_path . "download/file.$phpEx?avatar=";
+			break;
+			case AVATAR_GALLERY:
+				$avatar_img = $phpbb_root_path . $config['avatar_gallery_path'] . '/';
+			break;
+		}
+		$avatar_img .= $avatar;
+		return '<img src="' . $avatar_img . '" width="' . $avatar_width . '" height="' . $avatar_height . '" alt="' . ((!empty($user->lang[$alt])) ? $user->lang[$alt] : $alt) . '" />';
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/gym_sitemaps.php
===================================================================
--- gym_sitemaps/includes/gym_sitemaps.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_sitemaps.php	(Premod 3.0.8)
@@ -0,0 +1,659 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_sitemaps.php 272 2010-11-21 13:56:31Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+// For Compatibility with the phpBB SEO mod rewrites
+if (empty($phpbb_seo)) {
+	require_once($phpbb_root_path . 'gym_sitemaps/includes/phpbb_seo_class_light.' . $phpEx);
+	$phpbb_seo = new phpbb_seo();
+	define('STARTED_LIGHT', true);
+}
+/**
+* gym_sitemaps Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class gym_sitemaps {
+	// $_GET vars
+	var $actions = array();
+	// Working vars
+	var $gym_config = array();
+	var $override = array();
+	var $override_type = array();
+	var $gym_output;
+	var $output_data = array();
+	var $cache_config = array();
+	var $yahoo_config = array();
+	var $ext_config = array();
+	var $gzip_config = array();
+	var $style_config = array();
+	var $gym_auth = array();
+	var $module_auth = array();
+	/**
+	* constuctor
+	*/
+	function gym_sitemaps($action_type = '') {
+		global $phpEx, $phpbb_seo, $user, $config, $phpbb_root_path, $_action_types, $_override_types, $auth;
+		$start_time = $phpbb_seo->microtime_float();
+		// Set default values
+		$this->gym_config = $this->actions = array();
+		$this->override_type = $_override_types;
+		$this->actions['action_types'] = $_action_types;
+		$this->actions['action_type'] = in_array($action_type, $this->actions['action_types']) ? $action_type : '';
+		$this->actions['extra_params'] = $this->actions['extra_params_full'] = $this->actions['auth_param'] = $this->actions['sql_report_msg'] = '';
+		$this->actions['auth_guest_list'] = $this->actions['auth_guest_read'] = $this->actions['auth_view_list'] = $this->actions['auth_read_list'] = array();
+		$this->actions['robots_patterns'] = array();
+		if (empty($this->actions['action_type']) ) {
+			$this->gym_error(403, '', __FILE__, __LINE__);
+		}
+		// Grab required config
+		obtain_gym_config($this->actions['action_type'], $this->gym_config);
+		if (empty($this->gym_config) ) {
+			$this->gym_error(404, '', __FILE__, __LINE__);
+		}
+		// Set the overidding options
+		$this->set_override();
+		$this->path_config = array('gym_path' => $phpbb_root_path . 'gym_sitemaps/',
+			'gym_img_url' => $phpbb_seo->seo_path['phpbb_url'] . 'gym_sitemaps/images/');
+		// The main array
+		$this->output_data = array('microtime'=> $start_time,
+			'time'	=> time(),
+			'mem_usage' => 0,
+			'gen_data' => '',
+			'gen_out' => '',
+			'url_sofar' => 0,
+			'url_sofar_total' => 0,
+			'showstats' => 0,
+			'data' => '',
+			'expires_time' => 0,
+		);
+		// Ceck the day interval and reset pinged
+		if (@$config['gym_today'] < $this->output_data['time']) {
+			set_config('gym_today', $this->output_data['time'] + 3600*24, 1);
+			set_config('gym_pinged_today', 0, 1);
+		}
+		$this->url_config = array( 'start_default' => '&amp;start=',
+			'google_default' => "sitemap.$phpEx",
+			'html_default' => "map.$phpEx",
+			'rss_default' => "gymrss.$phpEx",
+			'gzip_ext_out' => '',
+			'zero_dupe' => (boolean) $this->gym_config['gym_zero_dupe'],
+			'uri' => $phpbb_seo->seo_path['uri'],
+			'current' => '',
+			'modrewrite' => false,
+		);
+		$this->gzip_config = array('gzip_level' => (int) $this->gym_config['gym_gzip_level']);
+		$this->cache_config = array(
+			'do_cache' => true, // this is used when preventing the caching of private content.
+			'cached' => 'false',
+			'mod_since' => (boolean) $this->gym_config['gym_mod_since'],
+		);
+		// init $gym_auth
+		$this->gym_auth = array(
+			'admin' => $auth->acl_gets('a_') ? true : false,
+			'globalmod' => $auth->acl_getf_global('m_') ? true : false,
+			'reg' => $user->data['is_registered'] ? true : false,
+			'guest' => $user->data['is_registered'] ? false : true,
+			'all' => true,
+			'none' => false,
+		);
+		// Workaround for error message handling
+		$phpbb_seo->file_hbase['map'] = $phpbb_seo->file_hbase['gymrss'] = $phpbb_seo->file_hbase['sitemap'] = $phpbb_seo->seo_path['phpbb_url'];
+		// Clear buffer, just in case it was started elswhere
+		while (@ob_end_clean());
+		return;
+	}
+	/**
+	* init_get_vars ().
+	* Get and check the basic get vars
+	* @access private
+	*/
+	function init_get_vars() {
+		// Builds the action_modules array
+		$this->init_action_modules();
+		// Basic options : gymfile.php?var(=value)
+		$this->actions['module_main'] = $this->actions['module_sub'] = '';
+		foreach ($this->actions['action_modules'] as $module) {
+			if (isset($_GET[$module])) {
+				$this->actions['module_main'] = $module;
+				$this->actions['module_sub'] = !empty($_GET[$module]) ? trim(utf8_htmlspecialchars(str_replace(array("\n", "\r", "\0"), '', $_GET[$module]))) : '';
+				unset($_GET[$module]);
+			}
+		}
+		return;
+	}
+	/**
+	* init_action_modules ().
+	* Build the autogenerated array of all expected actions
+	* @access private
+	*/
+	function init_action_modules() {
+		global $cache, $phpEx;
+		if (($this->actions['action_modules'] = $cache->get('_gym_action_' . $this->actions['action_type'])) === false) {
+			$this->actions['action_modules'] = array();
+			$dir = @opendir( $this->path_config['gym_path'] . 'modules' );
+			$action_from_file = '';
+			while( ($file = @readdir($dir)) !== FALSE ) {
+				if(preg_match('`^' . $this->actions['action_type'] . '_[a-z0-9_-]+\.' . $phpEx . '$`i', $file)) {
+					$action_from_file = trim(str_replace( $this->actions['action_type'] . '_', '' , str_replace('.' . $phpEx , '' ,$file)), "/");
+					if (@$this->gym_config[$this->actions['action_type'] . '_' . $action_from_file . '_installed']) {
+						$this->actions['action_modules'][$action_from_file] = $action_from_file;
+					}
+				}
+			}
+			@closedir($dir);
+			$cache->put('_gym_action_' . $this->actions['action_type'], $this->actions['action_modules']);
+		}
+	}
+	/**
+	* load_modules ( $module_type, $method = '' ).
+	* loads all modules for a given action_type
+	* Optional, starts a method
+	* @access private
+	*/
+	function load_modules( $method = ''  ) {
+		foreach ( $this->actions['action_modules'] as $module ) {
+			$this->load_module( $this->actions['action_type'] . "_$module", $method);
+		}
+	}
+	/**
+	* load_module ( $module_class, $method = '' ).
+	* loads a module for a given action
+	* Optional, starts a method
+	* @access private
+	*/
+	function load_module( $module_class, $method = '', $return = false ) {
+		global $phpEx;
+		$module_file = $this->path_config['gym_path'] . 'modules/' . $module_class . '.' . $phpEx;
+		if ( !empty($this->gym_config[$module_class . '_installed']) && file_exists($module_file) ) {
+			include_once($module_file);
+			if (class_exists($module_class)) {
+				$gym_module = new $module_class($this);
+				if ( !empty($method) && method_exists($gym_module, $method)) {
+					$gym_module->$method();
+				}
+				if ($return) {
+					return $gym_module;
+				}
+			}
+		} else {
+			$this->gym_error(500, '', __FILE__, __LINE__);
+		}
+	}
+	/**
+	* gym_init_output ()
+	* In case we need to hanlde the output
+	* @access private
+	*/
+	function gym_init_output() {
+		global $phpEx;
+		include_once($this->path_config['gym_path'] . 'includes/gym_output.' . $phpEx);
+		$this->gym_output = new gym_output($this);
+	}
+	/**
+	* gym_auth_value()
+	* @access private
+	*/
+	function gym_auth_value($value) {
+		return !empty($this->gym_auth[$value]);
+	}
+	/**
+	* set_module_option($config_key, $override ='')
+	* will check if a module config value is available
+	* Set it or use the main type default value or the main global value
+	* Globale module value is used when cyclying through modules ( $this->actions['module_main'] = '' )
+	* $override = global => global config
+	* $override = output_type => module config
+	* $override = module => sub module config
+	* degrades to the global config in case there is no better otpion
+	* @access private
+	*/
+	function set_module_option($config_key, $override = OVERRIDE_MODULE) {
+		$cond = '';
+		// Check if we have a sub module option
+		if ( ($override == OVERRIDE_MODULE) && @isset($this->gym_config[$this->actions['action_type'] . '_' . $this->actions['module_main'] . "_$config_key"]) ) {
+			return $this->gym_config[$this->actions['action_type'] . '_' . $this->actions['module_main'] . "_$config_key"];
+		}
+		// Else look for an output type option
+		if ( ($override != OVERRIDE_GLOBAL) && @isset($this->gym_config[$this->actions['action_type'] . "_$config_key"]) ) {
+			return $this->gym_config[$this->actions['action_type'] . "_$config_key"];
+
+		}
+		// Else return the global config value or the next available valid option from the output type to the module level or null
+		return isset($this->gym_config["gym_$config_key"]) ? $this->gym_config["gym_$config_key"] : ( @isset($this->gym_config[$this->actions['action_type'] . "_$config_key"]) ? $this->gym_config[$this->actions['action_type'] . "_$config_key"] : ( @isset($this->gym_config[$this->actions['action_type'] . '_' . $this->actions['module_main'] . "_$config_key"]) ? $this->gym_config[$this->actions['action_type'] . '_' . $this->actions['module_main'] . "_$config_key"] : null) );
+	}
+	/**
+	* set_override()
+	* Will set the three levels of overriding
+	*/
+	function set_override() {
+		foreach ($this->override_type as $type) {
+			$this->override[$type] = $this->_set_override($type);
+		}
+		$this->override[$this->actions['action_type']] = $this->gym_config[$this->actions['action_type'] . '_override'];
+		return;
+	}
+	/**
+	* _set_override()
+	* helper for set_override()
+	*/
+	function _set_override($type) {
+		$main_key = 'gym_override_' . $type;
+		$mode_key = $this->actions['action_type'] . '_override_' . $type;
+	//	$module_key = !empty($this->actions['module_main']) ? $this->actions['action_type'] . '_' . $this->actions['module_main'] . '_override_' . $type : 0;
+		if ($this->gym_config['gym_override']) { // if top level overrinding is activated
+			return ($this->gym_config[$main_key] != OVERRIDE_GLOBAL)  ? ($this->gym_config[$mode_key] != OVERRIDE_GLOBAL ? $this->gym_config[$mode_key] : $this->gym_config[$main_key]) : OVERRIDE_GLOBAL;
+		} else {
+			return $this->gym_config[$mode_key];
+		}
+	}
+	/**
+	 * xml_encode()
+	 * helper
+	 */
+	function xml_encode($utf8_string) {
+		static $find = array('&', '<', '>');
+		static $replace = array('&#x26;', '&#x3C;', '&#x3E;');
+		return numeric_entify_utf8(str_replace($find, $replace, $utf8_string));
+	}
+	/**
+	* check_forum_auth()
+	* Returns various forum auth and properties
+	*/
+	function check_forum_auth($guest_auth = true) {
+		global $auth, $db, $user, $cache;
+		$forum_auth_list = array('list' => array(), 'read' => array(), 'list_post' => array(), 'read_post' => array(), 'public_list' => array(), 'public_read' => array(), 'skip_pass' => array(), 'skip_cat' => array(), 'skip_all' => array(), 'skip_link' => array());
+		$need_cache = false;
+		$cache_file = '_gym_auth_forum_guest';
+		// First check the public forum list
+		if (($forum_auth_list = $cache->get($cache_file)) === false) {
+			$forum_auth_list = array('list' => array(), 'read' => array(), 'list_post' => array(), 'read_post' => array(), 'public_list' => array(), 'public_read' => array(), 'skip_pass' => array(), 'skip_cat' => array(), 'skip_all' => array(), 'skip_link' => array());
+			$guest_data = array('user_id' => ANONYMOUS,
+				'user_type' => USER_IGNORE,
+				'user_permissions' . (defined('XLANG_AKEY') ? XLANG_AKEY : '') => '',
+			);
+			$g_auth = new auth();
+			$g_auth->acl($guest_data);
+			// the forum id array
+			$forum_list_ary = $g_auth->acl_getf('f_list', true);
+			foreach ($forum_list_ary as $forum_id => $null) {
+				$forum_auth_list['list'][$forum_id] = (int) $forum_id;
+			}
+			$forum_read_ary = $g_auth->acl_getf('f_read', true);
+			foreach ($forum_read_ary as $forum_id => $null) {
+				$forum_auth_list['read'][$forum_id] = (int) $forum_id;
+			}
+			ksort($forum_auth_list['list']);
+			ksort($forum_auth_list['read']);
+			$sql = "SELECT forum_id, forum_type, forum_password
+				FROM " . FORUMS_TABLE . "
+				WHERE	forum_type <> " . FORUM_POST . " OR forum_password <> ''";
+			$result = $db->sql_query($sql);
+			while ( $row = $db->sql_fetchrow($result) ) {
+				$forum_id = (int) $row['forum_id'];
+				if ($row['forum_password']) {
+					$forum_auth_list['skip_pass'][$forum_id] = $forum_id;
+				}
+				if ($row['forum_type'] == FORUM_CAT) {
+					$forum_auth_list['skip_cat'][$forum_id] = $forum_id;
+				} else if ($row['forum_type'] == FORUM_LINK) {
+					$forum_auth_list['skip_link'][$forum_id] = $forum_id;
+				}
+				$forum_auth_list['skip_all'][$forum_id] = $forum_id;
+			}
+			$db->sql_freeresult($result);
+			ksort($forum_auth_list['skip_pass']);
+			ksort($forum_auth_list['skip_all']);
+			ksort($forum_auth_list['skip_link']);
+			ksort($forum_auth_list['skip_cat']);
+			// Never mind about fourm links
+			$forum_auth_list['read'] = array_diff_assoc($forum_auth_list['read'], $forum_auth_list['skip_link']);
+			$forum_auth_list['list'] = array_diff_assoc($forum_auth_list['list'], $forum_auth_list['skip_link']);
+			ksort($forum_auth_list['read']);
+			ksort($forum_auth_list['list']);
+			$forum_auth_list['list_post'] = array_diff_assoc($forum_auth_list['list'], $forum_auth_list['skip_all']);
+			$forum_auth_list['read_post'] = array_diff_assoc($forum_auth_list['read'], $forum_auth_list['skip_all']);
+			$forum_auth_list['public_list'] = array_diff_assoc($forum_auth_list['list'], $forum_auth_list['skip_pass']);
+			$forum_auth_list['public_read'] = array_diff_assoc($forum_auth_list['read'], $forum_auth_list['skip_pass']);
+			$cache->put($cache_file, $forum_auth_list);
+		}
+
+		$this->module_auth['forum'] = & $forum_auth_list;
+		if ($guest_auth) { // sometime, we need to only check guest auths, even if user is registered
+			$this->actions['auth_param'] = implode('-', $forum_auth_list['read_post']);
+			return $forum_auth_list['read_post'];
+		}
+		// else handle the real auth
+		$forum_auth_list['read'] = $forum_auth_list['list'] = array();
+		$forum_list_ary = $auth->acl_getf('f_list', true);
+		foreach ($forum_list_ary as $forum_id => $null) {
+			$forum_auth_list['list'][$forum_id] = (int) $forum_id;
+		}
+		$forum_read_ary = $auth->acl_getf('f_read', true);
+		foreach ($forum_read_ary as $forum_id => $null) {
+			$forum_auth_list['read'][$forum_id] = (int) $forum_id;
+		}
+		ksort($forum_auth_list['list']);
+		ksort($forum_auth_list['read']);
+		$forum_auth_list['list'] = array_diff_assoc($forum_auth_list['list'], $forum_auth_list['skip_link']);
+		$forum_auth_list['read'] = array_diff_assoc($forum_auth_list['read'], $forum_auth_list['skip_link']);
+		$forum_auth_list['list_post'] = array_diff_assoc($forum_auth_list['list'], $forum_auth_list['skip_all']);
+		$forum_auth_list['read_post'] = array_diff_assoc($forum_auth_list['read'], $forum_auth_list['skip_all']);
+
+		$this->actions['auth_param'] = implode('-', $forum_auth_list['read_post']);
+		return $forum_auth_list['read_post'];
+	}
+	/**
+	* Smiley processing, the phpBB3 function, but, with absolute linking
+	* a little optimization and regular config bypass.
+	*/
+	function smiley_text($text, $force_option = false) {
+		global $config, $user, $phpbb_seo;
+		static $viewsmilies;
+		if (!isset($viewsmilies)) { // Costs less than optionget ;-)
+			$viewsmilies = $user->optionget('viewsmilies');
+		}
+		if ($force_option || !$viewsmilies) {
+			return preg_replace('#<!\-\- s(.*?) \-\-><img src="\{SMILIES_PATH\}\/.*? \/><!\-\- s\1 \-\->#', '\1', $text);
+		} else {
+			return preg_replace('#<!\-\- s(.*?) \-\-><img src="\{SMILIES_PATH\}\/(.*?) \/><!\-\- s\1 \-\->#', '<img src="' . $phpbb_seo->seo_path['phpbb_url'] . $config['smilies_path'] . '/\2 />', $text);
+		}
+	}
+	/**
+	* obtain_robots_disallows()
+	* obtain the eventual robots.txt exclusions
+	* and parse them into a patern array for later use
+	* @access private
+	*/
+	function obtain_robots_disallows() {
+		global $phpbb_root_path, $phpbb_seo, $cache, $phpEx;
+		if (function_exists('file_get_contents')) {
+			// Build the domain root path
+			$phpbb_real_path = trim(phpbb_realpath($phpbb_root_path), '/');
+			$root_real_path = str_replace(trim($phpbb_seo->seo_path['phpbb_script'], '/'), '', $phpbb_real_path);
+			if (file_exists($root_real_path . '/robots.txt')) {
+				$time_created = filemtime($root_real_path . '/robots.txt');
+				if (($this->actions['robots_patterns'] = $cache->get('_gym_config_robots_regex' )) === false) {
+					$robots = file_get_contents($root_real_path . '/robots.txt');
+					preg_match_all('`^Disallow[\s]*:[\s]*([a-z0-9_\.&;\?,:/-]+)[\s]*$`im', $robots, $matches,PREG_SET_ORDER);
+					if (!empty($matches[0][1])) {
+						foreach ($matches as $match) {
+							if (!empty($match[1])) {
+								$this->actions['robots_patterns'][] = $phpbb_seo->seo_path['root_url'] . trim($match[1], '/');
+							}
+						}
+					}
+					$this->actions['robots_patterns']['date'] = $time_created;
+					$cache->put('_gym_config_robots_regex' , $this->actions['robots_patterns']);
+				} elseif ($this->actions['robots_patterns']['date'] < $time_created) { // robots.tx was updated
+					$cache->destroy('_gym_config_robots_regex');
+					$this->obtain_robots_disallows();
+				}
+
+			}
+		}
+		return;
+	}
+	/**
+	* is_robots_disallowed()
+	* checks if an url is disallowed by the robots.txt patterns
+	* @access private
+	*/
+	function is_robots_disallowed($url) {
+		if (!empty($this->actions['robots_patterns'])) {
+			foreach($this->actions['robots_patterns'] as $pattern) {
+				if (stripos( $url, $pattern) !== false) {
+					return true;
+				}
+			}
+		}
+		return false;
+	}
+	/**
+	* set_exclude_list($id_list) will build up the public unauthed ids
+	* @access private
+	*/
+	function set_exclude_list($id_list) {
+		$exclude_list = empty($id_list) ? array() : explode(',', $id_list);
+		$ret = array();
+		foreach ($exclude_list as $value ) {
+			$value = (int) trim($value);
+			if (!empty($value)) {
+				$ret[$value] = $value;
+			}
+		}
+		return $ret;
+	}
+	/**
+	* set_exclude_list($id_list) will build up the public unauthed ids
+	* This method is deprecated since 2.0.RC2
+	* @access private
+	*/
+	function set_not_in_list($id_list = array(), $field = '', $and = '') {
+		if ( !empty($id_list) && is_array($id_list) ) {
+			$not_in_id_sql = " $field NOT IN (" . implode(",", array_map('intval', $id_list)) . ") $and ";
+		} else {
+			$not_in_id_sql = '';
+		}
+		return $not_in_id_sql;
+	}
+	/**
+	* is_forum_public($forum_id) Will tell if a forum is publicly viewable or listable (auth guest)
+	* @access private
+	*/
+	function is_forum_public($forum_id, $type = 'read') {
+		$type = $type === 'list' ? 'list' : 'read';
+		return (boolean) isset($this->actions["auth_guest_$type"][$forum_id]);
+	}
+
+	// --> Others <--
+	/**
+	* init_url_rewrite()
+	*/
+	function init_url_rewrite($modr = false, $type = 0) {
+		global $phpbb_seo, $phpEx;
+		$this->url_config['modrewrite'] = $modr ? true : false;
+		// Mod rewrite type auto detection
+		$this->url_config['modrtype'] = !empty($phpbb_seo->modrtype) ? max(0, (int) $phpbb_seo->modrtype) : max(0, (int) $type);
+		if (!@isset($phpbb_seo->seo_opt['url_rewrite'])) {
+			$phpbb_seo->seo_opt['url_rewrite'] = $this->url_config['modrtype'] > 0 ? true : false;
+		}
+		// make sure virtual_folder uses the proper value
+		$phpbb_seo->seo_opt['virtual_folder'] = $this->url_config['modrtype'] ? $phpbb_seo->seo_opt['virtual_folder'] : false;
+		$this->url_config['forum_start_tpl'] = $this->url_config['start_default'] . '%1$d';
+		$this->url_config['topic_start_tpl'] = $this->url_config['start_default'] . '%1$d';
+		$this->url_config['forum_tpl'] = "viewforum.$phpEx?f=%1\$d";
+		$this->url_config['topic_tpl'] = "viewtopic.$phpEx?f=%1\$d&amp;t=%2\$d";
+		if (!$phpbb_seo->seo_opt['url_rewrite']) {
+			$this->url_config['forum_index'] = "index.$phpEx";
+			$phpbb_seo->seo_opt['virtual_folder'] = false;
+			$this->url_config['forum_ext'] = '';
+			$this->url_config['topic_ext'] = '';
+		} else {
+			$this->url_config['forum_index'] = !empty($phpbb_seo->seo_static['index']) ? $phpbb_seo->seo_static['index'] . $phpbb_seo->seo_ext['index'] : '';
+			if ($this->url_config['modrtype'] >= 1) { // Simple mod rewrite, default is none (0)
+				$this->url_config['forum_ext'] = $phpbb_seo->seo_ext['forum'];
+				$this->url_config['topic_ext'] = $phpbb_seo->seo_ext['topic'];
+				$this->url_config['forum_start_tpl'] = $phpbb_seo->seo_opt['virtual_folder'] ? '/' . $phpbb_seo->seo_static['pagination'] . '%1$d' . $phpbb_seo->seo_ext['pagination'] : $phpbb_seo->seo_delim['start'] . '%1$d' . $this->url_config['forum_ext'];
+				$this->url_config['topic_start_tpl'] = $this->url_config['topic_ext'] == '/' ? '/' . $phpbb_seo->seo_static['pagination'] . '%1$d' . $phpbb_seo->seo_ext['pagination'] : $phpbb_seo->seo_delim['start'] . '%1$d' . $this->url_config['topic_ext'];
+			}
+			if ($this->url_config['modrtype'] >= 2) { // +Mixed
+			}
+			if ($this->url_config['modrtype'] >= 3) { // +Advanced
+			}
+		}
+	}
+	/**
+	* forum_url() builds forum url with proper options
+	* Suffixe is not added here, to properly deal with pagination
+	*/
+	function forum_url($forum_name, $forum_id) {
+		global $phpbb_seo;
+		return $phpbb_seo->seo_opt['url_rewrite'] ? $phpbb_seo->set_url($forum_name, $forum_id, 'forum') : sprintf($this->url_config['forum_tpl'], $forum_id);
+	}
+	/**
+	* topic_url($topic_title, $topic_id, $forum_url, $forum_id) builds forum url with proper options
+	* Suffixe is not added here, to properly deal with pagination
+	*/
+	function topic_url($topic_data, $forum_id, $forum_url = '') {
+		global $phpbb_seo;
+		return $phpbb_seo->seo_opt['url_rewrite'] ? $phpbb_seo->prepare_iurl($topic_data, 'topic', trim($forum_url, '/')) : sprintf($this->url_config['topic_tpl'], $forum_id, (int) $topic_data['topic_id']);
+	}
+	/**
+	* Returns usable start param
+	* -xx | /pagexx.html
+	*/
+	function set_start($type, $start) {
+		global $phpbb_seo;
+		return $start > 0 ? sprintf($this->url_config[$type . '_start_tpl'], (int) $start) : $this->url_config[$type . '_ext'];
+	}
+	/**
+	* check start var consistency
+	* and return our best guess for $start, eg the first valid page
+	* parameter according to pagination settings being lower
+	* than the one sent.
+	*/
+	function chk_start($start = 0, $limit = 0) {
+		if ($limit > 0) {
+			$start = is_int($start/$limit) ? $start : intval($start/$limit)*$limit;
+		}
+		return (int) $start;
+	}
+	/**
+	* parse_link() builds an html link
+	*/
+	function parse_link($url, $title = '', $tag_arround = '') {
+		global $config;
+		static $linktpl = '%4$s<a href="%1$s" %2$s>%3$s</a>%5$s';
+		$title_tag = $tag1 = $tag2 = '';
+		if (empty($title) ) {
+			$title = $url;
+		} else {
+			$title_tag = 'title="' . $title . '"';
+		}
+		if (!empty($tag_arround)) {
+			$tag1 = "<$tag_arround>";
+			$tag2 = "</$tag_arround>";
+		}
+		return sprintf($linktpl, $url, $title_tag, $title, $tag1, $tag2);
+	}
+	/**
+	* seo_kill_dupes($url) will kill duplicates when pages are not cached
+	* @access private
+	*/
+	function seo_kill_dupes($url) {
+		global $user, $auth, $_SID, $phpbb_seo;
+		$url = str_replace('&amp;', '&', $url);
+		// if an https request lead us here or if it is forced, then use it as a reference
+		$url = $phpbb_seo->sslify($url, $phpbb_seo->ssl['use']);
+		if ($this->url_config['zero_dupe']) {
+			$requested_url = $this->url_config['uri'];
+			if (!empty($_REQUEST['explain']) && (boolean) ($auth->acl_get('a_') && defined('DEBUG_EXTRA'))) {
+				if ($_REQUEST['explain'] == 1) {
+					return;
+				}
+			}
+			$url = $phpbb_seo->drop_sid($url);
+			if (!empty($_GET['sid']) && !empty($_SID)) {
+				$url .=  (utf8_strpos( $url, '?' ) !== false ? '&' : '?') . 'sid=' . $user->session_id;
+			}
+			if ( $requested_url !== $url ) {
+				$this->gym_redirect($url);
+			}
+		}
+		$this->url_config['current'] = $url;
+		return;
+	}
+	/**
+	* Custom HTTP 301 redirections.
+	* To kill duplicates
+	*/
+	function gym_redirect($url, $header = "301 Moved Permanently", $code = 301, $replace = true) {
+		if (headers_sent()) {
+			return false;
+		}
+		if (strstr(urldecode($url), "\n") || strstr(urldecode($url), "\r") || strstr(urldecode($url), ';url')) {
+			$this->gym_error(400, '',  __FILE__, __LINE__);
+		}
+		$http = "HTTP/1.1 ";
+		header($http . $header, $replace, $code);
+		header("Location:" . $url);
+		$this->safe_exit();
+	}
+	/**
+	* gym_error(($errno, $msg_text, $errfile, $errline)
+	* Will properly handle error for all cases, admin always get full debug
+	* Partly based on msg_handler()
+	* @access private
+	*/
+	function gym_error($errno = 0, $msg_key = '', $errfile = '', $errline = '', $sql = '') {
+		global $user, $phpbb_seo, $auth, $phpbb_root_path, $phpEx, $msg_title;
+		$http_codes = array (
+			204 => 'HTTP/1.1 204 No Content',
+			400 => 'HTTP/1.1 400 Bad Request',
+			401 => 'HTTP/1.1 401 Unauthorized',
+			403 => 'HTTP/1.1 403 Forbidden',
+			404 => 'HTTP/1.1 404 Not Found',
+			405 => 'HTTP/1.1 405 Method Not Allowed',
+			406 => 'HTTP/1.1 406 Not Acceptable',
+			410 => 'HTTP/1.1 410 Gone',
+			500 => 'HTTP/1.1 500 Internal Server Error',
+			503 => 'HTTP/1.1 503 Service Unavailable',
+		);
+		$header = isset($http_codes[$errno]) ? $http_codes[$errno] : '';
+		$return_url = append_sid("{$phpbb_root_path}index.$phpEx");
+		if (!empty($user) && !empty($user->lang)) {
+			$msg_title = (empty($msg_key)) ? ( !empty($user->lang['GYM_ERROR_' . $errno]) ? $user->lang['GYM_ERROR_' . $errno] :  ( !empty($header) ? $header : $user->lang['GENERAL_ERROR'])  ) : ((!empty($user->lang[$msg_key])) ? $user->lang[$msg_key] : $msg_key);
+			$msg_text = !empty($user->lang[$msg_key . '_EXPLAIN']) ? $user->lang[$msg_key . '_EXPLAIN'] : (!empty($user->lang['GYM_ERROR_' . $errno . '_EXPLAIN']) ?  $user->lang['GYM_ERROR_' . $errno . '_EXPLAIN'] : ( (!empty($msg_key) ? $msg_key : (!empty($header) ? $header : $msg_title) ) ) );
+			$l_return_index = sprintf($user->lang['RETURN_INDEX'], '<a href="' . $return_url . '">', '</a>');
+			if ( ( $errno == 500 || $errno == 503 ) && !empty($config['board_contact'])) {
+				$msg_text .= '<p>' . sprintf($user->lang['NOTIFY_ADMIN_EMAIL'], $config['board_contact']) . '</p>';
+			}
+		} else {
+			$msg_title = 'GYM Sitemaps General Error';
+			$l_return_index = '<a href="' . $return_url . '">Return to index page</a>';
+			if ( ( $errno == 500 || $errno == 503 ) && !empty($config['board_contact'])) {
+				$msg_text .= '<p>Please notify the board administrator or webmaster: <a href="mailto:' . $config['board_contact'] . '">' . $config['board_contact'] . '</a></p>';
+			}
+		}
+		$msg_text .= '<br/><br/>' . $l_return_index;
+		if (@$auth->acl_get('a_')) {
+			if (!empty($user->lang[$msg_key . '_EXPLAIN_ADMIN'])) {
+				$msg_text .= '<br/><br/>' . $user->lang[$msg_key . '_EXPLAIN_ADMIN'];
+			}
+			if (defined('DEBUG')) {
+				$msg_text .= '</p><br/><h2>Debug :</h2><p>' . (!empty($errfile) ? "<br/><b>File :</b> " . utf8_htmlspecialchars($errfile) . "<br/>" : '');
+				$msg_text .= !empty($errline) ? "<br/><b>Line :</b> " . utf8_htmlspecialchars($errline) . "<br/>" : '';
+				$msg_text .= !empty($sql) ? "<br/><b>Sql :</b>  " . utf8_htmlspecialchars($sql) . "<br/>" : '';
+				$msg_text .= '</p><div style="font-size:12px">' . get_backtrace() . '</div><p>';
+			}
+		}
+		if ( !empty($header) ) {
+			header($header);
+		}
+		meta_refresh(5, $return_url);
+		trigger_error($msg_text);
+		$this->safe_exit();
+		return;
+	}
+	/**
+	* For a safe exit
+	* @access private
+	*/
+	function safe_exit() {
+		garbage_collection();
+		exit_handler();
+		exit;
+	}
+}
+?>
Index: gym_sitemaps/includes/gym_rss.php
===================================================================
--- gym_sitemaps/includes/gym_rss.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_rss.php	(Premod 3.0.8)
@@ -0,0 +1,715 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_rss.php 272 2010-11-21 13:56:31Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_sitemaps.' . $phpEx);
+/**
+* gym_rss Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class gym_rss extends gym_sitemaps {
+	var	$rss_config = array();
+	/**
+	* constuctor
+	*/
+	function gym_rss() {
+		global $phpbb_seo, $phpEx, $config, $user;
+		global $db, $auth;
+		$this->gym_sitemaps('rss');
+		// init output
+		$this->output_data['showstats'] = (boolean) ($this->gym_config['gym_showstats'] || $this->gym_config['rss_showstats']);
+		// Check the main vars
+		$this->init_get_vars();
+		// url without IDs like forum feed url in case the phpBB SEO mod are used and set so
+		// and basic parameter for url such as blabla/news/digest/long/module-rss.xml => gymrss.php?module=blabla&news&digest&long
+		if ( isset($_GET['nametoid']) && !empty($_GET['nametoid']) && isset($_GET['modulename']) && !empty($_GET['modulename']) &&  empty($this->actions['module_main']) && empty($this->actions['module_sub']) ) {
+			$module_name = trim(strtolower($_GET['modulename']));
+			// is the module available ?
+			if (in_array($module_name, $this->actions['action_modules'])) {
+				$this->actions['module_main'] = $module_name;
+				// Do we get an id (?module=id)
+				if ($id = @array_search(trim($_GET['nametoid']), $phpbb_seo->cache_config[$module_name]) ) {
+					$this->actions['module_sub'] = intval($id);
+				} else { // Pass the variable to the script ?module_name=$_GET['nametoid']
+					$this->actions['module_sub'] = trim(utf8_htmlspecialchars(str_replace(array("\n", "\r"), '', $_GET['nametoid'])));
+				}
+			}
+
+		}
+		if (empty($this->actions['action_modules'])) {
+			$this->gym_error(404, '', __FILE__, __LINE__);
+		}
+		// Set last mod time from DB, will only be used as his for general feeds and channel lists
+		// put it into phpbb config for the dynamic property.
+		$config_name = $this->actions['action_type'] . '_' . (!empty($this->actions['module_main']) ? $this->actions['module_main'] . '_' : '') . 'last_mod_time';
+		if (@$config[$config_name] < $config['board_startdate']) {
+			set_config($config_name, $user->time_now, 1);
+		}
+		$this->output_data['last_mod_time'] = intval($config[$config_name]);
+		// Init the output class
+		$this->gym_init_output();
+		// Setup the output
+		$this->cache_config = array_merge(
+			// Global
+			$this->cache_config,
+			// Other stuff required here
+			array(
+				'cache_enable' => (boolean) $this->set_module_option('cache_on', $this->override['cache']),
+				'cache_auto_regen' => (boolean) $this->set_module_option('cache_auto_regen', $this->override['cache']),
+				'cache_force_gzip' => (boolean) $this->set_module_option('cache_force_gzip', $this->override['cache']),
+				'cache_born' => $this->output_data['last_mod_time'],
+				'cache_max_age' => round($this->set_module_option('cache_max_age', $this->override['cache']),2) * 3600,
+				'cache_file_ext' => ( $this->gym_output->gzip_config['gzip'] || $this->gym_config['rss_cache_force_gzip'] ) ? '.xml.gz' : '.xml',
+			)
+		);
+		// Can you believe it, sprintf is faster than straight parsing.
+		$this->style_config	= array(
+			'rss_header' => '<'.'?xml version="1.0" encoding="utf-8"?'.'>%s' . "\n" . '<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"' . "\n\t" . 'xmlns:content="http://purl.org/rss/1.0/modules/content/"' . "\n\t" . 'xmlns:atom="http://www.w3.org/2005/Atom">' . "\n" . '<!-- Generated by Google Yahoo MSN Sitemaps and RSS %s - &#169; 2006, ' . date('Y') . ' www.phpBB-SEO.com -->',
+			'rss_footer' => "\n\t" . '</channel>' . "\n" . '</rss>',
+			'rss_item_tpl' => "\n\t\t" . '<item>' . "\n\t\t\t" . '<title>%1$s</title>'. "\n\t\t\t" . '<link>%2$s</link>%3$s' . "\n\t\t\t" . '<description>%4$s</description>%8$s' . "\n\t\t\t" . '<source url="%5$s">%6$s</source>' . "\n\t\t\t" . '<guid isPermaLink="true">%7$s</guid>' . "\n\t\t" . '</item>',
+			'rsschan_tpl' => "\n\t" . '<channel>' . "\n\t\t" . '<title>%1$s</title>' . "\n\t\t" . '<link>%2$s</link>' . "\n\t\t" . '<description>%3$s</description>%4$s' . "\n\t\t" . '%5$s' . "\n\t\t" . '<docs>http://blogs.law.harvard.edu/tech/rss</docs>' . "\n\t\t" . '<generator>Google Yahoo MSN Sitemaps and RSS ' . $this->gym_config['gym_version'] . ' - &#169; 2006, ' . date('Y') . ' www.phpBB-SEO.com</generator>%6$s' . "\n\t\t" . '<atom:link href="%7$s" rel="self" type="application/rss+xml" />%8$s',
+			'rsschan_input_tpl' => "\n\t\t" . '<textInput>' . "\n\t\t\t" . '<title>%1$s</title>' . "\n\t\t\t" . '<description>%2$s</description>' . "\n\t\t\t" . '<link>%3$s</link>' . "\n\t\t\t" . '<name>%4$s</name>' . "\n\t\t" . '</textInput>' . "\n",
+			'rsschan_img_tpl' => '<image>' . "\n\t\t\t" . '<title>%1$s</title>' . "\n\t\t\t" . '<url>%2$s</url>' . "\n\t\t\t" . '<link>%3$s</link>' . "\n\t\t" . '</image>',
+			'chan_lastbuildate_tpl' => "\n\t\t" . '<lastBuildDate>%1$s</lastBuildDate>',
+			'chan_ttl_tpl' => "\n\t\t" . '<ttl>%1$s</ttl>',
+			'item_pubdate_tpl' => "\n\t\t\t" . '<pubDate>%1$s</pubDate>',
+			'item_creator_tpl' => "\n\t\t\t" . '<dc:creator>%1$s</dc:creator>',
+			'xslt_style' => '',
+			'stats_genlist'	=> "\n" . '<!-- URL list generated in  %s s %s - %s sql - %s URLs listed -->',
+			'stats_start' => "\n" . '<!--  Output started from cache after %s s - %s sql -->',
+			'stats_nocache'	=> "\n" . '<!--  Output ended after %s s %s -->',
+			'stats_end' => "\n" . '<!--  Output from cache ended up after %s s - %s sql -->',
+		);
+		$rss_limit_time = (int) $this->set_module_option('limit_time', $this->override['limit']);
+		$rss_lang = trim($this->set_module_option('lang', $this->gym_config['rss_override']));
+		$this->rss_config = array( 'rss_c_info' => ( !empty($this->gym_config['rss_c_info'])) ? "\n\t\t" . '<copyright>' . $this->xml_encode($this->gym_config['rss_c_info']) . '</copyright>' : '',
+			'rss_xslt' => ( $this->gym_config['rss_xslt'] ) ? true : false,
+			'rss_force_xslt' => ( $this->gym_config['rss_xslt'] && $this->gym_config['rss_force_xslt'] ) ? true : false,
+			'rss_lang' => ( !empty($rss_lang) ) ? "\n\t\t" . '<language>' . $this->xml_encode($rss_lang) . '</language>' : '',
+			'rss_url' => $phpbb_seo->sslify($this->gym_config['rss_url'], $phpbb_seo->ssl['use'], false),
+			'rss_yahoo_appid' => ( !empty($this->gym_config['rss_yahoo_appid']) ) ? trim($this->gym_config['rss_yahoo_appid']) : '',
+			// module specific settings we should often need in module
+			// Some are used here to filter the allowed actions, will go to main default if unset in the module
+			'rss_url_limit' => (int) $this->set_module_option('url_limit', $this->override['limit']),
+			'rss_sql_limit' => (int) $this->set_module_option('sql_limit', $this->override['limit']),
+			'rss_limit_time' => ( $rss_limit_time >= 0 ) ? $rss_limit_time*3600*24 : 0,
+			'rss_modrewrite' => (int) $this->set_module_option('modrewrite', $this->override['modrewrite']),
+			'rss_modrtype' => (int) $this->set_module_option('modrtype', $this->override['modrewrite']),
+			'rss_sitename' => $this->set_module_option('sitename'),
+			'rss_site_desc' => $this->set_module_option('site_desc'),
+			'rss_logo_url' => $this->path_config['gym_img_url'] . trim($this->set_module_option('logo_url'), '/'),
+			'rss_image_url' => $this->path_config['gym_img_url'] . trim($this->set_module_option('image_url'), '/'),
+			'rss_sort' => $this->set_module_option('sort', $this->override['sort']),
+			'rss_allow_auth' => (boolean) $this->set_module_option('allow_auth', $this->gym_config['rss_override']),
+			'rss_cache_auth' => (boolean) $this->set_module_option('cache_auth', $this->gym_config['rss_override']),
+			'rss_allow_content' => (boolean) $this->set_module_option('allow_content', $this->gym_config['rss_override']),
+			'rss_allow_news' => (boolean) $this->set_module_option('allow_news', $this->gym_config['rss_override']),
+			'rss_news_update' => round($this->set_module_option('news_update', $this->gym_config['rss_override']), 2) * 3600,
+			'rss_allow_profile' => (boolean) $this->set_module_option('allow_profile', $this->gym_config['rss_override']),
+			'rss_allow_profile_links' => (boolean) $this->set_module_option('allow_profile_links', $this->gym_config['rss_override']),
+			'rss_sumarize' => (int) $this->set_module_option('sumarize', $this->gym_config['rss_override']),
+			'rss_sumarize_method' => trim($this->set_module_option('sumarize_method', $this->gym_config['rss_override'])),
+			'rss_allow_short' => (boolean) $this->set_module_option('allow_short', $this->gym_config['rss_override']),
+			'rss_allow_long' => (boolean) $this->set_module_option('allow_long', $this->gym_config['rss_override']),
+			'rss_allow_bbcode' => (boolean) $this->set_module_option('allow_bbcode', $this->gym_config['rss_override']),
+			'rss_strip_bbcode' => trim($this->set_module_option('strip_bbcode', $this->gym_config['rss_override'])),
+			'rss_allow_links' => (boolean) $this->set_module_option('allow_links', $this->gym_config['rss_override']),
+			'rss_allow_emails' => (boolean) $this->set_module_option('allow_emails', $this->gym_config['rss_override']),
+			'rss_allow_smilies' => (boolean) $this->set_module_option('allow_smilies', $this->gym_config['rss_override']),
+			'rss_yahoo_notify' => (boolean) $this->set_module_option('yahoo_notify', $this->gym_config['rss_override']),
+			'rss_nohtml' => (boolean) $this->set_module_option('nohtml', $this->gym_config['rss_override']),
+			//@TODO add acp option for this ?
+			'rss_display_author' => /*(boolean) $this->set_module_option('display_author', $this->gym_config['rss_override'])*/ true,
+			'rss_yahoo_notify_url' => '',
+			'rss_msg_filters' => array(),
+			'rss_auth_msg' => '',
+			'rss_do_explain' => false,
+		);
+		$this->rss_config['rss_auth_guest'] = ($this->rss_config['rss_allow_auth'] && $user->data['is_registered']) ? false : true;
+		$this->cache_config['do_cache'] = $this->rss_config['rss_auth_guest'] ? true :  $this->rss_config['rss_cache_auth'];
+		// remind for later
+		$this->rss_config['rss_profile_mode'] = $this->rss_config['rss_allow_profile_links'] ? 'full' : 'no_profile';
+		// Check the rss specific vars and do basic set_up for msg output
+		$this->init_rss_vars();
+
+		if (!$this->rss_config['rss_auth_guest']) {
+			$this->rss_config['rss_auth_msg'] =  "\n" . ( ($this->actions['rss_channel_list'] || empty($this->actions['module_sub']) || $this->actions['module_sub'] == 'channels') ? sprintf($user->lang['RSS_AUTH_SOME_USER'], $user->data['username'] ) : sprintf($user->lang['RSS_AUTH_THIS_USER'], $user->data['username'] ) ) . "\n";
+		}
+		// Are we going to explain ?
+		if (!empty($_REQUEST['explain']) && $auth->acl_get('a_') && defined('DEBUG_EXTRA') && method_exists($db, 'sql_report')) {
+			$this->rss_config['rss_do_explain'] = true;
+			$this->cache_config['do_cache'] = false;
+		}
+		$this->rss_output();
+		if ($this->rss_config['rss_do_explain']) {
+			$db->sql_report('display');
+		} else {
+			$this->gym_output->do_output();
+		}
+		return;
+	}
+	/**
+	* init_rss_vars()
+	* Set up the specific rss modules GET vars.
+	* @access private
+	*/
+	function init_rss_vars() {
+		global $user, $phpEx, $phpbb_seo;
+		// Let's now check out if it's a GYM 1.x URL
+		if ($this->gym_config['rss_1xredir'] && !empty($_GET['gym1x'])) {
+			$this->actions['gym1x_newurl'] = '/' . (isset($_GET['m']) ? 'digest/' : '' ) . (isset($_GET['l']) ? 'long/' : (isset($_GET['s']) ? 'short/' : '' ) );
+			$this->actions['gym1x_newurl'] = empty($this->actions['module_main']) ? 'rss' . $this->actions['gym1x_newurl'] . 'rss.xml' : (empty($_GET['gymtitle']) ? 'rss' .  $this->actions['gym1x_newurl'] . (!empty($this->actions['module_sub']) ? $this->actions['module_sub'] . '/' : '' ) . $this->actions['module_main'] . '.xml' : $phpbb_seo->set_url($_GET['gymtitle'], (int) $this->actions['module_sub'], 'forum') . $this->actions['gym1x_newurl'] . $this->actions['module_main'] . '.xml');
+			// nothing else needed for this
+			return;
+
+		}
+		$this->actions['rss_content'] = $this->actions['rss_short_list'] = $this->actions['rss_long_list'] = $this->actions['rss_channel_list'] = $this->actions['rss_news_list'] = false;
+		$this->rss_config['extra_title'] = $this->url_config['extra_params_full'] = $this->url_config['extra_params'] = '';
+		$this->url_config['rss_announces_path'] = $phpbb_seo->seo_static['global_announce'] . '/';
+		// Channel list
+		if ( ( $module_sub_chan = ($this->actions['module_sub'] === 'channels' ? true : false) ) || (isset($_GET['channels']) && empty($this->actions['module_main']) ) ) {
+			$this->actions['rss_channel_list'] = true;
+			$this->rss_config['extra_title'] = ' - ' . $user->lang['RSS_CHAN_LIST_TITLE'];
+			if ($this->rss_config['rss_modrewrite'] || !$module_sub_chan) {
+				$this->url_config['extra_params_full'] .= 'channels/';
+			}
+		}
+		// News = first message only
+		if ( isset($_GET['news']) && $this->rss_config['rss_allow_news']) {
+			$this->actions['rss_news_list'] = true;
+			$this->rss_config['extra_title'] .= ' - ' . $user->lang['RSS_NEWS'];
+			$this->url_config['extra_params_full'] .= 'news/';
+			$this->url_config['extra_params'] .= 'news/';
+			if (!empty($this->rss_config['rss_news_update'])) {
+				$this->cache_config['cache_max_age'] = $this->rss_config['rss_news_update'];
+			}
+			unset($_GET['channels']); // no channel listing
+		}
+		// Do we output text ?
+		if ( isset($_GET['digest']) && $this->rss_config['rss_allow_content'] ) {
+			$this->actions['rss_content'] = true;
+			$this->rss_config['extra_title'] .= ' - ' . $user->lang['RSS_CONTENT'];
+			$this->url_config['extra_params_full'] .= 'digest/';
+			$this->url_config['extra_params'] .= 'digest/';
+			$this->rss_config['rss_url_limit'] = intval($this->set_module_option('url_limit_msg', $this->gym_config['rss_override']));
+			$this->rss_config['rss_sql_limit'] = intval($this->set_module_option('sql_limit_msg', $this->gym_config['rss_override']));
+		}
+		// Custom limits short
+		if ( isset($_GET['short']) && $this->rss_config['rss_allow_short'] ) {
+			$this->actions['rss_short_list'] = true;
+			$this->rss_config['extra_title'] .= ' - ' . $user->lang['RSS_SHORT'];
+			$this->url_config['extra_params_full'] .= 'short/';
+			$this->url_config['extra_params'] .= 'short/';
+			$this->rss_config['rss_url_limit'] = $this->actions['rss_content'] ? intval($this->rss_config['rss_url_limit']/3) : intval($this->set_module_option('url_limit_short', $this->gym_config['rss_override']));
+			$this->rss_config['rss_sql_limit'] = $this->actions['rss_content'] ? intval($this->rss_config['rss_url_limit']/2) : intval($this->set_module_option('sql_limit_short', $this->gym_config['rss_override']));
+		}
+		// Custom limits long
+		if ( isset($_GET['long']) && !$this->actions['rss_short_list'] && $this->rss_config['rss_allow_long'] ) {
+			$this->actions['rss_long_list'] = true;
+			$this->rss_config['extra_title'] .= ' - ' . $user->lang['RSS_LONG'];
+			$this->url_config['extra_params_full'] .= 'long/';
+			$this->url_config['extra_params'] .= 'long/';
+			$this->rss_config['rss_url_limit'] = $this->actions['rss_content'] ? intval($this->rss_config['rss_url_limit']*3) : intval($this->set_module_option('url_limit_long', $this->gym_config['rss_override']));
+			$this->rss_config['rss_sql_limit'] = $this->actions['rss_content'] ? intval($this->rss_config['rss_url_limit']*2) : intval($this->set_module_option('sql_limit_long', $this->gym_config['rss_override']));
+		}
+		// Adjust variable a bit
+		if ($this->actions['rss_content'] ) { // requested and auth
+			$this->rss_config['rss_msg_filters'] = $this->set_msg_strip($this->rss_config['rss_strip_bbcode']);
+		}
+		$this->url_config['extra_params_delimE'] = $this->url_config['extra_paramsE'] = '';
+		$this->url_config['extra_params_delimQ'] = $this->url_config['extra_paramsQ'] = '';
+		$this->url_config['rss_vpath'] = '';
+		if ($this->rss_config['rss_modrewrite']) {
+			$this->actions['extra_params'] = $this->url_config['extra_params'];
+			$this->actions['extra_params_full'] = $this->url_config['extra_params_full'];
+			$this->url_config['extra_params_delimE'] = '/';
+			$this->url_config['extra_params_delimQ'] = '?';
+			$this->url_config['rss_vpath'] = 'rss/'; // virtual rss path for forum RSS feed URLs etc ...
+			$this->url_config['rss_default'] = 'rss.xml' . $this->url_config['gzip_ext_out'] ;
+			if (!empty($this->url_config['extra_params'])) {
+				$this->url_config['extra_paramsE'] = $this->url_config['extra_params'];
+				$this->url_config['extra_paramsQ'] = $this->url_config['extra_params_delimQ'] . $this->url_config['extra_params'];
+			}
+		} else {
+			$this->url_config['extra_params'] = str_replace('/', '&amp;', trim($this->url_config['extra_params'], '/'));
+			$this->actions['extra_params_full'] = str_replace('/', '&amp;', trim($this->url_config['extra_params_full'], '/'));
+			$this->url_config['extra_params_delimE'] = '&amp;';
+			$this->url_config['extra_params_delimQ'] = '?';
+			if (!empty($this->url_config['extra_params'])) {
+				$this->url_config['extra_paramsE'] = $this->url_config['extra_params_delimE'] . $this->url_config['extra_params'];
+				$this->url_config['extra_paramsQ'] = $this->url_config['extra_params_delimQ'] . $this->url_config['extra_params'];
+			}
+		}
+	}
+	/**
+	* forum_rss_url() builds rss forum url with proper options
+	* Suffixe is not added here, to properly deal with pagination
+	*/
+	function forum_rss_url($forum_name, $forum_id) {
+		global $phpbb_seo;
+		return !empty($phpbb_seo->cache_config['forum'][$forum_id]) ? $phpbb_seo->cache_config['forum'][$forum_id] : $phpbb_seo->format_url( $forum_name, 'forum' ) . $this->url_config['rss_forum_delim'] . $forum_id;
+	}
+	/**
+	* rss_output() will build all rss output
+	* @access private
+	*/
+	function rss_output() {
+		global $phpEx, $db, $config, $phpbb_root_path, $user, $phpbb_seo;
+		// Initialize SQL cycling : do not query for more than required
+		$this->rss_config['rss_sql_limit'] = ($this->rss_config['rss_sql_limit'] > $this->rss_config['rss_url_limit']) ? $this->rss_config['rss_url_limit'] : $this->rss_config['rss_sql_limit'];
+		// XSLT styling
+		if ($this->rss_config['rss_xslt']) {
+			// here we could go further and allow user style to be used, would need to parse the cache a bit,
+			// but, unlike Google sitemaps, RSS feeds are decently small for that.
+			$this->style_config['xslt_style'] = "\n" . '<'.'?xml-stylesheet type="text/xsl" href="' . $phpbb_seo->seo_path['phpbb_url'] . 'gym_sitemaps/gym_style.' . $phpEx . '?action-rss,type-xsl,lang-' . $config['default_lang'] . ',theme_id-' . $config['default_style'] . '" media="screen, projection" ?'.'>';
+			$blanc_fix = '';
+			if ($this->rss_config['rss_force_xslt']) {
+				// FF 2 and IE7 only look for the first 500 chars to decide if it's rss or not
+				// and impose their private styling
+				for ($i=0; $i<550; $i++) {
+					$blanc_fix .= ' ';
+				}
+				$blanc_fix = "\n" . '<!-- Some spaces ' . $blanc_fix . ' to force xlst -->';
+			}
+			$this->style_config['xslt_style'] .= $blanc_fix;
+		}
+		// Remove guid for channels
+		if ($this->actions['rss_channel_list']) {
+			$this->style_config['rss_item_tpl'] = str_replace("\n\t\t\t" . '<guid isPermaLink="true">%s</guid>', '', $this->style_config['rss_item_tpl']);
+		}
+		// custom url transition message
+		if (!empty($this->actions['gym1x_newurl'])) {
+			$chan_title = $user->lang['RSS_1XREDIR'] . ' - ' . $this->gym_config['rss_sitename'];
+			$chan_desc = $user->lang['RSS_1XREDIR_MSG'] . ' : ' . $this->parse_link($this->actions['gym1x_newurl']) . "\n" . $this->gym_config['rss_site_desc'];
+			$rss_new_url = $this->rss_config['rss_url'] . $this->actions['gym1x_newurl'];
+			$this->output_data['data'] = sprintf($this->style_config['rss_header'], $this->style_config['xslt_style'], $this->gym_config['gym_version'] );
+			$this->parse_channel($chan_title, $chan_desc, $rss_new_url, $this->output_data['last_mod_time'], $this->rss_config['rss_image_url'], $rss_new_url);
+			$this->parse_item($chan_title, $chan_desc, $rss_new_url, $rss_new_url, '', $this->output_data['last_mod_time']);
+			$this->output_data['data'] .= $this->style_config['rss_footer'];
+			return;
+		}
+		// module action
+		if (in_array($this->actions['module_main'], $this->actions['action_modules'])) { // List item from the module
+			$module_class = $this->actions['action_type'] . '_' . $this->actions['module_main'];
+			$this->load_module($module_class, 'rss_module');
+			if ( empty($this->output_data['url_sofar']) ) {
+				$this->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__);
+			}
+			$this->output_data['data'] = sprintf($this->style_config['rss_header'], $this->style_config['xslt_style'], $this->gym_config['gym_version'] ) . $this->output_data['data'] . $this->style_config['rss_footer'];
+		} else { // Add items from installed modules
+			$site_title = $this->gym_config['rss_sitename'];
+			$site_desc = $this->gym_config['rss_site_desc'] . "\n";
+			if ($this->actions['rss_channel_list']) {
+				$chan_source = $this->rss_config['rss_url'] . $this->url_config['rss_vpath'] . (($this->rss_config['rss_modrewrite']) ? (!empty($this->url_config['extra_params']) ? $this->url_config['extra_params'] : '') : $this->url_config['rss_default'] . $this->url_config['extra_params_delimQ'] . $this->actions['extra_params_full']);
+				$site_title_full = $site_title . $this->rss_config['extra_title'];
+				$site_desc .= $user->lang['RSS_CHAN_LIST_DESC'] . "\n";
+			} else {
+				$chan_source = $this->rss_config['rss_url'] . $this->url_config['rss_vpath'] . (($this->rss_config['rss_modrewrite']) ? (!empty($this->url_config['extra_params']) ? $this->url_config['extra_params'] : '') . $this->url_config['rss_default'] : $this->url_config['rss_default'] . $this->url_config['extra_paramsQ']);
+				$site_title_full = $site_title . $this->rss_config['extra_title'];
+			}
+			$this->seo_kill_dupes($chan_source);
+			$this->parse_channel($site_title_full, $site_desc, $this->rss_config['rss_url'], $this->output_data['last_mod_time'], $this->rss_config['rss_image_url'], $chan_source);
+			// Since we are going to cycle through modules, we need to ajust URL limit and counting a bit
+			// URL limit, we take the last xx items from each feed
+			// where xx is the URL limit divided by the number of feeds
+			$this->rss_config['rss_url_limit'] = !empty($this->actions['action_modules']) ? intval($this->rss_config['rss_url_limit'] / count($this->actions['action_modules'])) : 0;
+			if ( empty($this->rss_config['rss_url_limit']) ) {
+				$this->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__);
+			}
+			// start the modules
+			// We are working on all available modules
+			$this->load_modules('rss_main');
+			$this->output_data['url_sofar'] = $this->output_data['url_sofar_total'];
+			if ( empty($this->output_data['url_sofar']) ) {
+				$this->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__);
+			}
+			$this->output_data['data'] = sprintf($this->style_config['rss_header'], $this->style_config['xslt_style'], $this->gym_config['gym_version'] ) . $this->output_data['data'] . $this->style_config['rss_footer'];
+		}
+		if ( $this->rss_config['rss_yahoo_notify'] && ($this->output_data['time'] >= ($this->cache_config['cache_born'] + $this->cache_config['cache_max_age'])) ) {
+			$this->rss_yahoo_notify();
+		}
+		return;
+	}
+	/**
+	* parse_channel() adds the channel info to the output
+	*/
+	function parse_channel($chan_title, $chan_desc, $chan_link, $lastBuildDate = 0, $chan_image = '', $chan_source = '') {
+		global $config, $user;
+		// Misc SQL Explain
+		global $auth;
+		if ( !empty($chan_source) && $auth->acl_get('a_') && defined('DEBUG_EXTRA')) {
+			if (!empty($_REQUEST['explain'])) {
+				return;
+			}
+			if (empty($user->lang['GYM_SQLEXPLAIN_MSG'])) {
+				$user->add_lang('gym_sitemaps/gym_common');
+			}
+			$report_url =  $chan_source . (strpos($chan_source, '?') !== false ? '&amp;' : '?') . 'explain=1';
+			$this->actions['sql_report_msg'] = "\n<i style=\"color:#CC0000\">" . sprintf($user->lang['GYM_SQLEXPLAIN_MSG'], $this->parse_link($report_url , $user->lang['GYM_SQLEXPLAIN'])) . '</i>';
+		}
+		$lastBuildDate = intval($lastBuildDate);
+		if ( $lastBuildDate > $config['board_startdate']) {
+			$this->output_data['last_mod_time'] = $lastBuildDate;
+			if (( $this->cache_config['cache_max_age'] + $lastBuildDate) <= $this->output_data['time']) {
+				$ttl_time = (int) ($this->cache_config['cache_max_age'] / 60);
+			} else {
+				$ttl_time = ( $this->cache_config['cache_max_age'] + $lastBuildDate) - $this->output_data['time'];
+			}
+			$ttl = sprintf($this->style_config['chan_ttl_tpl'], intval( ( $ttl_time / 60)) );
+			$lastBuildDate = sprintf($this->style_config['chan_lastbuildate_tpl'], gmdate('D, d M Y H:i:s \G\M\T', intval($lastBuildDate)));
+		} else {
+			$lastBuildDate = '';
+			$ttl = '';
+		}
+		$chan_image = !empty($chan_image) ? sprintf($this->style_config['rsschan_img_tpl'], $this->xml_encode($chan_title), $chan_image, $chan_link) : '';
+		$input = !empty($chan_source) ? sprintf($this->style_config['rsschan_input_tpl'], $this->xml_encode($user->lang['RSS_2_LINK'] . ' : ' . $chan_title), $this->xml_encode($chan_desc . $user->lang['RSS_2_LINK']), $chan_source, 'gym_sitemaps') :  '';
+
+		$this->output_data['data'] .= sprintf($this->style_config['rsschan_tpl'], $this->xml_encode($chan_title), $chan_link, $this->xml_encode($chan_desc . $this->rss_config['rss_auth_msg'] . $this->actions['sql_report_msg']), $lastBuildDate, $chan_image, $ttl, $chan_source, $input);
+	}
+	/**
+	* parse_item() adds the item info to the output
+	*/
+	function parse_item($item_title, $item_desc, $item_link, $item_source, $item_source_title = '', $pubDate = 0, $author = false) {
+		global $config;
+		$pubDate = $pubDate > $config['board_startdate'] ? sprintf($this->style_config['item_pubdate_tpl'], gmdate('D, d M Y H:i:s \G\M\T', intval($pubDate))) : '';
+		$item_desc = $this->rss_config['rss_nohtml'] ? strip_tags($item_desc) : $item_desc;
+		$item_source_title = !empty($item_source_title) ? $item_source_title : $item_title;
+		$author = $author ? sprintf($this->style_config['item_creator_tpl'], $this->xml_encode($author)) : '';
+		$this->output_data['data'] .= sprintf($this->style_config['rss_item_tpl'], $this->xml_encode($item_title), $item_link, $pubDate, $this->xml_encode($item_desc . $this->rss_config['rss_auth_msg']), $item_source, $this->xml_encode($item_source_title), $item_link, $author);
+		$this->output_data['url_sofar']++;
+	}
+	/**
+	* prepare_for_output($topic, $key = '')
+	* will put together BBcodes and smilies before the output
+	* @param array $topic
+	* @access private
+	*/
+	function prepare_for_output($topic, $key = '') {
+		global $config, $user, $phpbb_seo;
+		static $bbcode;
+		static $patterns;
+		static $replaces;
+		$bbcode_uid = $topic['bbcode_uid' . $key];
+		$bitfield = $topic['bbcode_bitfield' . $key];
+		$message_title = !empty($topic['post_subject' . $key]) ? $topic['post_subject' . $key] : $topic['topic_title'];
+		$message_title = censor_text($message_title);
+		$message = '<b>' . $message_title . '</b>' . "\n\n" . $topic['post_text' . $key];
+		if (!isset($patterns)) {
+			if ( !empty($this->rss_config['rss_msg_filters']['pattern']) ) {
+				$patterns = $this->rss_config['rss_msg_filters']['pattern'];
+				$replaces = $this->rss_config['rss_msg_filters']['replace'];
+			} else {
+				$patterns = $replaces = array();
+			}
+		}
+		if (!empty($patterns)) {
+			$message = preg_replace($patterns, $replaces, $message);
+		}
+		if ($this->rss_config['rss_sumarize'] > 0 ) {
+			$message = $this->summarize( $message, $this->rss_config['rss_sumarize'], $this->rss_config['rss_sumarize_method'] );
+			// Clean broken tag at the end of the message
+			$message = preg_replace('`\<[^\<\>]*$`i', ' ...', $message);
+			// Close broken bbcode tags requiring it
+			$this->close_bbcode_tags($message, $bbcode_uid);
+		}
+		$message = censor_text($message);
+		if (!$this->rss_config['rss_nohtml']) {
+			if ($bitfield && $this->rss_config['rss_allow_bbcode']) {
+				if (!class_exists('bbcode')) {
+					global $phpbb_root_path, $phpEx;
+					include_once($phpbb_root_path . 'includes/bbcode.' . $phpEx);
+				}
+				if (empty($bbcode)) {
+					$bbcode = new bbcode($bitfield);
+				} else {
+					$bbcode->bbcode($bitfield);
+				}
+				if ( !$this->rss_config['rss_allow_links'] ) {
+					$message = preg_replace("`\[/?url(=.*)?\]`i", "", $message);
+				}
+				$bbcode->bbcode_second_pass($message, $bbcode_uid);
+			}
+			// Parse smilies
+			$message = $this->smiley_text($message, !($this->rss_config['rss_allow_smilies'] && $topic['enable_smilies' . $key]));
+			if ($this->rss_config['rss_sumarize'] > 0 ) {
+				// last clean up
+				static $_find = array('`\<\!--[^\<\>]+--\>`Ui', '`\[\/?[^\]\[]*\]`Ui');
+				$message = preg_replace($_find, '', $message);
+				$message .= "\n\n" . '<a href="' . $topic['topic_url' . $key] . '"><b>' . $user->lang['RSS_MORE'] . ' ...</b></a>'. "\n\n";
+			}
+		} else {
+			$message = strip_tags(preg_replace('`\[\/?[^\]\[]*\]`Ui', '', $message));
+		}
+		return "\n" . $message;
+	}
+	/**
+	* close_bbcode_tags(&$message, $uid, $bbcodelist)
+	* will tend to do it nicely ;-)
+	* Will close the bbcode tags requiring it in the list (quote|b|u|i|color|*|list)
+	* Beware, bo not reduce $bbcodelist without knowing what you are doing
+	*/
+	function close_bbcode_tags(&$message, $uid, $bbcodelist = 'quote|b|u|i|color|*|list') {
+		global $config, $user, $phpbb_seo;
+		$open_lists = $close_lists = array();
+		$bbcodelist = str_replace('|*', '|\*', $bbcodelist);
+		$open_count = preg_match_all('`\[(' . $bbcodelist . ')(\=([a-z0-9]{1}))?[^\]\[]*\:' . $uid . '\]`i', $message, $open_matches);
+		$close_count = preg_match_all('`\[/(' . $bbcodelist . ')(\:([a-z]{1}))?[^\]\[]*\:' . $uid . '\]`i', $message, $close_matches);
+		if ($open_count == $close_count) { // No need to go further
+			return;
+		}
+		if (!empty($open_matches[1])) {
+			$open_list = array_count_values($open_matches[1]);
+			$close_list = !empty($close_matches[1]) ? array_count_values($close_matches[1]) : array();
+			$list_to_close = array();
+			if (isset($open_list['list'])) {
+				foreach ($open_matches[1] as $k => $v) {
+					if ($v == 'list') {
+						$open_lists[] = !empty($open_matches[3][$k]) ? 'o' : 'u';
+					}
+				}
+				if (!empty($close_matches[1])) {
+					foreach ($close_matches[1] as $k => $v) {
+						if ($v == 'list') {
+							$close_lists[] = !empty($close_matches[3][$k]) ? 'o' : 'u';
+						}
+					}
+				}
+				$list_to_close = array_reverse(array_diff_assoc($open_lists, $close_lists));
+			}
+			unset($open_list['*'], $open_list['list']);
+			foreach ($open_list as $bbcode => $total) {
+				if (empty($close_list[$bbcode]) || $close_list[$bbcode] < $total) {
+					// close the tags
+					$diff = empty($close_list[$bbcode]) ? $total : $total - $close_list[$bbcode];
+					$message .= str_repeat("[/$bbcode:$uid]", $diff);
+				}
+			}
+			// Close the lists if required
+			foreach ($list_to_close as $ltype) {
+				$message .= "[/*:m:$uid][/list:$ltype:$uid]";
+			}
+		}
+		return;
+	}
+	/**
+	* set_msg_strip($bbcode_list) will build up the unauthed bbcode list
+	* $bbcode_list = 'code:0,img:1,quote';
+	* $bbcode_list = 'all';
+	* 1 means the bbcode and it's content will be striped.
+	* all means all bbcodes.
+	* $returned_list = array('patern' => $matching_patterns, 'replace' => $replace_patterns);
+	* @access private
+	*/
+	function set_msg_strip($bbcode_list) {
+		$patterns = $replaces = array();
+		// Now the bbcodes
+		if (!$this->rss_config['rss_allow_bbcode'] || preg_match('`all\:?([0-1]*)`i', $bbcode_list, $matches)) {
+			if ( (@$matches[1] != 1 ) ) {
+				$patterns[] = '`\[\/?[a-z0-9\*\+\-]+(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})\]`i';
+				$replaces[] = '';
+			} else {
+				$patterns[] = '`\[([a-z0-9\*\+\-]+)((=|:)[^\:\]]*)?\:[0-9a-z]{5,}\].*\[/(?1)(:?[^\:\]]*)?\:[0-9a-z]{5,}\]`Usi';
+				$replaces[] = "{ \\1 }";
+			}
+			$patterns[] = '`<[^>]*>(.*<[^>]*>)?`Usi'; // All html
+			$replaces[] = '';
+		} else {
+			// Take care about links & emails
+			if ( !$this->rss_config['rss_allow_links'] ) {
+				if ( !$this->rss_config['rss_allow_emails'] ) { // Saves couple RegEx
+					$email_find = '[a-z0-9&\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+';
+					$email_replace = 'str_replace(array("@", "."), array("  AT  ", " DOT "),"\\1")';
+					$email_option = 'e';
+				} else {
+					$email_find = '.*?';
+					$email_replace = "\\1";
+					$email_option = '';
+				}
+				$patterns[] = '`<!\-\- ([lmw]+) \-\-><a (?:class="[\w-]+" )?href="(.*?)">.*?</a><!\-\- \1 \-\->`i';
+				$replaces[] = "\\2";
+				$patterns[] = '`\[/?url[^\]\[]*\]`i';
+				$replaces[] = '';
+				$patterns[] = '`<!\-\- e \-\-><a href="mailto:(' . $email_find . ')">.*?</a><!\-\- e \-\->`i' . $email_option;
+				$replaces[] = $email_replace;
+			}
+			if ( !$this->rss_config['rss_allow_emails'] && $this->rss_config['rss_allow_links'] ) {
+				$patterns[] = '`<!\-\- e \-\-><a href="mailto:([a-z0-9&\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+)">.*?</a><!\-\- e \-\->`ei';
+				$replaces[] = 'str_replace(array("@", "."), array("  AT  ", " DOT "),"\\1")';
+			}
+			$exclude_list =  ( empty($bbcode_list) ? array() : explode(',', $bbcode_list) );
+			$RegEx_unset = $RegEx_remove = '';
+			foreach ($exclude_list as $key => $value ) { // Group the RegEx
+				$value = trim($value);
+				if (preg_match("`[a-z0-9]+(\:([0-1]*))?`i", $value, $matches) ) {
+					$values = (strpos($value, ':') !== false) ?  explode(':', $value) : array($value);
+					if ( (@$matches[2] != 1 ) ) {
+						$RegEx_unset .= (!empty($RegEx_unset) ? '|' : '' ) . $values[0];
+					} else {
+						$RegEx_remove .= (!empty($RegEx_remove) ? '|' : '' ) . $values[0];
+					}
+				}
+			}
+			if (!empty($RegEx_remove) ) {
+				$patterns[] =  '`\[(' . $RegEx_remove . ')((=|:)[^\:\]]*)?\:[0-9a-z]{5,}\].*\[/(?1)(:?[^\:\]]*)?\:[0-9a-z]{5,}\]`Usi';
+				$replaces[] = "{ \\1 }";
+			}
+			if (!empty($RegEx_unset) ) {
+				$patterns[] =  '`\[/?(' . $RegEx_unset . ')(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})\]`i';
+				$replaces[] = '';
+			}
+		}
+		return  array('pattern' => $patterns, 'replace' => $replaces);
+	}
+	/**
+	* Some text formating functions for text output
+	* un_htmlspecialchars()
+	* @access private
+	*/
+	function un_htmlspecialchars($text) {
+		return preg_replace(array('#&gt;#', '#&lt;#', '#&quot;#', '#&amp;#'), array('>', '<', '"', '&'), $text);
+	}
+	/**
+	* Summarize method selector
+	* @access private
+	*/
+	function summarize($string, $limit, $method = 'lines') {
+		switch ($method) {
+			case 'words':
+				return $this->word_limit($string, $limit);
+				break;
+			case 'chars':
+				return $this->char_limit($string, $limit);
+				break;
+			case 'lines':
+			default:
+				return $this->line_limit($string, $limit);
+				break;
+		}
+	}
+	/**
+	* Cut the text by lines
+	* @access private
+	*/
+	function line_limit($string, $limit = 10, $ellipsis = ' ...') {
+		return count($lines = preg_split("`[\n\r]+`", ltrim($string), $limit + 1)) > $limit ? rtrim(utf8_substr($string, 0, utf8_strlen($string) - utf8_strlen(end($lines)))) . $ellipsis : $string;
+	}
+	/**
+	* Cut the text according to the number of words.
+	* Borrowed from www.php.net http://www.php.net/preg_replace
+	* @access private
+	*/
+	function word_limit($string, $limit = 50, $ellipsis = ' ...') {
+		return count($words = preg_split('`\s+`', ltrim($string), $limit + 1)) > $limit ? rtrim(utf8_substr($string, 0, utf8_strlen($string) - utf8_strlen(end($words)))) . $ellipsis : $string;
+	}
+	/**
+	* Cut the text according to the number of characters.
+	* Borrowed from www.php.net http://www.php.net/preg_replace
+	* @access private
+	*/
+	function char_limit($string, $limit = 100, $ellipsis = ' ...') {
+		return utf8_strlen($fragment = utf8_substr($string, 0, $limit + 1 - utf8_strlen($ellipsis))) < utf8_strlen($string) + 1 ? preg_replace('`\s*\S*$`', '', $fragment) . $ellipsis : $string;
+	}
+
+	// --> Yahoo! Notification functions <--
+	/**
+	* rss_yahoo_notify($url) will handle yahoo notification of new content
+	* @access private
+	*/
+	function rss_yahoo_notify($url = '') {
+		global $user, $config, $phpbb_seo;
+		$url = !empty($url) ? str_replace('&amp;', '&', $url) : (!empty($this->url_config['rss_yahoo_notify_url']) ? $this->url_config['rss_yahoo_notify_url'] : '');
+		$url = trim($url);
+		if (empty($url) || !$this->rss_config['rss_yahoo_notify'] || empty($this->rss_config['yahoo_appid'])) {
+			return;
+		}
+		// No more than 200 pings a day!
+		if (@$config['gym_pinged_today'] > 200) {
+			// @TODO add logs about this ?
+			return;
+		}
+		$skip = array('://localhost', '://127.0.0.1', '://192.168.', '://169.254.');
+		foreach ($skip as $_skip) {
+			if (utf8_strpos($url, $_skip) !== false) {
+				// @TODO add logs about this ?
+				return;
+			}
+		}
+		// If ssl is not forced, always ping with http urls
+		$url = $phpbb_seo->sslify($url, $phpbb_seo->ssl['forced']);
+		$not_curl= true;
+		$timout = 3;
+		// The Yahoo! Web Services request
+		// Based on the Yahoo! developper hints : http://developer.yahoo.com/php/
+		$request = "http://search.yahooapis.com/SiteExplorerService/V1/updateNotification?appid=" . urlencode($this->rss_config['yahoo_appid']) . '&url=' . urlencode($url);
+		if (function_exists('curl_exec')) {
+			$not_curl= false;
+			// Initialize the session
+			$session = curl_init($request);
+			// Set curl options
+			curl_setopt($session, CURLOPT_HEADER, false);
+			curl_setopt($session, CURLOPT_USERAGENT, 'GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+			curl_setopt($session, CURLOPT_TIMEOUT, $timout);
+			curl_setopt($session, CURLOPT_RETURNTRANSFER, true);
+			// Make the request
+			$response = curl_exec($session);
+			// Close the curl session
+			curl_close($session);
+			// Get HTTP Status code from the response
+			$status_codes = array();
+			preg_match('/\d\d\d/', $response, $status_code);
+			$status_code = $status_codes[0];
+			// Get the XML from the response, bypassing the header
+			if (!($xml = strstr($response, '<?xml'))) {
+				$xml = null;
+				$not_curl= true;
+			}
+		} else if ( $not_curl && function_exists('file_get_contents') ) {
+			ini_set('user_agent','GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+			ini_set('default_socket_timeout', $timout);
+			// Make the request
+			if ($xml = file_get_contents($request)) {
+				// Retrieve HTTP status code
+				list($version,$status_code,$msg) = explode(' ',$http_response_header[0], 3);
+			} else {
+			//	$user->lang['RSS_YAHOO_NO_METHOD'] = sprintf($user->lang['RSS_YAHOO_NO_METHOD'], $request, $xml);
+				$this->gym_error(503, 'RSS_YAHOO_NO_METHOD',  __FILE__, __LINE__);
+			}
+		}
+		// Check the XML return message
+		// Do it this way here in case curl actually returned no header
+		// but did get the proper answer.
+		if (!strpos($xml, 'success')) {
+			// Check the HTTP Status code
+			switch( $status_code ) {
+				case 200: // Success
+					set_config('gym_pinged_today', @$config['gym_pinged_today'] + 1, 1);
+					break;
+				case 503:
+					$this->gym_error(500, 'RSS_YAHOO_503', __FILE__, __LINE__);
+					break;
+				case 403:
+					$this->gym_error(500, 'RSS_YAHOO_403', __FILE__, __LINE__);
+					break;
+				case 400:
+				//	$user->lang['RSS_YAHOO_400_MSG'] = sprintf($user->lang['RSS_YAHOO_400_MSG'], $request, $xml);
+					$this->gym_error(500,'RSS_YAHOO_400',  __FILE__, __LINE__);
+					break;
+				default:
+				//	$user->lang['RSS_YAHOO_ERROR_MSG'] = sprintf($user->lang['RSS_YAHOO_400_MSG'], $status_code, $request, $xml);
+					$this->gym_error(500, 'RSS_YAHOO_500', __FILE__, __LINE__);
+			}
+		}
+		return;
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/gym_common.php
===================================================================
--- gym_sitemaps/includes/gym_common.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_common.php	(Premod 3.0.8)
@@ -0,0 +1,367 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_common.php 264 2010-06-02 07:13:08Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+global $table_prefix;
+// Table
+define('GYM_CONFIG_TABLE', $table_prefix . 'gym_config');
+// Overrides (must be numbers, and OVERRIDE_GLOBAL > OVERRIDE_OTYPE > OVERRIDE_MODULE > 0)
+define('OVERRIDE_GLOBAL', 3);
+define('OVERRIDE_OTYPE', 2);
+define('OVERRIDE_MODULE', 1);
+
+// Some set up
+$_action_types = array('google' => 'google', 'rss' => 'rss', 'html' => 'html', /*'yahoo' => 'yahoo'*/);
+if (defined('ADMIN_START') || defined('IN_INSTALL')) {
+	$_action_types['main'] = 'main';
+}
+$_override_types = array('cache', 'gzip', 'modrewrite', 'limit', 'pagination', 'sort');
+
+/**
+* obtain_gym_config ($mode, &$cfg_array).
+* Get the required config datas
+*/
+function obtain_gym_config($mode, &$cfg_array) {
+	global $db, $cache;
+	$sql_config = '';
+	$cache_file = '_gym_config';
+	$mode = empty($mode) ? 'main' : $mode;
+	if ($mode != 'main') {
+		$sql_config = 	"WHERE config_type = 'main' OR config_type = '" . $db->sql_escape($mode). "'";
+		$cache_file .= '_' . $mode;
+	} else {
+		$cache_file .= '_main';
+	}
+	if (($cfg_array = $cache->get($cache_file)) === false) {
+		$cfg_array = array();
+		$sql = "SELECT *
+			FROM " . GYM_CONFIG_TABLE . "
+			$sql_config";
+		$db->sql_return_on_error(true);
+		$result = $db->sql_query($sql);
+		$db->sql_return_on_error(false);
+		while ($row = $db->sql_fetchrow($result)) {
+			$cfg_array[$row['config_name']] = $row['config_value'];
+		}
+		$db->sql_freeresult($result);
+		$cache->put($cache_file, $cfg_array);
+	}
+	return;
+}
+/**
+* set_gym_config($config_name, $config_value, $mode, &$cfg_array)
+* Set gym_config value. Creates missing config entry if needed.
+*/
+function set_gym_config($config_name, $config_value, $mode, &$cfg_array) {
+	global $db, $_action_types;
+	if (!in_array($mode, $_action_types) ) {
+		trigger_error('GYM_ERROR_MODULE_TYPE', E_USER_ERROR);
+	}
+	$sql = 'UPDATE ' . GYM_CONFIG_TABLE . "
+		SET config_value = '" . $db->sql_escape($config_value) . "'
+		WHERE config_name = '" . $db->sql_escape($config_name) . "'";
+	$db->sql_query($sql);
+	if (!$db->sql_affectedrows() && !isset($cfg_array[$config_name])) {
+		$sql = 'INSERT INTO ' . GYM_CONFIG_TABLE . ' ';
+		$sql .= $db->sql_build_array('INSERT', array(
+			'config_name'	=> (string) $config_name,
+			'config_value'	=> (string) $config_value,
+			'config_type'	=> (string) $mode,
+			)
+		);
+		$db->sql_query($sql);
+	}
+	$cfg_array[$config_name] = $config_value;
+	return;
+}
+/**
+* rem_gym_config($config_name, &$cfg_array)
+* Delete rem_gym_config value.
+*/
+function rem_gym_config($config_name, &$cfg_array) {
+	global $db;
+	$sql = 'DELETE FROM ' . GYM_CONFIG_TABLE . "
+		WHERE config_name = '" . $db->sql_escape($config_name) . "'";
+	$db->sql_query($sql);
+	unset($cfg_array[$config_name]);
+	return;
+}
+/**
+* obtain_gym_links().
+* Builds the rss and sitemaps links
+*/
+function obtain_gym_links($gym_links = array()) {
+	global $phpbb_root_path, $template, $cache, $config, $phpEx, $user, $phpbb_seo, $auth;
+	if (empty($config['gym_installed'])) {
+		return;
+	}
+	$_phpbb_seo = !empty($phpbb_seo);
+	$board_url = $_phpbb_seo ? $phpbb_seo->seo_path['phpbb_url'] : generate_board_url() . '/';
+	$gym_config = array();
+	$ssl_bit = $phpbb_seo->ssl['use'] ? 'ssl_' : '';
+	$cache_file = '_gym_links_' . $ssl_bit . $user->data['user_lang'];
+	$gym_link_tpl = '<a href="%1$s" title="%3$s" class="gym"><img src="' . $board_url . 'gym_sitemaps/images/%2$s" alt="%3$s" width="14", height="14"/>&nbsp;%4$s</a>&nbsp;';
+	if (($links = $cache->get($cache_file)) === false) {
+		obtain_gym_config('main', $gym_config);
+		$user->add_lang('gym_sitemaps/gym_common');
+		if (!defined('GYM_RSS_FUNC_INC')) {
+			require($phpbb_root_path . 'gym_sitemaps/includes/gym_rss_functions.' . $phpEx);
+		}
+		$links = get_gym_links($gym_config);
+		$cache->put($cache_file, $links);
+	}
+	// In case one would want to manually fil the array in some file, like viewforum
+	// Would be passed here from page_header() where $gym_links is global
+	if (!empty($gym_links['main'])) {
+		$links = array_merge($links['main'], $gym_links['main']);
+	}
+	// A bit dirty but lazy way to add forum maps and news pages everywhere ;-)
+	$html_setup = & $links['setup']['html'];
+	$rss_setup = & $links['setup']['rss'];
+	$google_setup = & $links['setup']['google'];
+	if (!empty($html_setup['forum_allow_cat_news']) || !empty($html_setup['forum_allow_cat_map']) || !empty($rss_setup['forum_rss']) || !empty($google_setup['forum_google'])) {
+		$_f_sep = $_phpbb_seo ? $phpbb_seo->seo_delim['forum'] : '';
+		$display_main_index = !empty($links['setup']['main']['link_index']);
+		if ($display_main_index && !empty($template->_tpldata['forumrow'])) {
+			foreach ($template->_tpldata['forumrow'] as $k => $v) {
+				$num_topics = !empty($v['TOPICS']) ? max(0, (int) $v['TOPICS']) : 0;
+				if ($num_topics && empty($v['S_IS_LINK']) && empty($v['S_IS_CAT'])) {
+					$link = '';
+					$forum_id = (int) $v['FORUM_ID'];
+					$forum_name = $v['FORUM_NAME'];
+					if (!empty($html_setup['link_index']) && (isset($html_setup['auth_guest'][$forum_id]) || (!empty($html_setup['forum_allow_auth']) && !isset($html_setup['forum_exclude'][$forum_id])))) {
+						if ($html_setup['forum_allow_cat_news']) {
+							$url = sprintf($html_setup['forum_cat_news'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id );
+							$link .= sprintf($gym_link_tpl, $url, 'html_news.gif', sprintf($html_setup['l_html_news_of'], $forum_name), $html_setup['l_html_news']);
+						}
+						if ($html_setup['forum_allow_cat_map']) {
+							$url = sprintf($html_setup['forum_cat_map'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id );
+							$link .= ' ' . sprintf($gym_link_tpl, $url, 'maps-icon.gif', sprintf($html_setup['l_html_map_of'], $forum_name), $html_setup['l_html_map']);
+						}
+					}
+					if (!empty($rss_setup['link_index']) && (isset($rss_setup['auth_guest'][$forum_id]) || ($rss_setup['forum_allow_auth'] && !isset($rss_setup['forum_exclude'][$forum_id])))) {
+						$url = sprintf($rss_setup['forum_cat_rss'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id );
+						$link .= ' ' . sprintf($gym_link_tpl, $url, 'feed-icon.png', sprintf($rss_setup['l_rss_feed_of'], $forum_name), $rss_setup['l_rss_feed']);
+					}
+					if (!empty($google_setup['link_index']) && isset($google_setup['auth_guest'][$forum_id]) && ($num_topics >= $google_setup['threshold'])) {
+							$url = sprintf($google_setup['forum_cat_google'], $_phpbb_seo ? str_replace($_f_sep . $forum_id, '', $phpbb_seo->seo_url['forum'][$forum_id]) . $_f_sep . $forum_id : '', $forum_id );
+							$link .= ' ' . sprintf($gym_link_tpl, $url, 'sitemap-icon.gif', sprintf($google_setup['l_google_sitemap_of'], $forum_name), $google_setup['l_google_sitemap']);
+					}
+					if ($link) {
+						$template->_tpldata['forumrow'][$k]['FORUM_DESC'] .= "<br/>$link";
+					}
+				}
+			}
+		}
+		$display_main_cat = !empty($links['setup']['main']['link_cat']);
+		if ($display_main_cat && !empty($template->_rootref['FORUM_NAME']) && !empty($template->_rootref['FORUM_ID'])) {
+			$forum_id = (int) $template->_rootref['FORUM_ID'];
+			$forum_name = $template->_rootref['FORUM_NAME'];
+			$do_display = false;
+			if (!empty($template->_tpldata['navlinks'])) {
+				$forum_data = $template->_tpldata['navlinks'][count($template->_tpldata['navlinks']) - 1];
+			}
+			if (!empty($forum_data) ) {
+				if ($_phpbb_seo && empty($phpbb_seo->seo_url['forum'][$forum_id])) {
+					$phpbb_seo->seo_url['forum'][$forum_id] = $phpbb_seo->set_url($forum_name, $forum_id, 'forum');
+				}
+				if (!empty($html_setup['link_cat']) && (isset($html_setup['auth_guest'][$forum_id]) || (!empty($html_setup['forum_allow_auth']) && !isset($html_setup['forum_exclude'][$forum_id]))) ) {
+					if ($html_setup['forum_allow_cat_news']) {
+						$url = sprintf($html_setup['forum_cat_news'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id);
+						$title = sprintf($html_setup['l_html_news_of'], $forum_name);
+						$links['main']['GYM_HTML_FORUM_NEWS_LINK'] = sprintf($gym_link_tpl, $url, 'html_news.gif', $title, $html_setup['l_html_news']);
+						$do_display = true;
+					}
+					if ($html_setup['forum_allow_cat_map']) {
+						$url = sprintf($html_setup['forum_cat_map'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id );
+						$title = sprintf($html_setup['l_html_map_of'], $forum_name);
+						$links['main']['GYM_HTML_FORUM_MAP_LINK'] = sprintf($gym_link_tpl, $url, 'maps-icon.gif', $title, $html_setup['l_html_map']);
+						$do_display = true;
+					}
+				}
+			}
+			if (!empty($forum_data['S_IS_POST'])) {
+				if (!empty($rss_setup['link_cat']) && (isset($rss_setup['auth_guest'][$forum_id]) || ($rss_setup['forum_allow_auth'] && !isset($rss_setup['forum_exclude'][$forum_id])) )) {
+					$url = sprintf($rss_setup['forum_cat_rss'], $_phpbb_seo ? $phpbb_seo->seo_url['forum'][$forum_id] : '', $forum_id );
+					$title = sprintf($rss_setup['l_rss_feed_of'], $forum_name);
+					$links['main']['GYM_RSS_FORUM_LINK'] = sprintf($gym_link_tpl, $url, 'feed-icon.png', $title, $rss_setup['l_rss_feed']);
+					if (!empty($links['setup']['rss']['display_forum_alternate'])) {
+						$links['alternate'][] = array(
+							'TITLE' => $title,
+							'URL' => $url
+						);
+					}
+					$do_display = true;
+				}
+				if (!empty($google_setup['link_cat']) && isset($google_setup['auth_guest'][$forum_id])) {
+					$url = sprintf($google_setup['forum_cat_google'], $_phpbb_seo ? str_replace($_f_sep . $forum_id, '', $phpbb_seo->seo_url['forum'][$forum_id]) . $_f_sep . $forum_id : '', $forum_id );
+					$title = sprintf($google_setup['l_google_sitemap_of'], $forum_name);
+					$links['main']['GYM_GOOGLE_FORUM_LINK'] = sprintf($gym_link_tpl, $url, 'sitemap-icon.gif', $title, $google_setup['l_google_sitemap']);
+					$do_display = true;
+				}
+			}
+			$links['main']['GYM_LINKS_CAT'] = $do_display;
+		}
+	}
+	if (!empty($links['main'])) {
+		$template->assign_vars($links['main']);
+	}
+	if (!empty($links['alternate'])) {
+		foreach ($links['alternate'] as $alternate) {
+			$template->assign_block_vars('gym_rsslinks', $alternate);
+		}
+	}
+	return $links['setup'];
+}
+/**
+* display_feed($params, $tpl_prefix = '')
+* $params : array of params or string feed URL for defaults
+* tpl_prefix is for using different link blocks on one page
+* Use display_feed('http://www.example.com/rss/rss.xml') to use default settings.
+* */
+function display_feed($params, $tpl_prefix = '') {
+	global $cache, $user, $config, $template, $phpbb_root_path, $phpEx;
+	if (is_string($params)) {
+		$params = array('url' => $params);
+	}
+	$_params = array(
+		'url' => trim(str_replace('&amp;', '&', $params['url'])),
+		'slide' => !empty($params['slide']),
+		'speed' => !empty($params['speed']) ? max((int) $params['speed'], 1) : 30,
+		'ttl' => !empty($params['ttl']) ? max((int) $params['ttl'], 0) : 3600,
+		'limit' => !empty($params['limit']) ? max((int) $params['limit'], 1) : 5,
+		'desc' => !empty($params['desc']),
+		'html' => !empty($params['html']),
+		'striptags' => !empty($params['striptags']),
+	);
+	if (empty($_params['url'])) {
+		return false;
+	}
+	$cache_file = '_gym_links_' . md5($user->data['user_lang'] . $_params['url']);
+	if (($feed_data = $cache->get($cache_file)) === false) {
+		if (!defined('GYM_RSS_FUNC_INC')) {
+			require($phpbb_root_path . 'gym_sitemaps/includes/gym_rss_functions.' . $phpEx);
+		}
+		$feed_data = get_feed_data($_params);
+		$cache->put($cache_file, $feed_data, $_params['ttl']);
+	}
+	if (!empty($feed_data['items'])) {
+		$template->assign_vars(array($tpl_prefix . 'GYM_RSS_AGREGATED' => true,
+			$tpl_prefix . 'GYM_CHAN_TITLE' => $feed_data['setup']['chantitle'],
+			$tpl_prefix . 'GYM_CHAN_LINK' => $feed_data['setup']['chanlink'],
+			$tpl_prefix . 'GYM_CHAN_SOURCE' => $_params['url'],
+			$tpl_prefix . 'GYM_RSS_AUTHOR' => false,
+			$tpl_prefix . 'GYM_RSS_DATE' => $feed_data['setup']['date'],
+			$tpl_prefix . 'GYM_RSS_DESC' => $_params['desc'],
+			$tpl_prefix . 'GYM_RSS_SLIDE' => $_params['slide'],
+			$tpl_prefix . 'GYM_RSS_SLIDE_SP' => 'height:' . ($_params['desc'] ? $_params['limit']*45: $_params['limit']*20) . 'px;',
+			$tpl_prefix . 'GYM_RSS_SLIDE_SP_JS' => $_params['desc'] ? $_params['limit']*45 : $_params['limit']*20,
+			$tpl_prefix . 'GYM_RSS_SLIDE_EP' => $_params['desc'] ? (int) ($_params['limit']*$feed_data['setup']['desclen']/(count($feed_data['items'])*2.67)) : $_params['limit']*45,
+			$tpl_prefix . 'GYM_RSS_CSSID' => $tpl_prefix . 'gnews',
+			$tpl_prefix . 'GYM_RSS_SCRSPEED' => $_params['speed'],
+		));
+		$i = 1;
+		foreach ($feed_data['items'] as $item) {
+			if ($i > $_params['limit']) {
+				break;
+			}
+			$template->assign_block_vars(strtolower($tpl_prefix) . 'gym_link_list', $item);
+			$i++;
+		}
+		unset($feed_data);
+		return true;
+	}
+	return false;
+}
+/**
+* get_override($mode, $key, $gym_config)
+*
+*/
+function get_override($mode, $key, $gym_config) {
+	return $gym_config['gym_override_' . $key] != OVERRIDE_GLOBAL ? ($gym_config[$mode . '_override_' . $key] != OVERRIDE_GLOBAL ? $gym_config[$mode . '_override_' . $key] : $gym_config['gym_override_' . $key] ) : OVERRIDE_GLOBAL;
+}
+/**
+* get_gym_option($mode, $type, $gym_config)
+* Same effect as gym_sitemaps::set_module_option() but with all params and usable outisde the class
+*/
+function get_gym_option($mode, $module, $key, $override, &$gym_config) {
+	return ($override == OVERRIDE_MODULE && @isset($gym_config[$mode . '_' . $module . '_' . $key])) ? $gym_config[$mode . '_' . $module . '_' . $key] : ( ($override != OVERRIDE_GLOBAL && @isset($gym_config[$mode . '_' . $key])) ? $gym_config[$mode . '_' . $key] : ( isset($gym_config['gym_' . $key]) ? $gym_config['gym_' . $key] : ( @isset($gym_config[$mode . '_' . $key]) ? $gym_config[$mode . '_' . $key] : ( @isset($gym_config[$mode . '_' . $module . '_' . $key]) ? $gym_config[$mode . '_' . $module . '_' . $key] : null ) ) ) );
+}
+/**
+* get_date_from_header($response_header_array)
+*/
+function get_date_from_header($response_header_array) {
+	if (is_array($response_header_array)) {
+		foreach ($response_header_array as $header_line) {
+			if (preg_match('`Date:(.+)`i', $header_line, $match)) {
+				return (int) strtotime(trim($match[1]));
+			}
+		}
+	}
+	return 0;
+}
+/**
+* numeric_entify_utf8()
+* borrowed from php.net : http://www.php.net/utf8_decode
+*/
+function numeric_entify_utf8($utf8_string) {
+	$out = "";
+	$ns = strlen ($utf8_string);
+	for ($nn = 0; $nn < $ns; $nn ++) {
+		$ch = $utf8_string[$nn];
+		$ii = ord ($ch);
+		if ($ii < 128) { //1 7 0bbbbbbb (127)
+			$out .= $ch;
+		} elseif ($ii >> 5 == 6) { //2 11 110bbbbb 10bbbbbb (2047)
+			$b1 = ($ii & 31);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b2 = ($ii & 63);
+			$ii = ($b1 * 64) + $b2;
+			$ent = sprintf ("&#%d;", $ii);
+			$out .= $ent;
+		} elseif ($ii >> 4 == 14) { //3 16 1110bbbb 10bbbbbb 10bbbbbb
+			$b1 = ($ii & 31);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b2 = ($ii & 63);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b3 = ($ii & 63);
+			$ii = ((($b1 * 64) + $b2) * 64) + $b3;
+			$ent = sprintf ("&#%d;", $ii);
+			$out .= $ent;
+		} elseif ($ii >> 3 == 30) { //4 21 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb
+			$b1 = ($ii & 31);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b2 = ($ii & 63);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b3 = ($ii & 63);
+			$nn ++;
+			$ch = $utf8_string[$nn];
+			$ii = ord ($ch);
+			$b4 = ($ii & 63);
+			$ii = ((((($b1 * 64) + $b2) * 64) + $b3) * 64) + $b4;
+			$ent = sprintf ("&#%d;", $ii);
+			$out .= $ent;
+		}
+	}
+	return $out;
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/.htaccess
===================================================================
--- gym_sitemaps/includes/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/includes/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/includes/gym_google.php
===================================================================
--- gym_sitemaps/includes/gym_google.php	(phpBB 3.0.8)
+++ gym_sitemaps/includes/gym_google.php	(Premod 3.0.8)
@@ -0,0 +1,302 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_google.php 272 2010-11-21 13:56:31Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_sitemaps.' . $phpEx);
+/**
+* gym_google Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class gym_google extends gym_sitemaps {
+	var	$google_config = array();
+	// changefreq values, set to null to deactivate a value
+	var	$freq_values = array('always' => 1, 'hourly' => 1, 'daily' => 1, 'weekly' => 1, 'monthly' => 1, 'yearly' => 1, 'never'  => 1);
+	/**
+	* constuctor
+	*/
+	function gym_google() {
+		global $phpbb_seo, $phpEx, $config;
+		global $db, $auth, $user;
+		$this->gym_sitemaps('google');
+		// init output
+		$this->output_data['showstats'] = $this->gym_config['gym_showstats'] && $this->gym_config['google_showstats'];
+		// Check the main vars
+		$this->init_get_vars();
+		if (empty($this->actions['action_modules'])) {
+			$this->gym_error(404, '', __FILE__, __LINE__);
+		}
+		// Set last mod time from DB, will only be used as his for sitempaindex
+		// put it into phpbb config for the dynamic property.
+		$config_name = $this->actions['action_type'] . '_' . (!empty($this->actions['module_main']) ? $this->actions['module_main'] . '_' : '') . 'last_mod_time';
+		if (@$config[$config_name] < $config['board_startdate']) {
+			set_config($config_name, $this->output_data['time'], 1);
+		}
+		$this->output_data['last_mod_time'] = intval($config[$config_name]);
+		// Init the output class
+		$this->gym_init_output();
+		// Setup the output
+		$this->cache_config = array_merge(
+			// Global
+			$this->cache_config,
+			// Other stuff required here
+			array(
+				'cache_enable' => (boolean) $this->set_module_option('cache_on', $this->override['cache']),
+				'cache_auto_regen' => (boolean) $this->set_module_option('cache_auto_regen', $this->override['cache']),
+				'cache_force_gzip' => (boolean) $this->set_module_option('cache_force_gzip', $this->override['cache']),
+				'cache_born' => $this->output_data['last_mod_time'],
+				'cache_max_age' => round($this->set_module_option('cache_max_age', $this->override['cache']),2) * 3600,
+				'cache_file_ext' => ( $this->gym_output->gzip_config['gzip'] || $this->set_module_option('cache_force_gzip', $this->override['cache']) ) ? '.xml.gz' : '.xml',
+			)
+		);
+		// Can you believe it, sprintf is faster than straight parsing.
+		$this->style_config	= array('Sitemap_tpl' => "\n\t" . '<url>' . "\n\t\t" . '<loc>%1$s</loc>%2$s%3$s%4$s' . "\n\t" . '</url>',
+			'SitmIndex_tpl' => "\n\t" . '<sitemap>' . "\n\t\t" . '<loc>%s</loc>%s' . "\n\t" . '</sitemap>',
+			'lastmod_tpl' => "\n\t\t" . '<lastmod>%s</lastmod>',
+			'changefreq_tpl' => "\n\t\t" . '<changefreq>%s</changefreq>',
+			'priority_tpl' => "\n\t\t" . '<priority>%.1f</priority>',
+			'xslt_style' => '',
+			'stats_genlist'	=> "\n" . '<!-- URL list generated in  %s s %s - %s sql - %s URLs listed -->',
+			'stats_start' => "\n" . '<!--  Output started from cache after %s s - %s sql -->',
+			'stats_nocache'	=> "\n" . '<!--  Output ended after %s s %s -->',
+			'stats_end' => "\n" . '<!--  Output from cache ended up after %s s - %s sql -->',
+		);
+		$this->google_config = array(
+			'google_default_priority' => $this->set_module_option('default_priority', $this->gym_config['google_override']),
+			// in sitemaps we only want to issue https urls if ssl is actually forced
+			// otherwise, http links are considered as canonical
+			// If ssl is not forced, then the links in sitemaps won't be https, but
+			// the xsl transform template will show https urls upon request.
+			'google_url' => $phpbb_seo->sslify($this->gym_config['google_url'], $phpbb_seo->ssl['forced']),
+			// module specific settings we should often need in module
+			'google_modrewrite' => (int) $this->set_module_option('modrewrite', $this->override['modrewrite']),
+			'google_modrtype' => (int) $this->set_module_option('modrtype', $this->override['modrewrite']),
+			'google_pagination' => $this->set_module_option('pagination', $this->override['pagination']),
+			'google_limitdown' => (int) $this->set_module_option('limitdown', $this->override['pagination']),
+			'google_limitup'=> (int) $this->set_module_option('limitup', $this->override['pagination']),
+			'google_sql_limit' => (int) $this->set_module_option('sql_limit', $this->override['limit']),
+			'google_url_limit' => (int) $this->set_module_option('url_limit', $this->override['limit']),
+			'google_sort' => ($this->set_module_option('sort', $this->override['sort']) === 'DESC') ? 'DESC' : 'ASC',
+			'google_ping' => $this->set_module_option('ping', $this->gym_config['google_override']),
+			// display threshold
+			'google_threshold' => max(1, (int) $this->gym_config['google_threshold']),
+			'google_allow_auth' => (int) $this->set_module_option('allow_auth', $this->gym_config['google_override']),
+			'google_cache_auth' => (int) $this->set_module_option('cache_auth', $this->gym_config['google_override']),
+		);
+		// SSL
+		// in sitemaps we only want to issue https urls if ssl is actually forced
+		// otherwise, http links are considered as canonical
+		foreach ($phpbb_seo->seo_path as $k => $v) {
+			$phpbb_seo->seo_path[$k] = $phpbb_seo->sslify($v, $phpbb_seo->ssl['forced']);
+		}
+		$this->google_config['google_auth_guest'] = ($this->google_config['google_allow_auth'] && ($user->data['is_bot'] || $user->data['is_registered'])) ? false : true;
+		$this->cache_config['do_cache'] = $this->google_config['google_auth_guest'] ? true :  $this->google_config['google_cache_auth'];
+		if ($this->gym_config['google_xslt']) {
+			$this->style_config['xslt_style'] = "\n" . '<?xml-stylesheet type="text/xsl" href="' . $phpbb_seo->sslify($phpbb_seo->seo_path['phpbb_url'], $phpbb_seo->ssl['use']) . 'gym_sitemaps/gym_style.' . $phpEx . '?action-google,type-xsl,lang-' . $config['default_lang'] . ',theme_id-' . $config['default_style'] . '" ?'.'>';
+		}
+		// Take care about module categorie urls, assuming that they are of the proper form
+		// title-sepXX.xml
+		// assuming that phpbb_seo seo_delim array is properly set.
+		if (empty($this->actions['module_main']) && empty($this->actions['module_sub']) && !empty($_REQUEST['module_sep']) && !empty($_REQUEST['module_sub'])) {
+			if ($module = @array_search('-' . $_REQUEST['module_sep'], $phpbb_seo->seo_delim)) {
+				$this->actions['module_main'] = $module;
+				$this->actions['module_sub'] = (int) $_REQUEST['module_sub'];
+			}
+		}
+		// Are we going to explain ?
+		$do_explain = false;
+		if (!empty($_REQUEST['explain']) && $auth->acl_get('a_') && defined('DEBUG_EXTRA') && method_exists($db, 'sql_report')) {
+			$do_explain = true;
+			$this->cache_config['do_cache'] = false;
+		}
+		if ( empty($this->actions['module_main']) ) { // SitemapIndex
+			$this->google_sitemapindex();
+		} else { // Sitemap
+			$this->google_sitemap();
+		}
+		if ($do_explain) {
+			$db->sql_report('display');
+		} else {
+			$this->gym_output->do_output();
+		}
+		return;
+	}
+	/**
+	* GGs_sitemapindex() will build our sitemapIndex
+	* Listing all available sitemaps
+	* @access private
+	*/
+	function google_sitemapindex() {
+		global $phpEx, $phpbb_seo, $db;
+		$sitemapindex_url = $this->google_config['google_url'] . ( $this->google_config['google_modrewrite'] ? 'sitemapindex.xml' . $this->url_config['gzip_ext_out'] : 'sitemap.'.$phpEx);
+		$this->seo_kill_dupes($sitemapindex_url);
+		$this->output_data['data'] = '<'.'?xml version="1.0" encoding="UTF-8"?'.'>' . $this->style_config['xslt_style'] . "\n" . '<sitemapindex xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"' . "\n\t" . 'xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9' . "\n\t" . 'http://www.sitemaps.org/schemas/sitemap/0.9/siteindex.xsd"' . "\n\t" . 'xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' . "\n" . '<!-- Generated by Google Yahoo MSN Sitemaps and RSS ' . $this->gym_config['gym_version'] . ' -  2006, ' . date('Y') . ' www.phpBB-SEO.com -->' . "\n";
+		// start the modules
+		$this->load_modules('sitemapindex');
+		// Grabb the total
+		$this->output_data['url_sofar'] = $this->output_data['url_sofar_total'];
+		if ( empty($this->output_data['url_sofar']) ) {
+			$this->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__);
+		}
+		$this->output_data['data'] .= "\n" . '</sitemapindex>';
+		if ( $this->google_config['google_ping'] && ($this->output_data['time'] >= ($this->cache_config['cache_born'] + $this->cache_config['cache_max_age'])) ) {
+			$this->google_ping($sitemapindex_url);
+		}
+		return;
+	}
+	/**
+	* GGs_sitemap() will build the actual Google sitemaps, all cases
+	* @access private
+	*/
+	function google_sitemap() {
+		global $phpEx, $phpbb_seo, $db;
+		// Initialize SQL cycling : do not query for more than required
+		$this->gym_config['google_sql_limit'] = ($this->gym_config['google_sql_limit'] > $this->gym_config['google_url_limit']) ? $this->gym_config['google_url_limit'] : $this->gym_config['google_sql_limit'];
+		$this->output_data['data'] = '<'.'?xml version="1.0" encoding="UTF-8"?'.'>' . $this->style_config['xslt_style'] . "\n" . '<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"' . "\n\t" . 'xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9' . "\n\t" . 'http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"' . "\n\t" . 'xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' . "\n" . '<!-- Generated by Google Yahoo MSN Sitemaps and RSS ' . $this->gym_config['gym_version'] . ' -  2006, ' . date('Y') . ' www.phpBB-SEO.com -->' . "\n";
+		// start the module
+		$module_class = $this->actions['action_type'] . '_' . $this->actions['module_main'];
+		$this->load_module($module_class, 'sitemap');
+		if (empty($this->output_data['url_sofar']) ) {
+			$this->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__);
+		}
+		$this->output_data['data'] .= "\n" . '</urlset>';
+		if ( $this->google_config['google_ping'] && ($this->output_data['time'] >= ($this->cache_config['cache_born'] + $this->cache_config['cache_max_age'])) ) {
+			$this->google_ping();
+		}
+		return;
+	}
+	/**
+	* parse_sitemap($url, $lastmodtime = 0)
+	* adds the module sitemaps to the sitemapindex
+	*/
+	function parse_sitemap($url, $lastmodtime = 0) {
+		global $config, $user;
+		if ($lastmodtime > $config['board_startdate']) {
+			$lastmodtime = sprintf($this->style_config['lastmod_tpl'], gmdate('Y-m-d\TH:i:s'.'+00:00', intval($lastmodtime)));
+		} else {
+			$lastmodtime = '';
+		}
+		$this->output_data['data'] .= sprintf($this->style_config['SitmIndex_tpl'], $url, $lastmodtime);
+		$this->output_data['url_sofar']++;
+	}
+	/**
+	* parse_item() adds the item info to the output
+	*/
+	function parse_item($url, $priority = 1.0, $changefreq = 'always', $lastmodtime = 0) {
+		global $config, $user;
+		$changefreq = isset($this->freq_values[$changefreq]) ? sprintf($this->style_config['changefreq_tpl'], $changefreq) : '';
+		$priority = $priority <= 1 && $priority > 0 ? str_replace(',', '.', sprintf($this->style_config['priority_tpl'], $priority)) : '';
+		$lastmodtime = $lastmodtime > $config['board_startdate'] ? sprintf($this->style_config['lastmod_tpl'], gmdate('Y-m-d\TH:i:s'.'+00:00', intval($lastmodtime))) : '';
+		$this->output_data['data'] .= sprintf($this->style_config['Sitemap_tpl'], $url, $lastmodtime, $changefreq, $priority);
+		$this->output_data['url_sofar']++;
+	}
+	/**
+	* get_priority() computes the priority, bases on last mod time and page number
+	* Freshest items with most pages gets the highest priority
+	* 42 is the answer to the most important question in the universe ;-)
+	*/
+	function get_priority($lastmodtime, $pages = 1) {
+		global $user;
+		return $user->time_now / ($user->time_now + ((($user->time_now - $lastmodtime)* 42) / $pages));
+	}
+	/**
+	* get_changefreq($lastmodtime) computes the changefreq, based on lastmodtime
+	*/
+	function get_changefreq($lastmodtime) {
+		global $user;
+		$dt = $user->time_now - $lastmodtime;
+		// 	42 weeks ~ 10 month		| 8 weeks 			| 15 days			| 2 days		| 12 hours
+		return $dt > 25401600 ? 'yearly' : ( $dt > 4838400 ? 'monthly' : ( $dt > 1296000 ? 'weekly' : ( $dt > 172800 ? 'daily' : ( $dt > 43200 ? 'hourly' : 'always' ) ) ) );
+	}
+	/**
+	* google_ping($url = '')
+	* ping google
+	*/
+	function google_ping($url = '') {
+		global $config, $phpbb_seo;
+		$url = !empty($url) ? str_replace('&amp;', '&', $url) : (!empty($this->url_config['current']) ? $this->url_config['current'] : '');
+		$url = trim($url);
+		if (empty($url)) {
+			return;
+		}
+		// No more than 200 pings a day!
+		if (@$config['gym_pinged_today'] > 200) {
+			// @TODO add logs about this ?
+			return;
+		}
+		$skip = array('://localhost', '://127.0.0.1', '://192.168.', '://169.254.');
+		foreach ($skip as $_skip) {
+			if (utf8_strpos($url, $_skip) !== false) {
+				// @TODO add logs about this ?
+				return;
+			}
+		}
+		// If ssl is not forced, always ping with http urls
+		$url = $phpbb_seo->sslify($url, $phpbb_seo->ssl['forced']);
+		$se_urls = array('http://www.google.com/', /*'http://www.yahoo.com/', 'http://www.live.com/'*/);
+		$timout = 3;
+		$time = time();
+		$pinged = 0;
+		foreach ($se_urls as $se_url) {
+			if (time() - $time >= $timout) {
+				return;
+			}
+			$request = $se_url . 'ping?sitemap=' . urlencode($url);
+			if ( function_exists('file_get_contents') ) {
+				// Make the request
+				@ini_set('user_agent','GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+				@ini_set('default_socket_timeout', $timout);
+				$status_code = false;
+				if (@file_get_contents($request)) {
+					// Retrieve HTTP status code
+					@list($version,$status_code,$msg) = @explode(' ',$http_response_header[0], 3);
+				}
+				if (@$status_code != 200) {
+					// @TODO add logs about this ?
+				} else {
+					$pinged++;
+					$this->style_config['stats_genlist'] .= "\n<!--  Pinged $se_url - $url -->";
+				}
+			} else if (function_exists('curl_exec')) {
+				// Initialize the session
+				$session = curl_init($request);
+				// Set curl options
+				curl_setopt($session, CURLOPT_HEADER, false);
+				curl_setopt($session, CURLOPT_USERAGENT, 'GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+				curl_setopt($session, CURLOPT_TIMEOUT, $timout);
+				curl_setopt($session, CURLOPT_RETURNTRANSFER, true);
+				// Make the request
+				$response = curl_exec($session);
+				// Close the curl session
+				curl_close($session);
+				// Get HTTP Status code from the response
+				$status_codes = array();
+				preg_match('/\d\d\d/', $response, $status_code);
+				$status_code = @$status_codes[0];
+				// Get the the response, bypassing the header
+				if ($status_code != 200) {
+					// @TODO add logs about this ?
+				} else {
+					$pinged++;
+					$this->style_config['stats_genlist'] .= "\n<!--  Pinged $se_url - $url -->";
+				}
+			} else {
+				// @TODO add logs about this ?
+			}
+		}
+		if ($pinged) {
+			set_config('gym_pinged_today', @$config['gym_pinged_today'] + $pinged, 1);
+		}
+		return;
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/includes/index.htm
===================================================================
--- gym_sitemaps/includes/index.htm	(phpBB 3.0.8)
+++ gym_sitemaps/includes/index.htm	(Premod 3.0.8)
@@ -0,0 +1,10 @@
+<html>
+<head>
+<title></title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+</head>
+
+<body bgcolor="#FFFFFF" text="#000000">
+
+</body>
+</html>
Index: gym_sitemaps/docs/update_from_last.txt
===================================================================
--- gym_sitemaps/docs/update_from_last.txt	(phpBB 3.0.8)
+++ gym_sitemaps/docs/update_from_last.txt	(Premod 3.0.8)
@@ -0,0 +1,54 @@
+##############################################################
+## MOD Title: 		phpBB SEO GYM SItemaps & RSS 2.0.1 => 2.0.2 update
+## MOD Author: 		dcz <n/a> http://www.phpbb-seo.com/
+## MOD Description: 	This are the update steps for the phpBB SEO GYM SItemaps & RSS 2.0.1 => 2.0.2 update.
+## 			Check http://www.phpbb-seo.com/en/gym-sitemaps-rss/google-yahoo-msn-sitemaps-rss-t2734.html
+## 			for the latest version or to get help with this MOD
+##
+## MOD Version: 	1.0
+##
+## Installation Level: 	(Eazy)
+## Installation Time: 	1 Minute
+## Files To Edit: 	(0)
+##			
+##
+## Included Files: n/a
+##############################################################
+## Author Notes:
+## _____________
+##
+## This are the update steps for the phpBB3 SEO GYM SItemaps & RSS 2.0.1 => 2.0.2 update.
+##
+##############################################################
+## MOD History:
+##
+##	2010-11-20 - 1.0
+##		- First version released
+##
+##############################################################
+## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
+##############################################################
+
+
+#
+#-----[ DIY INSTRUCTIONS ]--------------------------------------------------
+#
+
+_________________________________________
+>>>>   INSTALLATION INSTRUCTIONS    <<<<<
+_________________________________________
+
+To update from all 2.0.x (phpBB3) versions you will have to upload all files in the root/ directory of the archive to your phpBB/ ftp directory, after you will have taken care manually of the eventual code change you would have implemented in the template files (directory phpBB/styles/, .html, .js and .xsl) added by the module.
+Once done, just lunch the update script (example.com/phpBB/gym_sitemaps/gym_install.php).
+Your settings will be kept during the update process.
+
+Once you will have updated, you will have to refresh your theme's cache as well as phpBB's cache (ACP => STYLE, Themes => Refresh).
+
+These code changes are the code changes to implement in the phpBB3 files that are modified when first installing this module.
+
+NO code changes required for this update.
+
+#
+#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
+#
+# EoM
Index: gym_sitemaps/docs/COPYING
===================================================================
--- gym_sitemaps/docs/COPYING	(phpBB 3.0.8)
+++ gym_sitemaps/docs/COPYING	(Premod 3.0.8)
@@ -0,0 +1,65 @@
+GNU LESSER GENERAL PUBLIC LICENSE
+
+Version 3, 29 June 2007
+
+Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>
+
+Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.
+
+This version of the GNU Lesser General Public License incorporates the terms and conditions of version 3 of the GNU General Public License, supplemented by the additional permissions listed below.
+0. Additional Definitions.
+
+As used herein, "this License" refers to version 3 of the GNU Lesser General Public License, and the "GNU GPL" refers to version 3 of the GNU General Public License.
+
+"The Library" refers to a covered work governed by this License, other than an Application or a Combined Work as defined below.
+
+An "Application" is any work that makes use of an interface provided by the Library, but which is not otherwise based on the Library. Defining a subclass of a class defined by the Library is deemed a mode of using an interface provided by the Library.
+
+A "Combined Work" is a work produced by combining or linking an Application with the Library. The particular version of the Library with which the Combined Work was made is also called the "Linked Version".
+
+The "Minimal Corresponding Source" for a Combined Work means the Corresponding Source for the Combined Work, excluding any source code for portions of the Combined Work that, considered in isolation, are based on the Application, and not on the Linked Version.
+
+The "Corresponding Application Code" for a Combined Work means the object code and/or source code for the Application, including any data and utility programs needed for reproducing the Combined Work from the Application, but excluding the System Libraries of the Combined Work.
+1. Exception to Section 3 of the GNU GPL.
+
+You may convey a covered work under sections 3 and 4 of this License without being bound by section 3 of the GNU GPL.
+2. Conveying Modified Versions.
+
+If you modify a copy of the Library, and, in your modifications, a facility refers to a function or data to be supplied by an Application that uses the facility (other than as an argument passed when the facility is invoked), then you may convey a copy of the modified version:
+
+    * a) under this License, provided that you make a good faith effort to ensure that, in the event an Application does not supply the function or data, the facility still operates, and performs whatever part of its purpose remains meaningful, or
+    * b) under the GNU GPL, with none of the additional permissions of this License applicable to that copy.
+
+3. Object Code Incorporating Material from Library Header Files.
+
+The object code form of an Application may incorporate material from a header file that is part of the Library. You may convey such object code under terms of your choice, provided that, if the incorporated material is not limited to numerical parameters, data structure layouts and accessors, or small macros, inline functions and templates (ten or fewer lines in length), you do both of the following:
+
+    * a) Give prominent notice with each copy of the object code that the Library is used in it and that the Library and its use are covered by this License.
+    * b) Accompany the object code with a copy of the GNU GPL and this license document.
+
+4. Combined Works.
+
+You may convey a Combined Work under terms of your choice that, taken together, effectively do not restrict modification of the portions of the Library contained in the Combined Work and reverse engineering for debugging such modifications, if you also do each of the following:
+
+    * a) Give prominent notice with each copy of the Combined Work that the Library is used in it and that the Library and its use are covered by this License.
+    * b) Accompany the Combined Work with a copy of the GNU GPL and this license document.
+    * c) For a Combined Work that displays copyright notices during execution, include the copyright notice for the Library among these notices, as well as a reference directing the user to the copies of the GNU GPL and this license document.
+    * d) Do one of the following:
+          o 0) Convey the Minimal Corresponding Source under the terms of this License, and the Corresponding Application Code in a form suitable for, and under terms that permit, the user to recombine or relink the Application with a modified version of the Linked Version to produce a modified Combined Work, in the manner specified by section 6 of the GNU GPL for conveying Corresponding Source.
+          o 1) Use a suitable shared library mechanism for linking with the Library. A suitable mechanism is one that (a) uses at run time a copy of the Library already present on the user's computer system, and (b) will operate properly with a modified version of the Library that is interface-compatible with the Linked Version.
+    * e) Provide Installation Information, but only if you would otherwise be required to provide such information under section 6 of the GNU GPL, and only to the extent that such information is necessary to install and execute a modified version of the Combined Work produced by recombining or relinking the Application with a modified version of the Linked Version. (If you use option 4d0, the Installation Information must accompany the Minimal Corresponding Source and Corresponding Application Code. If you use option 4d1, you must provide the Installation Information in the manner specified by section 6 of the GNU GPL for conveying Corresponding Source.)
+
+5. Combined Libraries.
+
+You may place library facilities that are a work based on the Library side by side in a single library together with other library facilities that are not Applications and are not covered by this License, and convey such a combined library under terms of your choice, if you do both of the following:
+
+    * a) Accompany the combined library with a copy of the same work based on the Library, uncombined with any other library facilities, conveyed under the terms of this License.
+    * b) Give prominent notice with the combined library that part of it is a work based on the Library, and explaining where to find the accompanying uncombined form of the same work.
+
+6. Revised Versions of the GNU Lesser General Public License.
+
+The Free Software Foundation may publish revised and/or new versions of the GNU Lesser General Public License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.
+
+Each version is given a distinguishing version number. If the Library as you received it specifies that a certain numbered version of the GNU Lesser General Public License "or any later version" applies to it, you have the option of following the terms and conditions either of that published version or of any later version published by the Free Software Foundation. If the Library as you received it does not specify a version number of the GNU Lesser General Public License, you may choose any version of the GNU Lesser General Public License ever published by the Free Software Foundation.
+
+If the Library as you received it specifies that a proxy can decide whether future versions of the GNU Lesser General Public License shall apply, that proxy's public statement of acceptance of any version is permanent authorization for you to choose that version for the Library.
Index: gym_sitemaps/docs/update_from_lastFR.txt
===================================================================
--- gym_sitemaps/docs/update_from_lastFR.txt	(phpBB 3.0.8)
+++ gym_sitemaps/docs/update_from_lastFR.txt	(Premod 3.0.8)
@@ -0,0 +1,54 @@
+##############################################################
+## MOD Title: 		phpBB SEO GYM SItemaps & RSS MAJ 2.0.1 => 2.0.2
+## MOD Author: 		dcz <n/a> http://www.phpbb-seo.com/
+## MOD Description: 	Ceci est la procdure de mise  jour du MOD GYM SItemaps & RSS pour la transition version 2.0.1 => 2.0.2
+## 			Rendez-vous sur http://www.phpbb-seo.com/fr/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-t3136.html
+## 			pour toujours obtenir la dernire version ou de l'aide pour ce MOD.
+##
+## MOD Version: 	1.0
+##
+## Installation Level: 	(Eazy)
+## Installation Time: 	1 Minute
+## Files To Edit: 	(0)
+##			
+##
+## Included Files: n/a
+##############################################################
+## Author Notes:
+## _____________
+##
+## Voici les instructions de mise  jour : phpBB3 SEO GYM SItemaps & RSS 2.0.1 => 2.0.2
+##
+##############################################################
+## MOD History:
+##
+##	2010-11-20 - 1.0
+##		- First version released
+##
+##############################################################
+## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
+##############################################################
+
+
+#
+#-----[ DIY INSTRUCTIONS ]--------------------------------------------------
+#
+
+_____________________________________________
+>>>> INSTALLATION POUR VOTRE FORUM <<<<<
+_____________________________________________
+
+Pour mettre  jour depuis n'importe quelle version 2.0.x (phpBB3), vous devrez tout d'abord uploader tous les fichiers contenus dans le dossier root/ de l'archive dans le dossier ftp de phpBB, en prenant soin de conserver vos ventuelles modification des fichiers de template (dossier phpBB/styles/, .html, .js et .xsl) ajouts par le module. 
+Une fois les fichiers en place, lancez simplement le script de mise  jour (example.com/phpBB/gym_sitemaps/gym_install.php).
+Vos rglages seront conservs lors de la mise  jour.
+
+Une fois les nouveaux fichiers en place, il vous faudra vider le cache de phpBB et rafraichir vos thmes (ACP => STYLE => Thmes => Rafraichir).
+
+Les modifications  de ce fichier concernent les fichier de phpBB3 qui ont t modifis lors de l'installation du module.
+
+Aucune modification requise pour cette mise  jour.
+
+#
+#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
+#
+# EoM
Index: gym_sitemaps/gym_install.php
===================================================================
--- gym_sitemaps/gym_install.php	(phpBB 3.0.8)
+++ gym_sitemaps/gym_install.php	(Premod 3.0.8)
@@ -0,0 +1,937 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gym_install.php 271 2010-11-20 20:53:59Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/*
+ * Based on the phpBB3 install package / www.phpBB.com
+ */
+define('IN_PHPBB', true);
+define('IN_INSTALL', true);
+$phpbb_root_path = (defined('PHPBB_ROOT_PATH')) ? PHPBB_ROOT_PATH : './../';
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+@define('GYM_VERSION', '2.0.2');
+// Try to override some limits - maybe it helps some...
+@set_time_limit(0);
+$mem_limit = @ini_get('memory_limit');
+if (!empty($mem_limit)) {
+	$unit = strtolower(substr($mem_limit, -1, 1));
+	$mem_limit = (int) $mem_limit;
+	if ($unit == 'k') {
+		$mem_limit = floor($mem_limit / 1024);
+	} else if ($unit == 'g') {
+		$mem_limit *= 1024;
+	} else if (is_numeric($unit)) {
+		$mem_limit = floor((int) ($mem_limit . $unit) / 1048576);
+	}
+	$mem_limit = max(128, $mem_limit) . 'M';
+} else {
+	$mem_limit = '128M';
+}
+@ini_set('memory_limit', $mem_limit);
+include($phpbb_root_path . 'common.' . $phpEx);
+// Include essential scripts
+require($phpbb_root_path . 'includes/functions_install.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('gym_sitemaps/install');
+// Security check
+// Circumvent a potential phpbb bug with paths
+$redirect = append_sid(generate_board_url() . "/gym_sitemaps/gym_install.$phpEx");
+if (!$user->data['is_registered']) {
+	login_box($redirect, $user->lang['SEO_LOGIN'],'', false, false);
+}
+if (!$auth->acl_get('a_')) {
+	$user->session_kill(true);
+	login_box($redirect, $user->lang['SEO_LOGIN_ADMIN'],'', false, false);
+}
+if ($user->data['user_type'] != USER_FOUNDER) {
+	login_box($redirect, $user->lang['SEO_LOGIN_FOUNDER'],'', false, false);
+}
+$user->add_lang(array('acp/common', 'acp/board', 'install', 'posting', 'acp/modules'));
+$mode = request_var('mode', 'overview');
+$sub = request_var('sub', '');
+// Set some standard variables we want to force
+$config['load_tplcompile']	= '1';
+$template->set_custom_template('../adm/style', '../admin');
+$template->assign_var('T_TEMPLATE_PATH', '../adm/style');
+// the acp template is never stored in the database
+$user->theme['template_storedb'] = false;
+// Start the installer
+$install = new module();
+$install->create('install', "gym_install.$phpEx", $mode, $sub);
+$install->load();
+// Generate the page
+$install->page_header();
+$install->generate_navigation();
+$template->set_filenames(array(
+	'body' => $install->get_tpl_name())
+);
+$install->page_footer();
+/**
+* @package install
+*/
+class module {
+	var $id = 0;
+	var $type = 'install';
+	var $module_ary = array();
+	var $filename;
+	var $module_url = '';
+	var $tpl_name = '';
+	var $mode;
+	var $sub;
+	/**
+	* Private methods, should not be overwritten
+	*/
+	function create($module_type, $module_url, $selected_mod = false, $selected_submod = false) {
+		global $db, $config, $phpEx, $phpbb_root_path, $user;
+		$module = array(
+			array(
+				'module_type'		=> 'install',
+				'module_title'		=> 'OVERVIEW',
+				'module_filename'	=> 'overview_gym_sitemaps',
+				'module_order'		=> 0,
+				'module_subs'		=> array('INTRO', 'LICENSE', 'SUPPORT'),
+				'module_stages'		=> '',
+				'module_reqs'		=> ''
+			),
+			array(
+				'module_type'		=> 'install',
+				'module_title'		=> 'INSTALL_GYM_SITEMAPS',
+				'module_filename'	=> 'install_gym_sitemaps',
+				'module_order'		=> 1,
+				'module_subs'		=> '',
+				'module_stages'		=> array('INTRO', 'FINAL'),
+				'module_reqs'		=> ''
+			),
+			array(
+				'module_type'		=> 'uninstall',
+				'module_title'		=> 'UNINSTALL_GYM_SITEMAPS',
+				'module_filename'	=> 'install_gym_sitemaps',
+				'module_order'		=> 2,
+				'module_subs'		=> '',
+				'module_stages'		=> array('INTRO', 'FINAL'),
+				'module_reqs'		=> ''
+			),
+			array(
+				'module_type'		=> 'update',
+				'module_title'		=> 'UPDATE_GYM_SITEMAPS',
+				'module_filename'	=> 'install_gym_sitemaps',
+				'module_order'		=> 3,
+				'module_subs'		=> '',
+				'module_stages'		=> array('INTRO', 'FINAL'),
+				'module_reqs'		=> ''
+			),
+		);
+		// Order to use and count further if modules get assigned to the same position or not having an order
+		$max_module_order = 1000;
+		foreach ($module as $row) {
+			// Module order not specified or module already assigned at this position?
+			if (!isset($row['module_order']) || isset($this->module_ary[$row['module_order']])) {
+				$row['module_order'] = $max_module_order;
+				$max_module_order++;
+			}
+			$this->module_ary[$row['module_order']]['name'] = $row['module_title'];
+			$this->module_ary[$row['module_order']]['filename'] = $row['module_filename'];
+			$this->module_ary[$row['module_order']]['subs'] = $row['module_subs'];
+			$this->module_ary[$row['module_order']]['stages'] = $row['module_stages'];
+			if (strtolower($selected_mod) == strtolower($row['module_title'])) {
+				$this->id = (int) $row['module_order'];
+				$this->filename = (string) $row['module_filename'];
+				$this->module_url = (string) $module_url;
+				$this->mode = (string) $selected_mod;
+				// Check that the sub-mode specified is valid or set a default if not
+				if (is_array($row['module_subs'])) {
+					$this->sub = strtolower((in_array(strtoupper($selected_submod), $row['module_subs'])) ? $selected_submod : $row['module_subs'][0]);
+				} else if (is_array($row['module_stages'])) {
+					$this->sub = strtolower((in_array(strtoupper($selected_submod), $row['module_stages'])) ? $selected_submod : $row['module_stages'][0]);
+				} else {
+					$this->sub = '';
+				}
+			}
+		} // END foreach
+	} // END create
+	/**
+	* Load and run the relevant module if applicable
+	*/
+	function load($mode = false, $run = true) {
+		global $phpbb_root_path, $phpEx;
+		if ($run) {
+			if (!empty($mode)) {
+				$this->mode = $mode;
+			}
+			$module = $this->filename;
+			if (!class_exists($module)) {
+				$this->error('Module "' . htmlspecialchars($module) . '" not accessible.', __LINE__, __FILE__);
+			}
+			$this->module = new $module($this);
+			if (method_exists($this->module, 'main')) {
+				$this->module->main($this->mode, $this->sub);
+			}
+		}
+	}
+	/**
+	* Output the standard page header
+	*/
+	function page_header() {
+		if (defined('HEADER_INC')) {
+			return;
+		}
+		define('HEADER_INC', true);
+		global $template, $user, $stage, $phpbb_root_path;
+		$template->assign_vars(array(
+			'L_INSTALL_PANEL'	=> $user->lang['SEO_INSTALL_PANEL'],
+			'L_SKIP'		=> $user->lang['SKIP'],
+			'PAGE_TITLE'		=> $this->get_page_title(),
+			'T_IMAGE_PATH'		=> $phpbb_root_path . 'adm/images/',
+			'S_CONTENT_DIRECTION' 	=> $user->lang['DIRECTION'],
+			'S_CONTENT_ENCODING' 	=> 'UTF-8',
+			'S_USER_LANG'		=> $user->lang['USER_LANG'],
+			)
+		);
+		header('Content-type: text/html; charset=UTF-8');
+		header('Cache-Control: private, no-cache="set-cookie"');
+		header('Expires: 0');
+		header('Pragma: no-cache');
+		return;
+	}
+	/**
+	* Output the standard page footer
+	*/
+	function page_footer() {
+		global $db, $template, $phpbb_seo;
+		$template->display('body');
+		// Close our DB connection.
+		if (!empty($db) && is_object($db)) {
+			$db->sql_close();
+		}
+		exit;
+	}
+	/**
+	* Returns desired template name
+	*/
+	function get_tpl_name() {
+		return $this->module->tpl_name . '.html';
+	}
+	/**
+	* Returns the desired page title
+	*/
+	function get_page_title() {
+		global $user;
+		if (!isset($this->module->page_title)) {
+			return '';
+		}
+		return (isset($user->lang[$this->module->page_title])) ? $user->lang[$this->module->page_title] : $this->module->page_title;
+	}
+	/**
+	* Generate an HTTP/1.1 header to redirect the user to another page
+	* This is used during the installation when we do not have a database available to call the normal redirect function
+	* @param string $page The page to redirect to relative to the installer root path
+	*/
+	function redirect($page) {
+		$server_name = (!empty($_SERVER['SERVER_NAME'])) ? $_SERVER['SERVER_NAME'] : getenv('SERVER_NAME');
+		$server_port = (!empty($_SERVER['SERVER_PORT'])) ? (int) $_SERVER['SERVER_PORT'] : (int) getenv('SERVER_PORT');
+		$secure = (bool) ((isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] === 'on' || $_SERVER['HTTPS'] === true)) || (isset($_SERVER['SERVER_PORT']) && (int) $_SERVER['SERVER_PORT'] === 443));
+
+		$script_name = (!empty($_SERVER['PHP_SELF'])) ? $_SERVER['PHP_SELF'] : getenv('PHP_SELF');
+		if (!$script_name) {
+			$script_name = (!empty($_SERVER['REQUEST_URI'])) ? $_SERVER['REQUEST_URI'] : getenv('REQUEST_URI');
+		}
+		// Replace backslashes and doubled slashes (could happen on some proxy setups)
+		$script_name = str_replace(array('\\', '//'), '/', $script_name);
+		$script_path = trim(dirname($script_name));
+		$url = (($secure) ? 'https://' : 'http://') . $server_name;
+		if ($server_port && (($secure && $server_port <> 443) || (!$secure && $server_port <> 80))) {
+			$url .= ':' . $server_port;
+		}
+		$url .= $script_path . '/' . $page;
+		header('Location: ' . $url);
+		exit;
+	}
+	/**
+	* Generate the navigation tabs
+	*/
+	function generate_navigation() {
+		global $user, $template, $phpEx;
+		if (is_array($this->module_ary)) {
+			@ksort($this->module_ary);
+			foreach ($this->module_ary as $cat_ary) {
+				$cat = $cat_ary['name'];
+				$l_cat = (!empty($user->lang['CAT_' . $cat])) ? $user->lang['CAT_' . $cat] : preg_replace('#_#', ' ', $cat);
+				$cat = strtolower($cat);
+				$url = $this->module_url . "?mode=$cat";
+				if ($this->mode == $cat) {
+					$template->assign_block_vars('t_block1', array(
+						'L_TITLE'		=> $l_cat,
+						'S_SELECTED'	=> true,
+						'U_TITLE'		=> $url,
+					));
+					if (is_array($this->module_ary[$this->id]['subs'])) {
+						$subs = $this->module_ary[$this->id]['subs'];
+						foreach ($subs as $option) {
+							$l_option = (!empty($user->lang['SUB_' . $option])) ? $user->lang['SUB_' . $option] : preg_replace('#_#', ' ', $option);
+							$option = strtolower($option);
+							$url = $this->module_url . '?mode=' . $this->mode . "&amp;sub=$option";
+							$template->assign_block_vars('l_block1', array(
+								'L_TITLE'		=> $l_option,
+								'S_SELECTED'	=> ($this->sub == $option),
+								'U_TITLE'		=> $url,
+							));
+						}
+					}
+					if (is_array($this->module_ary[$this->id]['stages'])) {
+						$subs = $this->module_ary[$this->id]['stages'];
+						$matched = false;
+						foreach ($subs as $option) {
+							$l_option = (!empty($user->lang['STAGE_' . $option])) ? $user->lang['STAGE_' . $option] : preg_replace('#_#', ' ', $option);
+							$option = strtolower($option);
+							$matched = ($this->sub == $option) ? true : $matched;
+
+							$template->assign_block_vars('l_block2', array(
+								'L_TITLE'		=> $l_option,
+								'S_SELECTED'	=> ($this->sub == $option),
+								'S_COMPLETE'	=> !$matched,
+							));
+						}
+					}
+				} else {
+					$template->assign_block_vars('t_block1', array(
+						'L_TITLE'		=> $l_cat,
+						'S_SELECTED'	=> false,
+						'U_TITLE'		=> $url,
+					));
+				}
+			}
+		}
+	}
+	/**
+	* Output an error message
+	* If skip is true, return and continue execution, else exit
+	*/
+	function error($error, $line = '', $file = '', $skip = false, $title = '') {
+		global $user, $db, $template, $phpbb_seo;
+		$title = !empty($title) ? $title : $user->lang['INST_ERR_FATAL'];
+		$file = !empty($file) ? basename($file) . ' [ ' . $line . ' ]' : '';
+		if ($skip) {
+			$template->assign_block_vars('checks', array(
+				'S_LEGEND'	=> true,
+				'LEGEND'	=> $user->lang['INST_ERR'],
+			));
+			$template->assign_block_vars('checks', array(
+				'TITLE'		=> basename($file) . ' [ ' . $line . ' ]',
+				'RESULT'	=> '<b style="color:red">' . $error . '</b>',
+			));
+			return;
+		}
+		echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">';
+		echo '<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">';
+		echo '<head>';
+		echo '<meta http-equiv="content-type" content="text/html; charset=utf-8" />';
+		echo '<title>' . $title . '</title>';
+		echo '<link href="../adm/style/admin.css" rel="stylesheet" type="text/css" media="screen" />';
+		echo '</head>';
+		echo '<body id="errorpage">';
+		echo '<div id="wrap">';
+		echo '	<div id="page-header">';
+		echo '	</div>';
+		echo '	<div id="page-body">';
+		echo '		<div id="acp">';
+		echo '		<div class="panel">';
+		echo '			<span class="corners-top"><span></span></span>';
+		echo '			<div id="content">';
+		echo '				<h1>' . $title . '</h1>';
+		echo '				<p>' . $file . '</p>' . "\n";
+		echo '				<p><b>' . $error . "</b></p>\n";
+		echo '			</div>';
+		echo '			<span class="corners-bottom"><span></span></span>';
+		echo '		</div>';
+		echo '		</div>';
+		echo '	</div>';
+		echo '	<div id="page-footer">';
+		echo '		Powered by phpBB &copy; 2000, 2002, 2005, 2007, 2008 <a href="http://www.phpbb.com/">phpBB Group</a>';
+		echo '	</div>';
+		echo '</div>';
+		echo '</body>';
+		echo '</html>';
+		if (!empty($db) && is_object($db)) {
+			$db->sql_close();
+		}
+		exit;
+	}
+	/**
+	* Output an error message for a database related problem
+	* If skip is true, return and continue execution, else exit
+	*/
+	function db_error($error, $sql, $line, $file, $skip = false) {
+		global $user, $db, $template;
+		if ($skip) {
+			$template->assign_block_vars('checks', array(
+				'S_LEGEND'	=> true,
+				'LEGEND'	=> $user->lang['INST_ERR_FATAL'],
+			));
+			$template->assign_block_vars('checks', array(
+				'TITLE'		=> basename($file) . ' [ ' . $line . ' ]',
+				'RESULT'	=> '<b style="color:red">' . $error . '</b><br />&#187; SQL:' . $sql,
+			));
+			return;
+		}
+		$template->set_filenames(array(
+			'body' => 'install_error.html')
+		);
+		$this->page_header();
+		$this->generate_navigation();
+		$template->assign_vars(array(
+			'MESSAGE_TITLE'		=> $user->lang['INST_ERR_FATAL_DB'],
+			'MESSAGE_TEXT'		=> '<p>' . basename($file) . ' [ ' . $line . ' ]</p><p>SQL : ' . $sql . '</p><p><b>' . $error . '</b></p>',
+		));
+		// Rollback if in transaction
+		if ($db->transaction) {
+			$db->sql_transaction('rollback');
+		}
+		$this->page_footer();
+	}
+}
+/**
+* Installation Tabs
+*/
+class install_gym_sitemaps extends module {
+	var $errors = array();
+	var $uninst_prefix = '';
+	var $modrtype_lang = array();
+	var $action_types = array();
+	var $version = '(not set)';
+	var $old_config = array();
+	var $config_report = array();
+	function install_gym_sitemaps(&$p_master) {
+		global $user, $phpbb_seo, $config, $phpbb_root_path, $phpEx, $_action_types;
+		$this->p_master = &$p_master;
+		$this->version = GYM_VERSION;
+		require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+		// For Compatibility with the phpBB SEO mod rewrites
+		if (empty($phpbb_seo)) {
+			require_once($phpbb_root_path . 'gym_sitemaps/includes/phpbb_seo_class_light.' . $phpEx);
+			$phpbb_seo = new phpbb_seo();
+			define('STARTED_LIGHT', true);
+		}
+		$this->action_types = $_action_types;
+		$this->modrtype_lang = set_phpbb_seo_links();
+	}
+	function main($mode, $sub) {
+		global $user, $template, $phpbb_root_path, $phpbb_seo, $phpEx, $cache, $db;
+		switch ($mode) {
+		case 'install_gym_sitemaps':
+			$this->uninst_prefix = '';
+			break;
+		case 'update_gym_sitemaps':
+			obtain_gym_config('main', $this->old_config);
+			if (!empty($this->old_config)) {
+				$this->uninst_prefix = 'UPDATE_';
+			} else {
+				$this->p_master->error($user->lang['SEO_ERROR_NOTINSTALLED']. '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+				exit;
+			}
+			break;
+		case 'uninstall_gym_sitemaps':
+			$this->uninst_prefix = 'UN_';
+			break;
+		}
+		switch ($sub) {
+			case 'intro':
+				$this->page_title = $user->lang['SUB_INTRO'];
+				$template->assign_vars(array(
+					'TITLE'			=> $user->lang[$this->uninst_prefix . 'SEO_INSTALL_INTRO'],
+					'BODY'			=> sprintf($user->lang[$this->uninst_prefix . 'SEO_INSTALL_INTRO_BODY'], @$this->modrtype_lang['link'], $this->version),
+					'L_SUBMIT'		=> $user->lang[$this->uninst_prefix . 'SEO_INSTALL'],
+					'S_LANG_SELECT'	=> '',
+					'U_ACTION'		=> $this->p_master->module_url . "?mode=$mode&amp;sub=final",
+				));
+			break;
+			case 'final':
+				if ($mode != 'uninstall_gym_sitemaps') {
+					$update = $mode == 'update_gym_sitemaps' ? true : false;
+					if(!$update) {
+						$this->add_modules($mode, $sub);
+						$this->install_tables($mode);
+					}
+					$gym_modules = $gym_modules_acp = array();
+					foreach ($this->action_types as $otype) { // List all output types (sitemaps, rss, html, yahoo ...)
+						$dir = opendir( $phpbb_root_path . 'gym_sitemaps/acp' );
+						while( ($file = readdir($dir)) !== FALSE ) { // Look for available mocules
+							if(preg_match('`^' . $otype . '_([a-z0-9_-]+)\.' . $phpEx . '$`i', $file, $matches)) {
+								$type_module = trim(str_replace('.' . $phpEx , '' ,$file), "/");
+								$_module = str_replace($otype . '_', '', $type_module);
+								if ($matches[1] === 'main' || (file_exists($phpbb_root_path . 'gym_sitemaps/modules/' .  $file) ) ) {
+									$gym_modules[$otype][$_module] = $type_module;
+								}
+							}
+						}
+						closedir($dir);
+						foreach ($gym_modules[$otype] as $_module => $type_module) { // List all available modules
+							$module_file = $phpbb_root_path . 'gym_sitemaps/acp/' . $type_module . '.' . $phpEx;
+
+							if ( file_exists($module_file) ) {
+								include_once($module_file);
+								if (class_exists($type_module)) {
+									$gym_module = new $type_module($this);
+									if ( method_exists($gym_module, 'acp_module')) { // Looks like we match
+										$gym_modules_acp[$otype][$_module] = $gym_module->acp_module();
+										foreach ($gym_modules_acp[$otype][$_module]['info']['actions'] as $module_action) { // list the module's options sets
+											foreach ($gym_modules_acp[$otype][$_module][$module_action]['default'] as $module_config => $default_value ) { // In the end list possible options for this module for this module's options set
+												if (!isset($this->old_config[$module_config])) {
+													// Update config
+													set_gym_config($module_config, $default_value, $otype, $this->old_config);
+													$this->config_report[] = "SET <b>$module_config</b> to $default_value";
+												}
+											}
+										}
+										if (!isset($this->old_config[$type_module . '_installed'])) {
+											// Set the module as installed
+											set_gym_config($type_module . '_installed', 1, 'main', $this->old_config);
+											$this->config_report[] = "ACTIVATED <b>$type_module module</b>";
+										}
+									}
+								}
+							}
+						}
+					}
+				} else {
+					$this->remove_modules($mode, $sub);
+					$this->install_tables($mode);
+				}
+				if (@method_exists($cache, 'purge')) {
+					$cache->purge();
+				}
+				$this->final_stage($mode, $sub);
+			break;
+		}
+		$this->tpl_name = 'install_install';
+	}
+	/**
+	* Populate the module tables
+	*/
+	function add_modules($mode, $sub) {
+		global $db, $user, $phpbb_root_path, $phpEx;
+		include_once($phpbb_root_path . 'includes/acp/acp_modules.' . $phpEx);
+		$_module = new acp_modules();
+		if ( $this->get_module_id('ACP_GYM_SITEMAPS')  > 0 ) {
+			$url_mod = !empty($sub) ? '?mode=' . $mode : '';
+
+			$this->p_master->error(sprintf($user->lang['SEO_ERROR_INSTALLED'], $user->lang['ACP_CAT_PHPBB_SEO'] ) . '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+		}
+		$module_classes = array('acp');
+		// Add categories
+		foreach ($module_classes as $module_class) {
+			$categories = array();
+			// Set the module class
+			$_module->module_class = $module_class;
+			foreach ($this->module_categories[$module_class] as $cat_name => $subs) {
+				$module_data = array(
+					'module_basename'	=> '',
+					'module_enabled'	=> 1,
+					'module_display'	=> 1,
+					'parent_id'		=> 0,
+					'module_class'		=> $module_class,
+					'module_langname'	=> $cat_name,
+					'module_mode'		=> '',
+					'module_auth'		=> '',
+				);
+				if ( $this->get_module_id('ACP_CAT_PHPBB_SEO')  < 1 ) {
+					// Add category
+					$_module->update_module_data($module_data, true);
+				} else {
+					$module_data['module_id'] = $this->check_module_id('ACP_CAT_PHPBB_SEO');
+				}
+				// Check for last sql error happened
+				if ($db->sql_error_triggered) {
+					$error = $db->sql_error($db->sql_error_sql);
+					$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+				}
+				$categories[$cat_name]['id'] = (int) $module_data['module_id'];
+				$categories[$cat_name]['parent_id'] = 0;
+				// Create sub-categories...
+				if (is_array($subs)) {
+					foreach ($subs as $level2_name) {
+						$module_data = array(
+							'module_basename'	=> '',
+							'module_enabled'	=> 1,
+							'module_display'	=> 1,
+							'parent_id'			=> (int) $categories[$cat_name]['id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $level2_name,
+							'module_mode'		=> '',
+							'module_auth'		=> '',
+						);
+						$_module->update_module_data($module_data, true);
+						// Check for last sql error happened
+						if ($db->sql_error_triggered) {
+							$error = $db->sql_error($db->sql_error_sql);
+							$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+						}
+						$categories[$level2_name]['id'] = (int) $module_data['module_id'];
+						$categories[$level2_name]['parent_id'] = (int) $categories[$cat_name]['id'];
+					}
+				}
+			}
+			// Get the modules we want to add... returned sorted by name
+			$module_info = $_module->get_module_infos('gym_sitemaps', $module_class);
+			foreach ($module_info as $module_basename => $fileinfo) {
+				foreach ($fileinfo['modes'] as $module_mode => $row) {
+					foreach ($row['cat'] as $cat_name) {
+						if (!isset($categories[$cat_name])) {
+							continue;
+						}
+						$module_data = array(
+							'module_basename'	=> $module_basename,
+							'module_enabled'	=> 1,
+							'module_display'	=> (isset($row['display'])) ? (int) $row['display'] : 1,
+							'parent_id'			=> (int) $categories[$cat_name]['id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $row['title'],
+							'module_mode'		=> $module_mode,
+							'module_auth'		=> $row['auth'],
+						);
+						$_module->update_module_data($module_data, true);
+						// Check for last sql error happened
+						if ($db->sql_error_triggered) {
+							$error = $db->sql_error($db->sql_error_sql);
+							$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+						}
+					}
+				}
+			}
+		}
+	}
+	/**
+	* remove_modules
+	*/
+	function remove_modules($mode, $sub) {
+		global $db, $user, $phpbb_root_path, $phpEx;
+		include_once($phpbb_root_path . 'includes/acp/acp_modules.' . $phpEx);
+		$_module = new acp_modules();
+		// Set the module class
+		$module_classes = array_keys($this->module_categories);
+		$_module->u_action = "phpbb_seo_install.$phpEx";
+		$cat_module_data = array();
+		$module_data = array();
+		$delete_module_data = array();
+		foreach ($module_classes as $module_class) {
+			$_module->module_class = $module_class;
+			foreach ($this->module_categories[$module_class] as $cat_name => $subs) {
+				// If the cat is already uninstalled break for now
+				if ( $this->get_module_id($cat_name) < 1 ) {
+					$url_mod = !empty($this->sub) ? '?mode=' . $this->mode : '';
+					$this->p_master->error(sprintf($user->lang['SEO_ERROR_UNINSTALLED'], $user->lang[$cat_name] ). '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+				}
+				$cat_module_data[$cat_name] = array(
+					'module_id'		=> $this->check_module_id($cat_name),
+					'module_basename'	=> '',
+					'module_enabled'	=> 1,
+					'module_display'	=> 1,
+					'parent_id'		=> 0,
+					'module_class'		=> $module_class,
+					'module_langname'	=> $cat_name,
+					'module_mode'		=> '',
+					'module_auth'		=> '',
+				);
+				if (is_array($subs)) {
+					foreach ($subs as $sub_cat) {
+						$sub_cat_module_data[$sub_cat] = array(
+							'module_id'		=> $this->check_module_id($sub_cat),
+							'module_basename'	=> '',
+							'module_enabled'	=> 1,
+							'module_display'	=> 1,
+							'parent_id'		=> (int) $cat_module_data[$cat_name]['module_id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $sub_cat,
+							'module_mode'		=> '',
+							'module_auth'		=> '',
+						);
+						$branch = $_module->get_module_branch($sub_cat_module_data[$sub_cat]['module_id'],'children', 'descending', false);
+						if (sizeof($branch)) {
+							foreach ($branch as $module) {
+								$error = $_module->delete_module($module['module_id']);
+								if (!sizeof($error)) {
+									$_module->remove_cache_file();
+									$delete_module_data[$module['module_id']] = $module['module_langname'] . ' - id : ' . $module['module_id'];
+								} else {
+									$this->errors[] = implode(' ', $error);
+								}
+							} // End modules
+						}
+						if (!sizeof($this->errors)) {
+							$error = $_module->delete_module($sub_cat_module_data[$sub_cat]['module_id']);
+							if (!sizeof($error)) {
+								$_module->remove_cache_file();
+								$delete_module_data[$sub_cat_module_data[$sub_cat]['module_id']] = $sub_cat_module_data[$sub_cat]['module_langname'] . ' - id : ' . $sub_cat_module_data[$sub_cat]['module_id'];
+							} else {
+								$this->errors[] = implode(' ', $error);
+							}
+						}
+					}
+				} // End sub categories
+				if (!sizeof($this->errors)) {
+				 	$branch = $_module->get_module_branch($cat_module_data[$cat_name]['module_id'],'children', 'descending', false);
+					if (empty($branch)) {
+						$error = $_module->delete_module($cat_module_data[$cat_name]['module_id']);
+					}
+					if (!sizeof($error)) {
+						$_module->remove_cache_file();
+						$delete_module_data[$cat_module_data[$cat_name]['module_id']] = $cat_module_data[$cat_name]['module_langname'] . ' - id : ' . $cat_module_data[$cat_name]['module_id'];
+					} else {
+						$this->errors[] = implode(' ', $error);
+					}
+				}
+			} // End categories
+		} // End classes
+		return;
+	}
+	/**
+	* install_tables
+	*/
+	function install_tables($mode) {
+		global $db;
+		if ( $mode === 'install_gym_sitemaps') {
+			//$sql = "DROP TABLE IF EXISTS " . GYM_CONFIG_TABLE;
+			//$db->sql_query($sql);
+			$sql = array();
+			switch( $db->sql_layer ) {
+				case 'oracle':
+					$sql[] = "CREATE TABLE " . GYM_CONFIG_TABLE . " (
+						config_name varchar(255) DEFAULT '',
+						config_value varchar(255) DEFAULT '',
+						config_type varchar(10) DEFAULT 'gym' NOT NULL,
+						CONSTRAINT pk_gym_config PRIMARY KEY (config_name)
+					)";
+					$sql[] = "CREATE INDEX gym_config_type ON " . GYM_CONFIG_TABLE . " (config_type)";
+					break;
+				case 'firebird':
+					$sql[] = "CREATE TABLE " . GYM_CONFIG_TABLE . " (
+						config_name VARCHAR(255) CHARACTER SET NONE DEFAULT '' NOT NULL,
+						config_value VARCHAR(255) CHARACTER SET UTF8 DEFAULT '' NOT NULL COLLATE UNICODE,
+						config_type VARCHAR(10) DEFAULT 'gym' NOT NULL
+					)";
+					$sql[] = "ALTER TABLE " . GYM_CONFIG_TABLE . " ADD PRIMARY KEY (config_name)";
+					$sql[] = "CREATE INDEX gym_config_type ON " . GYM_CONFIG_TABLE . "(config_type)";
+					break;
+				case 'sqlite':
+					$sql[] = "CREATE TABLE " . GYM_CONFIG_TABLE . " (
+						config_name varchar(255) DEFAULT '',
+						config_value varchar(255) DEFAULT '',
+						config_type varchar(10) DEFAULT 'gym',
+						PRIMARY KEY (config_name)
+					)";
+					$sql[] = "CREATE INDEX gym_config_type ON " . GYM_CONFIG_TABLE . " (config_type)";
+					break;
+				case 'postgres':
+					$sql[] = "CREATE TABLE " . GYM_CONFIG_TABLE . " (
+						config_name varchar(255) DEFAULT '' NOT NULL,
+						config_value varchar(255) DEFAULT '' NOT NULL,
+						config_type varchar(10) DEFAULT 'gym' NOT NULL,
+						PRIMARY KEY (config_name)
+					)";
+					$sql[] = "CREATE INDEX gym_config_type ON " . GYM_CONFIG_TABLE . " (config_type)";
+					break;
+				case 'mssql':
+				case 'mssqlnative':
+				case 'mssql_odbc':
+					$sql[] = "CREATE TABLE [" . GYM_CONFIG_TABLE . "] (
+							[config_name] [varchar] (255) DEFAULT ('') NOT NULL ,
+							[config_value] [varchar] (255) DEFAULT ('') NOT NULL ,
+							[config_type] [varchar] (10) DEFAULT ('') NOT NULL
+						) ON [PRIMARY] ";
+					$sql[] = "ALTER TABLE [" . GYM_CONFIG_TABLE . "] WITH NOCHECK ADD
+							CONSTRAINT [PK_gym_config] PRIMARY KEY  CLUSTERED
+							(
+								[config_name]
+							)  ON [PRIMARY] ";
+					$sql[] = "CREATE  INDEX [config_type] ON [" . GYM_CONFIG_TABLE . "]([config_type]) ON [PRIMARY] ";
+					break;
+				case 'mysql':
+				case 'mysql4':
+				case 'mysqli':
+				default:
+					$sqlt = "CREATE TABLE " . GYM_CONFIG_TABLE . " (
+						config_name varchar(255) DEFAULT '' NOT NULL,
+						config_value varchar(255) DEFAULT '' NOT NULL,
+						config_type varchar(10) DEFAULT 'gym' NOT NULL,
+						PRIMARY KEY (config_name),
+						KEY config_type (config_type)
+					)";
+					if ($db->sql_layer == 'mysqli' || version_compare($db->sql_server_info(true), '4.1.3', '>=')) {
+						$sqlt .= ' CHARACTER SET `utf8` COLLATE `utf8_bin`';
+					}
+					$sql[] = $sqlt;
+					break;
+			}
+			foreach ($sql as $query ) {
+				$db->sql_query($query);
+			}
+		} else {
+			$sql = "DROP TABLE IF EXISTS " . GYM_CONFIG_TABLE;
+			$db->sql_query($sql);
+		}
+	}
+	/**
+	* check_module_id by title
+	*/
+	function check_module_id($title) {
+		global $user;
+		if ( $module_id = $this->get_module_id($title)) {
+			return $module_id;
+		} else {
+			$url_mod = !empty($this->sub) ? '?mode=' . $this->mode : '';
+			$this->p_master->error(sprintf($user->lang['SEO_ERROR_ID'], $title ) . '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+		}
+	}
+	/**
+	* get_module_id by title
+	*/
+	function get_module_id($title) {
+		global $db, $user, $phpEx;
+		$sql = 'SELECT module_id
+			FROM ' . MODULES_TABLE . "
+			WHERE module_langname = '" . $db->sql_escape($title) . "'";
+		$result = $db->sql_query_limit($sql, 1);
+		$row = $db->sql_fetchrow($result);
+		if ($row['module_id'] > 1) {
+			return intval($row['module_id']);
+		}
+		return 0;
+	}
+	/**
+	* Sends an email to the board administrator with their password and some useful links
+	*/
+	function final_stage($mode, $sub) {
+		global $auth, $config, $db, $user, $template, $user, $phpbb_root_path, $phpEx, $phpbb_seo, $cache;
+		$update_info = '';
+		if (!sizeof($this->errors) ) {
+			if ($mode != 'uninstall_gym_sitemaps') {
+				set_gym_config('gym_version', $this->version, 'main', $this->old_config);
+				$this->config_report[] = "SET <b>gym_version</b> to $this->version";
+				set_config('gym_installed', 1);
+			} else {
+				set_config('gym_installed', 0);
+			}
+			add_log('admin', 'SEO_LOG_' . strtoupper($mode), $this->version );
+		} else {
+			set_config('gym_installed', 0);
+			add_log('admin', 'SEO_LOG_' . strtoupper($mode) . '_FAIL', $this->errors);
+			$cache->purge();
+			$this->p_master->error($user->lang['SEO_ERROR_INSTALL'] . '<br/><pre>' . implode('<br/>', $this->errors) . '</pre>', __LINE__, __FILE__);
+		}
+		$cache->purge();
+		$this->page_title = $user->lang['STAGE_FINAL'];
+		if (  $mode != 'uninstall_gym_sitemaps' ) {
+			if ($mode == 'update_gym_sitemaps') {
+				$key = 'UPDATE';
+				$lang_key = strpos($user->lang_name, 'fr') !== false ? 'FR' : '';
+				if ($update_infos = @file("./docs/update_from_last$lang_key.txt")) {
+					foreach ($update_infos as $line) {
+						$line = str_replace(array("\r", "\n"), '', utf8_htmlspecialchars(is_utf8($line) ? $line : utf8_recode($line, 'iso-8859-1')));
+						$update_info .= (preg_match('`^#`', $line) ? "<b style=\"color:blue;\">$line</b>" : $line) . '<br/>';
+					}
+				}
+			} else {
+				$key = 'INSTALL';
+			}
+			$submit_action = append_sid($phpbb_root_path . 'adm/index.' . $phpEx . '?sid=' . $user->session_id);
+			$title = $user->lang['SEO_INSTALL_CONGRATS'];
+			$body =  sprintf($user->lang["SEO_{$key}_CONGRATS_EXPLAIN"], $this->modrtype_lang['link'], $this->version) . '<br/>' . implode('<br/>', $this->config_report) . "<br/><br/><hr/><pre>$update_info</pre>";
+		} else {
+			$submit_action = append_sid($phpbb_root_path . 'index.' . $phpEx);
+			$title = $user->lang['UN_SEO_INSTALL_CONGRATS'];
+			$body = sprintf($user->lang['UN_SEO_INSTALL_CONGRATS_EXPLAIN'], $this->modrtype_lang['link'], $this->version);
+		}
+		$template->assign_vars(array(
+			'TITLE'		=> $title,
+			'BODY'		=> $body,
+			'L_SUBMIT'	=> $user->lang['SEO_FINAL_' . strtoupper($mode)],
+			'U_ACTION'	=> $submit_action,
+		));
+	}
+	var $module_categories = array(
+		'acp'	=> array(
+			'ACP_CAT_PHPBB_SEO'		=> array(
+				'ACP_GYM_SITEMAPS',
+			),
+		),
+	);
+}
+/**
+* is_utf8($string)
+* Borrowed from php.net : http://www.php.net/mb_detect_encoding (detectUTF8)
+*/
+function is_utf8($string) {
+	// non-overlong 2-byte|excluding overlongs|straight 3-byte|excluding surrogates|planes 1-3|planes 4-15|plane 16
+	return preg_match('%(?:[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF] |\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})+%xs', $string);
+}
+function set_phpbb_seo_links() {
+	global $user, $config;
+	$modinfo_lang = array();
+	$modinfo_lang['title'] = $user->lang['CAT_SEO_PREMOD'];
+	$modinfo_lang['modlinks_en'] = 'http://www.phpbb-seo.com/en/gym-sitemaps-rss/google-yahoo-msn-sitemaps-rss-t2734.html';
+	$modinfo_lang['modlinks_fr'] = 'http://www.phpbb-seo.com/fr/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-t3136.html';
+	$modinfo_lang['modforumlinks_en'] = 'http://www.phpbb-seo.com/en/gym-sitemaps-rss/';
+	$modinfo_lang['modforumlinks_fr'] = 'http://www.phpbb-seo.com/fr/gym-sitemaps-rss/';
+	if (strpos($config['default_lang'], 'fr') !== false ) {
+		$modinfo_lang['linkurl'] = $modinfo_lang['modlinks_fr'];
+		$modinfo_lang['link'] = '<a href="' . $modinfo_lang['modlinks_fr'] . '" title="' . $modinfo_lang['title'] . '" target="_phpBBSEO"><b>' . $modinfo_lang['title'] . '</b></a>';
+		$modinfo_lang['forumlinkurl'] = $modinfo_lang['modforumlinks_fr'];
+	} else {
+		$modinfo_lang['linkurl'] = $modinfo_lang['modlinks_en'];
+		$modinfo_lang['link'] = '<a href="' . $modinfo_lang['modlinks_en'] . '" title="' . $modinfo_lang['title'] . '" target="_phpBBSEO"><b>' . $modinfo_lang['title'] . '</b></a>';
+		$modinfo_lang['forumlinkurl'] = $modinfo_lang['modforumlinks_en'];
+	}
+	return $modinfo_lang;
+}
+/**
+* Main Tab - Overview
+*/
+class overview_gym_sitemaps extends module {
+	var $modrtype_lang = array();
+	var $version = '(not set)';
+	function overview_gym_sitemaps(&$p_master) {
+		$this->modrtype_lang = set_phpbb_seo_links();
+		$this->p_master = &$p_master;
+		$this->version = GYM_VERSION;
+	}
+	function main($mode, $sub) {
+		global $lang, $template, $language, $user, $phpbb_seo;
+		switch ($sub) {
+			case 'intro' :
+				$title = $user->lang['SEO_OVERVIEW_TITLE'];
+				$body = sprintf($user->lang['SEO_OVERVIEW_BODY'], $this->version, @$this->modrtype_lang['linkurl'], @$this->modrtype_lang['forumlinkurl']);
+			break;
+			case 'license' :
+				$title = $user->lang['SEO_LICENCE_TITLE'];
+				$body = '<p>' . $user->lang['SEO_LICENCE_BODY'] . '</p><br/><hr/>' . implode("<br/>\n", file('./docs/COPYING'));
+			break;
+			case 'support' :
+				$title = $user->lang['SEO_SUPPORT_TITLE'];
+				$body = sprintf($user->lang['SEO_SUPPORT_BODY'],$this->modrtype_lang['forumlinkurl'], $this->modrtype_lang['title'], @$this->modrtype_lang['linkurl'] );
+			break;
+		}
+		$this->tpl_name = 'install_main';
+		$this->page_title = $title;
+		$template->assign_vars(array(
+			'TITLE'		=> $title,
+			'BODY'		=> $body,
+
+			'S_LANG_SELECT'	=> '',
+		));
+	}
+}
+/**
+* Quick fix for using the module class outside ACP.
+*/
+function adm_back_link($u_action) {
+	global $user, $install;
+	$url_mod = !empty($install->sub) ? '?mode=' . $install->mode : '';
+	return '<br /><br /><a href="' . $install->module_url . $url_mod . '">&laquo; ' . $user->lang['BACK_TO_PREV'] . '</a>';
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/google_txt.php
===================================================================
--- gym_sitemaps/modules/google_txt.php	(phpBB 3.0.8)
+++ gym_sitemaps/modules/google_txt.php	(Premod 3.0.8)
@@ -0,0 +1,179 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_txt.php 148 2009-11-07 14:50:54Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_txt Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_txt {
+	var $url_settings = array();
+	var $options = array();
+	var $module_config = array();
+	var $outputs = array();
+	var $txt_files = array();
+	/**
+	* constuctor
+	*/
+	function google_txt(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		$this->options = &$this->gym_master->actions;
+		$this->outputs = &$this->gym_master->output_data;
+		$this->url_settings = &$this->gym_master->url_config;
+		$this->module_config = array_merge(
+			// Global
+			$this->gym_master->google_config,
+			// Other stuff required here
+			array(
+				'google_sources' => $this->gym_master->path_config['gym_path'] . 'sources/',
+				'google_randomize' => (boolean) $this->gym_master->gym_config['google_txt_randomize'],
+				'google_unique' => (boolean) $this->gym_master->gym_config['google_txt_unique'],
+				'google_check_robots' => (boolean) $this->gym_master->gym_config['google_txt_check_robots'],
+				'google_force_lastmod' => (boolean) $this->gym_master->gym_config['google_txt_force_lastmod'],
+			)
+		);
+		// Check cache
+		$this->gym_master->gym_output->setup_cache(); // Will exit if the cache is sent
+		// List available files
+		$this->get_source_list();
+		// Init url settngs
+		$this->init_url_settings();
+	}
+	/**
+	* Initialize mod rewrite to handle multiple URL standards.
+	* Only one 'if' is required after this in THE loop to properly switch
+	* between the four types (none, advanced, mixed and simple).
+	* @access private
+	*/
+	function init_url_settings() {
+		global $phpbb_seo;
+		// vars will fell like rain in the code ;)
+		$this->url_settings['google_txt_delim'] = !empty($phpbb_seo->seo_delim['google_txt']) ? $phpbb_seo->seo_delim['google_txt'] : '-';
+		$this->url_settings['google_txt_static'] = !empty($phpbb_seo->seo_static['google_txt']) ? $phpbb_seo->seo_static['google_txt'] : 'txt';
+		$this->url_settings['modrewrite'] = $this->module_config['google_modrewrite'];
+
+		if ($this->url_settings['modrewrite']) { // Module links
+			$this->url_settings['google_txt_tpl'] = $this->module_config['google_url'] . 'txt' . $this->url_settings['google_txt_delim'] . '%1$s.xml' . $this->url_settings['gzip_ext_out'];
+		} else {
+			$this->url_settings['google_txt_tpl'] = $this->module_config['google_url'] . $this->url_settings['google_default'] . '?txt=%1$s';
+		}
+		return;
+	}
+	/**
+	* sitemap, builds the sitemap
+	* @access private
+	*/
+	function sitemap() {
+		global $cache, $phpEx, $config;
+		if (!empty($this->txt_files[$this->options['module_sub']])) {
+			// Check robots.txt ?
+			if ($this->module_config['google_check_robots']) {
+				$this->gym_master->obtain_robots_disallows();
+			}
+			$sitemap_txt_url = sprintf( $this->url_settings['google_txt_tpl'], $this->options['module_sub'] );
+			$this->gym_master->seo_kill_dupes($sitemap_txt_url);
+			$txt_file = $this->txt_files[$this->options['module_sub']];
+			// Grab data
+			if (($txt_data = @file($txt_file)) && is_array($txt_data)) {
+				$last_mod = (int) @filemtime($txt_file);
+				$url_count = count($txt_data);
+				$this->outputs['last_mod_time'] = $last_mod > $config['board_startdate'] ? $last_mod : (time() - rand(500, 10000));
+				// Randomize ?
+				if ($this->module_config['google_randomize']) {
+					shuffle($txt_data);
+				}
+				// Limit ?
+				if ($this->module_config['google_url_limit'] > 0 && $this->module_config['google_url_limit'] < $url_count) {
+					$txt_data = array_slice($txt_data, 0, $this->module_config['google_url_limit']);
+				}
+				// Force last mod  ?
+				$last_mod = $this->module_config['google_force_lastmod'] ? $this->outputs['last_mod_time'] : 0;
+				// Parse URLs
+				$dt = rand(0, 3600);
+				$url_check = array();
+				foreach ($txt_data as $key => $url) {
+					$url = trim($url);
+					if (empty($url) || ($this->module_config['google_check_robots'] && $this->gym_master->is_robots_disallowed($url))) {
+						continue;
+					}
+					// Check unique ?
+					if ($this->module_config['google_unique']) {
+						if (isset($url_check[$url])) {
+							continue;
+						}
+						$url_check[$url] = 1;
+					}
+					if ($this->module_config['google_force_lastmod']) {
+						$_last_mod = $last_mod - $dt;
+						$priority = $this->gym_master->get_priority($_last_mod);
+						$changefreq = $this->gym_master->get_changefreq($_last_mod);
+					} else {
+						$_last_mod = $priority = $changefreq = 0;
+					}
+					$this->gym_master->parse_item(utf8_htmlspecialchars($url), $priority, $changefreq, $_last_mod);
+					$dt += rand(30, 3600*12);
+					unset($txt_data[$key]);
+				}
+			} else {
+				// Clear the cache to make sure the guilty url is not shown in the sitemapIndex
+				$cache->destroy('_gym_config_google_txt');
+				$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+			}
+		} else {
+			$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+		}
+		return;
+	}
+	/**
+	* sitemapindex, builds the sitemapindex
+	* @access private
+	*/
+	function sitemapindex() {
+		global $config;
+		// It's global list call, add module sitemaps
+		// Reset the local counting, since we are cycling through modules
+		$this->outputs['url_sofar'] = 0;
+		foreach ($this->txt_files as $txt_action => $source) {
+			$sitemap_txt_url = sprintf( $this->url_settings['google_txt_tpl'], $txt_action );;
+			$last_mod = (int) @filemtime($txt_file);
+			$last_mod = ($last_mod > $config['board_startdate'] && !$this->module_config['google_force_lastmod']) ? $last_mod : (time() - rand(500, 10000));
+			$this->gym_master->parse_sitemap($sitemap_txt_url, $last_mod);
+		}
+		// Add the local counting, since we are cycling through modules
+		$this->outputs['url_sofar_total'] = $this->outputs['url_sofar_total'] + $this->outputs['url_sofar'];
+		return;
+	}
+	/**
+	* get_source_list, builds the available sitemap list
+	* @access private
+	*/
+	function get_source_list() {
+		global $cache;
+		if (($this->txt_files = $cache->get('_gym_config_google_txt')) === false) {
+			$this->txt_files = array();
+			$RegEx = '`^google_([a-z0-9_-]+)\.txt`i';
+			$txt_dir = @opendir( $this->module_config['google_sources'] );
+			while( ($txt_file = @readdir($txt_dir)) !== false ) {
+				if(preg_match($RegEx, $txt_file, $matches)) {
+					if (!empty($matches[1])) {
+						$this->txt_files[$matches[1]] = $this->module_config['google_sources'] . 'google_' . $matches[1] . '.txt';
+					}
+				}
+			}
+			@closedir($txt_dir);
+			$cache->put('_gym_config_google_txt', $this->txt_files);
+		}
+		return;
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/google_xml.php
===================================================================
--- gym_sitemaps/modules/google_xml.php	(phpBB 3.0.8)
+++ gym_sitemaps/modules/google_xml.php	(Premod 3.0.8)
@@ -0,0 +1,247 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_xml.php 148 2009-11-07 14:50:54Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_xml Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_xml {
+	var $url_settings = array();
+	var $options = array();
+	var $module_config = array();
+	var $outputs = array();
+	var $xml_files = array();
+	/**
+	* constuctor
+	*/
+	function google_xml(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		$this->options = &$this->gym_master->actions;
+		$this->outputs = &$this->gym_master->output_data;
+		$this->url_settings = &$this->gym_master->url_config;
+		$this->module_config = array_merge(
+			// Global
+			$this->gym_master->google_config,
+			// Other stuff required here
+			array(
+				'google_sources' => $this->gym_master->path_config['gym_path'] . 'sources/',
+				'google_randomize' => (boolean) $this->gym_master->gym_config['google_xml_randomize'],
+				'google_unique' => (boolean) $this->gym_master->gym_config['google_xml_unique'],
+				'google_check_robots' => (boolean) $this->gym_master->gym_config['google_xml_check_robots'],
+				'google_force_limit' => (boolean) $this->gym_master->gym_config['google_xml_force_limit'],
+				'google_force_lastmod' => (boolean) $this->gym_master->gym_config['google_xml_force_lastmod'],
+			)
+		);
+		$this->module_config['xml_parse'] = (boolean) ($this->module_config['google_randomize'] || $this->module_config['google_unique'] || $this->module_config['google_force_limit'] || $this->module_config['google_force_lastmod']|| $this->module_config['google_check_robots']);
+		// Check cache
+		$this->gym_master->gym_output->setup_cache(); // Will exit if the cache is sent
+		// List available files
+		$this->get_source_list();
+		// Init url settngs
+		$this->init_url_settings();
+	}
+	/**
+	* Initialize mod rewrite to handle multiple URL standards.
+	* Only one 'if' is required after this in THE loop to properly switch
+	* between the four types (none, advanced, mixed and simple).
+	* @access private
+	*/
+	function init_url_settings() {
+		global $phpbb_seo;
+		// vars will fell like rain in the code ;)
+		$this->url_settings['google_xml_delim'] = !empty($phpbb_seo->seo_delim['google_xml']) ? $phpbb_seo->seo_delim['google_xml'] : '-';
+		$this->url_settings['google_xml_static'] = !empty($phpbb_seo->seo_static['google_xml']) ? $phpbb_seo->seo_static['google_xml'] : 'xml';
+		$this->url_settings['modrewrite'] = $this->module_config['google_modrewrite'];
+
+		if ($this->url_settings['modrewrite']) { // Module links
+			$this->url_settings['google_xml_tpl'] = $this->module_config['google_url'] . 'xml' . $this->url_settings['google_xml_delim'] . '%1$s.xml' . $this->url_settings['gzip_ext_out'];
+		} else {
+			$this->url_settings['google_xml_tpl'] = $this->module_config['google_url'] . $this->url_settings['google_default'] . '?xml=%1$s';
+		}
+		return;
+	}
+	/**
+	* sitemap, builds the sitemap
+	* @access private
+	*/
+	function sitemap() {
+		global $cache, $phpEx, $config, $user;
+		if (!empty($this->xml_files[$this->options['module_sub']])) {
+			// Check robots.txt ?
+			if ($this->module_config['google_check_robots']) {
+				$this->gym_master->obtain_robots_disallows();
+			}
+			$sitemap_xml_url = sprintf( $this->url_settings['google_xml_tpl'], $this->options['module_sub'] );
+			$this->gym_master->seo_kill_dupes($sitemap_xml_url);
+			$xml_file = $this->xml_files[$this->options['module_sub']];
+			// Grab data
+			if (strpos($xml_file, 'http://') !== false) {
+				@ini_set('user_agent','GYM Sitemaps &amp; RSS / www.phpBB-SEO.com');
+				// You may want to use a higher value for the timout in case you use slow external sitemaps
+				@ini_set('default_socket_timeout', 5);
+			}
+			if ($xml_data = @file_get_contents($xml_file)) {
+				if (!empty($http_response_header)) {
+					$_last_mod = get_date_from_header($http_response_header);
+				} else {
+					$_last_mod = (int) @filemtime($xml_file);
+				}
+				$this->outputs['last_mod_time'] = $_last_mod > $config['board_startdate'] ? $_last_mod : ($user->time_now - rand(500, 10000));
+				if (($url_tag_pos = utf8_strpos($xml_data, '<url>')) === false) {
+					// this basic test failed
+					// @TODO add loggs about this ?
+					$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+				}
+				if (!$this->module_config['xml_parse']) {
+					// use our hown headers
+					$xml_data = str_replace('</urlset>', '', trim($xml_data) );
+					// Add to the output variable
+					$this->outputs['data'] .= substr($xml_data, $url_tag_pos);
+					// Link count
+					$this->outputs['url_sofar'] = preg_match_all('`\<loc\>[^<>]+\</loc\>`Ui', $xml_data, $matches);
+					// free memory
+					unset($xml_data, $matches);
+				} else {
+					$total_matches = preg_match_all('`\<url\>.+\</url\>`Usi', $xml_data, $matches, PREG_SET_ORDER);
+					// free memory
+					unset($xml_data);
+					if (!empty($matches)) {
+						// Randomize ?
+						if ($this->module_config['google_randomize']) {
+							shuffle($matches);
+						}
+						// Limit ?
+						if ($this->module_config['google_url_limit'] > 0 && $this->module_config['google_url_limit'] < $total_matches) {
+							$matches = array_slice($matches, 0, $this->module_config['google_url_limit']);
+						}
+						// Force last mod  ?
+						$_last_mod = $this->module_config['google_force_lastmod'] ? $this->outputs['last_mod_time'] : 0;
+						// Parse URLs
+						$dt = rand(0, 3600);
+						$url_check = array();
+						foreach ($matches as $key => $data) {
+							preg_match_all('`\<(loc|lastmod|changefreq|priority)\>([^<>]+)\</\1\>`Ui', $data[0], $url_tags, PREG_SET_ORDER);
+							$loc = $priority = $changefreq = $lastmod = '';
+							foreach ($url_tags as $url_tag) {
+								if (empty($url_tag[1]) || empty($url_tag[2])) {
+									continue;
+								}
+								$url_tag[1] = strtolower($url_tag[1]);
+								${$url_tag[1]} = trim($url_tag[2]);
+							}
+							if (empty($loc)) {
+								continue;
+							}
+							// Check unique ?
+							if ($this->module_config['google_unique']) {
+								if (isset($url_check[$loc])) {
+									continue;
+								}
+								$url_check[$loc] = 1;
+							}
+							if ($this->module_config['google_check_robots'] && $this->gym_master->is_robots_disallowed($loc)) {
+								continue;
+							}
+							if ($this->module_config['google_force_lastmod']) {
+								$last_mod = $_last_mod - $dt;
+								$priority = $this->gym_master->get_priority($last_mod);
+								$changefreq = $this->gym_master->get_changefreq($last_mod);
+								$lastmod = gmdate('Y-m-d\TH:i:s'.'+00:00', $last_mod);
+							} else {
+								$lastmod = !empty($lastmod) ? $lastmod : 0;
+								$priority = !empty($priority) ? $priority : 0;
+								$changefreq = !empty($changefreq) ? $changefreq : 0;
+							}
+							$this->parse_item($loc, $priority, $changefreq, $lastmod);
+							unset($matches[$key]);
+							$dt += rand(30, 3600*12);
+						}
+						unset($url_check);
+					} else {
+						// Clear the cache to make sure the guilty url is not shown in the sitemapIndex
+						$cache->destroy('_gym_config_google_xml');
+						$this->gym_master->gym_error(500, '', __FILE__, __LINE__);
+					}
+
+				}
+			} else {
+				// Clear the cache to make sure the guilty url is not shown in the sitemapIndex
+				$cache->destroy('_gym_config_google_xml');
+				$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+			}
+		} else {
+			$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+		}
+		return;
+	}
+	/**
+	* sitemapindex, builds the sitemapindex
+	* @access private
+	*/
+	function sitemapindex() {
+		global $config;
+		// It's global list call, add module sitemaps
+		// Reset the local counting, since we are cycling through modules
+		$this->outputs['url_sofar'] = 0;
+		foreach ($this->xml_files as $xml_action => $source) {
+			$sitemap_xml_url = sprintf( $this->url_settings['google_xml_tpl'], $xml_action );
+			$last_mod = (int) @filemtime($xml_file);
+			$last_mod = ($last_mod > $config['board_startdate'] && !$this->module_config['google_force_lastmod']) ? $last_mod : (time() - rand(500, 10000));
+			$this->gym_master->parse_sitemap($sitemap_xml_url, $last_mod);
+		}
+		// Add the local counting, since we are cycling through modules
+		$this->outputs['url_sofar_total'] = $this->outputs['url_sofar_total'] + $this->outputs['url_sofar'];
+		return;
+	}
+	/**
+	* get_source_list, builds the available sitemap list
+	* @access private
+	*/
+	function get_source_list() {
+		global $cache, $phpEx;
+		if (($this->xml_files = $cache->get('_gym_config_google_xml')) === false) {
+			$this->xml_files = array();
+			// Check the eventual external url config
+			if (file_exists($this->module_config['google_sources'] . "xml_google_external.$phpEx")) {
+				include($this->module_config['google_sources'] . "xml_google_external.$phpEx");
+				// Duplicated keys will be overriden bellow
+				$this->xml_files = array_merge($this->xml_files, $external_setup);
+			}
+			$RegEx = '`^google_([a-z0-9_-]+)\.xml$`i';
+			$xml_dir = @opendir( $this->module_config['google_sources'] );
+			while( ($xml_file = @readdir($xml_dir)) !== false ) {
+				if(preg_match($RegEx, $xml_file, $matches)) {
+					if (!empty($matches[1])) {
+						$this->xml_files[$matches[1]] = $this->module_config['google_sources'] . 'google_' . $matches[1] . '.xml';
+					}
+				}
+			}
+			@closedir($xml_dir);
+			$cache->put('_gym_config_google_xml', $this->xml_files);
+		}
+		return;
+	}
+	/**
+	* parse_item() adds the item info to the output
+	*/
+	function parse_item($url, $priority = 1.0, $changefreq = 'always', $lastmodtime = 0) {
+		global $config, $user;
+		$changefreq = isset($this->gym_master->freq_values[$changefreq]) ? sprintf($this->gym_master->style_config['changefreq_tpl'], $changefreq) : '';
+		$priority = $priority <= 1 && $priority > 0 ? sprintf($this->gym_master->style_config['priority_tpl'], $priority) : '';
+		$lastmodtime = $lastmodtime > $config['board_startdate'] ? sprintf($this->gym_master->style_config['lastmod_tpl'], $lastmodtime) : '';
+		$this->gym_master->output_data['data'] .= sprintf($this->gym_master->style_config['Sitemap_tpl'], $url, $lastmodtime, $changefreq, $priority);
+		$this->gym_master->output_data['url_sofar']++;
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/html_forum.php
===================================================================
--- gym_sitemaps/modules/html_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/modules/html_forum.php	(Premod 3.0.8)
@@ -0,0 +1,665 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: html_forum.php 262 2010-04-20 11:06:58Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* html_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class html_forum {
+	var $url_settings = array();
+	var $options = array();
+	var $module_config = array();
+	var $outputs = array();
+	var $forum_cache = array();
+	var $call = array();
+	var $topic_tracking_info = array();
+	var $tracking_topics = array();
+	var $forum_tracking_info = array();
+	var $forum_datas = array();
+	var $icons = array();
+	var $html_switch = array();
+	var $start = 0;
+	var $module_auth = array();
+	var $actions = array();
+	/**
+	* constuctor
+	*/
+	function html_forum(&$gym_master) {
+		global $phpbb_seo;
+		$this->gym_master = &$gym_master;
+		$this->actions = &$this->gym_master->actions;
+		$this->outputs = &$this->gym_master->output_data;
+		$this->module_config = &$this->gym_master->html_config;
+		$this->url_settings = &$this->gym_master->url_config;
+		$this->start = &$this->gym_master->start;
+		$this->html_switch = &$this->gym_master->html_switch;
+		$this->module_auth = &$this->gym_master->module_auth;
+		$this->module_config['html_last_topics_exclude_list'] = '';
+		$this->module_config = array_merge(
+			// Global
+			$this->module_config,
+			// Other stuff required here
+			array(
+				'html_forum_news_ids' => trim($this->gym_master->gym_config['html_forum_news_ids'], ','),
+				'html_forum_ltopic' => (int) $this->gym_master->gym_config['html_forum_ltopic'],
+				'html_forum_ltopic_pagination' => (int) $this->gym_master->gym_config['html_forum_ltopic_pagination'],
+				'html_forum_cat_ltopic' => (int) $this->gym_master->gym_config['html_forum_cat_ltopic'],
+				'html_forum_news_ltopic' => (int) $this->gym_master->gym_config['html_forum_news_ltopic'],
+				'html_forum_cat_news_ltopic' => (int) $this->gym_master->gym_config['html_forum_cat_news_ltopic'],
+				'html_forum_last_post' => (boolean) $this->gym_master->gym_auth_value($this->gym_master->gym_config['html_forum_last_post']),
+				'html_forum_first' => ((int) $this->gym_master->gym_config['html_forum_first']) ? 'first' : 'last',
+				'html_forum_news_first' => ((int) $this->gym_master->gym_config['html_forum_news_first']) ? 'first' : 'last',
+				'html_forum_post_buttons' => (boolean) $this->gym_master->gym_auth_value($this->gym_master->gym_config['html_forum_post_buttons']),
+				'html_exclude_list' => trim($this->gym_master->gym_config['html_forum_exclude'], ','),
+				'html_ltopic_exclude' => trim($this->gym_master->gym_config['html_forum_ltopic_exclude'], ','),
+				'html_forum_desc' => (boolean) $this->gym_master->gym_auth_value($this->gym_master->gym_config['html_forum_desc']),
+				'html_forum_rules' => (boolean) $this->gym_master->gym_auth_value($this->gym_master->gym_config['html_forum_rules']),
+			)
+		);
+		// Build unauthed arrays
+		$this->module_config['exclude_list'] = $this->gym_master->set_exclude_list($this->module_config['html_exclude_list']);
+		// Wee need to check auth here
+		$this->gym_master->check_forum_auth($this->module_config['html_auth_guest']);
+		$this->actions['auth_guest_list'] = array_diff_assoc($this->module_auth['forum']['public_list'], $this->module_config['exclude_list']);
+		$this->actions['auth_guest_read'] = array_diff_assoc($this->module_auth['forum']['public_read'], $this->module_config['exclude_list']);
+		$this->actions['auth_view_list'] = array_diff_assoc($this->module_auth['forum']['list'], $this->module_config['exclude_list']);
+		$this->actions['auth_view_read'] = array_diff_assoc($this->module_auth['forum']['read'], $this->module_config['exclude_list']);
+		// Mod rewrite type auto detection
+		$this->url_settings['modrtype'] = ($phpbb_seo->modrtype >= 0) ? intval($phpbb_seo->modrtype) : intval($this->module_config['html_modrtype']);
+		// make sure virtual_folder uses the proper value
+		// Set up urls
+		$html_def = $this->url_settings['html_default'];
+		if ($this->module_config['html_modrewrite']) {
+			$html_news_def = $this->url_settings['html_news_default'];
+			$this->url_settings['html_forum_map'] = $html_def . 'forum/';
+			$this->url_settings['html_forum_cat_map'] = $html_def . 'forum/%1$s/';
+			$this->url_settings['html_forum_news'] = $html_news_def . 'forum/';
+			$this->url_settings['html_forum_cat_news'] = $html_news_def . 'forum/%1$s/';
+			$this->url_settings['html_forum_global_map'] = $html_def . 'forum/global/';
+			$this->url_settings['html_forum_global_news'] = $html_news_def . 'forum/global/';
+			$this->url_settings['html_forum_announce_map'] = $html_def . 'forum/announce/';
+			$this->url_settings['html_forum_announce_news'] = $html_news_def . 'forum/announce/';
+			$this->url_settings['html_forum_sticky_map'] = $html_def . 'forum/sticky/';
+			$this->url_settings['html_forum_sticky_news'] = $html_news_def . 'forum/sticky/';
+		} else {
+			$this->url_settings['html_forum_map'] = $html_def . '?forum';
+			$this->url_settings['html_forum_cat_map'] = $html_def . '?forum=%2$s';
+			$this->url_settings['html_forum_news'] = $html_def . '?forum=news';
+			$this->url_settings['html_forum_cat_news'] = $html_def . '?forum=%2$s&amp;news';
+			$this->url_settings['html_forum_global_map'] = $html_def . '?forum=global';
+			$this->url_settings['html_forum_global_news'] = $html_def . '?forum=global&amp;news';
+			$this->url_settings['html_forum_announce_map'] = $html_def . '?forum=announce';
+			$this->url_settings['html_forum_announce_news'] = $html_def . '?forum=announce&amp;news';
+			$this->url_settings['html_forum_sticky_map'] = $html_def . '?forum=sticky';
+			$this->url_settings['html_forum_sticky_news'] = $html_def . '?forum=sticky&amp;news';
+		}
+	}
+	/**
+	* Initialize forum output.
+	* Will as well compute all required info to be able to :
+	* 	- Know what url should be used
+	* 	- Know if the call is active and auth
+	* 	- Set up all params for the up comming call if necessary (when not caching)
+	* Please note :
+	* 	This method must exist in other modules, called by html_output in gym_html.php through load_module
+	* @access private
+	*/
+	function html_init() {
+		global $user, $db, $phpbb_seo, $auth, $config, $phpEx, $phpbb_root_path;
+		$nav_url = $nav_title = false;
+		$this->url_settings['current'] = $this->module_config['html_url'];
+
+		$this->outputs['right_col_cache_file'] = $this->actions['html_news_list'] ? 'forum_ltopics_news' : 'forum_ltopics_map';
+		// will pass variables to the render class
+		$this->call = array(
+			'forum_id' => 0,
+			'topic_id' => 0,
+			'limit' => 0,
+			'limit_time' => 0,
+			'sort' => 'DESC',
+			'display_user_info' => $this->module_config['html_allow_profile'],
+			'display_user_link' => $this->module_config['html_allow_profile_links'],
+			'display_link' => true,
+			'display_online' => $this->module_config['html_disp_online'],
+			'display_post_buttons' => $this->module_config['html_forum_post_buttons'],
+			'display_pagination' => 0,
+			'display_last_post' => $this->module_config['html_forum_last_post'],
+			'display_file' => $this->url_settings['html_default'],
+			'display_tracking' => $this->module_config['html_disp_tracking'],
+			'display_topic_status' => $this->module_config['html_disp_status'],
+			'display_sig' => $this->module_config['html_allow_sig'],
+			'display_order' => 'first',
+			'display_desc' => $this->module_config['html_forum_desc'],
+			'display_rules' => $this->module_config['html_forum_rules'],
+			'display_sumarize' => $this->module_config['html_sumarize'],
+			'display_sumarize_method' => $this->module_config['html_sumarize_method'],
+			'display_topic_pagination' => $this->module_config['html_item_pagination'],
+			'function' => false,
+			'method' => false,
+			'file' => false,
+			's_global' => false,
+			'forum_sql' => '',
+			'topic_sql' => '',
+			'single_forum' => false,
+			'cat_forum' => false,
+			'display_last_topic' => 0,
+			'last_topic_pagination' => $this->module_config['html_forum_ltopic_pagination'],
+		);
+		//$this->module_config['exclude_list'] = $this->module_config['exclude_list'] + $this->module_config['global_exclude_list'];
+		$pre_set = false;
+		$type_key = $_key = '';
+		switch ($this->actions['module_sub']) {
+		case 'global':
+			$this->actions['is_auth'] = $this->actions['is_active'] = true;
+			$this->call['s_global'] = $this->actions['is_public'] = true;
+			$this->call['forum_sql'] = "t.forum_id = 0";
+			$this->call['topic_sql'] = "t.topic_type = " . POST_GLOBAL;
+			$type_key = 'forum_global';
+			$pre_set = true;
+		case 'announce':
+			if (!$pre_set) {
+				$this->actions['is_public'] = $this->actions['is_auth'] = $this->actions['is_active'] = !empty($this->module_auth['forum']['read_post']);
+				if (empty($this->actions['auth_view_read'])) {
+					$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+				}
+				$this->call['forum_sql'] = $db->sql_in_set('t.forum_id', $this->actions['auth_view_read'], false, true);
+				$this->call['topic_sql'] = "t.topic_type = " . POST_ANNOUNCE;
+				$type_key = 'forum_announce';
+				$pre_set = true;
+			}
+		case 'sticky':
+			if (!$pre_set) {
+				$this->actions['is_public'] = $this->actions['is_auth'] = $this->actions['is_active'] = !empty($this->module_auth['forum']['read_post']);
+				if (empty($this->actions['auth_view_read'])) {
+					$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+				}
+				$this->call['forum_sql'] = $db->sql_in_set('t.forum_id', $this->actions['auth_view_read'], false, true);
+				$this->call['topic_sql'] = "t.topic_type = " . POST_STICKY;
+				$type_key = 'forum_sticky';
+				$pre_set = true;
+			}
+			if ($this->module_config['html_allow_news'] || $this->module_config['html_allow_map']) {
+				if ($this->actions['html_news_list'] && $this->module_config['html_allow_news']) {
+					$_key = 'news';
+					$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_posts_list.html';
+					$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_news_ltopic'];
+					$this->actions['pagination_limit'] = $this->call['limit'] = $this->module_config['html_news_pagination_limit'];
+					$this->call['method'] = 'display_posts';
+					$this->call['display_pagination'] = $this->module_config['html_news_pagination'];
+					$this->call['limit_time'] = $this->module_config['html_news_time_limit'];
+					$this->call['sort'] = $this->module_config['html_news_sort'];
+					$this->call['display_pagination'] = $this->module_config['html_news_pagination'];
+					$this->call['display_order'] = $this->module_config['html_forum_news_first'];
+					$this->call['file'] = 'display_posts.' . $phpEx;
+				} else if ($this->actions['html_map_list'] && $this->module_config['html_allow_map']) {
+					$_key = 'map';
+					$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_topics_list.html';
+					$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_ltopic'];
+					$this->actions['pagination_limit'] = $this->call['limit'] = $this->module_config['html_pagination_limit'];
+					$this->call['method'] = 'display_topics';
+					$this->call['display_pagination'] = $this->module_config['html_pagination'];
+					$this->call['limit_time'] = $this->module_config['html_map_time_limit'];
+					$this->call['sort'] = $this->module_config['html_sort'];
+					$this->call['display_pagination'] = $this->module_config['html_pagination'];
+					$this->call['display_order'] = $this->module_config['html_forum_first'];
+					$this->call['file'] = 'display_topics.' . $phpEx;
+				}
+				if (!empty($_key)) {
+					$this->outputs['page_title'] = $user->lang['HTML_' . strtoupper($type_key) . '_' . strtoupper($_key)];
+					$this->outputs['left_col_cache_file'] = $type_key . '_' . $_key;
+					$this->url_settings['current'] .= $this->gym_master->html_build_url('html_' . $type_key . '_' . $_key);
+				}
+				$this->start = $this->call['display_pagination'] ? $this->gym_master->chk_start($this->start, $this->call['limit']) : 0;
+			}
+			// current url
+			$this->call['display_file'] = $this->url_settings['current'];
+			$this->url_settings['current'] .= $this->gym_master->html_add_start($this->start);
+			break;
+		case 'news':
+			if ($this->actions['html_news_list']) {
+				$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_posts_list.html';
+				$this->outputs['left_col_cache_file'] = "forum_news";
+				$this->outputs['page_title'] = sprintf($user->lang['HTML_NEWS_OF'], $this->module_config['html_sitename']);
+				// Auth and active switches
+				$this->actions['is_auth'] = $this->actions['is_active'] = $this->actions['is_public'] = true;
+				$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_news_ltopic'];
+				$this->actions['pagination_limit'] = $this->call['limit'] = $this->module_config['html_news_pagination_limit'];
+				$this->module_config['html_forum_news_ids'] = $this->gym_master->set_exclude_list($this->module_config['html_forum_news_ids']);
+				if (empty($this->module_config['html_forum_news_ids'])) {
+					$this->actions['auth_view_read'] = array_diff_assoc($this->module_auth['forum']['read_post'], $this->module_config['exclude_list']);
+					$this->actions['is_auth'] = $this->actions['is_active'] = !empty($this->actions['auth_view_read']);
+					$this->call['single_forum'] = sizeof($this->actions['auth_view_read']) > 1 ? false : true;
+					if (empty($this->actions['auth_view_read'])) {
+						$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+					}
+					// Output news from all authed forums
+					$this->call['forum_sql'] = $db->sql_in_set('t.forum_id', $this->actions['auth_view_read'], false, true);
+				} else {
+					$this->call['single_forum'] = sizeof($this->module_config['html_forum_news_ids']) > 1 ? false : true;
+					// No exclude list here !
+					$this->call['forum_sql'] = $db->sql_in_set('t.forum_id', $this->module_config['html_forum_news_ids'], false, true);
+				}
+				$this->call['method'] = 'display_posts';
+				$this->call['display_pagination'] = $this->module_config['html_news_pagination'];
+				$this->call['limit_time'] = $this->module_config['html_news_time_limit'];
+				$this->call['sort'] = $this->module_config['html_news_sort'];
+				$this->call['display_pagination'] = $this->module_config['html_news_pagination'];
+				$this->call['display_order'] = $this->module_config['html_forum_news_first'];
+				$this->call['file'] = 'display_posts.' . $phpEx;
+				// current url
+				$this->start = $this->call['display_pagination'] ? $this->gym_master->chk_start($this->start, $this->call['limit']) : 0;
+				$this->url_settings['current'] .= $this->gym_master->html_build_url('html_forum_news');
+				$this->call['display_file'] = $this->url_settings['current'];
+				$this->url_settings['current'] .= $this->gym_master->html_add_start($this->start);
+			}
+			break;
+		default:
+			if ($this->actions['html_map_list'] && (empty($this->actions['module_sub']) || $this->actions['module_sub'] == 'map')) {
+				// Expected URL
+				$this->url_settings['current'] .= $this->url_settings['html_forum_map'];
+				$this->call['display_file'] = $this->url_settings['current'];
+				$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_forums_list.html';
+				$this->outputs['left_col_cache_file'] = "forum_map";
+				$this->actions['is_public'] = $this->actions['is_auth'] = true;
+				$this->actions['is_active'] = (boolean) ($this->module_config['html_allow_cat_news'] || $this->module_config['html_allow_cat_map'] );
+				$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_ltopic'];
+				$this->outputs['page_title'] = sprintf($user->lang['HTML_MAP_OF'], $this->module_config['html_sitename']);
+				$this->call['file'] = 'display_forums.' . $phpEx;
+				$this->call['method'] = 'display_forums';
+				// Here we need to be able to list categories as well as forums
+				// List all listable forums except excluded and links
+				if (empty($this->actions['auth_view_list'])) {
+					$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+				}
+				$this->call['forum_sql'] = $db->sql_in_set('f.forum_id', $this->actions['auth_view_list'], false, true);
+			} else if ($this->actions['html_news_list'] || $this->actions['html_map_list']) {
+				// Filter $this->actions['module_sub'] var type
+				$this->actions['module_sub'] = (int) $this->actions['module_sub'];
+				if ($this->actions['module_sub'] > 0) { // Forum map or news
+					$forum_id = $this->call['forum_id'] = $this->actions['module_sub'];
+
+					// Here we need to be able to list categories as well as forums
+					// A forum news or map is viewable when is a readable postable forum or a listable forum cat
+					// (with authed children see below)
+					$this->actions['is_auth'] = (boolean) ( isset($this->actions['auth_view_read'][$forum_id]) || (isset($this->module_auth['forum']['skip_cat'][$forum_id]) && isset($this->actions['auth_view_list'][$forum_id])) );
+					$this->actions['is_public'] = (boolean) isset($this->actions['auth_guest_list'][$forum_id]);
+					$this->call['single_forum'] = true;
+					if ($this->actions['html_news_list'] ) {
+						$this->actions['is_active'] = true;
+						$key = 'news';
+						$this->actions['pagination_limit'] = $this->call['limit'] = $this->module_config['html_news_pagination_limit'];
+						$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_cat_news_ltopic'];
+						$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_posts_list.html';
+						$this->call['file'] = 'display_posts.' . $phpEx;
+						$this->call['display_pagination'] = $this->module_config['html_news_pagination'];
+						$this->call['limit_time'] = $this->module_config['html_cat_news_time_limit'];
+						$this->call['display_order'] = $this->module_config['html_forum_news_first'];
+						$this->call['sort'] = $this->module_config['html_cat_news_sort'];
+						$this->call['method'] = 'display_posts';
+					} else if ($this->actions['html_map_list']) {
+						$this->actions['is_active'] = true;
+						$key = 'map';
+						$this->actions['pagination_limit'] = $this->call['limit'] = $this->module_config['html_pagination_limit'];
+						$this->outputs['right_col'] = $this->call['display_last_topic'] = $this->module_config['html_forum_cat_ltopic'];
+						$this->outputs['left_col_tpl'] = 'gym_sitemaps/display_topics_list.html';
+						$this->call['file'] = 'display_topics.' . $phpEx;
+						$this->call['display_pagination'] = $this->module_config['html_pagination'];
+						$this->call['limit_time'] = $this->module_config['html_cat_time_limit'];
+						$this->call['sort'] = $this->module_config['html_cat_sort'];
+						$this->call['display_order'] = $this->module_config['html_forum_first'];
+						$this->call['method'] = 'display_topics';
+					}
+					// Upon single forum calls, grabb forum data separatelly to allow access to forum data when there is no topic to list
+					// As well prevent topic row from listing repeated forum data
+					if ($this->actions['is_active']) {
+						$sql = "SELECT *
+							FROM " . FORUMS_TABLE . "
+							WHERE forum_id = $forum_id";
+						$result = $db->sql_query($sql);
+						if ($row = $db->sql_fetchrow($result)) {
+							// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+							$phpbb_seo->set_url($row['forum_name'], $forum_id, 'forum');
+							// www.phpBB-SEO.com SEO TOOLKIT END
+							$this->forum_datas[$forum_id] = array_merge($row,  array(
+								'forum_url' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+								'm_approve' => $auth->acl_get('m_approve', $forum_id),
+							));
+							if ($row['forum_password']) {
+								login_forum_box($row);
+							}
+						} else { // Forum does not exist
+							$this->actions['is_active'] = false;
+						}
+					}
+					if ($this->actions['is_active']) {
+						$this->call['forum_sql'] = "t.forum_id = $forum_id";
+						if ($this->forum_datas[$forum_id]['forum_type'] == FORUM_CAT) {
+							$this->call['cat_forum'] = $forum_id;
+							// lets check childrens
+							if ($f_ids = $this->gym_master->get_forum_children($forum_id)) {
+								$this->call['forum_sql'] = $db->sql_in_set('t.forum_id', array_keys($f_ids), false, true);
+								$this->call['single_forum'] = false;
+							} else {
+								// Cat with no readable sub forums
+								$this->actions['is_active'] = false;
+							}
+						}
+						$this->start = $this->call['display_pagination'] ? $this->gym_master->chk_start($this->start, $this->call['limit']) : 0;
+						$this->url_settings['current'] .= $this->gym_master->html_build_url('html_forum_cat_' . $key, $phpbb_seo->seo_url['forum'][$forum_id], $forum_id);
+						$this->call['display_file'] = $this->url_settings['current'];
+						$this->url_settings['current'] .= $this->gym_master->html_add_start($this->start);
+						$this->outputs['page_title'] = sprintf($user->lang['HTML_' . strtoupper($key) . '_OF'], $this->forum_datas[$forum_id]['forum_name']);
+						if ($this->module_config['html_allow_' . $key]) {
+							$nav_url = $this->url_settings['html_forum_' . $key];
+							$nav_title = sprintf($user->lang['HTML_' . strtoupper($key) . '_OF'], $this->module_config['html_sitename']);
+						}
+						$this->outputs['left_col_cache_file'] = "forum_$key" . "_$forum_id";
+						// Enable forum tracking
+						$_REQUEST['f'] = $this->call['forum_id'];
+						// Track user viewing this forum
+						$this->outputs['single_traking'] = true;
+					}
+				}
+			}
+			break;
+		}
+		if ($nav_url) {
+			global $template;
+			// Add Module page in navigation links
+			$template->assign_block_vars('navlinks', array(
+				'FORUM_NAME' => $nav_title,
+				'U_VIEW_FORUM'	=> append_sid($this->module_config['html_url'] . $nav_url))
+			);
+		}
+		return;
+	}
+	/**
+	* html_main() will build the module's main output
+	* @access private
+	*/
+	function html_main() {
+		if (!empty($this->call['file'])) {
+			require_once($this->gym_master->path_config['gym_path'] . 'display/' . $this->call['file']);
+		}
+		if (!empty($this->call['method'])) {
+			$output = new $this->call['method']($this);
+		}
+		return;
+	}
+	/**
+	* html_module()
+	* Add local optional module content to the main output, last_topics in our case
+	* @access private
+	*/
+	function html_module() {
+		if (!empty($this->call['display_last_topic'])) {
+			$this->last_topics($this->call['display_last_topic']);
+		}
+		return;
+	}
+	/**
+	* html_index()
+	* Add local links to the main site map
+	* @access private
+	*/
+	function html_index() {
+		global $user;
+		// We need to take care about overrides
+		$override = $this->gym_master->gym_config['html_override'];
+		$forum_allow_cat_map = (boolean) get_gym_option('html', 'forum', 'allow_cat_map', $override, $this->gym_master->gym_config);
+		$forum_allow_cat_news = (boolean) get_gym_option('html', 'forum', 'allow_cat_news', $override, $this->gym_master->gym_config);
+		$forum_allow_map = (boolean) get_gym_option('html', 'forum', 'allow_map', $override, $this->gym_master->gym_config);
+		$forum_allow_news = (boolean) get_gym_option('html', 'forum', 'allow_news', $override, $this->gym_master->gym_config);
+		if (!$forum_allow_cat_map && !$forum_allow_cat_news && !$forum_allow_map && !$forum_allow_news) {
+			return;
+		}
+		$this->outputs['module_data']['forum'] = array(
+			'title' => $this->gym_master->gym_config['html_forum_sitename'],
+			'desc' => $this->gym_master->gym_config['html_forum_site_desc'],
+			'img' => '',
+			'map_url' => $forum_allow_map && ($forum_allow_cat_map || $forum_allow_cat_news) ? $this->module_config['html_url'] . $this->url_settings['html_forum_map'] : false,
+			'news_url' => $forum_allow_news ? $this->module_config['html_url'] . $this->url_settings['html_forum_news'] : false,
+			'links' => array(),
+		);
+		// Add other supported links such as global annoucements etc ...
+		if ( $forum_allow_map  || $forum_allow_news ) {
+			$links = &$this->outputs['module_data']['forum']['links'];
+			$linkables = array( 'html_forum', 'html_forum_global', 'html_forum_announce', 'html_forum_sticky');
+			foreach ($linkables as $type) {
+				$links[$type] = array(
+					'map_title' => $forum_allow_news ? $user->lang[strtoupper($type . '_map')] : '',
+					'map_url' => $forum_allow_news ? $this->url_settings[$type . '_map'] : '',
+					'news_title' => $forum_allow_map ? $user->lang[strtoupper($type . '_news')] : '',
+					'news_url' => $forum_allow_map ? $this->url_settings[$type . '_news'] : '',
+				);
+			}
+		}
+		return;
+	}
+	function last_topics($limit = 10) {
+		global $db, $template, $user, $config, $phpEx, $phpbb_root_path, $phpbb_seo, $auth, $cache;
+		// Usefull for multi bb topic & forum tracking
+		// Leave default for single forum eg : '_track'
+		$tracking_cookie_name = (defined('XLANG_AKEY') ? XLANG_AKEY : '') . '_track';
+		$this->outputs['right_col_tpl'] = 'gym_sitemaps/last_topics_list.html';
+		// wa can use start here since there are always more topics overall than in a single forum
+		$start = $this->start ? $this->gym_master->chk_start($this->start, $limit) : 0;
+		$template->assign_vars(array('LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST')));
+		// Wee need to check auth here
+		$this->module_config['last_topics_exclude_list'] = $this->gym_master->set_exclude_list($this->module_config['html_ltopic_exclude']);
+		$forum_auth_ids = array_diff_assoc($this->module_auth['forum']['read_post'], $this->module_config['last_topics_exclude_list']);
+		$all_forum_datas = $forum_datas = array();
+		if (!empty($forum_auth_ids)) {
+			$topic_sql_auth = $db->sql_in_set('t.forum_id', $forum_auth_ids, false, true);
+			$template->assign_vars(array(
+				'NEWEST_POST_IMG' => $user->img('icon_topic_newest', 'VIEW_NEWEST_POST'),
+				'LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST'),
+			));
+			$display_tracking = &$this->call['display_tracking'];
+			$display_user_info = &$this->call['display_user_info'];
+			$display_topic_status = &$this->call['display_topic_status'];
+			if (!$display_tracking) {
+				$load_db_lastread = $load_anon_lastread = false;
+			} else {
+				$load_db_lastread = (boolean) ($config['load_db_lastread'] && $user->data['is_registered']);
+				$load_anon_lastread = (boolean) ($config['load_anon_lastread'] || $user->data['is_registered']);
+			}
+			$template->assign_vars(array(
+					'LASTX_TOPICS_TITLE' => sprintf($user->lang['HTML_LASTX_TOPICS_TITLE'], $limit)
+				)
+			);
+			// Get The Data, first forums
+			if (!empty($this->forum_datas)) {
+				$f_id_done = array_keys($this->forum_datas);
+				$f_id_done = array_combine($f_id_done, $f_id_done);
+				unset($f_id_done[0]);
+				$forum_query_ids = array_diff_assoc($forum_auth_ids, $f_id_done);
+			} else {
+				$forum_query_ids = $forum_auth_ids;
+			}
+			// Only get the required forums data
+			if (!empty($forum_query_ids)) {
+				$forum_sql_auth = $db->sql_in_set('f.forum_id', $forum_query_ids, false, true);
+				$sql_array = array(
+					'SELECT'	=> 'f.*',
+					'FROM'		=> array(
+						FORUMS_TABLE	=> 'f',
+					),
+					'LEFT_JOIN' => array(),
+				);
+				if ($load_db_lastread) {
+					$sql_array['SELECT'] .= ', ft.mark_time as forum_mark_time';
+					$sql_array['LEFT_JOIN'][] = array(
+						'FROM'	=> array(FORUMS_TRACK_TABLE => 'ft'),
+						'ON'	=> 'ft.user_id = ' . $user->data['user_id'] . ' AND ft.forum_id = f.forum_id'
+					);
+				}
+				$sql_array['WHERE'] = $forum_sql_auth;
+				$result = $db->sql_query($db->sql_build_query('SELECT', $sql_array));
+				while ($row = $db->sql_fetchrow($result)) {
+					$forum_id = (int) $row['forum_id'];
+					$forum_datas[$forum_id] = $row;
+				}
+				$db->sql_freeresult($result);
+			}
+			// Now the topics
+			$sql_array = array(
+				'SELECT'	=> 't.*',
+				'FROM'		=> array(
+					TOPICS_TABLE	=> 't',
+				),
+				'LEFT_JOIN' => array(),
+			);
+			if ($display_user_info && $display_topic_status && $user->data['is_registered']) {
+				$sql_array['LEFT_JOIN'][] = array('FROM' => array(TOPICS_POSTED_TABLE => 'tp'), 'ON' => 'tp.topic_id = t.topic_id AND tp.user_id = ' . $user->data['user_id']);
+				$sql_array['SELECT'] .= ', tp.topic_posted';
+			}
+			if ($load_db_lastread) {
+				$sql_array['SELECT'] .= ', tt.mark_time';
+				$sql_array['LEFT_JOIN'][] = array(
+					'FROM'	=> array(TOPICS_TRACK_TABLE => 'tt'),
+					'ON'	=> 'tt.user_id = ' . $user->data['user_id'] . ' AND tt.topic_id = t.topic_id'
+				);
+			} elseif ($load_anon_lastread && empty($this->tracking_topics)) {
+				$this->tracking_topics = (isset($_COOKIE[$config['cookie_name'] . $tracking_cookie_name])) ? ((STRIP) ? stripslashes($_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : $_COOKIE[$config['cookie_name'] . $tracking_cookie_name]) : '';
+				$this->tracking_topics = ($this->tracking_topics) ? tracking_unserialize($this->tracking_topics) : array();
+				if (!$user->data['is_registered']) {
+					$user->data['user_lastmark'] = (isset($this->tracking_topics['l'])) ? (int) (base_convert($this->tracking_topics['l'], 36, 10) + $config['board_startdate']) : 0;
+				}
+			}
+			$sql_array['WHERE'] = "$topic_sql_auth
+						AND t.topic_status <> " . ITEM_MOVED . ' AND t.topic_approved = 1';
+			$sql_array['ORDER_BY'] = 'topic_last_post_time DESC';
+			$result = $db->sql_query_limit($db->sql_build_query('SELECT', $sql_array), $limit, $start);
+			while ($row = $db->sql_fetchrow($result)) {
+				$topic_id = (int) $row['topic_id'];
+				$forum_id = (int) $row['forum_id'];
+				$all_forum_datas[$forum_id][$topic_id] = $row;
+			}
+			$db->sql_freeresult($result);
+			// Grab icons
+			if (empty($this->icons)) {
+				$this->icons = $cache->obtain_icons();
+			}
+			$folder_alt = 'NO_NEW_POSTS';
+			$topic_type = '';
+			$folder_img = 'topic_read';
+			$topic_folder_img = $user->img($folder_img, $folder_alt);
+			$topic_folder_img_src = $user->img($folder_img, $folder_alt, false, '', 'src');
+			foreach ($all_forum_datas as $forum_id => $topic_datas) {
+				// Start with the forum
+				$forum_id = (int) $forum_id;
+				if (empty($this->forum_datas[$forum_id])) {
+					$row = & $forum_datas[$forum_id];
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					$phpbb_seo->set_url($row['forum_name'], $forum_id, 'forum');
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					$this->forum_datas[$forum_id] = array_merge($row,  array(
+						'forum_url' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+						'm_approve' => $auth->acl_get('m_approve', $forum_id),
+					));
+					if ($load_db_lastread) {
+						$this->forum_tracking_info[$forum_id] = !empty($row['forum_mark_time']) ? $row['forum_mark_time'] : $user->data['user_lastmark'];
+					} elseif ($load_anon_lastread) {
+						$this->forum_tracking_info[$forum_id] = isset($this->tracking_topics['f'][$forum_id]) ? (int) (base_convert($this->tracking_topics['f'][$forum_id], 36, 10) + $config['board_startdate']) : $user->data['user_lastmark'];
+					}
+				}
+				$forum_unread = (isset($this->forum_tracking_info[$forum_id]) && $this->forum_datas[$forum_id]['forum_last_post_time'] > $this->forum_tracking_info[$forum_id]) ? true : false;
+				$folder_image = $folder_alt = '';
+				$folder_image = ($forum_unread) ? 'forum_unread' : 'forum_read';
+				// Which folder should we display?
+				if ($this->forum_datas[$forum_id]['forum_status'] == ITEM_LOCKED) {
+					$folder_image = ($forum_unread) ? 'forum_unread_locked' : 'forum_read_locked';
+					$folder_alt = 'FORUM_LOCKED';
+				} else {
+					$folder_alt = ($forum_unread) ? 'NEW_POSTS' : 'NO_NEW_POSTS';
+				}
+				$template->assign_block_vars('last_forums', array(
+						'FORUM_NAME' => $this->forum_datas[$forum_id]['forum_name'],
+						'FORUM_FOLDER_IMG' => $user->img($folder_image, $folder_alt),
+						'FORUM_FOLDER_IMG_SRC' => $user->img($folder_image, $folder_alt, false, '', 'src'),
+						'FORUM_FOLDER_IMG_ALT'	=> isset($user->lang[$folder_alt]) ? $user->lang[$folder_alt] : '',
+						'U_VIEWFORUM' => append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id"),
+					)
+				);
+				// Now the topics
+				foreach ($topic_datas as $topic_id => $topic_data) {
+					$topic_id = (int) $topic_id;
+					if ($load_db_lastread) {
+						$this->topic_tracking_info[$topic_id] = !empty($topic_data['mark_time']) ? $topic_data['mark_time'] : $user->data['user_lastmark'];
+					} else if ($load_anon_lastread) {
+						$topic_id36 = base_convert($topic_id, 10, 36);
+						if (isset($this->tracking_topics['t'][$topic_id36])) {
+							$this->tracking_topics['t'][$topic_id] = base_convert($this->tracking_topics['t'][$topic_id36], 36, 10) + $config['board_startdate'];
+						}
+						$this->topic_tracking_info[$topic_id] = isset($this->tracking_topics['t'][$topic_id]) ? $this->tracking_topics['t'][$topic_id] : $user->data['user_lastmark'];
+					}
+					if (!empty($this->forum_tracking_info[$forum_id])) {
+						$this->topic_tracking_info[$topic_id] = $this->topic_tracking_info[$topic_id] > $this->forum_tracking_info[$forum_id] ? $this->topic_tracking_info[$topic_id] : $this->forum_tracking_info[$forum_id];
+					}
+					$topic_data['topic_title'] = censor_text($topic_data['topic_title']);
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					$phpbb_seo->prepare_iurl($topic_data, 'topic', $topic_data['topic_type'] == POST_GLOBAL ? $this->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id]);
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					// Replies
+					$replies = $this->forum_datas[$forum_id]['m_approve'] ? $topic_data['topic_replies_real'] : $topic_data['topic_replies'];
+					$last_page = (($replies + 1) > $config['posts_per_page']) ? floor($replies / $config['posts_per_page']) * $config['posts_per_page'] : 0;
+					$last_post_url =  append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id" . ($last_page ? "&amp;start=$last_page" : '')) . '#p' . $topic_data['topic_last_post_id'];
+					$unread_topic = (isset($this->topic_tracking_info[$topic_id]) && $topic_data['topic_last_post_time'] > $this->topic_tracking_info[$topic_id]) ? true : false;
+					// Get folder img, topic status/type related information
+					if ($display_topic_status) {
+						$this->gym_master->topic_status($topic_data, $replies, $unread_topic, $folder_img, $folder_alt, $topic_type);
+						$topic_folder_img = $user->img($folder_img, $folder_alt);
+						$topic_folder_img_src = $user->img($folder_img, $folder_alt, false, '', 'src');
+					}
+					$view_topic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$topic_id");
+					$template->assign_block_vars('last_forums.last_topics', array(
+							'TOPIC_TITLE' => $topic_data['topic_title'],
+							'PAGINATION' => $this->call['last_topic_pagination'] ? $this->gym_master->topic_generate_pagination($replies, $view_topic_url) : '',
+							'TOPIC_TYPE' => $topic_type,
+							'TOPIC_FOLDER_IMG' => $topic_folder_img,
+							'TOPIC_FOLDER_IMG_SRC' => $topic_folder_img_src,
+							'TOPIC_FOLDER_IMG_ALT' => $user->lang[$folder_alt],
+							'TOPIC_ICON_IMG' => (!empty($this->icons[$topic_data['icon_id']])) ? $this->icons[$topic_data['icon_id']]['img'] : '',
+							'TOPIC_ICON_IMG_WIDTH' => (!empty($this->icons[$topic_data['icon_id']])) ? $this->icons[$topic_data['icon_id']]['width'] : '',
+							'TOPIC_ICON_IMG_HEIGHT' => (!empty($this->icons[$topic_data['icon_id']])) ? $this->icons[$topic_data['icon_id']]['height'] : '',
+							'U_NEWEST_POST' => $unread_topic ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' .  $forum_id . '&amp;t=' . $topic_id . '&amp;view=unread#unread') : '',
+							'U_VIEW_TOPIC' => $view_topic_url,
+							'U_LAST_POST' => $last_post_url,
+							'S_UNREAD_TOPIC' => $unread_topic,
+						)
+					);
+				}
+			}
+			unset($forum_datas, $all_forum_datas);
+		}
+	}
+	/**
+	* Generates forum rules / desc for given forum
+	*/
+	function generate_forum_info($forum_data, $type = 'desc') {
+		static $types = array('desc' => 1, 'rules' => 1);
+		if (!isset($types[$type])) {
+			return '';
+		}
+		$forum_info = array('forum_desc' => false, 'forum_rules' => false, 'forum_rules_link' => false);
+		if (!empty($forum_data["forum_$type"])) {
+			$forum_info["forum_$type"] = generate_text_for_display($forum_data["forum_$type"], $forum_data["forum_{$type}_uid"], $forum_data["forum_{$type}_bitfield"], $forum_data["forum_{$type}_options"]);
+		} else if (isset($forum_data["forum_{$type}_link"])) {
+			$forum_info['forum_rules_link'] = $forum_data['forum_rules_link'];
+		}
+		return $type == 'rules' ? $forum_info : $forum_info["forum_$type"];
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/rss_forum.php
===================================================================
--- gym_sitemaps/modules/rss_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/modules/rss_forum.php	(Premod 3.0.8)
@@ -0,0 +1,608 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: rss_forum.php 262 2010-04-20 11:06:58Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class rss_forum {
+	var $url_config = array();
+	var $actions = array();
+	var $module_auth = array();
+	var $module_config = array();
+	var $output_data = array();
+	var $forum_cache = array();
+	/**
+	* constuctor
+	*/
+	function rss_forum(&$gym_master) {
+		global $user, $db;
+		$this->gym_master = &$gym_master;
+		$this->actions = &$this->gym_master->actions;
+		$this->module_auth = &$this->gym_master->module_auth;
+		$this->output_data = &$this->gym_master->output_data;
+		$this->module_config = &$this->gym_master->rss_config;
+		$this->url_config = &$this->gym_master->url_config;
+		$this->module_config = array_merge(
+			// Global
+			$this->module_config,
+			// Other stuff required here
+			array(
+				'rss_first' => ( $this->gym_master->gym_config['rss_forum_first'] ) ? TRUE : FALSE,
+				'rss_last' => ( $this->gym_master->gym_config['rss_forum_last']  ) ? TRUE : FALSE,
+				'rss_forum_rules' => ( $this->gym_master->gym_config['rss_forum_rules']  ) ? TRUE : FALSE,
+				'rss_exclude_list' => trim($this->gym_master->gym_config['rss_forum_exclude'], ','),
+			)
+		);
+		// Set up msg outpout
+		if ($this->actions['rss_news_list'] || $this->actions['module_sub'] === 'announces' ) {
+			$this->module_config['rss_first'] = true;
+			$this->module_config['rss_last'] = false;
+			$this->module_config['rss_sort'] = 'DESC';
+		} else {
+			$this->module_config['rss_last'] = ($this->module_config['rss_first']) ? $this->module_config['rss_last'] : true;
+		}
+		// Build unauthed array
+		$this->module_config['exclude_list'] = $this->gym_master->set_exclude_list($this->module_config['rss_exclude_list']);
+		// Wee need to check auth here
+		$this->gym_master->check_forum_auth($this->module_config['rss_auth_guest']);
+		$this->actions['auth_guest_read'] = array_diff_assoc($this->module_auth['forum']['public_read'], $this->module_config['exclude_list'], $this->module_auth['forum']['skip_all']);
+		$this->actions['auth_view_read'] = array_diff_assoc($this->module_auth['forum']['read_post'], $this->module_config['exclude_list']);
+		if (empty($this->actions['auth_view_read'])) {
+			$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+		}
+		$this->actions['in_id_sql'] = $db->sql_in_set('forum_id', $this->actions['auth_view_read'], false, true);
+		$this->gym_master->gym_output->setup_cache(); // Will exit if the cache is sent
+
+		$this->init_url_settings();
+	}
+	/**
+	* Initialize mod rewrite to handle multiple URL standards.
+	* Only one 'if' is required after this in THE loop to properly switch
+	* between the four types (none, advanced, mixed and simple).
+	* @access private
+	*/
+	function init_url_settings() {
+		global $phpbb_seo, $phpEx;
+		// vars will fell like rain in the code ;)
+		$this->gym_master->init_url_rewrite($this->module_config['rss_modrewrite'], $this->module_config['rss_modrtype']);
+
+		$this->url_config['rss_forum_pre'] = $this->url_config['rss_default'] . '?forum=';
+		$this->url_config['rss_forum_default'] = $this->url_config['rss_default'] . '?forum';
+		$this->url_config['rss_forum_news_default'] = $this->url_config['rss_forum_default'] . '&amp;news';
+		$this->url_config['rss_forum_news'] = '&amp;news';
+		$this->url_config['rss_forum_channel_default'] = $this->url_config['rss_forum_pre'] . 'channels';
+		$this->url_config['rss_forum_channel'] = '';
+		$this->url_config['rss_forum_announces_default'] = $this->url_config['rss_forum_pre'] . 'announces';
+		$this->url_config['rss_forum_announces'] = '';
+		$this->url_config['rss_forum_file'] = '';
+		$this->url_config['rss_forum_delim'] = !empty($phpbb_seo->seo_delim['forum']) ? $phpbb_seo->seo_delim['forum'] : '-f';
+		$this->url_config['rss_forum_static'] = 'forum';
+
+		if ($this->module_config['rss_modrewrite']) { // Module links
+			$this->url_config['rss_forum_pre'] = ($this->url_config['modrtype'] >= 2) ? '' : $this->url_config['rss_forum_static'] . $this->url_config['rss_forum_delim'];
+			$this->url_config['rss_forum_file'] = ($this->url_config['modrtype'] > 0 ? '' : '/' ) . 'forum.xml' . $this->url_config['gzip_ext_out'];
+			$this->url_config['rss_forum_default'] = '';
+			$this->url_config['rss_forum_announces_default'] = $this->url_config['rss_forum_news_default'] = $this->url_config['rss_forum_channel_default'] = '';
+			$this->url_config['rss_forum_news'] = 'news/';
+			$this->url_config['rss_forum_channel'] =  'channels/';
+			$this->url_config['rss_forum_announces'] = 'announces/';
+		}
+		return;
+	}
+	/**
+	* rss_main()
+	* Add content to the main listing (channel list and rss feed)
+	* @access private
+	*/
+	function rss_main() {
+		global $config, $db, $phpbb_seo, $user, $phpEx;
+		// It's global channel list call, add static channels
+		// Reset the local counting, since we are cycling through modules
+		$this->output_data['url_sofar'] = 0;
+		$time_limit = '';
+		$approve_sql = ' AND topic_approved = 1';
+		$approve_sqlt = ' AND t.topic_approved = 1';
+		if ( $this->actions['rss_channel_list'] ) { // Channel lists
+			// Add the forum channel
+			$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_channel_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_channel'] . $this->url_config['rss_forum_file'];
+			$chan_link = $phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'];
+			$item_tile = !empty($this->gym_master->gym_config['rss_forum_sitename']) ? $this->gym_master->gym_config['rss_forum_sitename'] : $config['sitename'];
+			$item_desc = (!empty($this->gym_master->gym_config['rss_forum_site_desc']) ? $this->gym_master->gym_config['rss_forum_site_desc'] : $config['site_desc']) . "\n\n";
+			$this->gym_master->parse_item($item_tile . ' - ' . $user->lang['RSS_CHAN_LIST_TITLE'], $item_desc . $user->lang['RSS_CHAN_LIST_DESC'], $chan_link, $chan_source, $item_tile .  ' - ' . $user->lang['RSS_CHAN_LIST_TITLE'], $this->output_data['last_mod_time']);
+			// add the main news forum feed
+			if ($this->module_config['rss_allow_news']) {
+				$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_default'] . ($this->actions['rss_news_list'] ? '' : $this->url_config['rss_forum_news']) . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->parse_item($item_tile . ' - ' . $user->lang['RSS_NEWS'], $user->lang['RSS_NEWS_DESC'] . ' ' . $item_tile . "\n\n" . $this->module_config['rss_site_desc'], $chan_link, $chan_source, $item_tile . ' - ' . $user->lang['RSS_NEWS'], $this->output_data['last_mod_time']);
+			}
+			// Add announces feed to the list ?
+			// Count items
+			$sql = "SELECT COUNT(topic_id) AS topic
+				FROM " . TOPICS_TABLE . "
+				WHERE forum_id = 0
+				AND topic_type = " . POST_GLOBAL . $approve_sql;
+			$result = $db->sql_query($sql);
+			$row = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+			if (!empty($row['topic'])) {
+				unset($row);
+				$forum_announces_url =  $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_announces_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_announces'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->parse_item(sprintf($user->lang['RSS_ANNOUNCES_TITLE'], $this->module_config['rss_sitename']), sprintf($user->lang['RSS_ANNOUCES_DESC'], $this->module_config['rss_sitename']) . "\n\n" . $this->module_config['rss_site_desc'], $chan_link, $forum_announces_url, '', $this->output_data['last_mod_time']);
+			}
+			// add the main forum feed
+			$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+
+			// Forum stats
+			$forum_stats = '<b>' . $user->lang['STATISTICS'] . '</b> : ' . sprintf($user->lang['TOTAL_USERS_OTHER'], $config['num_users']) . ' || ' . "\n";
+			$forum_stats .= sprintf($user->lang['TOTAL_TOPICS_OTHER'], $config['num_topics']) . ' || ';
+			$forum_stats .= sprintf($user->lang['TOTAL_POSTS_OTHER'], $config['num_posts']) . "\n";
+			$forum_stats .= ($this->module_config['rss_allow_profile'] ? "\n" . sprintf($user->lang['NEWEST_USER'], get_username_string($this->module_config['rss_profile_mode'], $config['newest_user_id'], $config['newest_username'], $config['newest_user_colour']) ) : '') . "\n\n";
+			$item_desc .= $forum_stats;
+			$this->gym_master->parse_item($item_tile, $item_desc, $chan_link, $chan_source, $item_tile, $this->output_data['last_mod_time']);
+			// Grabb the forum data
+			$this->list_forums();
+		} else { // Main feeds
+			// Grabb forums info
+			$forum_data = array();
+			$sql = "SELECT *
+				FROM " . FORUMS_TABLE . "
+					WHERE " . $this->actions['in_id_sql'] . "
+				ORDER BY forum_last_post_id " . $this->module_config['rss_sort'];
+			$result = $db->sql_query($sql);
+			while ($row = $db->sql_fetchrow($result)) {
+				$forum_data[$row['forum_id']] = $row;
+			}
+			$db->sql_freeresult($result);
+			unset($row);
+			// Build sql components
+			$topic_forum_sql = '';
+			if ($this->module_config['rss_limit_time'] > 0 ) {
+				$time_limit = ($this->output_data['time'] - $this->module_config['rss_limit_time']);
+				$time_limit_sql = "topic_last_post_time > $time_limit AND ";
+			} else {
+				$time_limit_sql = '';
+			}
+			// Count topics
+			$sql = "SELECT COUNT(topic_id) AS topic
+				FROM " . TOPICS_TABLE . "
+				WHERE $time_limit_sql
+					" . $this->actions['in_id_sql'] . "
+					AND topic_status <> " . ITEM_MOVED . $approve_sql;
+			$result = $db->sql_query($sql);
+			$row = $db->sql_fetchrow($result);
+			$forum_data['topic_count'] = ( $row['topic'] ) ? $row['topic'] : 1;
+			$db->sql_freeresult($result);
+			unset($row);
+			$forum_sql = 't.' . $this->actions['in_id_sql'] . ' AND ';
+			$this->list_topics($forum_sql, $forum_data, $time_limit, $approve_sqlt);
+		}
+		// Add the local counting, since we are cycling through modules
+		$this->output_data['url_sofar_total'] = $this->output_data['url_sofar_total'] + $this->output_data['url_sofar'];
+		return;
+	}
+	/**
+	* rss_module() will build the module's specific sub feeds,
+	* @access private
+	*/
+	function rss_module() {
+		global $user, $db, $phpbb_seo, $auth, $config;
+		$forum_sql = '';
+		$time_limit = '';
+		$approve_sql = ' AND topic_approved = 1';
+		$approve_sqlt = ' AND t.topic_approved = 1';
+		$forum_data = array('topic_count' => 0);
+		if ($this->actions['module_sub'] === 'channels') { // Module channel list
+			//If so check for dupes and build channel header
+			$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_channel_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_channel'] . $this->url_config['rss_forum_file'];
+			// Kill dupes
+			$this->gym_master->seo_kill_dupes($chan_source);
+			$chan_title = $this->module_config['rss_sitename'];
+			$chan_link = $phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'];
+			$chan_desc = sprintf($user->lang['RSS_CHAN_LIST_DESC_MODULE'], $this->module_config['rss_sitename']) . "\n\n" . $this->module_config['rss_site_desc'] . "\n\n";
+
+			// Forum stats
+			$site_stats = '<b>' . $user->lang['STATISTICS'] . '</b> : ' . sprintf($user->lang['TOTAL_USERS_OTHER'], $config['num_users']) . ' || ';
+			$site_stats .= sprintf($user->lang['TOTAL_TOPICS_OTHER'], $config['num_topics']) . ' || ';
+			$site_stats .= sprintf($user->lang['TOTAL_POSTS_OTHER'], $config['num_posts']);
+
+			$site_stats .= ($this->module_config['rss_allow_profile'] ? "\n" . sprintf($user->lang['NEWEST_USER'], get_username_string($this->module_config['rss_profile_mode'], $config['newest_user_id'], $config['newest_username'], $config['newest_user_colour']) ) : '') . "\n";
+			$chan_title_full = $chan_title . ' ' . $user->lang['RSS_CHAN_LIST_TITLE'];
+			$this->gym_master->parse_channel($chan_title_full, $chan_desc, $chan_link,  $this->output_data['last_mod_time'], $this->module_config['rss_image_url'], $chan_source);
+			// Add main forum feed to the list only when not requesting a news channel list
+			if (!$this->actions['rss_news_list']) {
+				$forum_feed_url = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->parse_item($chan_title, $this->module_config['rss_site_desc'] . "\n\n" . $site_stats, $chan_link, $forum_feed_url, '', $this->output_data['last_mod_time']);
+			}
+			// add the main news forum feed
+			if ($this->module_config['rss_allow_news']) {
+				$news_chan = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_default'] . ($this->actions['rss_news_list'] ? '' : $this->url_config['rss_forum_news']) . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->parse_item($chan_title . ' - ' . $user->lang['RSS_NEWS'], $user->lang['RSS_NEWS_DESC'] . ' ' . $chan_title  . "\n\n" . $this->module_config['rss_site_desc'], $chan_link, $news_chan, $chan_title . ' - ' . $user->lang['RSS_NEWS'], $this->output_data['last_mod_time']);
+			}
+			// Add announces feed to the list ?
+			// Count items
+			$sql = "SELECT COUNT(topic_id) AS topic
+				FROM " . TOPICS_TABLE . "
+				WHERE forum_id = 0
+				AND topic_type = " . POST_GLOBAL . $approve_sql;
+			$result = $db->sql_query($sql);
+			$row = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+			if (!empty($row['topic'])) {
+				unset($row);
+				$forum_announces_url =  $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_announces_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_announces'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->parse_item(sprintf($user->lang['RSS_ANNOUNCES_TITLE'], $this->module_config['rss_sitename']), sprintf($user->lang['RSS_ANNOUCES_DESC'], $this->module_config['rss_sitename']) . "\n\n" . $this->module_config['rss_site_desc'], $chan_link, $forum_announces_url, '', $this->output_data['last_mod_time']);
+			}
+			$this->list_forums();
+			return;
+
+		} elseif ($this->actions['module_sub'] === 'announces') { // Global annnounces list
+
+			// it's the announces sitemap
+			// We want to list all the global announces from the forum
+			$forum_sql = ' t.forum_id = 0 AND t.topic_type = ' . POST_GLOBAL;
+			// Count items
+			$sql = "SELECT COUNT(topic_id) AS topic
+				FROM " . TOPICS_TABLE . " t
+				WHERE $forum_sql $approve_sql";
+			$result = $db->sql_query($sql);
+			$row = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+			if(empty($row['topic'])) {
+				$this->gym_master->gym_error(404, 'GYM_TOO_FEW_ITEMS',  __FILE__, __LINE__);
+				exit;
+			} else {
+				$forum_data['topic_count'] = (int) $row['topic'];
+				unset($row);
+			}
+			$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_vpath'] . $this->url_config['rss_forum_announces_default'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_announces'] . $this->url_config['rss_forum_file'];
+			// Kill dupes
+			$this->gym_master->seo_kill_dupes($chan_source);
+			$chan_title = sprintf($user->lang['RSS_ANNOUNCES_TITLE'], $this->module_config['rss_sitename']);
+			$chan_link = $phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'];
+			$chan_desc =  sprintf($user->lang['RSS_ANNOUCES_DESC'], $this->module_config['rss_sitename']) . "\n\n" . $this->module_config['rss_site_desc'];
+			// Forum announces location
+			$this->gym_master->parse_channel($chan_title . $this->module_config['extra_title'], $chan_desc . "\n", $chan_link,  $this->output_data['last_mod_time'], $this->module_config['rss_image_url'], $chan_source);
+			// Dirty but efficient workarround for announces
+			$this->forum_cache[0]['forum_url'] = $phpbb_seo->seo_opt['virtual_folder'] ? $phpbb_seo->seo_static['global_announce'] . $phpbb_seo->seo_ext['global_announce'] : '';
+			$this->forum_cache[0]['forum_url_full'] = $this->forum_cache[0]['forum_name'] = $chan_title;
+			$this->forum_cache[0]['replies_key'] = 'topic_replies';
+			$this->forum_cache[0]['approve'] = 0;
+			$this->forum_cache[0]['forum_rss_url'] = $chan_source;
+			$this->actions['auth_view_read'][0] = 0;
+			$this->list_topics($forum_sql . ' AND ' , $forum_data);
+
+		} else { // Module feeds
+
+			// Filter $this->actions['module_sub'] var type
+			$this->actions['module_sub'] = intval($this->actions['module_sub']);
+			if ($this->actions['module_sub'] > 0) { // Forum Feed
+				$forum_sql = ' t.forum_id = ' . $this->actions['module_sub'] . ' AND ';
+				// Check forum auth and grab necessary infos
+				$sql = "SELECT *
+					FROM ". FORUMS_TABLE ." f
+					WHERE forum_id = " . $this->actions['module_sub'];
+					$result = $db->sql_query($sql);
+					$forum_data = $db->sql_fetchrow($result);
+					$db->sql_freeresult($result);
+					if ( empty($forum_data) ) {
+						$this->gym_master->gym_error(404, '', __FILE__, __LINE__, $sql);
+					}
+					$forum_id = (int) $forum_data['forum_id'];
+					if ( $forum_data['forum_type'] !=  FORUM_POST || !isset($this->actions['auth_view_read'][$forum_id]) ) {
+						$this->gym_master->gym_error(401, '', __FILE__, __LINE__);
+					}
+					// This forum is allowed, so let's start
+					$forum_rss_url = $this->module_config['rss_url'] . ($this->module_config['rss_modrewrite'] ? $phpbb_seo->set_url($forum_data['forum_name'], $forum_id, 'forum')  . '/' : $this->url_config['rss_forum_pre'] . $forum_id);
+					// Build Yahoo notify URL
+					// If the URL is not rewritten, we cannot use "&", get rid of options in such cases.
+					if ($this->module_config['rss_yahoo_notify']) {
+						if ( $this->url_config['modrewrite'] ) {
+							$this->url_config['rss_yahoo_notify_url'] = $forum_rss_url . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+						} else {
+							$this->url_config['rss_yahoo_notify_url'] = $forum_rss_url;
+						}
+					}
+					$forum_rss_url .= $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+					// Kill dupes
+					$this->gym_master->seo_kill_dupes($forum_rss_url);
+
+					// Properly set the limits
+					$this->forum_cache[$forum_id]['approve'] = 0;
+					$forum_data['topic_count'] =  $forum_data['forum_topics'];
+					$this->forum_cache[$forum_id]['replies_key'] = 'topic_replies';
+					// In case the forum called for a feed is really big, apply time limit
+					if ( $this->module_config['rss_limit_time'] > 0 && $forum_data['topic_count'] > 500) {
+						$time_limit = ($this->output_data['time'] - $this->module_config['rss_limit_time']);
+						// So let's count topic in this forum
+						$sql = "SELECT COUNT(topic_id) AS forum_topics
+							FROM " . TOPICS_TABLE . "
+							WHERE forum_id = $forum_id
+								AND topic_last_post_time > $time_limit
+								AND topic_status <> " . ITEM_MOVED . "
+								$approve_sql";
+						$result = $db->sql_query($sql);
+						$row = $db->sql_fetchrow($result);
+						$forum_data['topic_count'] = ( $row['forum_topics'] ) ? $row['forum_topics'] : 1;
+						$db->sql_freeresult($result);
+						unset($row);
+						// now check if we've got still enough topic to ouptut
+						if ( $forum_data['topic_count'] <= $this->module_config['rss_url_limit'] ) {
+							$time_limit = 0;
+						}
+					}
+					$this->forum_cache[$forum_id]['forum_rss_url'] = $forum_rss_url;
+					$chan_title = $this->forum_cache[$forum_id]['forum_name'] = $forum_data['forum_name'];
+					$this->forum_cache[$forum_id]['forum_url'] = $this->gym_master->forum_url($forum_data['forum_name'], $forum_id);
+					$this->forum_cache[$forum_id]['forum_url_full'] = $this->gym_master->parse_link($phpbb_seo->seo_path['phpbb_urlR'] . $this->forum_cache[$forum_id]['forum_url'] . $this->url_config['forum_ext'], $this->forum_cache[$forum_id]['forum_name'], 'h5');
+					// Build Chan info
+					// Forum stats
+					$forum_stats = "\n" . '<b>' . $user->lang['STATISTICS'] . '</b> : ' . $forum_data['topic_count'] . ' ' . (($forum_data['forum_topics'] >= 0) ? $user->lang['TOPICS'] : $user->lang['TOPIC'] );
+					$forum_stats .= ' || ' . $forum_data['forum_posts'] . ' ' . (($forum_data['forum_posts'] >= 0) ? $user->lang['POSTS'] : $user->lang['POST'] );
+					// Forum rules ?
+					$forum_rules = ($this->module_config['rss_forum_rules'] && $forum_data['forum_rules']) ? generate_text_for_display($forum_data['forum_rules'], $forum_data['forum_rules_uid'], $forum_data['forum_rules_bitfield'], $forum_data['forum_rules_options']) : '';
+					$forum_desc = generate_text_for_display($forum_data['forum_desc'], $forum_data['forum_desc_uid'], $forum_data['forum_desc_bitfield'], $forum_data['forum_desc_options']);
+					// Is this item public ?
+					$this->module_config['rss_auth_msg'] = ($this->gym_master->is_forum_public($forum_id) ? '' : "\n\n" . $user->lang['RSS_AUTH_THIS'] . "\n" );
+					// Profiles
+					$lastposter = '';
+					if ($this->module_config['rss_allow_profile'] ) {
+						$lastposter = "\n" . $user->lang['GYM_LAST_POST_BY'] . get_username_string($this->module_config['rss_profile_mode'], $forum_data['forum_last_poster_id'], $forum_data['forum_last_poster_name'], $forum_data['forum_last_poster_colour']);
+					}
+					$chan_desc = $forum_desc . $forum_rules . "\n" . $forum_stats . $lastposter;
+					$chan_image = !empty($forum_data['forum_image']) ? $phpbb_seo->seo_path['phpbb_url'] . trim($forum_data['forum_image'], '/') : $this->module_config['rss_image_url'];
+					$this->gym_master->parse_channel($chan_title . $this->module_config['extra_title'], $chan_desc, $phpbb_seo->seo_path['phpbb_urlR'] . $this->forum_cache[$forum_id]['forum_url'] . $this->url_config['forum_ext'], $forum_data['forum_last_post_time'], $chan_image, $forum_rss_url);
+
+			} else { // module Rss
+
+				$forum_sql = ' t.' . $this->actions['in_id_sql'] . ' AND ';
+				$chan_source = $this->module_config['rss_url'] . $this->url_config['rss_forum_default'] . $this->url_config['rss_vpath'] . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+				$this->gym_master->seo_kill_dupes($chan_source);
+
+				// Forum stats
+				$forum_stats = '<b>' . $user->lang['STATISTICS'] . '</b> : ' . sprintf($user->lang['TOTAL_USERS_OTHER'], $config['num_users']) . ' || ';
+				$forum_stats .= sprintf($user->lang['TOTAL_TOPICS_OTHER'], $config['num_topics']) . ' || ';
+				$forum_stats .= sprintf($user->lang['TOTAL_POSTS_OTHER'], $config['num_posts']);
+
+				$forum_stats .= ($this->module_config['rss_allow_profile'] ? "\n" . sprintf($user->lang['NEWEST_USER'], get_username_string($this->module_config['rss_profile_mode'], $config['newest_user_id'], $config['newest_username'], $config['newest_user_colour'])) : '')  . "\n";
+				// Chan info
+				$chan_title = $this->module_config['rss_sitename'];
+				$chan_link = $phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'];
+				$chan_desc = $this->module_config['rss_site_desc'] . "\n\n";
+				$forum_image = sprintf($this->gym_master->style_config['rsschan_img_tpl'], $chan_title, $this->module_config['rss_image_url'], $chan_link);
+				$chan_time = gmdate('D, d M Y H:i:s \G\M\T', $this->output_data['last_mod_time']);
+				$chan_title_full = $chan_title . $this->module_config['extra_title'];
+				$this->gym_master->parse_channel($chan_title_full, $chan_desc . $forum_stats, $chan_link,  $this->output_data['last_mod_time'], $this->module_config['rss_image_url'], $chan_source);
+				// Grabb forums info
+				$forum_data = array();
+				$sql = "SELECT *
+					FROM " . FORUMS_TABLE . "
+						WHERE " . $this->actions['in_id_sql'] . "
+					ORDER BY forum_last_post_id " . $this->module_config['rss_sort'];
+				$result = $db->sql_query($sql);
+				while ($row = $db->sql_fetchrow($result)) {
+					$forum_data[$row['forum_id']] = $row;
+				}
+				$db->sql_freeresult($result);
+				unset($row);
+				// Build sql components
+				$time_limit_sql = '';
+				if ($this->module_config['rss_limit_time'] > 0 ) {
+					$time_limit = ($this->output_data['time'] - $this->module_config['rss_limit_time']);
+					$time_limit_sql = "t.topic_last_post_time > $time_limit AND ";
+				} else {
+					$time_limit_sql = '';
+				}
+				$sql = "SELECT COUNT(topic_id) AS topic
+					FROM " . TOPICS_TABLE . " t
+					WHERE $time_limit_sql " . $this->actions['in_id_sql'] . "
+					AND topic_status <> " . ITEM_MOVED . $approve_sql;
+				$result = $db->sql_query($sql);
+				$row = $db->sql_fetchrow($result);
+				$forum_data['topic_count'] = !empty( $row['topic'] ) ? $row['topic'] : 1;
+				$db->sql_freeresult($result);
+				unset($row);
+			}
+			$this->list_topics($forum_sql, $forum_data, $time_limit, $approve_sqlt);
+		}
+
+	}
+	/**
+	* list_forums() builds the output for forum listing
+	* From a forum and from all forums
+	* @access private
+	*/
+	function list_forums() {
+		global $db, $user, $phpbb_seo, $auth;
+		$sql = "SELECT *
+			FROM " . FORUMS_TABLE . "
+				WHERE " . $this->actions['in_id_sql'] . "
+			ORDER BY forum_last_post_id " . $this->module_config['rss_sort'];
+		$result = $db->sql_query($sql);
+		while( $forum_data = $db->sql_fetchrow($result) ) {
+			$forum_id = (int) $forum_data['forum_id'];
+			// Make sure that the forum is auth
+			if (!isset($this->actions['auth_view_read'][$forum_id])) {
+				continue;
+			}
+			$topics_count = $forum_data['forum_topics'];
+			// Build Chan info
+			$forum_stats = '<b>' . $user->lang['STATISTICS'] . '</b> : ' . $topics_count . ' ' . (($forum_data['forum_topics'] >= 0) ? $user->lang['TOPICS'] : $user->lang['TOPIC'] );
+			$forum_stats .= ' || ' . $forum_data['forum_posts'] . ' ' . (($forum_data['forum_posts'] >= 0) ? $user->lang['POSTS'] : $user->lang['POST'] );
+			// Forum rules ?
+			$forum_rules = ($this->module_config['rss_forum_rules'] && $forum_data['forum_rules']) ? generate_text_for_display($forum_data['forum_rules'], $forum_data['forum_rules_uid'], $forum_data['forum_rules_bitfield'], $forum_data['forum_rules_options']) . "\n" : '';
+			$forum_desc = generate_text_for_display($forum_data['forum_desc'], $forum_data['forum_desc_uid'], $forum_data['forum_desc_bitfield'], $forum_data['forum_desc_options']) ;
+			$forum_desc .=  !empty($forum_desc) ? "\n\n" : '';
+			// Is this item public ?
+			$this->module_config['rss_auth_msg'] = ($this->gym_master->is_forum_public($forum_id)) ? '' :  "\n" . $user->lang['RSS_AUTH_THIS'];
+			$item_title = $forum_data['forum_name'];
+			// Profiles
+			$lastposter = '';
+			if ($this->module_config['rss_allow_profile'] && !empty($forum_data['forum_last_poster_id'])) {
+				$lastposter =  "\n" . $user->lang['GYM_LAST_POST_BY'] . get_username_string($this->module_config['rss_profile_mode'], $forum_data['forum_last_poster_id'], $forum_data['forum_last_poster_name'], $forum_data['forum_last_poster_colour']) . "\n";
+			}
+			// Build URLs
+			$forum_rss_url = $this->module_config['rss_url'] .  ( !empty($this->url_config['rss_forum_pre']) ? $this->url_config['rss_forum_pre'] . $forum_id : $this->gym_master->forum_rss_url( $forum_data['forum_name'] , $forum_id)  . '/' ) . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+			$forum_url = $phpbb_seo->seo_path['phpbb_urlR'] . $this->gym_master->forum_url($forum_data['forum_name'], $forum_id, $phpbb_seo->seo_static['forum']) . $this->url_config['forum_ext'];
+			$item_desc = $forum_desc . $forum_rules . $forum_stats . $lastposter;
+			$this->gym_master->parse_item($item_title, $item_desc, $forum_url, $forum_rss_url, $item_title . $this->module_config['extra_title'], $forum_data['forum_last_post_time']);
+		} // End forum list loop
+		$db->sql_freeresult($result);
+		unset ($forum_data);
+	}
+	/**
+	* list_topics($forum_sql, $forum_data, $time_limit = 0, $approve_sql = '') builds the output for topic listing
+	* From a forum and from all forums
+	* @access private
+	*/
+	function list_topics($forum_sql, $forum_data, $time_limit = 0, $approve_sql = '') {
+		global $config, $db, $phpbb_seo, $auth, $user;
+		// Build sql components all remaining cases
+		$msg_sql1 = $msg_sql2 = $msg_sql3 = '';
+		// DBK if news list, use topic start time
+		$time_key = $this->actions['rss_news_list'] ? 't.topic_time' : 't.topic_last_post_time';
+		$order_key = $this->actions['rss_news_list'] ? 't.topic_id' : 't.topic_last_post_id';
+		$time_limit = $time_limit > 0 ? "$time_key > $time_limit AND " : '';
+		if ( $this->actions['rss_content'] ) {
+			if($this->module_config['rss_last'] || !$this->module_config['rss_first']) { // Go for last post content
+				$msg_sql1 = ", p.post_id, p.post_approved, p.post_reported, p.enable_bbcode, p.enable_smilies, p.enable_magic_url, p.enable_sig, p.post_subject, p.post_text, p.post_attachment, p.bbcode_bitfield, p.bbcode_uid, p.post_edit_time";
+				$msg_sql2 = ", " . POSTS_TABLE . " p ";
+				$msg_sql3 = " AND p.post_id = t.topic_last_post_id AND p.post_approved = 1 AND p.post_reported = 0 ";
+			}
+			if($this->module_config['rss_first']) { // First post as well ?
+				$msg_sql1 .= " , pF.post_id as post_idF, pF.post_approved as post_approvedF, pF.post_reported as post_reportedF, pF.enable_bbcode as enable_bbcodeF, pF.enable_smilies as enable_smiliesF, pF.enable_magic_url as enable_magic_urlF, pF.enable_sig as enable_sigF, pF.post_subject as post_subjectF, pF.post_text as post_textF, pF.post_attachment as post_attachmentF, pF.bbcode_bitfield as bbcode_bitfieldF, pF.bbcode_uid as bbcode_uidF, pF.post_edit_time as post_edit_timeF ";
+				$msg_sql2 .= ", " . POSTS_TABLE . " pF ";
+				$msg_sql3 .= " AND pF.post_id = t.topic_first_post_id AND pF.post_approved = 1 AND pF.post_reported = 0 ";
+			}
+		}
+		$sql_first = "SELECT t.* $msg_sql1
+			FROM " . TOPICS_TABLE . " t $msg_sql2
+			WHERE $forum_sql $time_limit
+				t.topic_status <> " . ITEM_MOVED . "
+				$approve_sql
+				$msg_sql3
+				ORDER BY $order_key " . $this->module_config['rss_sort'];
+		// Absolute limit
+		$topic_sofar = 0;
+		$topics = array();
+		$paginated = $config['posts_per_page'];
+		// Do the loop
+		while( ( $topic_sofar <  $forum_data['topic_count'] ) && ($this->output_data['url_sofar'] < $this->module_config['rss_url_limit']) ) {
+			$result = $db->sql_query_limit($sql_first, $this->module_config['rss_sql_limit'], $topic_sofar);
+			while ($topic = $db->sql_fetchrow($result)) {
+				// In case we are looking for more than one forum
+				$forum_id = (int) $topic['forum_id'];
+				// Make sure that the forum is auth
+				if (!isset($this->actions['auth_view_read'][$forum_id])) {
+					continue;
+				}
+				// In case we are going to output forum data many times, let's build this once
+				if (empty($this->forum_cache[$forum_id])) {
+					// Set mod rewrite & type
+					$this->forum_cache[$forum_id]['forum_rss_url'] =  $this->module_config['rss_url'] . ($this->module_config['rss_modrewrite'] ? $phpbb_seo->set_url($forum_data[$forum_id]['forum_name'], $forum_id, 'forum')  . '/' : $this->url_config['rss_forum_pre'] . $forum_id) . $this->url_config['extra_paramsE'] . $this->url_config['rss_forum_file'];
+					$this->forum_cache[$forum_id]['forum_url'] = $this->gym_master->forum_url($forum_data[$forum_id]['forum_name'], $forum_id);
+					$this->forum_cache[$forum_id]['forum_name'] = $forum_data[$forum_id]['forum_name'];
+					$this->forum_cache[$forum_id]['approve'] = 0;
+					$this->forum_cache[$forum_id]['replies_key'] = 'topic_replies';
+					$this->forum_cache[$forum_id]['forum_url_full'] = $this->gym_master->parse_link($phpbb_seo->seo_path['phpbb_urlR'] . $this->forum_cache[$forum_id]['forum_url'] . $this->url_config['forum_ext'], $this->forum_cache[$forum_id]['forum_name'], 'h5');
+				}
+				if ( $topic['topic_reported'] || !$topic['topic_approved'] ) { // Skip for now if reported or unapproved
+
+					continue;
+				}
+				$pages = ceil( ($topic[$this->forum_cache[$forum_id]['replies_key']] + 1) / $paginated);
+				$topic['topic_title'] = censor_text($topic['topic_title']);
+				$topic['topic_replies'] = $topic[$this->forum_cache[$forum_id]['replies_key']];
+				$topic_stats = '<b>' . $user->lang['STATISTICS'] . '</b> : ' . ($topic['topic_replies'] + 1) . ' ' . (($topic['topic_replies'] > 1) ? $user->lang['REPLIES'] : $user->lang['POST'] );
+				$topic_stats .= ' || ' . ($topic['topic_views'] + 1) . ' ' . $user->lang['VIEWS'];
+				$topic['topic_url'] = $phpbb_seo->seo_path['phpbb_urlR'] . $this->gym_master->topic_url($topic, $forum_id, $this->forum_cache[$forum_id]['forum_url']);
+				$has_reply = ($topic['topic_last_post_id'] > $topic['topic_first_post_id']) ? true : false;
+
+				// Is this item public ?
+				$this->module_config['rss_auth_msg'] = ($this->gym_master->is_forum_public($forum_id) ? '' :  "\n\n" . $user->lang['RSS_AUTH_THIS'] ) . "\n\n";
+
+				// Do we output the topic URL
+				if( $has_reply && $this->module_config['rss_first']) {
+					$topic['topic_urlF'] = $topic['topic_url'] . $this->url_config['topic_ext'];
+					$first_message = '';
+					// With the msg content
+					if ($this->actions['rss_content'] && @$topic['post_idF'] ) {
+						if ($topic['post_reportedF'] == 1 || !$topic['post_approvedF']) {
+							$first_message = $user->lang['RSS_REPORTED_UNAPPROVED'];
+						} else {
+							$first_message = $this->gym_master->prepare_for_output( $topic, 'F' );
+						}
+					}
+					// Profiles
+					$lastposter = $author = '';
+					if ($this->module_config['rss_allow_profile']  && !empty($topic['topic_poster'])) {
+						if ($this->module_config['rss_display_author']) {
+							$author = $topic['topic_first_poster_name'];
+						}
+						$lastposter = "\n" . $user->lang['GYM_FIRST_POST_BY'] . get_username_string($this->module_config['rss_profile_mode'], $topic['topic_poster'], $topic['topic_first_poster_name'], $topic['topic_first_poster_colour']) . "\n\n";
+					}
+					$item_desc = $this->forum_cache[$forum_id]['forum_url_full'] . "\n\n" .  $first_message. "\n" . $topic_stats . $lastposter;
+					// DBK use topic time if news
+					$time_key = $this->actions['rss_news_list'] ? 'topic_time' : 'topic_last_post_time';
+					$this->gym_master->parse_item($topic['topic_title'], $item_desc, $topic['topic_urlF'],  $this->forum_cache[$forum_id]['forum_rss_url'], $this->forum_cache[$forum_id]['forum_name'] . $this->module_config['extra_title'], $topic[$time_key], $author);
+				}
+				// Do we output the last post URL
+				if ( $this->module_config['rss_last'] || !$has_reply) {
+					$start = ($pages > 1) ? $paginated * ($pages-1) : 0;
+					$post_num = '';
+					$item_title = $topic['topic_title'];
+					$profile_key = 'first';
+					$user_id_key = 'topic_poster';
+					// For news and annoucements
+					$first_last = ($this->module_config['rss_first'] && !$this->module_config['rss_last']) ? 'F'  : '';
+					if ( $has_reply ) {
+						$item_title = !empty($topic['post_subject']) ? $topic['post_subject'] : $topic['topic_title'];
+
+						$post_num = '#p' . $topic['topic_last_post_id'];
+						$profile_key = 'last';
+						$user_id_key = 'topic_last_poster_id';
+					}
+					$topic['topic_url' . $first_last] = $topic['topic_url'];
+					$topic['topic_url' . $first_last] .= $this->gym_master->set_start('topic', $start) . $post_num;
+					// With the msg content
+					$last_message = '';
+					if ($this->actions['rss_content'] && @$topic['post_id' . $first_last]) {
+						if ($topic['post_reported' . $first_last] == 1 || ! $topic['post_approved' . $first_last]) {
+							$last_message = $user->lang['RSS_REPORTED_UNAPPROVED'];
+						} else {
+							$last_message = $this->gym_master->prepare_for_output( $topic, $first_last);
+						}
+					}
+					// Profiles
+					$lastposter = $author = '';
+					if ($this->module_config['rss_allow_profile'] && !empty($topic[$user_id_key]) ) {
+						if ($this->module_config['rss_display_author']) {
+							$author = $topic['topic_' . $profile_key . '_poster_name'];
+						}
+						$lastposter = "\n" . $user->lang['GYM_' . strtoupper($profile_key) . '_POST_BY'] . get_username_string($this->module_config['rss_profile_mode'], $topic[$user_id_key], $topic['topic_' . $profile_key . '_poster_name'], $topic['topic_' . $profile_key . '_poster_colour']);
+					}
+					$item_desc = $this->forum_cache[$forum_id]['forum_url_full'] .  $last_message . "\n" . $topic_stats .  $lastposter;
+					// DBK use topic time if news
+					$time_key = $this->actions['rss_news_list'] ? 'topic_time' : 'topic_last_post_time';
+					$this->gym_master->parse_item($item_title, $item_desc, $topic['topic_url' . $first_last],  $this->forum_cache[$forum_id]['forum_rss_url'], $this->forum_cache[$forum_id]['forum_name'] . $this->module_config['extra_title'], $topic[$time_key], $author);
+				}
+			}// End topic loop
+			// Used to separate query
+			$topic_sofar = $topic_sofar + $this->module_config['rss_sql_limit'];
+			$db->sql_freeresult($result);
+			unset($topic);
+		}// End Query limit loop
+		unset($forum_data, $this->forum_cache);
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/google_forum.php
===================================================================
--- gym_sitemaps/modules/google_forum.php	(phpBB 3.0.8)
+++ gym_sitemaps/modules/google_forum.php	(Premod 3.0.8)
@@ -0,0 +1,342 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: google_forum.php 254 2010-03-12 15:08:58Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+// First basic security
+if ( !defined('IN_PHPBB') ) {
+	exit;
+}
+/**
+* google_forum Class
+* www.phpBB-SEO.com
+* @package phpBB SEO
+*/
+class google_forum {
+	var $url_config = array();
+	var $actions = array();
+	var $module_auth = array();
+	var $module_config = array();
+	var $output_data = array();
+	/**
+	* constuctor
+	*/
+	function google_forum(&$gym_master) {
+		$this->gym_master = &$gym_master;
+		$this->actions = &$this->gym_master->actions;
+		$this->module_auth = &$this->gym_master->module_auth;
+		$this->output_data = &$this->gym_master->output_data;
+		$this->url_config = &$this->gym_master->url_config;
+		$this->module_config = array_merge(
+			// Global
+			$this->gym_master->google_config,
+			// Other stuff required here
+			array(
+				'google_sticky_priority' => $this->gym_master->gym_config['google_forum_sticky_priority'],
+				'google_announce_priority' => $this->gym_master->gym_config['google_forum_announce_priority'],
+				'google_exclude' => trim($this->gym_master->gym_config['google_forum_exclude'], ','),
+			)
+		);
+		// Build exclude_list array
+		$this->module_config['exclude_list'] = $this->gym_master->set_exclude_list($this->module_config['google_exclude']);
+		// Wee need to check auth here (Only public and postable forums for sitemaps)
+		$this->gym_master->check_forum_auth($this->module_config['google_auth_guest']);
+		// Wee need to check auth here
+		$this->actions['auth_guest_read'] = array_diff_assoc($this->module_auth['forum']['public_read'], $this->module_config['exclude_list'], $this->module_auth['forum']['skip_all']);
+		$this->actions['auth_view_read'] = array_diff_assoc($this->module_auth['forum']['read_post'], $this->module_config['exclude_list']);
+		if (empty($this->actions['auth_view_read'])) {
+			$this->gym_master->gym_error(404, '', __FILE__, __LINE__);
+		}
+		// Check cache
+		$this->gym_master->gym_output->setup_cache(); // Will exit if the cache is sent
+		$this->init_url_settings();
+	}
+	/**
+	* Initialize mod rewrite to handle multiple URL standards.
+	* Only one 'if' is required after this in THE loop to properly switch
+	* between the four types (none, advanced, mixed and simple).
+	* @access private
+	*/
+	function init_url_settings() {
+		global $phpbb_seo, $phpEx;
+		// vars will fell like rain in the code ;)
+		$this->gym_master->init_url_rewrite($this->module_config['google_modrewrite'], $this->module_config['google_modrtype']);
+		$this->url_config['google_forum_tpl'] = $this->module_config['google_url'] . $this->url_config['google_default'] . '?forum=%1$s';
+		$this->url_config['google_forum_default'] = $this->url_config['google_default'] . '?forum';
+		$this->url_config['google_annouces_default'] = sprintf($this->url_config['google_forum_tpl'], 'announces');
+		$this->url_config['google_forum_ext'] = '';
+		$this->url_config['google_forum_delim'] = !empty($phpbb_seo->seo_delim['forum']) ? $phpbb_seo->seo_delim['forum'] : '-f';
+		$this->url_config['google_forum_static'] = !empty($phpbb_seo->seo_static['forum']) ? $phpbb_seo->seo_static['forum'] : 'forum';
+		if ($this->url_config['modrewrite']) { // Module links
+			$this->url_config['google_forum_ext'] = '.xml' . $this->url_config['gzip_ext_out'];
+			$this->url_config['google_forum_tpl'] = $this->module_config['google_url'] . ($this->url_config['modrtype'] >= 2 ? '%2$s' . $this->url_config['google_forum_delim'] . '%1$s' . $this->url_config['google_forum_ext'] : $this->url_config['google_forum_static'] . $this->url_config['google_forum_delim'] . '%1$s' . $this->url_config['google_forum_ext']);
+			$this->url_config['google_forum_default'] = 'forum-sitemap' . $this->url_config['google_forum_ext'];
+			$this->url_config['google_annouces_default'] = $this->module_config['google_url'] . 'forum-announces' . $this->url_config['google_forum_ext'];
+		}
+		return;
+	}
+	/**
+	* sitemap, builds the sitemap
+	* @access private
+	*/
+	function sitemap() {
+		global $config, $phpbb_seo, $db, $user, $auth;
+		$approve_sql = ' AND topic_approved = 1';
+		if ($this->actions['module_sub'] === 'announces') {
+			// Start with forums info
+			$forum_data = array();
+			$forum_data['replies_key'] = 'topic_replies';
+			$forum_data['forum_url'] = $phpbb_seo->seo_opt['virtual_folder'] ? $phpbb_seo->seo_static['global_announce'] . $phpbb_seo->seo_ext['global_announce'] : '' ;
+			// Do we want to list all the global announces from the forum
+			// Count items
+			$sql = "SELECT COUNT(topic_id) AS topic
+				FROM " . TOPICS_TABLE . "
+				WHERE forum_id = 0
+				AND topic_type = " . POST_GLOBAL . $approve_sql;
+			$result = $db->sql_query($sql);
+			$row = $db->sql_fetchrow($result);
+			$db->sql_freeresult($result);
+			if(empty($row['topic'])) {
+				$this->gym_master->gym_error(404, 'GYM_TOO_FEW_ITEMS',  __FILE__, __LINE__);
+				exit;
+			} else {
+				$forum_data['topic_count'] = (int) $row['topic'];
+				unset($row);
+			}
+			// it's the announces sitemap
+			$announces_sitemap_url = $this->url_config['google_annouces_default'];
+			$this->gym_master->seo_kill_dupes($announces_sitemap_url);
+			// Forum index location
+			$this->gym_master->parse_item($phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'], 1, 'always', time());
+			$forum_sql = ' forum_id = 0 AND topic_type = ' . POST_GLOBAL . ' AND ';
+			$this->list_topics($forum_sql, $forum_data, $approve_sql);
+		} else {
+			// Filter $this->actions['module_sub'] var type
+			$this->actions['module_sub'] = intval($this->actions['module_sub']);
+			if ($this->actions['module_sub'] > 0) {
+				// then It's a forum sitemap
+				// Check forum auth and grab necessary infos
+				$sql = "SELECT *
+					FROM ". FORUMS_TABLE ." f
+					WHERE forum_id = " . $this->actions['module_sub'];
+				$result = $db->sql_query($sql);
+				$forum_data = $db->sql_fetchrow($result);
+				$db->sql_freeresult($result);
+				if ( empty($forum_data) ) {
+					$this->gym_master->gym_error(404, '', __FILE__, __LINE__, $sql);
+				}
+				$forum_id = (int) $forum_data['forum_id'];
+				if ( $forum_data['forum_type'] !=  FORUM_POST || !isset($this->actions['auth_view_read'][$forum_id]) ) {
+					$this->gym_master->gym_error(401, '',  __FILE__, __LINE__);
+				}
+				// This forum is allowed, so let's start
+				$forum_sitemap_url = sprintf($this->url_config['google_forum_tpl'], $forum_id, str_replace($phpbb_seo->seo_delim['forum'] . $forum_id, '', $phpbb_seo->set_url($forum_data['forum_name'], $forum_id, 'forum')));
+				// Approval and pagination
+				$paginated = $config['posts_per_page'];
+				$forum_data['topic_count'] = (int) $forum_data['forum_topics'];
+				$forum_data['replies_key'] = 'topic_replies';
+				// Do not serve content if there is no topic in the forum
+				if ( $forum_data['topic_count'] < $this->module_config['google_threshold'] ) {
+					$this->gym_master->gym_error(404, 'GYM_TOO_FEW_ITEMS', __FILE__, __LINE__, $sql);
+				}
+				$this->gym_master->seo_kill_dupes($forum_sitemap_url);
+				$forum_data['forum_url'] = $this->gym_master->forum_url($forum_data['forum_name'], $forum_id) . $this->url_config['forum_ext'];
+				$this->gym_master->parse_item($phpbb_seo->seo_path['phpbb_urlR'] . $forum_data['forum_url'], 1.0, 'always', $forum_data['forum_last_post_time']);
+				$forum_sql = ' forum_id = ' .  $forum_id . ' AND topic_type <> ' . POST_GLOBAL . ' AND ';
+				$this->list_topics($forum_sql, $forum_data, $approve_sql);
+			} else {
+				// it's the forums sitemap
+				$forum_sitemap_url = $this->module_config['google_url'] . $this->url_config['google_forum_default'];
+				$this->gym_master->seo_kill_dupes($forum_sitemap_url);
+				// Forum index location
+				$this->gym_master->parse_item($phpbb_seo->seo_path['phpbb_urlR'] . $this->url_config['forum_index'], 1, 'always', time());
+				$sql = "SELECT *
+					FROM ". FORUMS_TABLE . " WHERE " . $db->sql_in_set('forum_id' , $this->actions['auth_view_read'], false, true) . "
+					ORDER BY forum_last_post_id " . $this->module_config['google_sort'];
+				$result = $db->sql_query($sql);
+				// Forums loop
+				while( $forum_data = $db->sql_fetchrow($result) ) {
+					$forum_id = (int) $forum_data['forum_id'];
+					// Make sure that the forum is auth
+					if (!isset($this->actions['auth_view_read'][$forum_id])) {
+						continue;
+					}
+					$topics_count = $forum_data['forum_topics'];
+					// Not enough topics in this forum, skip
+					if ($topics_count < $this->module_config['google_threshold']) {
+						continue;
+					}
+					$paginated = $forum_data['forum_topics_per_page'] ? $forum_data['forum_topics_per_page'] : $config['topics_per_page'];
+					$pages = ceil( ($topics_count + 1) / $paginated);
+					$forum_url = $phpbb_seo->seo_path['phpbb_urlR'] . $this->gym_master->forum_url($forum_data['forum_name'], $forum_id);
+					$forum_priority = $this->gym_master->get_priority($forum_data['forum_last_post_time'], $pages);
+					$forum_change = $this->gym_master->get_changefreq($forum_data['forum_last_post_time']);
+					$this->gym_master->parse_item( $forum_url . $this->url_config['forum_ext'], $forum_priority, $forum_change, $forum_data['forum_last_post_time']);
+					if ($pages > 1 && $this->module_config['google_pagination']) {
+						// Reset Pages limits for this topic
+						$pag_limit1 = $this->module_config['google_limitdown'];
+						$pag_limit2 = $this->module_config['google_limitup'];
+						// If $pag_limit2 too big for this topic, lets output all pages
+						$pag_limit2 = ( $pages < $pag_limit2 ) ?  ($pages - 1) :  $pag_limit2;
+						$i=1;
+						while ( ($i < $pages) ) {
+							if ( ( $i <= $pag_limit1 ) || ( $i > ($pages - $pag_limit2 ) ) ) {
+								$forum_priority *= 0.95;
+								$url = $forum_url . sprintf($this->url_config['forum_start_tpl'], $paginated * $i);
+								$this->gym_master->parse_item( $url, $forum_priority, $forum_change, $forum_data['forum_last_post_time']);
+								$i++;
+							} else {
+								$i++;
+							}
+						}
+					}
+				} // End Forum map loop
+				$db->sql_freeresult($result);
+				unset ($forum_data);
+			}
+		}
+		return;
+	}
+	/**
+	* sitemapindex, builds the sitemapindex
+	* @access private
+	*/
+	function sitemapindex() {
+		global $phpbb_seo, $db, $config, $user, $auth;
+		$approve_sql = ' AND topic_approved = 1';
+		// It's global list call, add module sitemaps
+		// Reset the local counting, since we are cycling through modules
+		$this->output_data['url_sofar'] = 0;
+		// Announces map location ?
+		// Count items
+		$sql = "SELECT COUNT(topic_id) AS topic
+			FROM " . TOPICS_TABLE . "
+			WHERE forum_id = 0
+			AND topic_type = " . POST_GLOBAL . $approve_sql;
+		$result = $db->sql_query($sql);
+		$row = $db->sql_fetchrow($result);
+		$db->sql_freeresult($result);
+		if (!empty($row['topic'])) {
+			unset($row);
+			$announces_sitemap_url = $this->url_config['google_annouces_default'];
+			$this->gym_master->parse_sitemap($announces_sitemap_url, $user->time_now - rand(1,150));
+		}
+		$sql = "SELECT *
+			FROM ". FORUMS_TABLE . "
+				WHERE " . $db->sql_in_set('forum_id', $this->actions['auth_view_read'], false, true) . "
+			ORDER BY forum_last_post_id " . $this->module_config['google_sort'];
+		$result = $db->sql_query($sql);
+		// Reset vars
+		$forum_sitemap_urls = '';
+		$sitemap_data = array();
+		$last_ever = 0;
+		$num_sitemaps = 0;
+		while( $forum_data = $db->sql_fetchrow($result) ) {
+			$forum_id = (int) $forum_data['forum_id'];
+			// Make sure that the forum is auth
+			if (!isset($this->actions['auth_view_read'][$forum_id])) {
+				continue;
+			}
+			// Only car about approved topics
+			$topics_count = (int) $forum_data['forum_topics'];
+			// Not enough topics in this forum, skip
+			if ($topics_count < $this->module_config['google_threshold']) {
+				continue;
+			}
+			// Let's count accurately
+			if ($this->module_config['google_pagination']) {
+				$paginated = $forum_data['forum_topics_per_page'] ? $forum_data['forum_topics_per_page'] : $config['topics_per_page'];
+				$pages = ceil( ($topics_count + 1) / $paginated);
+				$num_sitemaps += min($this->module_config['google_limitdown'] + $this->module_config['google_limitup'], $pages);
+			} else {
+				$num_sitemaps++;
+			}
+			// Build sitemap url
+			$sitemap_data[$forum_id]['url'] = sprintf($this->url_config['google_forum_tpl'], $forum_id, str_replace($phpbb_seo->seo_delim['forum'] . $forum_id, '', $phpbb_seo->set_url($forum_data['forum_name'], $forum_id, 'forum')));
+			$sitemap_data[$forum_id]['lastmod'] = $forum_data['forum_last_post_time'] > $config['board_startdate'] ? $forum_data['forum_last_post_time'] : $config['board_startdate'];
+		}// End Forum map loop
+		$db->sql_freeresult($result);
+		unset ($forum_data);
+		if (!empty($sitemap_data)) {
+			// only add the Forum map location if showing enough forums
+			if ( $num_sitemaps >= $this->module_config['google_threshold'] ) {
+				// Forum map location
+				$forum_sitemap_url = $this->module_config['google_url'] . $this->url_config['google_forum_default'];
+				$this->gym_master->parse_sitemap($forum_sitemap_url, $user->time_now);
+			}
+			foreach ($sitemap_data as $data) {
+				$this->gym_master->parse_sitemap($data['url'], $data['lastmod']);
+			}
+			unset ($sitemap_data);
+		}
+		// Add the local counting, since we are cycling through modules
+		$this->output_data['url_sofar_total'] = $this->output_data['url_sofar_total'] + $this->output_data['url_sofar'];
+		return;
+	}
+	/**
+	* list_topics($forum_sql, $forum_data, $approve_sql = '') builds the output for topic listing
+	* From a forum and from all forums
+	* @access private
+	*/
+	function list_topics($forum_sql, $forum_data, $approve_sql = '') {
+		global $db, $phpbb_seo, $auth, $config, $user;
+		// initial setup
+		$topic_sofar = 0;
+		$topics = array();
+		$sql_first = "SELECT *
+				FROM " . TOPICS_TABLE . "
+				WHERE $forum_sql
+					topic_status <> " . ITEM_MOVED . "
+					$approve_sql
+					ORDER BY topic_last_post_id " . $this->module_config['google_sort'];
+		$paginated = $config['posts_per_page'];
+		while( ( $topic_sofar <  $forum_data['topic_count'] ) && ($this->output_data['url_sofar'] < $this->module_config['google_url_limit']) ) {
+			$result = $db->sql_query_limit($sql_first, $this->module_config['google_sql_limit'], $topic_sofar);
+			while ($topic = $db->sql_fetchrow($result)) {
+				$forum_id = (int) $topic['forum_id'];
+				// Make sure that the forum is auth
+				if ((!isset($this->actions['auth_view_read'][$forum_id]) && $this->actions['module_sub'] !== 'announces') || $topic['topic_reported']) { // Skip for now if reported, approved are checked above when required
+					continue;
+				}
+				$pages = ceil( ($topic[$forum_data['replies_key']] + 1) / $paginated);
+				$topic['topic_title'] = censor_text($topic['topic_title']);
+				$topic_url = $phpbb_seo->seo_path['phpbb_urlR'] . $this->gym_master->topic_url($topic, $forum_id, $forum_data['forum_url']);
+				if ($topic['topic_type'] == POST_NORMAL ) {
+					$topic_priority = $this->gym_master->get_priority($topic['topic_last_post_time'], $pages);
+				} else {
+					$topic_priority = $topic['topic_type'] == POST_STICKY ? $this->module_config['google_sticky_priority'] : $this->module_config['google_announce_priority'];
+				}
+				$topic_change = ($topic['topic_status'] == ITEM_LOCKED) ? 'never' : $this->gym_master->get_changefreq($topic['topic_last_post_time']);
+				$topic_time = gmdate('Y-m-d\TH:i:s'.'+00:00', $topic['topic_last_post_time']);
+				$this->gym_master->parse_item($topic_url . $this->url_config['topic_ext'], $topic_priority, $topic_change, $topic['topic_last_post_time']);
+				if ($pages > 1 && $this->module_config['google_pagination']) {
+					// Reset Pages limits for this topic
+					$pag_limit1 = $this->module_config['google_limitdown'];
+					$pag_limit2 = $this->module_config['google_limitup'];
+					// If $pag_limit2 too big for this topic, lets output all pages
+					$pag_limit2 = ( $pages < $pag_limit2 ) ?  ($pages - 1) :  $pag_limit2;
+					$i=1;
+					while ( ($i < $pages) ) {
+						if ( ( $i <= $pag_limit1 ) || ( $i > ($pages - $pag_limit2 ) ) ) {
+							$topic_priority *= 0.95;
+							$url = $topic_url . sprintf($this->url_config['topic_start_tpl'], $paginated * $i);
+							$this->gym_master->parse_item($url, $topic_priority, $topic_change, $topic['topic_last_post_time']);
+							$i++;
+						} else {
+							$i++;
+						}
+					}
+				}
+			}// End topic loop
+			// Used to separate query
+			$topic_sofar = $topic_sofar + $this->module_config['google_sql_limit'];
+			$db->sql_freeresult($result);
+			unset($topic);
+		}// End Query limit loop
+	}
+}
+?>
\ No newline at end of file
Index: gym_sitemaps/modules/.htaccess
===================================================================
--- gym_sitemaps/modules/.htaccess	(phpBB 3.0.8)
+++ gym_sitemaps/modules/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Limit GET POST PUT DELETE>
+Order Allow,Deny
+Deny from All
+</Limit>
Index: gym_sitemaps/modules/index.htm
===================================================================
--- gym_sitemaps/modules/index.htm	(phpBB 3.0.8)
+++ gym_sitemaps/modules/index.htm	(Premod 3.0.8)
@@ -0,0 +1,10 @@
+<html>
+<head>
+<title></title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+</head>
+
+<body bgcolor="#FFFFFF" text="#000000">
+
+</body>
+</html>
Index: map.php
===================================================================
--- map.php	(phpBB 3.0.8)
+++ map.php	(Premod 3.0.8)
@@ -0,0 +1,23 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: map.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+define('IN_PHPBB', true);
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+$phpbb_root_path = './';
+include($phpbb_root_path . 'common.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('gym_sitemaps/gym_common');
+// Start the process
+require($phpbb_root_path . 'gym_sitemaps/includes/gym_html.' . $phpEx);
+
+$gym_html = new gym_html();
+exit;
+?>
\ No newline at end of file
Index: images/phpbb-seo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: I:\web\phpbb-seo.com\aTEAM\svn\svn_phpbb\images\phpbb-seo.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: includes/db/dbal.php
===================================================================
--- includes/db/dbal.php	(revision 1)
+++ includes/db/dbal.php	(Premod 3.0.8)
@@ -711,7 +711,9 @@
 	function sql_report($mode, $query = '')
 	{
 		global $cache, $starttime, $phpbb_root_path, $user;
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		global $phpbb_seo;
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		if (empty($_REQUEST['explain']))
 		{
 			return false;
@@ -741,7 +743,7 @@
 						<meta http-equiv="Content-Style-Type" content="text/css" />
 						<meta http-equiv="imagetoolbar" content="no" />
 						<title>SQL Report</title>
-						<link href="' . $phpbb_root_path . 'adm/style/admin.css" rel="stylesheet" type="text/css" media="screen" />
+						<link href="' . $phpbb_seo->seo_path['phpbb_url'] . 'adm/style/admin.css" rel="stylesheet" type="text/css" media="screen" />
 					</head>
 					<body id="errorpage">
 					<div id="wrap">
Index: includes/functions_content.php
===================================================================
--- includes/functions_content.php	(revision 1)
+++ includes/functions_content.php	(Premod 3.0.8)
@@ -762,7 +762,9 @@
 
 	global $template, $cache, $user;
 	global $extensions, $config, $phpbb_root_path, $phpEx;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	//
 	$compiled_attachments = array();
 
@@ -937,7 +939,25 @@
 				$display_cat = ATTACHMENT_CATEGORY_NONE;
 			}
 
-			$download_link = append_sid("{$phpbb_root_path}download/file.$phpEx", 'id=' . $attachment['attach_id']);
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			//$download_link = append_sid("{$phpbb_root_path}download/file.$phpEx", 'id=' . $attachment['attach_id']);
+			$download_link = "{$phpbb_root_path}download/file.$phpEx?id=" . $attachment['attach_id'];
+			$comment_clean = preg_replace('`<[^>]*>`Ui', ' ', $comment);
+			$block_array += array(
+				'COMMENT_CLEAN'		=> $comment_clean,
+			);
+			if (!empty($phpbb_seo->seo_opt['rewrite_files'])) {
+				if (empty($phpbb_seo->seo_url['file'][$attachment['attach_id']])) {
+					if (($_pos = utf8_strpos($comment, '<br')) !== false) {
+						$comment_url = strip_tags(utf8_substr($comment, 0, $_pos));
+					} else {
+						$comment_url = $comment_clean;
+					}
+					$comment_url = utf8_strlen($comment_url) > 60 ? utf8_substr($comment_url, 0, 60) : $comment_url;
+					$phpbb_seo->seo_url['file'][$attachment['attach_id']] = $phpbb_seo->format_url($comment_url, $phpbb_seo->seo_static['file'][$display_cat]);
+				}
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT END
 
 			switch ($display_cat)
 			{
@@ -1013,7 +1033,9 @@
 						'S_FLASH_FILE'	=> true,
 						'WIDTH'			=> $width,
 						'HEIGHT'		=> $height,
-						'U_VIEW_LINK'	=> $download_link . '&amp;view=1',
+						// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+						'U_VIEW_LINK'	=> append_sid($download_link . '&amp;view=1'),
+						// www.phpBB-SEO.com SEO TOOLKIT END
 					);
 
 					// Viewed/Heared File ... update the download count
@@ -1028,7 +1050,9 @@
 					);
 				break;
 			}
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			$download_link = append_sid($download_link);
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			$l_download_count = (!isset($attachment['download_count']) || $attachment['download_count'] == 0) ? $user->lang[$l_downloaded_viewed . '_NONE'] : (($attachment['download_count'] == 1) ? sprintf($user->lang[$l_downloaded_viewed], $attachment['download_count']) : sprintf($user->lang[$l_downloaded_viewed . 'S'], $attachment['download_count']));
 
 			$block_array += array(
@@ -1237,7 +1261,16 @@
 			// For anonymous the link leads to a login page.
 			if ($user_id && $user_id != ANONYMOUS && ($user->data['user_id'] == ANONYMOUS || $auth->acl_get('u_viewprofile')))
 			{
-				$profile_url = ($custom_profile_url !== false) ? $custom_profile_url . '&amp;u=' . (int) $user_id : str_replace(array('={USER_ID}', '=%7BUSER_ID%7D'), '=' . (int) $user_id, $_profile_cache['base_url']);
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				// $profile_url = ($custom_profile_url !== false) ? $custom_profile_url . '&amp;u=' . (int) $user_id : str_replace(array('={USER_ID}', '=%7BUSER_ID%7D'), '=' . (int) $user_id, $_profile_cache['base_url']);
+				global $phpbb_seo, $phpbb_root_path, $phpEx;
+				$phpbb_seo->set_user_url( $username, $user_id );
+				if ($custom_profile_url !== false) {
+					$profile_url = reapply_sid($custom_profile_url . (strpos($custom_profile_url, '?') !== false ?  '&amp;' : '?' ) . 'u=' . (int) $user_id);
+				} else {
+					$profile_url = append_sid("{$phpbb_root_path}memberlist.$phpEx", 'mode=viewprofile&amp;u=' . (int) $user_id);
+				}
+				// www.phpBB-SEO.com SEO TOOLKIT END
 			}
 			else
 			{
Index: includes/utf/utf_tools.php
===================================================================
--- includes/utf/utf_tools.php	(revision 1)
+++ includes/utf/utf_tools.php	(Premod 3.0.8)
@@ -105,6 +105,10 @@
 if (extension_loaded('mbstring'))
 {
 	mb_internal_encoding('UTF-8');
+	// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+	// ini_set is only used to try to make things better for mods using mbstring directly
+	// I know they're not supposed to, but you know they still could and the fix is costless
+	@ini_set("mbstring.internal_encoding", 'UTF-8');
 
 	/**
 	* UTF-8 aware alternative to strrpos
@@ -129,11 +133,15 @@
 
 			if (is_null($offset))
 			{
-				return mb_strrpos($str, $needle);
+				// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+				// Explicit encoding
+				return mb_strrpos($str, $needle, 0, 'UTF-8');
 			}
 			else
 			{
-				return mb_strrpos($str, $needle, $offset);
+				// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+				// Explicit encoding
+				return mb_strrpos($str, $needle, $offset, 'UTF-8');
 			}
 		}
 	}
@@ -153,8 +161,9 @@
 				{
 					return false;
 				}
-
-				return mb_strrpos($str, $needle);
+				// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+				// Explicit encoding
+				return mb_strrpos($str, $needle, 'UTF-8');
 			}
 			else
 			{
@@ -163,10 +172,12 @@
 					trigger_error('utf8_strrpos expects parameter 3 to be long', E_USER_ERROR);
 					return false;
 				}
-
-				$str = mb_substr($str, $offset);
-
-				if (false !== ($pos = mb_strrpos($str, $needle)))
+				// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+				// Explicit encoding
+				$str = mb_substr($str, $offset, mb_strlen($str, 'UTF-8'), 'UTF-8');
+				// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+				// Explicit encoding
+				if (false !== ($pos = mb_strrpos($str, $needle, 'UTF-8')))
 				{
 					return $pos + $offset;
 				}
@@ -184,11 +195,15 @@
 	{
 		if (is_null($offset))
 		{
-			return mb_strpos($str, $needle);
+			// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+			// Explicit encoding
+			return mb_strpos($str, $needle, 0, 'UTF-8');
 		}
 		else
 		{
-			return mb_strpos($str, $needle, $offset);
+			// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+			// Explicit encoding
+			return mb_strpos($str, $needle, $offset, 'UTF-8');
 		}
 	}
 
@@ -198,7 +213,9 @@
 	*/
 	function utf8_strtolower($str)
 	{
-		return mb_strtolower($str);
+		// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+		// Explicit encoding
+		return mb_strtolower($str, 'UTF-8');
 	}
 
 	/**
@@ -207,7 +224,9 @@
 	*/
 	function utf8_strtoupper($str)
 	{
-		return mb_strtoupper($str);
+		// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+		// Explicit encoding
+		return mb_strtoupper($str, 'UTF-8');
 	}
 
 	/**
@@ -218,11 +237,15 @@
 	{
 		if (is_null($length))
 		{
-			return mb_substr($str, $offset);
+			// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+			// Explicit encoding
+			return mb_substr($str, $offset, mb_strlen($str, 'UTF-8'), 'UTF-8');
 		}
 		else
 		{
-			return mb_substr($str, $offset, $length);
+			// Fix for http://www.phpbb.com/bugs/phpbb3/52315
+			// Explicit encoding
+			return mb_substr($str, $offset, $length, 'UTF-8');
 		}
 	}
 
Index: includes/acm/acm_memcache.php
===================================================================
--- includes/acm/acm_memcache.php	(revision 1)
+++ includes/acm/acm_memcache.php	(Premod 3.0.8)
@@ -135,4 +135,4 @@
 	}
 }
 
-?>
+?>
\ No newline at end of file
Index: includes/functions_posting.php
===================================================================
--- includes/functions_posting.php	(revision 1)
+++ includes/functions_posting.php	(Premod 3.0.8)
@@ -1319,13 +1319,18 @@
 				$messenger->to($addr['email'], $addr['name']);
 				$messenger->im($addr['jabber'], $addr['name']);
 
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				global $phpbb_seo;
+				$phpbb_seo->set_url(htmlspecialchars_decode($forum_name), $forum_id, 'forum');
+				$phpbb_seo->prepare_iurl(array('topic_id' => $topic_id, 'topic_title' => htmlspecialchars_decode($topic_title)), 'topic', $phpbb_seo->seo_url['forum'][$forum_id]);
 				$messenger->assign_vars(array(
 					'USERNAME'		=> htmlspecialchars_decode($addr['name']),
 					'TOPIC_TITLE'	=> htmlspecialchars_decode($topic_title),
 					'FORUM_NAME'	=> htmlspecialchars_decode($forum_name),
 
-					'U_FORUM'				=> generate_board_url() . "/viewforum.$phpEx?f=$forum_id",
-					'U_TOPIC'				=> generate_board_url() . "/viewtopic.$phpEx?f=$forum_id&t=$topic_id",
+					'U_FORUM'				=> !empty($phpbb_seo->seo_opt['url_rewrite']) ? $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}viewforum.$phpEx?f=$forum_id")) : generate_board_url() . "/viewforum.$phpEx?f=$forum_id",
+					'U_TOPIC'				=> !empty($phpbb_seo->seo_opt['url_rewrite']) ? $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}viewtopic.$phpEx?f=$forum_id&amp;t=$topic_id")) : generate_board_url() . "/viewtopic.$phpEx?f=$forum_id&t=$topic_id",
+				// www.phpBB-SEO.com SEO TOOLKIT END
 					'U_NEWEST_POST'			=> generate_board_url() . "/viewtopic.$phpEx?f=$forum_id&t=$topic_id&p=$post_id&e=$post_id",
 					'U_STOP_WATCHING_TOPIC'	=> generate_board_url() . "/viewtopic.$phpEx?uid={$addr['user_id']}&f=$forum_id&t=$topic_id&unwatch=topic",
 					'U_STOP_WATCHING_FORUM'	=> generate_board_url() . "/viewforum.$phpEx?uid={$addr['user_id']}&f=$forum_id&unwatch=forum",
@@ -1628,7 +1633,9 @@
 function submit_post($mode, $subject, $username, $topic_type, &$poll, &$data, $update_message = true, $update_search_index = true)
 {
 	global $db, $auth, $user, $config, $phpEx, $template, $phpbb_root_path;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// We do not handle erasing posts here
 	if ($mode == 'delete')
 	{
@@ -1816,7 +1823,11 @@
 				'topic_time_limit'			=> ($topic_type == POST_STICKY || $topic_type == POST_ANNOUNCE) ? ($data['topic_time_limit'] * 86400) : 0,
 				'topic_attachment'			=> (!empty($data['attachment_data'])) ? 1 : 0,
 			);
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			if (!empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+				$sql_data[TOPICS_TABLE]['sql'] += array('topic_url' => isset($data['topic_url']) ? $data['topic_url'] : '');
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			if (isset($poll['poll_options']) && !empty($poll['poll_options']))
 			{
 				$poll_start = ($poll['poll_start']) ? $poll['poll_start'] : $current_time;
@@ -1902,7 +1913,11 @@
 
 				'topic_attachment'			=> (!empty($data['attachment_data'])) ? 1 : (isset($data['topic_attachment']) ? $data['topic_attachment'] : 0),
 			);
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			if (!empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+				$sql_data[TOPICS_TABLE]['sql'] += array('topic_url' => isset($data['topic_url']) ? $data['topic_url'] : '');
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			// Correctly set back the topic replies and forum posts... only if the topic was approved before and now gets disapproved
 			if (!$post_approval && $data['topic_approved'])
 			{
@@ -2604,7 +2619,12 @@
 	{
 		$params .= '&amp;t=' . $data['topic_id'];
 	}
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	$phpbb_seo->set_url($data['forum_name'], $data['forum_id'], 'forum');
+	if ( $params ) {
+		$phpbb_seo->prepare_iurl($data, 'topic', $topic_type == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$data['forum_id']]);
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	$url = (!$params) ? "{$phpbb_root_path}viewforum.$phpEx" : "{$phpbb_root_path}viewtopic.$phpEx";
 	$url = append_sid($url, 'f=' . $data['forum_id'] . $params) . $add_anchor;
 
Index: includes/acp/acp_update.php
===================================================================
--- includes/acp/acp_update.php	(revision 1)
+++ includes/acp/acp_update.php	(Premod 3.0.8)
@@ -50,14 +50,16 @@
 		$announcement_url = trim($info[1]);
 		$announcement_url = (strpos($announcement_url, '&amp;') === false) ? str_replace('&', '&amp;', $announcement_url) : $announcement_url;
 		$update_link = append_sid($phpbb_root_path . 'install/index.' . $phpEx, 'mode=update');
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		// moved a little bellow
 		// next feature release
-		$next_feature_version = $next_feature_announcement_url = false;
+		/*$next_feature_version = $next_feature_announcement_url = false;
 		if (isset($info[2]) && trim($info[2]) !== '')
 		{
 			$next_feature_version = trim($info[2]);
 			$next_feature_announcement_url = trim($info[3]);
-		}
+		}*/
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
 
 		// Determine automatic update...
 		$sql = 'SELECT config_value
@@ -71,7 +73,28 @@
 
 		$up_to_date_automatic = (version_compare(str_replace('rc', 'RC', strtolower($current_version)), str_replace('rc', 'RC', strtolower($latest_version)), '<')) ? false : true;
 		$up_to_date = (version_compare(str_replace('rc', 'RC', strtolower($config['version'])), str_replace('rc', 'RC', strtolower($latest_version)), '<')) ? false : true;
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$phpbb_seo_update = '';
+		if ($up_to_date) {
+			$phpbb_seo_update = trim(str_replace($current_version, '', $latest_version));
+		}
+		$update_instruction = sprintf($user->lang['UPDATE_INSTRUCTIONS'], $announcement_url, $update_link);
+		if (!empty($phpbb_seo_update)) {
+			$auto_package = trim($info[2]);
+			$auto_update = $auto_package === 'auto_update:yes' ? true : false;
+			$up_to_date = ($latest_version === @$config['seo_premod_version']) ? true : false;
+			if (!$auto_update) {
+				$update_instruction = '<br/><br/><hr/>' . sprintf($user->lang['ACP_PREMOD_UPDATE'], $latest_version, $announcement_url) . '<br/><hr/>';
+			}
+		}
+		// next feature release
+		$next_feature_version = $next_feature_announcement_url = false;
+		if (isset($info[3]) && trim($info[3]) !== '')
+		{
+			$next_feature_version = trim($info[3]);
+			$next_feature_announcement_url = trim($info[4]);
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		$template->assign_vars(array(
 			'S_UP_TO_DATE'		=> $up_to_date,
 			'S_UP_TO_DATE_AUTO'	=> $up_to_date_automatic,
Index: includes/acp/info/acp_gym_sitemaps.php
===================================================================
--- includes/acp/info/acp_gym_sitemaps.php	(phpBB 3.0.8)
+++ includes/acp/info/acp_gym_sitemaps.php	(Premod 3.0.8)
@@ -0,0 +1,39 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: acp_gym_sitemaps.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+
+/**
+* @package module_install
+*/
+class acp_gym_sitemaps_info {
+	function module() {
+		return array(
+			'filename'	=> 'gym_sitemaps',
+			'title'		=> 'ACP_GYM_SITEMAPS',
+			'version'	=> '2.0.0',
+			'modes'		=> array(
+				'main'		=> array('title' => 'ACP_GYM_MAIN', 'auth' => 'acl_a_board', 'cat' => array('ACP_GYM_SITEMAPS')),
+				'google'	=> array('title' => 'ACP_GYM_GOOGLE_MAIN', 'auth' => 'acl_a_board', 'cat' => array('ACP_GYM_SITEMAPS')),
+				'rss'		=> array('title' => 'ACP_GYM_RSS_MAIN', 'auth' => 'acl_a_board', 'cat' => array('ACP_GYM_SITEMAPS')),
+				//'yahoo'		=> array('title' => 'ACP_GYM_YAHOO_MAIN', 'auth' => 'acl_a_board', 'cat' => array('ACP_GYM_SITEMAPS')),
+				'html'		=> array('title' => 'ACP_GYM_HTML_MAIN', 'auth' => 'acl_a_board', 'cat' => array('ACP_GYM_SITEMAPS')),
+			),
+		);
+	}
+
+	function install()
+	{
+	}
+
+	function uninstall()
+	{
+	}
+}
+
+?>
\ No newline at end of file
Index: includes/acp/info/acp_phpbb_seo.php
===================================================================
--- includes/acp/info/acp_phpbb_seo.php	(phpBB 3.0.8)
+++ includes/acp/info/acp_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,37 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: acp_phpbb_seo.php 131 2009-10-25 12:03:44Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+
+/**
+* @package module_install
+*/
+class acp_phpbb_seo_info {
+	function module() {
+		return array(
+			'filename'	=> 'phpbb_seo',
+			'title'		=> 'ACP_CAT_PHPBB_SEO',
+			'version'	=> '0.6.0',
+			'modes'		=> array(
+				'settings'		=> array('title' => 'ACP_PHPBB_SEO_CLASS', 'auth' => 'acl_a_board', 'cat' => array('ACP_MOD_REWRITE')),
+				'forum_url'		=> array('title' => 'ACP_FORUM_URL', 'auth' => 'acl_a_board', 'cat' => array('ACP_MOD_REWRITE')),
+				'htaccess'		=> array('title' => 'ACP_HTACCESS', 'auth' => 'acl_a_board', 'cat' => array('ACP_MOD_REWRITE')),
+				'extended'		=> array('title' => 'ACP_SEO_EXTENDED', 'auth' => 'acl_a_board', 'cat' => array('ACP_MOD_REWRITE')),
+			));
+	}
+
+	function install()
+	{
+	}
+
+	function uninstall()
+	{
+	}
+}
+
+?>
\ No newline at end of file
Index: includes/acp/acp_profile.php
===================================================================
--- includes/acp/acp_profile.php	(revision 1)
+++ includes/acp/acp_profile.php	(Premod 3.0.8)
@@ -1623,4 +1623,4 @@
 	}
 }
 
-?>
+?>
\ No newline at end of file
Index: includes/acp/acp_gym_sitemaps.php
===================================================================
--- includes/acp/acp_gym_sitemaps.php	(phpBB 3.0.8)
+++ includes/acp/acp_gym_sitemaps.php	(Premod 3.0.8)
@@ -0,0 +1,1255 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: acp_gym_sitemaps.php 272 2010-11-21 13:56:31Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+/**
+* phpBB_SEO Class
+* www.phpBB-SEO.com
+* @package Advanced phpBB3 SEO mod Rewrite
+*/
+class acp_gym_sitemaps {
+	var $u_action;
+	var $new_config = array();
+	var $dyn_select = array();
+	var $gym_config = array();
+	var $gym_modules = array();
+	var $gym_modules_acp = array();
+	var $mode = 'gym';
+	var $modes = array();
+	var $module = 'gym';
+	var $action = 'main';
+	var $maction = '';
+	var $support_link = array();
+	var $override = array();
+	var $override_type = array();
+	var $array_type_cfg = array();
+	var $multiple_options = array();
+	var $modrtype_lang = array();
+	var $write_type = 'forum';
+	var $lengh_limit = 20;
+	var $word_limit = 3;
+	var $seo_unset_opts = array();
+
+	/**
+	* Constructor
+	*/
+	function main($id, $mode) {
+		global $config, $db, $user, $auth, $template, $cache;
+		global $phpbb_root_path, $phpbb_admin_path, $phpEx, $table_prefix, $phpbb_seo, $_action_types;
+		require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+		// Start the phpbb_seo class
+		if ( !is_object($phpbb_seo) ) {
+			if ( file_exists($phpbb_root_path . 'phpbb_seo/phpbb_seo_class.' . $phpEx)) {
+				require_once($phpbb_root_path . 'phpbb_seo/phpbb_seo_class.' . $phpEx);
+			} else {
+				require_once($phpbb_root_path . 'gym_sitemaps/includes/phpbb_seo_class_light.' . $phpEx);
+			}
+			$phpbb_seo = new phpbb_seo();
+		}
+		$user->add_lang('gym_sitemaps/acp/gym_common');
+		// action=(module|cache|modrewrite...)&amp;module=(main|forum| ...)
+		$action	= request_var('action', 'main');
+		$module	= request_var('module', 'main');
+		// maction =(settings|maintenance|save)&amp;action=(module|cache|modrewrite...)&amp;module=(main|forum| ...)
+		$maction = request_var('maction', '');
+		$mactions = array('settings', 'maintenance', 'install');
+		$maction = in_array($maction, $mactions) ? $maction : '';
+		$submit = (isset($_POST['submit'])) ? true : false;
+		$this->modes = $_action_types;
+		$this->override_type = $_override_types;
+		$this->override = array();
+		// Filter allowed modes
+		$this->mode = $mode;
+		$this->module = $module;
+		$this->action = $action;
+		$this->maction = $maction;
+		$this->set_phpbb_seo_links();
+		// Get gym config
+		obtain_gym_config('main', $this->gym_config);
+		$this->new_config = $this->gym_config;
+		// define common validation arrays
+		$this->dyn_select['modrtype'] =  array( 0 => 'GYM_MODREWRITE_NONE', 1 => 'GYM_MODREWRITE_SIMPLE', 2 => 'GYM_MODREWRITE_MIXED', 3 => 'GYM_MODREWRITE_ADVANCED');
+		$this->dyn_select['gzip_level'] =  array( 1 => 1, 2 => 2, 3 => 3, 4 => 4, 5 => 5, 6 => 6, 7 => 7, 8 => 8, 9 => 9);
+		$this->dyn_select['sort'] =  array( 'DESC' => 'GYM_DESC', 'ASC' => 'GYM_ASC');
+		$this->dyn_select['override'] =  array( OVERRIDE_GLOBAL => 'GYM_OVERRIDE_GLOBAL', OVERRIDE_OTYPE => 'GYM_OVERRIDE_OTYPE', OVERRIDE_MODULE => 'GYM_OVERRIDE_MODULE');
+		$this->dyn_select['sumarize_method'] =  array( 'chars' => 'GYM_METHOD_CHARS', 'words' => 'GYM_METHOD_WORDS', 'lines' => 'GYM_METHOD_LINES');
+		$this->dyn_select['gym_auth'] = array(
+			'admin' => 'GYM_AUTH_ADMIN',
+			'globalmod' => 'GYM_AUTH_GLOBALMOD',
+			'reg' => 'GYM_AUTH_REG',
+			'guest' => 'GYM_AUTH_GUEST',
+			'all' => 'GYM_AUTH_ALL',
+			'none' => 'GYM_AUTH_NONE',
+		);
+		$this->dyn_select['rss_linking_types'] = array('n' => 'RSS_LINKING_NEWS', 'nd' => 'RSS_LINKING_NEWS_DIGEST', 'r' => 'RSS_LINKING_REGULAR', 'rd' => 'RSS_LINKING_REGULAR_DIGEST');
+		// Get the module list
+		// Populate the $this->gym_modules[$mode][$module] array
+		$this->gym_get_modules($mode);
+		// Load the relevant modules acp options
+		// Populate the $this->gym_modules_acp[$mode][$module] array
+		$this->gym_module_acp($mode, $module);
+		// Acp options array for this case
+		$display_vars = $error = array();
+		// salt the form
+		$form_key = 'acp_gym';
+		add_form_key($form_key);
+		// check form salt
+		if ($submit && !check_form_key($form_key)) {
+			$error[] = $user->lang['FORM_INVALID'];
+			$submit = false;
+		}
+		// Cache management
+		if ($maction === 'maintenance') {
+			$display_vars = $this->gym_maintenance( $mode, $module, $action, $submit );
+			$submit = false;
+		} elseif ($maction === 'settings') { // settings management
+			$display_vars = $this->gym_set_default( $mode, $module, $action, $submit );
+			$submit = false;
+		} elseif ($maction === 'install') { // module install
+			$display_vars = $this->gym_install( $mode, $module, $action, $submit );
+			$submit = false;
+		} else {
+			if ( !in_array($mode, $this->modes) || !in_array($module, $this->gym_modules[$mode])) {
+				trigger_error('NO_MODE', E_USER_ERROR);
+			} else {
+				$script_to_check = array();
+				if (empty($this->gym_modules_acp[$mode][$module][$action]['display_vars'])) {
+					$action = $this->action = 'main';
+				}
+				// here we'll check if the GYM script urls are consistent
+				if (!$submit) {
+					$this->check_scripts($error, $this->gym_config, $mode);
+				}
+				$display_vars = $this->gym_modules_acp[$mode][$module][$action]['display_vars'];
+				// Check if we do not have a new module needing a new config key
+				$clear_cache = false;
+				foreach ($display_vars['vars'] as $key => $value) {
+					if (!isset($this->gym_config[$key]) && strpos($key, 'legend') === false) {
+						$clear_cache = true;
+						if(isset($this->gym_modules_acp[$mode][$module][$action]['default'][$key])) {
+							$this->new_config[$key] = $this->gym_modules_acp[$mode][$module][$action]['default'][$key];
+							set_gym_config($key, $this->new_config[$key], $mode, $this->gym_config);
+						}
+					}
+				}
+				if ($clear_cache) {
+					$this->remove_cache('config');
+				}
+			}
+		}
+		// Load the module's language files
+		foreach ($this->gym_modules_acp[$mode] as $active_modules => $null) {
+			if (!empty($this->gym_modules_acp[$mode][$active_modules]['info']['lang_file'])) {
+				$user->add_lang('gym_sitemaps/acp/' . $this->gym_modules_acp[$mode][$active_modules]['info']['lang_file']);
+			}
+		}
+		$cfg_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : $this->new_config;
+		// We validate the complete config if whished
+		validate_config_vars($display_vars['vars'], $cfg_array, $error);
+
+		// check script urls if necessary
+		if ($submit && isset($cfg_array[$mode . '_url'])) {
+			// will enforce trailing slashes automatically
+			$this->check_scripts($error, $cfg_array, $mode);
+		}
+		// Do not write values if there is an error
+		if (sizeof($error)) {
+			$submit = false;
+		}
+		// We go through the display_vars to make sure no one is trying to set variables he/she is not allowed to...
+		foreach ($display_vars['vars'] as $config_name => $cfg_setup) {
+			if ( (!isset($cfg_array[$config_name]) && @$cfg_setup['method'] != 'select_multiple_string') || strpos($config_name, 'legend') !== false) {
+				continue;
+			}
+			// Handle multiple select options
+			if (!empty($cfg_setup['method']) && $cfg_setup['method'] == 'select_multiple_string') {
+				if (isset($_POST['multiple_' . $config_name])) {
+					$m_values = utf8_normalize_nfc(request_var('multiple_' . $config_name, array('' => '')));
+					$validate_int = $cfg_setup['multiple_validate'] == 'int' ? true : false;
+					foreach($m_values as $k => $v) {
+						if ($validate_int) {
+							$v = (int) $v;
+						}
+						if (empty($v)) {
+							unset($m_values[$k]);
+						} else {
+							$m_values[$k] = $v;
+						}
+					}
+					sort($m_values);
+					$this->new_config[$config_name] = $m_values;
+					$config_value = implode(',', $m_values);
+					if ( strlen($config_value) > 255 ) {
+						$error[] = sprintf($user->lang['SETTING_TOO_LONG'], $user->lang[$cfg_setup['lang']], 255);
+					}
+					$submit = empty($error);
+				} else {
+					if ($submit) {
+						$this->new_config[$config_name] = array();
+						$config_value = '';
+					} else {
+						$config_value = $this->new_config[$config_name];
+						$this->new_config[$config_name] = !empty($config_value) ? explode(',', $config_value) : array();
+					}
+				}
+			} else {
+				$this->new_config[$config_name] = $config_value = $cfg_array[$config_name];
+			}
+			if ($submit) {
+				set_gym_config($config_name, $config_value, $mode, $this->gym_config);
+			}
+		}
+		if ($submit) {
+			$this->remove_cache('config');
+			add_log('admin', 'GYM_LOG_CONFIG_' . strtoupper($mode));
+			trigger_error($user->lang['CONFIG_UPDATED'] . $this->back_to_prev());
+		}
+		$this->tpl_name = 'acp_gym_sitemaps';
+		$this->page_title = $display_vars['title'];
+		// add the maitenance links
+		$maintenance_links = '';
+		$maintenance_links .= '<a href="' . $this->u_action . '&amp;maction=maintenance&amp;action=' . $action . '&amp;module=' . $module . '"><b style="color:red;">' . $user->lang['GYM_MAINTENANCE'] . '</b></a><b> &bull; </b>';
+		$maintenance_links .= '<a href="' . $this->u_action . '&amp;maction=settings&amp;action=' . $action . '&amp;module=' . $module . '"><b style="color:red;">' . $user->lang['GYM_SETTINGS'] . '</b></a>';
+		$install_link = ($mode !== 'main') ? '<b> &bull; </b><a href="' . $this->u_action . '&amp;maction=install&amp;action=' . $action . '&amp;module=' . $module . '"><b style="color:red;">' . $user->lang['GYM_INSTALL'] . '</b></a>' : '';
+		if ($action === 'gzip') {
+			// Adjust language variable a bit
+			$user->lang['GYM_GZIP_EXPLAIN'] = sprintf( $user->lang['GYM_GZIP_EXPLAIN'], ($config['gzip_compress'] ? $user->lang['GYM_GZIP_FORCED'] : $user->lang['GYM_GZIP_CONFIGURABLE']) );
+		}
+		$lang_key = 'GYM_' . strtoupper($mode);
+		$l_mode_title = $this->safe_lang($lang_key);
+		$l_mode_title_explain = $this->safe_lang($lang_key . '_EXPLAIN');
+		$lang_key = $this->gym_modules_acp[$mode][$module]['info']['title_lang'];
+		$l_module_title = $this->safe_lang($lang_key);
+		$l_module_title_explain = $this->safe_lang($lang_key . '_EXPLAIN');
+		$l_title = $this->safe_lang($display_vars['title']);
+		$l_title_explain = $this->safe_lang($display_vars['title'] . '_EXPLAIN');
+		$l_title_explain .= ($action === 'cache' && $mode !== 'html') ? $this->check_cache_folder($phpbb_root_path . 'gym_sitemaps/cache') : '';
+		$template->assign_vars(array(
+			'L_MODE_TITLE'		=> $l_mode_title,
+			'L_MODE_ITLE_EXPLAIN'	=> $l_mode_title_explain,
+			'L_MODULE_TITLE'	=> $l_module_title,
+			'L_MODULE_ITLE_EXPLAIN'	=> $l_module_title_explain,
+			'L_TITLE'		=> $l_title,
+			'L_TITLE_EXPLAIN'	=> $l_title_explain,
+			'GYM_VERSION'		=> $this->gym_config['gym_version'],
+			'INSTALL_LINK'		=> $install_link,
+			'MAINTENANCE_LINKS'	=> $maintenance_links,
+			'S_ERROR'		=> (sizeof($error)) ? true : false,
+			'ERROR_MSG'		=> implode('<br />', $error),
+			'S_SUBMIT_BUTTON'	=> !empty($this->gym_modules_acp[$mode][$module][$action]['default']),
+			'U_ACTION'		=> $this->u_action . '&amp;maction=' . $maction . '&amp;action=' . $action . '&amp;module=' . $module)
+		);
+
+		$this->gym_module_menu( $mode, $module, $action );
+
+		$this->gym_menu( $mode, $module, $action );
+		// Output relevant page
+		foreach ($display_vars['vars'] as $config_key => $vars) {
+			if (!is_array($vars) && strpos($config_key, 'legend') === false) {
+				continue;
+			}
+			if (strpos($config_key, 'legend') !== false) {
+				$template->assign_block_vars('options', array(
+					'S_LEGEND'		=> true,
+					'LEGEND'		=> $this->safe_lang($vars))
+				);
+				continue;
+			}
+			$type = explode(':', $vars['type']);
+			$l_explain = '';
+			if ($vars['explain'] && isset($vars['lang_explain'])) {
+				$l_explain = $this->safe_lang($vars['lang_explain']);
+			} elseif ($vars['explain']) {
+				$l_explain = $this->safe_lang($vars['lang'] . '_EXPLAIN');
+			}
+			// Add overriding infos
+			$form = true;
+			if (isset($vars['overriding']) && $vars['overriding']) {
+				$vars['append'] = $this->is_overriden($mode, $module, $action, $config_key, $vars);
+				//$form = $vars['append'] == $this->safe_lang('GYM_COULD_OVERRIDE') ? true : false;
+			}
+			$content = '';
+			$template->assign_block_vars('options', array(
+				'KEY' => $config_key,
+				'TITLE' => $this->safe_lang($vars['lang']),
+				'S_EXPLAIN' => $vars['explain'],
+				'TITLE_EXPLAIN'	=> $l_explain,
+				'CONTENT' =>  $form ? build_cfg_template($type, $config_key, $this->new_config, $config_key, $vars) : $vars['append'],
+				)
+			);
+			unset($display_vars['vars'][$config_key]);
+		}
+	}
+	/**
+	* gym_get_modules($mode).
+	* Populates $this->gym_modules[$mode][$module]
+	* with the acp modules list
+	*/
+	function gym_get_modules($mode) {
+		global $cache, $phpEx, $phpbb_root_path;
+		if (($this->gym_modules[$mode] = $cache->get('_gym_modules_' . $mode)) === false) {
+			$this->gym_modules[$mode] = array();
+			$dir = @opendir( $phpbb_root_path . 'gym_sitemaps/acp' );
+			while( ($file = @readdir($dir)) !== FALSE ) {
+				if(preg_match('`^' . $mode . '_([a-z0-9_-]+)\.' . $phpEx . '$`i', $file, $matches)) {
+					$module = trim(str_replace( $mode . '_', '' , str_replace('.' . $phpEx , '' ,$file)), "/");
+					if ($matches[1] == 'main' || (file_exists($phpbb_root_path . 'gym_sitemaps/modules/' .  $file) && !empty($this->gym_config[$mode . '_' . $module . '_installed'])) ) {
+						$this->gym_modules[$mode][$module] = $module;
+					}
+				}
+			}
+			@closedir($dir);
+			// Reorder a bit, put the main panel at the first position, others will keep
+			// the file system sorting
+			if (!empty($this->gym_modules[$mode]['main'])) {
+				$main = $this->gym_modules[$mode]['main'];
+				unset($this->gym_modules[$mode]['main']);
+				$this->gym_modules[$mode] = array('main' => $main) + $this->gym_modules[$mode];
+
+			}
+			$cache->put('_gym_modules_' . $mode, $this->gym_modules[$mode]);
+		}
+		if (!is_array($this->gym_modules[$mode]) || empty($this->gym_modules[$mode])) {
+			$this->remove_cache('acp', $mode);
+		}
+	}
+	/**
+	* gym_module_acp($mode, $module)
+	* loads acp module options in the $this->gym_modules_acp[$mode][$mode_module] array.
+	*/
+	function gym_module_acp($mode, $module) {
+		global $phpbb_root_path, $phpEx, $cache;
+		if (is_array($this->gym_modules[$mode]) && ($this->gym_modules_acp[$mode] = $cache->get('_gym_acp_' . $mode)) === false) {
+			foreach ($this->gym_modules[$mode] as $mode_module) {
+				$this->gym_pick_module($mode, $mode_module, $this->gym_modules_acp);
+			}
+			$cache->put('_gym_acp_' . $mode, $this->gym_modules_acp[$mode]);
+		}
+		if (!@is_array($this->gym_modules_acp[$mode]) || empty($this->gym_modules_acp[$mode])) {
+			$this->remove_cache('acp', $mode);
+		}
+	}
+	/**
+	* gym_pick_module( $mode, $module, $action)
+	* pick a given module data
+	*/
+	function gym_pick_module( $mode, $mode_module, &$return_array) {
+		global $phpbb_root_path, $phpEx;
+		$module_class = $mode . '_' . $mode_module;
+		$module_file = $phpbb_root_path . 'gym_sitemaps/acp/' . $module_class . '.' . $phpEx;
+		if ( file_exists($module_file) ) {
+			include_once($module_file);
+			if (class_exists($module_class)) {
+				$gym_module = new $module_class($this);
+				if ( method_exists($gym_module, 'acp_module')) {
+					$return_array[$mode][$mode_module] = $gym_module->acp_module();
+				}
+			}
+		}
+	}
+	/**
+	* gym_menu( $mode, $module, $action)
+	* Builds the module action links
+	*/
+	function gym_menu( $mode, $module, $action) {
+		global $template, $user;
+		foreach ($this->gym_modules_acp[$mode][$module]['info']['actions'] as $module_action) {
+				$template->assign_block_vars('menu', array(
+					'L_TITLE'	=> $this->safe_lang($this->gym_modules_acp[$mode][$module][$module_action]['display_vars']['title']),
+					'S_SELECTED'	=> $action == $module_action ? true : false,
+					'U_TITLE'	=> $this->u_action . '&amp;action=' . $module_action . '&amp;module=' . $module,
+				));
+		}
+		$template->assign_vars(array('S_MENU' => empty($this->maction)));
+		return;
+	}
+	/**
+	* gym_module_menu( $mode, $module, $action)
+	* builds the module ACP links
+	*/
+	function gym_module_menu( $mode, $module, $action ) {
+		global $template, $user;
+		foreach ($this->gym_modules_acp[$mode] as $modules) {
+				$template->assign_block_vars('menu_module', array(
+					'L_TITLE'		=> $this->safe_lang($modules['info']['title_lang']),
+					'S_SELECTED'	=> ($module == @$modules['info']['module'] && $this->maction !== 'install') ? true : false,
+					'U_TITLE'		=> $this->u_action . '&amp;module=' . @$modules['info']['module'] . (!empty($action) ? "&amp;action=$action" : ''),
+				));
+		}
+		$template->assign_vars(array('S_MENU' => true));
+		$template->assign_vars(array('S_MENU_MODULE' => true));
+		return;
+	}
+	/**
+	* gym_install( $mode, $module, $action, $submit = false )
+	* handle module install / un-install
+	*/
+	function gym_install( $mode, $module, $action, $submit = false ) {
+		global $user, $phpEx, $phpbb_root_path;
+		$post_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : array();
+		if ($submit) {
+			$un_install = $install = array();
+			foreach ($this->gym_modules[$mode] as $_module) { // check if we need to uninstall
+				$type_module = $mode . '_' . $_module;
+				if (isset($post_array[$type_module]) && !$post_array[$type_module] && !empty($this->gym_config[$type_module . '_installed'])) { // Uninstall
+					$un_install[$mode][$_module] = $type_module;
+				}
+			}
+			$dir = @opendir( $phpbb_root_path . 'gym_sitemaps/acp' );
+			while( ($file = @readdir($dir)) !== false ) { // check if we need to install
+				if(preg_match('`^' . $mode . '_([a-z0-9_-]+)\.' . $phpEx . '$`i', $file, $matches)) {
+					$type_module = trim(str_replace('.' . $phpEx , '' ,$file), "/");
+					$_module = str_replace($mode . '_', '', $type_module);
+					if ($matches[1] !== 'main' && file_exists($phpbb_root_path . 'gym_sitemaps/modules/' .  $file) && !isset($this->gym_modules[$mode][$_module]) && !empty($post_array[$type_module])) {
+						$install[$mode][$_module] = $type_module;
+					}
+				}
+			}
+			// Now un-install
+			if (!empty($un_install)) {
+				foreach ($un_install[$mode] as $_module => $type_module) {
+					// In case we are uninstalling from this module
+					// we go back to main
+					if ($module == $this->module) {
+						$this->module = 'main';
+					}
+					set_gym_config($type_module . '_installed', 0, 'main', $this->gym_config);
+					$this->gym_set_default( $mode, $_module, $action, true, true, true );
+				}
+			}
+			// Now install
+			if (!empty($install)) {
+				foreach ($install[$mode] as $_module => $type_module) {
+					set_gym_config($type_module . '_installed', 1, 'main', $this->gym_config);
+				}
+				$this->remove_cache('config');
+				$this->remove_cache('acp');
+				$this->gym_get_modules($mode);
+				foreach ($install[$mode] as $_module => $type_module) {
+					$this->gym_set_default( $mode, $_module, $action, true, true );
+				}
+			}
+			$this->remove_cache('config');
+			$this->remove_cache('acp');
+			trigger_error($user->lang['CONFIG_UPDATED'] . $this->back_to_prev());
+		}
+		// Adjust language variable a bit
+		$user->lang['GYM_MODULE_INSTALL'] = sprintf($user->lang['GYM_MODULE_INSTALL'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_MODULE_INSTALL_EXPLAIN'] = sprintf($user->lang['GYM_MODULE_INSTALL_EXPLAIN'], $user->lang[strtoupper($mode)] );
+		$display_vars = array( 'title'	=> 'GYM_MODULE_INSTALL');
+		$display_vars['vars'] = array();
+		$i = 1;
+		// Installed modules
+		$active = array();
+		foreach ($this->gym_modules[$mode] as $_module) {
+			if ($_module !== 'main') {
+				$active[$mode][$_module] = $mode . '_' . $_module;
+			}
+		}
+		if (!empty($active)){ // Add the active module list
+			$display_vars['vars']['legend' . $i] = 'GYM_MODULES_INSTALLED';
+			$i++;
+			foreach ($active[$mode] as $_module => $type_module) { // Installed modules
+				// Grabb the data
+				//$this->gym_module_acp($mode, $type_module);
+				$this->new_config[$type_module] = 1;
+				$display_vars['vars'][$type_module] = array('lang' => strtoupper($type_module), 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => false);
+			}
+		}
+		// now check if we have some module to install
+		$unactive = array();
+		$dir = @opendir( $phpbb_root_path . 'gym_sitemaps/acp' );
+		while( ($file = @readdir($dir)) !== FALSE ) {
+			if(preg_match('`^' . $mode . '_([a-z0-9_-]+)\.' . $phpEx . '$`i', $file, $matches)) {
+				$type_module = trim(str_replace('.' . $phpEx , '' ,$file), "/");
+				$_module = str_replace($mode . '_', '', $type_module);
+				if ($matches[1] !== 'main' && file_exists($phpbb_root_path . 'gym_sitemaps/modules/' .  $file) && !isset($this->gym_modules[$mode][$_module])) {
+					$unactive[$mode][$_module] = $type_module;
+					if ($_module != 'main' && !empty($this->gym_config[$type_module . '_installed'])) {
+						set_gym_config($type_module . '_installed', 0, 'main', $this->gym_config);
+					}
+				}
+			}
+		}
+		if (!empty($unactive)){ // Add the not active module list
+			$display_vars['vars']['legend' . $i] = 'GYM_MODULES_UNINSTALLED';
+			$i++;
+			foreach ($unactive[$mode] as $_module => $type_module) { // Uninstalled modules
+				// Grabb the data
+				$this->gym_pick_module($mode, $_module, $module_data);
+				if (!empty($module_data[$mode][$_module]['info']['lang_file'])) {
+					$user->add_lang('gym_sitemaps/acp/' . $module_data[$mode][$_module]['info']['lang_file']);
+				}
+				$this->new_config[$type_module] = 0;
+				$display_vars['vars'][$type_module] = array('lang' => strtoupper($type_module), 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => false);
+			}
+		}
+		return $display_vars;
+	}
+	/**
+	* gym_set_default( $mode, $module, $action, $submit = false, $silent = false, $uninstall = false )
+	* Set default values for modules
+	*/
+	function gym_set_default( $mode, $module, $action, $submit = false, $silent = false, $uninstall = false ) {
+		global $user, $phpbb_root_path, $phpEx;
+		$post_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : array();
+		$this->new_config['reset_all'] = $reset_all = isset($post_array['reset_all']) ? $post_array['reset_all'] : false;
+		if ($silent) {
+			$reset_all = true;
+		}
+		if ($submit) {
+			if ($mode === 'main' ) { // Reset all seting for all output and all modules
+				foreach ($this->modes as $output_mode) { // List the output modes
+					$this->gym_get_modules($output_mode);
+					foreach ($this->gym_modules[$output_mode] as $type_module) { // List modules from each output mode
+						if (!empty($post_array[$output_mode . '_' . $type_module . '_reset']) || $reset_all) {
+							// Grabb the data
+							$this->gym_module_acp($output_mode, $type_module);
+							foreach($this->gym_modules_acp[$output_mode][$type_module]['info']['actions'] as $module_action) {
+								foreach ($this->gym_modules_acp[$output_mode][$type_module][$module_action]['default'] as $module_config => $default_value ) { // In the end list possible options for this module's option set
+									// Update config
+									if ($uninstall) {
+										rem_gym_config($module_config, $this->gym_config);
+									} else {
+										set_gym_config($module_config, $default_value, $output_mode, $this->gym_config);
+									}
+								}
+							}
+						}
+					}
+				}
+			} elseif ($module === 'main') { // Only looking for one output type modules
+				foreach ($this->gym_modules[$mode] as $type_module) { // add the output types modules
+					if (!empty($post_array[$mode . '_' . $type_module . '_reset']) || $reset_all) {
+						// Grabb the data
+						$this->gym_module_acp($mode, $type_module);
+						foreach($this->gym_modules_acp[$mode][$type_module]['info']['actions'] as $module_action) {
+							foreach ($this->gym_modules_acp[$mode][$type_module][$module_action]['default'] as $module_config => $default_value ) {
+								// Update config
+								if ($uninstall) {
+									rem_gym_config($module_config, $this->gym_config);
+								} else {
+									set_gym_config($module_config, $default_value, $mode, $this->gym_config);
+								}
+							}
+						}
+					}
+				}
+			} else { // Only reset this module config
+				$this->gym_module_acp($mode, $module);
+				// Allow modules with no acp
+				if (!empty($this->gym_modules_acp[$mode][$module]['info'])) {
+					foreach ($this->gym_modules_acp[$mode][$module]['info']['actions'] as $module_action ) {
+						foreach ($this->gym_modules_acp[$mode][$module][$module_action]['default'] as $module_config => $default_value ) {
+							if (!empty($post_array[$mode . '_' . $module . '_' . $module_action . '_reset']) || $reset_all) {
+								// Update config
+								if ($uninstall) {
+									rem_gym_config($module_config, $this->gym_config);
+								} else {
+									set_gym_config($module_config, $default_value, $mode, $this->gym_config);
+								}
+							}
+						}
+					}
+				}
+			}
+			$this->clear_all_cache();
+			unset($post_array);
+			if (!$silent) {
+				trigger_error($user->lang['CONFIG_UPDATED'] . $this->back_to_prev());
+			} else {
+				return;
+			}
+		}
+		// Adjust language variable a bit
+		$user->lang['GYM_RESET'] = sprintf($user->lang['GYM_RESET'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_RESET_EXPLAIN'] = sprintf($user->lang['GYM_RESET_EXPLAIN'], $user->lang[strtoupper($mode)] );
+		$display_vars = array( 'title'	=> 'GYM_RESET');
+		$i = 1;
+		if ($mode === 'main' ) { // Reset all seting for all output and all modules
+			foreach ($this->modes as $output_mode) { // List the output types modules
+				$this->gym_get_modules($output_mode);
+				$display_vars['vars']['legend' . $i] = strtoupper($output_mode);
+				$i++;
+				foreach ($this->gym_modules[$output_mode] as $type_module) { // Then the modules
+					// Grabb the data
+					$this->gym_module_acp($output_mode, $type_module);
+					// Then the associated language files if any
+					if (!empty($this->gym_modules_acp[$output_mode][$type_module]['info']['lang_file'])) {
+						$user->add_lang('gym_sitemaps/acp/' . $this->gym_modules_acp[$output_mode][$type_module]['info']['lang_file']);
+					}
+					$var_key = $output_mode . '_' . $type_module . '_reset';
+					$this->new_config[$var_key] = 0;
+					$display_vars['vars'][$var_key] = array('lang' => strtoupper($var_key), 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true);
+				}
+			}
+		} elseif ($module === 'main') { // Only looking for one output type modules
+
+			foreach ($this->gym_modules[$mode] as $type_module) { // add the output types modules
+				// Grabb the data
+				$this->gym_module_acp($mode, $type_module);
+				$display_vars['vars']['legend' . $i] = strtoupper($mode . '_' . $type_module);
+				$i++;
+				$var_key = $mode . '_' . $type_module . '_reset';
+				$this->new_config[$var_key] = 0;
+				$display_vars['vars'][$var_key] = array('lang' => strtoupper($var_key), 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true);
+			}
+		} else { // Only reset this module config
+			$this->gym_module_acp($mode, $module);
+			$display_vars['vars']['legend' . $i] = strtoupper($mode . '_' . $module) . '_RESET';
+			$i++;
+			// Grabb the data
+			foreach ($this->gym_modules_acp[$mode][$module]['info']['actions'] as $module_action ) {
+				if (!empty($this->gym_modules_acp[$mode][$module][$module_action]['display_vars']['vars'])) {
+					$var_key = $mode . '_' . $module . '_' . $module_action . '_reset';
+					$this->new_config[$var_key] = 0;
+					$display_vars['vars'][$var_key] = array('lang' => strtoupper($var_key), 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true);
+				}
+			}
+		}
+		$display_vars['vars']['legend' . $i] = 'GYM_RESET_ALL';
+		$i++;
+		$display_vars['vars']['reset_all'] = array('lang' => 'GYM_RESET_ALL', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true);
+		return $display_vars;
+	}
+	/**
+	* gym_maintenance( $mode, $module, $action, $submit = false )
+	* handle cache (data + module's cache) clearing
+	*/
+	function gym_maintenance( $mode, $module, $action, $submit = false ) {
+		global $user, $phpbb_root_path, $phpEx;
+		$post_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : array();
+		$this->new_config['cache_action'] = $cache_action = isset($post_array['cache_action']) ? $post_array['cache_action'] : 'all';
+		$this->new_config['acp_modules'] = $acp_modules = isset($post_array['acp_modules']) ? $post_array['acp_modules'] : false;
+		unset($post_array);
+		$regexes = array( 'all' => '[a-z0-9_-]+', 'google' => 'google_', 'rss' => 'rss_', /*'html' => 'html_', 'yahoo' => 'yahoo_'*/);
+
+		$cache_dir = $phpbb_root_path . 'gym_sitemaps/cache/';
+		$cache_regex = $style_regex = $regexes['all'];
+		if ($cache_action == 'all') {
+			if ($mode != 'main') {
+				$cache_regex = $style_regex = $mode . '_';
+			}
+		} else {
+			if ($mode != 'main') { // we are at the output type level
+				$cache_regex = $style_regex = $mode . '_';
+				$cache_regex .= $cache_action . '_';
+			} else { // At the global level, we only can delete complete output type cache at once
+				$cache_regex = isset($regexes[$cache_action]) ? $regexes[$cache_action] : $regexes['all'];
+
+			}
+		}
+		if ($submit) {
+			$message = '';
+			if ($acp_modules) {
+				$this->remove_cache('acp', $cache_action);
+				$message = $user->lang['MODULE_CACHE_CLEARED'] . '<br/><br/>';
+			}
+			$accessed = false;
+			$deleted = '';
+			$res = opendir($cache_dir);
+			if($res) {
+				$num_del = 0;
+				while(($file = readdir($res))) {
+					// includes CSS and XSL cache
+					if(preg_match('`^(style_' . $style_regex . '|' . $cache_regex . ')[a-z0-9_-]+\.(xml|xml\.gz|css|xsl)$`i', $file)) {
+						@unlink($cache_dir . $file);
+						$deleted .=  "<li>$file</li>";
+						$num_del++;
+					}
+				}
+				$accessed = true;
+			}
+			closedir($res);
+			if ($accessed) {
+				if ($deleted !='') {
+					$message .= $user->lang['GYM_CACHE_CLEARED'] . $cache_dir . '<br/><br/>';
+					$message .= '<div align="left">' . $user->lang['GYM_FILE_CLEARED'] . " $num_del<ul>$deleted</ul></div>";
+				} else {
+					$message .= $user->lang['GYM_CACHE_ACCESSED'] . $cache_dir;
+				}
+			} else {
+				$message .= $user->lang['GYM_CACHE_NOT_CLEARED'] . $cache_dir;
+			}
+			trigger_error($message . $this->back_to_prev());
+		}
+		// Clear cache type
+		if ($mode === 'main') {
+			$cache_actions = array( 'gym' => $user->lang['ALL'], 'google' => $user->lang['GOOGLE'], 'rss' => $user->lang['RSS'], /*'yahoo' => $user->lang['YAHOO'], 'html' => $user->lang['HTML']*/);
+		} else {
+			$cache_actions = array();
+			foreach ($this->gym_modules[$mode] as $mode_module) {
+				if ($mode_module === 'main') {
+					if ($module !== 'main') {
+						continue;
+					}
+					$mode_module = 'all';
+				}
+				if (!empty($this->gym_modules_acp[$mode][$mode_module]['info']['lang_file'])) {
+					$user->add_lang('gym_sitemaps/acp/' . $this->gym_modules_acp[$mode][$mode_module]['info']['lang_file']);
+				}
+				$cache_actions[$mode_module] = $this->safe_lang(strtoupper($mode . '_' . $mode_module . '_reset'));
+			}
+		}
+		$this->gym_modules_acp[$this->mode][$this->module][$this->action]['select']['cache_action'] = $cache_actions;
+		// Adjust language variable a bit
+		$user->lang['GYM_MODULE_MAINTENANCE'] = sprintf($user->lang['GYM_CLEAR_CACHE'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_MODULE_MAINTENANCE_EXPLAIN'] = sprintf($user->lang['GYM_MODULE_MAINTENANCE_EXPLAIN'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_CLEAR_CACHE'] = sprintf($user->lang['GYM_CLEAR_CACHE'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_CLEAR_CACHE_EXPLAIN'] = sprintf($user->lang['GYM_CLEAR_CACHE_EXPLAIN'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_CLEAR_ACP_CACHE'] = sprintf($user->lang['GYM_CLEAR_ACP_CACHE'], $user->lang[strtoupper($mode)] );
+		$user->lang['GYM_CLEAR_ACP_CACHE_EXPLAIN'] = sprintf($user->lang['GYM_CLEAR_ACP_CACHE_EXPLAIN'], $user->lang[strtoupper($mode)] );
+		$display_vars = array( 'title'	=> 'GYM_MODULE_MAINTENANCE',
+			'vars'	=> array(
+				'legend1'	=> 'GYM_MODULE_MAINTENANCE',
+				'cache_action'	=> array('lang' => 'GYM_CLEAR_CACHE','validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true,),
+				'acp_modules' => array('lang' => 'GYM_CLEAR_ACP_CACHE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true),
+			),
+		);
+		return $display_vars;
+	}
+	/**
+	* is_overriden($mode, $module, $action, $config_key, $vars)
+	* tell if an option is overriden
+	*/
+	function is_overriden($mode, $module, $action, $config_key, $vars) {
+		global $user;
+		static $override_msg = array();
+		if (empty($override_msg)) {
+			$override_msg = array( OVERRIDE_GLOBAL => 'GYM_OVERRIDED_GLOBAL', OVERRIDE_OTYPE => 'GYM_OVERRIDED_OTYPE', OVERRIDE_MODULE => 'GYM_OVERRIDED_MODULE');
+		}
+		// Define overrides if needed
+		if (empty($this->override[$mode][$module])) {
+			foreach ($this->override_type as $_type) {
+				$this->override[$mode][$module][$_type] = $this->_set_override($mode, $module, $_type);
+			}
+			$this->override[$mode][$module][$mode] = $this->gym_config[$mode . '_override'];
+		}
+		$override = $overrided = $level = '';
+		if ($mode != 'main') {
+			// We are setting up an output type
+			if ($module != 'main') {
+				$option = str_replace($mode . "_$module" . '_', '', $config_key);
+				$level = OVERRIDE_MODULE;
+			} else { // we are setting up a module
+				$option = str_replace($mode . '_', '', $config_key);
+				$level = OVERRIDE_OTYPE;
+			}
+		} else { // Main level
+			$option = str_replace('gym_', '', $config_key);
+			$level = OVERRIDE_GLOBAL;
+		}
+		if (in_array($action, $this->override_type)) { // Main overrides
+			$override = $this->override[$mode][$module][$action];
+		} else {
+			$override = $this->override[$mode][$module][$mode];
+		}
+		$overrided = $this->_overriden_type($mode, $module, $option, $override, $level);
+		if ($overrided['override'] == $level) {
+			return '<br/><i style="color:green">' . $this->safe_lang('GYM_COULD_OVERRIDE') . '</i>';
+		} else {
+			$message = '';
+			// Check if we should show the value used
+			if ($overrided['used_value'] !== 'current') {
+				// Check var type
+				if ($vars['validate'] == 'bool') {
+					$message = $overrided['used_value'] ? $user->lang['YES'] : $user->lang['NO'];
+
+				} elseif (($vars['validate'] == 'int' || $vars['validate'] == 'string') && !@$vars['method'] == 'select_string') {
+					$message = htmlspecialchars($overrided['used_value']);
+					$message = $message == '' ? $user->lang['GYM_OVERRIDED_VALUE_NOTHING'] : $message;
+
+				} elseif (@$vars['method'] == 'select_string') {
+					$select_ary = $this->gym_modules_acp[$mode][$module][$action]['select'][$config_key];
+					$message = $this->safe_lang($select_ary[$overrided['used_value']]);
+				}
+			}
+			$message = !empty($message) ? '<br/>' . $user->lang['GYM_OVERRIDED_VALUE'] . $message : '';
+			return '<br/><i style="color:red">' . $this->safe_lang($override_msg[$overrided['override']]) . $message . '</i>';
+		}
+	}
+
+	/**
+	* _overriden_type()
+	* helper for is_overriden()
+	*/
+	function _overriden_type($mode, $module, $option, $override, $level ) {
+		// module level
+		if ( ($override == OVERRIDE_MODULE) && @isset($this->gym_config[$mode . "_$module" . "_$option"])) {
+			return array('override' => OVERRIDE_MODULE);
+		}
+		// Output type level
+		if ( $override != OVERRIDE_GLOBAL && @isset($this->gym_config[$mode . "_$option"])) {
+			return array('override' => OVERRIDE_OTYPE, 'used_value' => ($level != OVERRIDE_OTYPE ? $this->gym_config[$mode . "_$option"] : 'current' ) );
+		}
+		// Global level
+		if (isset($this->gym_config["gym_$option"])) {
+			return  array('override' => OVERRIDE_GLOBAL, 'used_value' => ($level != OVERRIDE_GLOBAL ? $this->gym_config["gym_$option"] : 'current' ) );
+		} elseif ( @isset($this->gym_config[$mode . "_$option"]) ) {
+			return  array('override' => OVERRIDE_OTYPE, 'used_value' => ($level != OVERRIDE_OTYPE ? $this->gym_config[$mode . "_$option"] : 'current' ) );
+		} elseif ( @isset($this->gym_config[$mode . "_$module" . "_$option"]) ) {
+			return  array('override' => OVERRIDE_MODULE, 'used_value' => ($level != OVERRIDE_MODULE ? $this->gym_config[$mode . "_$module" . "_$option"] : 'current' ) );
+		} else {
+			return null;
+		}
+	}
+	/**
+	* _set_override()
+	* helper for is_overriden()
+	*/
+	function _set_override($mode, $module, $type) {
+		$main_key = 'gym_override_' . $type;
+		$mode_key = $mode . '_override_' . $type;
+	//	$module_key = $module != 'main' ? $mode . '_' . $module . '_override_' . $type : 0;
+		if ($this->gym_config['gym_override']) {
+			return ($this->gym_config[$main_key] != OVERRIDE_GLOBAL)  ? ($this->gym_config[$mode_key] != OVERRIDE_GLOBAL ? $this->gym_config[$mode_key] : $this->gym_config[$main_key]) : OVERRIDE_GLOBAL;
+		} else {
+			return $this->gym_config[$mode_key];
+		}
+	}
+	/**
+	* safe_lang($lang_key)
+	* Safely set a lang key
+	*/
+	function safe_lang($lang_key) {
+		global $user;
+		return isset($user->lang[$lang_key]) ? $user->lang[$lang_key] : htmlspecialchars($lang_key);
+	}
+	/**
+	* back_to_prev()
+	* Generate back link for acp pages
+	*/
+	function back_to_prev() {
+		global $user;
+		return '<br /><br /><a href="' . $this->u_action . '&amp;maction=' . $this->maction . '&amp;action=' . $this->action . '&amp;module=' . $this->module . '">&laquo; ' . $user->lang['BACK_TO_PREV'] . '</a>';
+	}
+	/**
+	*  module_custom_select($value, $key) to grabb custom select function from modules
+	* In the $display_vars array :
+	* 'gym_config_key' => array('lang' => 'LANG_TITLE', 'validate' => 'int|bool|string', 'type' => 'custom', 'method' => 'module_custom_select', 'explain' => true),
+	* Will build the custom select unsing the module's select_gym_config_key($value, $key) method.
+	*/
+	function module_custom_select($value, $key) {
+		global $phpbb_root_path, $phpEx;
+		$method = 'select_' . $key;
+		$module_file = $phpbb_root_path . 'gym_sitemaps/acp/modules/' . $this->mode . '_' . $this->module . '.' . $phpEx;
+		if ( file_exists($module_file) ) {
+			include_once($module_file);
+			if (class_exists($module_class)) {
+				$gym_module = new $module_class($this);
+				if ( method_exists($gym_module, $method)) {
+					return $gym_module->$method($value, $key);
+				}
+			}
+		}
+		// Error
+	}
+	/**
+	*  select_multiple_string($value, $key) custom select string
+	*/
+	function select_multiple_string($value, $key) {
+		$select_ary = $this->gym_modules_acp[$this->mode][$this->module][$this->action]['select'][$key];
+		$size = min(12,count($select_ary));
+		$html = '<select multiple="multiple" id="' . $key . '" name="multiple_' . $key . '[]" size="' . $size . '">';
+		foreach ($select_ary as $sel_key => $sel_data) {
+			if (empty($sel_data['disabled'])) {
+				$selected = @array_search($sel_key, @$this->new_config[$key]) !== false ? 'selected="selected"' : '';
+				$disabled = '';
+			} else {
+				$disabled = 'disabled="disabled" class="disabled-option"';
+				$selected = '';
+			}
+			$sel_title = $sel_data['title'];
+			$html .= "<option value=\"$sel_key\" $disabled $selected>$sel_title</option>";
+		}
+		return $html . '</select>';
+	}
+	/**
+	*  select_string($value, $key) custom select string
+	*/
+	function select_string($value, $key) {
+		$select_ary = $this->gym_modules_acp[$this->mode][$this->module][$this->action]['select'][$key];
+		$html = '';
+		foreach ($select_ary as $sel_key => $sel_lang) {
+			$selected = ($sel_key == @$this->new_config[$key]) ? ' selected="selected"' : '';
+			$sel_title = $this->safe_lang($sel_lang);
+			$html .= '<option value="' . $sel_key . '"' . $selected . '>' . $sel_title . '</option>';
+		}
+		return $html;
+	}
+	/**
+	*  validate_num($value, $key, $num) validate num, 2.3255
+	*/
+	function validate_num($value, $key, $float = 1, $min = 0 , $max = 4) {
+		$float = $float > 0 ? (int) $float : 0;
+		$min = $min > 0 ? $min : 0;
+		$max = $max > 0 ? $max : 4;
+		$value = ($value >= $min && $value <= $max) ? $value : ($max/2);
+		$value = $float > 0 ? sprintf('%.' . $float . 'f', $value) : (int) $value;
+		return '<input id="' . $key . '" type="text" size="' . (strlen($max) + $float + 1) . '" maxlength="' . (strlen($max) + $float + 1) . '" name="config[' . $key . ']" value="' . $value . '" />';
+	}
+	/**
+	*  forum_select() // custom forum select setup
+	*/
+	function forum_select() {
+		if (empty($this->dyn_select['forums'])) {
+			$this->dyn_select['forums'] = make_forum_select(false, false, true, true, true, false, true);
+			foreach($this->dyn_select['forums'] as $f_id => $f_data) {
+				$this->dyn_select['forums'][$f_id] = array(
+					'title' => $f_data['padding'] . $f_data['forum_name'],
+					'disabled' => $f_data['disabled'],
+				);
+			}
+		}
+	}
+	/**
+	* clear_all_cache()
+	* Clears all the gym sitemaps cache ( acp modules, module lists and config )
+	*/
+	function clear_all_cache($option = '') {
+		global $phpbb_root_path, $phpEx, $acm_type, $cache;
+		if ($acm_type !== 'file') {
+			// Apparently, we cannot loop through cached variable using cache class in such case, purge all for now
+			$cache->purge();
+			return;
+		}
+		$dir = opendir( $cache->cache_dir );
+		$action_from_file = '';
+		while( ($file = @readdir($dir)) !== false ) {
+			if(preg_match('`^data_gym_' . $option . '[a-z0-9_-]+\.' . $phpEx . '$`i', $file)) {
+				@unlink($cache->cache_dir . $file);
+			}
+		}
+		@closedir($dir);
+		return;
+	}
+	/**
+	* remove_cache($cache_type, $file_type)
+	* Removes/unlinks config cache file(s)
+	*/
+	function remove_cache($type = 'config', $mode = '') {
+		global $phpbb_root_path, $phpEx, $acm_type;
+		if ($type == 'all' || $acm_type !== 'file') {
+			$this->clear_all_cache();
+			return;
+		}
+		$RegEx = ($type === 'config') ? '(config|links|auth)' : '';
+		$RegEx .= (!empty($mode) && in_array($mode, $this->modes) ? "_$mode" : '');
+		$this->clear_all_cache($RegEx);
+		return;
+	}
+	/**
+	*  set_phpbb_seo_links Builds links to support threads
+	*/
+	function set_phpbb_seo_links() {
+		global $config, $user, $template;
+		$this->support_link['links_en'] = array( 'release' =>  'http://www.phpbb-seo.com/en/gym-sitemaps-rss/google-yahoo-msn-sitemaps-rss-t2734.html', 'support' =>  'http://www.phpbb-seo.com/en/gym-sitemaps-rss/', 'seo_forum' =>  'http://www.phpbb-seo.com/en/', 'subscribe' => 'http://www.phpbb-seo.com/en/gym-sitemaps-rss/google-yahoo-msn-sitemaps-rss-t2734.html' );
+		$this->support_link['links_fr'] = array( 'release' =>  'http://www.phpbb-seo.com/fr/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-t3136.html', 'support' =>  'http://www.phpbb-seo.com/fr/gym-sitemaps-rss/', 'seo_forum' =>  'http://www.phpbb-seo.com/fr/', 'subscribe' => 'http://www.phpbb-seo.com/fr/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-t3136.html' );
+		if (strpos($config['default_lang'], 'fr') !== false ) {
+			$this->support_link['release'] = $this->support_link['links_fr']['release'];
+			$this->support_link['support'] = $this->support_link['links_fr']['support'];
+			$this->support_link['seo_forum'] = $this->support_link['links_fr']['seo_forum'];
+			$this->support_link['subscribe'] = $this->support_link['links_fr']['subscribe'];
+		} else {
+			$this->support_link['release'] = $this->support_link['links_en']['release'];
+			$this->support_link['support'] = $this->support_link['links_en']['support'];
+			$this->support_link['seo_forum'] = $this->support_link['links_en']['seo_forum'];
+			$this->support_link['subscribe'] = $this->support_link['links_en']['subscribe'];
+		}
+		$this->support_link['register'] = $this->support_link['seo_forum'] . 'profile.php?mode=register';
+		$this->support_link['update_msg'] = sprintf($user->lang['ACP_SEO_REGISTER_MSG'], sprintf($user->lang['ACP_SEO_REGISTER_TITLE'],$this->support_link['register'] ), sprintf($user->lang['ACP_SEO_REGISTER_UPDATE'], $this->support_link['subscribe'] ) );
+		$user->lang['TRANSLATION_INFO'] .= '<br/><a href="http://www.phpbb-seo.com/" title="' . ( strpos($config['default_lang'], 'fr') !== false  ?  'Optimisation du R&eacute;f&eacute;rencement' : 'Search Engine Optimization') . '">phpBB SEO</a>';
+		$this->support_link['release_full'] = '<a href="' . $this->support_link['release'] . '" title="' . $user->lang['ACP_SEO_RELEASE_THREAD'] . '">' . $user->lang['ACP_SEO_RELEASE_THREAD'] . '</a>';
+		$this->support_link['support_full'] = '<a href="' . $this->support_link['support'] . '" title="' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '">' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '</a>';
+		$this->support_link['seo_forum_full'] = '<a href="' . $this->support_link['seo_forum'] . '" title ="phpBB SEO">phpBB SEO</a>';
+		$template->assign_vars(array(
+			'SUPPORT_LINKS' => '<p>' . $this->support_link['release_full'] . '&nbsp;&bull;&nbsp;' . $this->support_link['support_full'] . '&nbsp;&bull;&nbsp;' . $this->support_link['seo_forum_full'] . '</p>',
+			)
+		);
+		if ($this->mode === 'main' && $this->module === 'main' && $this->action === 'main') {
+			$user->lang['MAIN_MAIN_EXPLAIN'] = sprintf( $user->lang['MAIN_MAIN_EXPLAIN'], $this->support_link['release_full'], $this->support_link['support_full'], $this->support_link['seo_forum_full'], $this->support_link['update_msg'] );
+		}
+		return;
+	}
+	/**
+	*  check_scripts Validates GYM scripts (gymrss, sitemap & map) locations
+	*/
+	function check_scripts(&$error, &$cfg_array, $only_mode = '') {
+		global $phpbb_root_path, $phpEx, $user, $phpbb_seo, $phpbb_admin_path;
+		$allowed_protocols = array('http', 'https'/*, 'ftp', 'ftps'*/);
+		$error = is_array($error) ? $error : array();
+		// check file_get_contents availability
+		$file_get = function_exists('file_get_contents');
+		if (!$file_get) {
+			// file_get_contents is not available, we won't be able to check everything
+			// @TODO find out how (we won't thgouh an error just for this),
+			// and also if it would be useful, to warn user about this
+		}
+		$scripts = array(
+			'rss' => array('file' => 'gymrss',),
+			'google' => array('file' => 'sitemap',),
+			'html' => array('file' => 'map',),
+		);
+		$only_mode = $only_mode && isset($scripts[$only_mode]) ? $only_mode : false;
+		if ($only_mode) {
+			$scripts[$only_mode]['url_config'] = isset($cfg_array[$only_mode . '_url']) ? ($cfg_array[$only_mode . '_url'] = trim($cfg_array[$only_mode . '_url'], ' /') . '/') : '';
+			$scripts = array($only_mode => $scripts[$only_mode]);
+		} else {
+			foreach ($scripts as $k => $v) {
+				if (isset($cfg_array[$k . '_url'])) {
+					$scripts[$k]['url_config'] = isset($cfg_array[$k . '_url']) ? ($cfg_array[$k . '_url'] = trim($cfg_array[$k . '_url'], ' /') . '/') : '';
+				} else {
+					// do not check without a reference
+					unset($scripts[$k]);
+				}
+			}
+		}
+		// let's not show a warning for a proto matter (since they are dealt with runtime)
+		foreach ($scripts as $k => $v) {
+			$scripts[$k]['url_config'] = $scripts[$k]['url_config'] ? $phpbb_seo->sslify($scripts[$k]['url_config'], $phpbb_seo->ssl['use']) : '';
+		}
+		$phpbb_url_config_url = append_sid($phpbb_admin_path . "index.$phpEx", "i=board&amp;mode=server#force_server_vars");
+		// all script should be placed in the same domain as phpBB
+		$root_url = $phpbb_seo->seo_path['root_url'];
+		if (($root_url_parts = @parse_url($root_url)) === false || empty($root_url_parts['scheme']) || !in_array($root_url_parts['scheme'], $allowed_protocols) || empty($root_url_parts['host'])) {
+			// the root url as set is wrong in phpbb config
+			$error[] = sprintf($user->lang['GYM_WRONG_PHPBB_URL'], $phpbb_url_config_url);
+			return false;
+		}
+		// deal with paths
+		$phpbb_url = $phpbb_seo->seo_path['phpbb_url'];
+		// the path from domain root to phpBB
+		$phpbb_clean_root_path = $phpbb_seo->seo_path['phpbb_script'];
+		$phpbb_root_path_parts = trim($phpbb_clean_root_path, '/ ');
+		$phpbb_root_path_parts = $phpbb_root_path_parts ? explode('/', $phpbb_root_path_parts) : false;
+		$phpbb_root_path_levels = 0;
+		if ($phpbb_root_path_parts) {
+			// the number of sub directory starting from domain's root
+			$phpbb_root_path_levels = count($phpbb_root_path_parts);
+		}
+		// form here to domain's root and then to domains root to phpBB directory should be a way to hit common.php
+		// from phpBB to domain's root
+		$phpbb_test_path = str_repeat('../', $phpbb_root_path_levels);
+		// from domain's root to phpBB
+		$phpbb_test_path .= $phpbb_clean_root_path;
+		if (!file_exists($phpbb_root_path . $phpbb_test_path)) {
+			// the root url as set is wrong in phpbb config
+			$error[] = sprintf($user->lang['GYM_WRONG_PHPBB_URL'], $phpbb_url_config_url);
+			return false;
+		}
+		foreach ($scripts as $mode => $setup) {
+			$error[$mode] = '<h2>' . $user->lang[strtoupper($mode) . '_URL'] . '</h2>';
+			$url_config_url = append_sid($phpbb_admin_path . "index.$phpEx", "i=gym_sitemaps&amp;mode=$mode#{$mode}_url");
+			$script_file = $setup['file'] . ".$phpEx";
+			if (($url_parts = @parse_url($setup['url_config'])) === false || empty($root_url_parts['scheme']) || !in_array($root_url_parts['scheme'], $allowed_protocols) || empty($root_url_parts['host'])) {
+				// the scritp url is wrong
+				$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT_URL'], $user->lang[strtoupper($mode)], $script_file);
+				$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+				continue;
+			}
+			if (strpos($setup['url_config'], $root_url) === false ) {
+				// the script domain is wrong
+				$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT_DOMAIN'], $user->lang[strtoupper($mode)], $root_url, $script_file);
+				$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+				continue;
+			}
+			// current gym script is configured in the phpBB domain
+			// let's check paths, start with something simple
+			if (strpos($setup['url_config'], $phpbb_url) !== false ) {
+				// script is (well should be) inside phpBB directory
+				$script_path = str_replace($phpbb_url, '', $setup['url_config']);
+				// if this is a sitemap, it would be wrong to put it within a sub directory inside the phpBB directory
+				if ($mode === 'google') {
+					if ($script_path) {
+						// sitemap is not usable for phpBB in there
+						$error[] = sprintf($user->lang['GYM_WRONG_SITEMAP_LOCATION'], $phpbb_url . $script_path, $root_url . $phpbb_clean_root_path);
+						$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+						continue;
+					}
+				}
+				if (file_exists($phpbb_root_path . $script_path . $script_file)) {
+					// the script is where it should
+					if ($file_get) {
+						// let's go further and check $phpbb_root_path in the script
+						if ($content = @file_get_contents($phpbb_root_path . $script_path . $script_file)) {
+							// expected pattern : $phpbb_root_path = './(some/thing/|../)';
+							if (preg_match('`^[\s]*\$phpbb_root_path[\s]*\=[\s]*(\'|")([a-z0-9_\./-]+)\1[\s]*\;[\s]*$`im', $content, $match)) {
+								// we have a match
+								$file_phpbb_root_path = $match[2];
+								unset($match, $content);
+								// since we're here inside phpBB directory
+								$file_phpbb_root_path_valid = $file_phpbb_root_path === './' . $script_path ? true : false;
+								if (!$file_phpbb_root_path_valid) {
+									// file_phpbb_root_path is not valid
+									$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT2_PHPBB'], $user->lang[strtoupper($mode)], $phpbb_url . $script_path, $script_file, './' . $script_path);
+									$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+									continue;
+								}
+							}
+						}
+					}
+				} else {
+					// the script is not located where the config claims it is
+					$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT_URL'], $user->lang[strtoupper($mode)], $script_file);
+					$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+					continue;
+				}
+
+			} else {
+				// The script is (well should be) somewhere outside the phpBB directory
+				$script_path = str_replace($root_url, '', $setup['url_config']);
+				$script_path_parts = trim($script_path, '/ ');
+				$script_path_parts = $script_path_parts ? explode('/', $script_path_parts) : false;
+				$script_path_levels = 0;
+				if ($script_path_parts) {
+					// the number of sub directory starting from domain's root
+					$script_path_levels = count($script_path_parts);
+				}
+				// path from here to the script
+				// from phpBB to root
+				$path_from_phpbb = str_repeat('../', $phpbb_root_path_levels);
+				// from root to script
+				$path_from_phpbb .= $script_path;
+				// and from adm
+				$path_from_here = $phpbb_root_path . $path_from_phpbb;
+				// if this is a sitemap, it would be wrong to put it where it would not be useful
+				// Example : example.com/phpBB/ or example.com/ with example.com/dir/sitemap.php
+				if ($mode === 'google') {
+					if ($script_path_levels > 1) {
+						// we are not in domain's root where everything is always ok
+						$script_path_is_ok = true;
+						if (!$phpbb_root_path_levels) {
+							// for sure, this is wrong
+							$script_path_is_ok = false;
+						} else {
+							// $script_path_parts should be < $phpbb_root_path_parts
+							if ($script_path_levels < $phpbb_root_path_levels) {
+								// check if path is ok, $phpbb_clean_root_path must contain $script_path
+								foreach ($script_path_parts as $k => $v) {
+									// must match all the way
+									if ($v !== $phpbb_root_path_parts[$k]) {
+										$script_path_is_ok = false;
+										break;
+									}
+								}
+							} else {
+								// script path configured is deeper than phpBB one
+								$script_path_is_ok = false;
+							}
+						}
+						if (!$script_path_is_ok) {
+							// sitemap is not usable for phpBB in there
+							$error[] = sprintf($user->lang['GYM_WRONG_SITEMAP_LOCATION'], $phpbb_url . $script_path, $root_url . $phpbb_clean_root_path);
+							$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+							continue;
+						}
+					}
+				}
+				if (file_exists($path_from_here . $script_file)) {
+					// the script is where it should
+					if ($file_get) {
+						// let's go further and check $phpbb_root_path in the script
+						if ($content = @file_get_contents($path_from_here . $script_file)) {
+							// expected pattern : $phpbb_root_path = './(some/thing/|../)';
+							if (preg_match('`^[\s]*\$phpbb_root_path[\s]*\=[\s]*(\'|")([a-z0-9_\./-]+)\1[\s]*\;[\s]*$`im', $content, $match)) {
+								// we have a match
+								$file_phpbb_root_path = $match[2];
+								unset($match, $content);
+								// expected path
+								// we need to filter any common parts in paths
+								// eg for the *wierd* example.com/dir/phpBB/ with example.com/dir/otherdir/script.php case,
+								// $phpbb_root_path should not go all the way to domain's root in script.php
+								if ($phpbb_root_path_levels > 1 && $script_path_levels > 1) {
+									if ($phpbb_root_path_parts[0] == $script_path_parts[0]) {
+										// these two indeed share some parts
+										$_phpbb_root_path_parts = $phpbb_root_path_parts;
+										$_script_path_parts = $script_path_parts;
+										foreach ($_phpbb_root_path_parts as $k => $v) {
+											if ($v == $_script_path_parts[$k]) {
+												unset($_phpbb_root_path_parts[$k], $_script_path_parts[$k]);
+											} else {
+												break;
+											}
+										}
+										// since the script can only be outside phpBB directory here
+										$_script_path_levels = count($_script_path_parts);
+										$_phpbb_root_path_parts = count($_phpbb_root_path_parts);
+										// from script to first common dir
+										$path_from_script = str_repeat('../', $_script_path_levels);
+										// and from first common dir to phpBB
+										$path_from_script .= trim(implode('/', $_phpbb_root_path_parts), ' /') . '/';
+										$file_phpbb_root_path_valid = $file_phpbb_root_path === './' . $path_from_script ? true : false;
+										if (!$file_phpbb_root_path_valid) {
+											// file_phpbb_root_path is not valid
+											$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT2_PHPBB'], $user->lang[strtoupper($mode)], $root_url . $script_path, $script_file, './' . $path_from_script);
+											$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+											continue;
+										}
+										// we're done here
+										continue;
+									}
+								}
+								// so we do not share paths ...
+								// from script to root
+								$path_from_script = str_repeat('../', $script_path_levels);
+								// and from root to phpBB
+								$path_from_script .= $phpbb_clean_root_path;
+								$file_phpbb_root_path_valid = $file_phpbb_root_path === './' . $path_from_script ? true : false;
+								if (!$file_phpbb_root_path_valid) {
+									// file_phpbb_root_path is not valid
+									$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT2_PHPBB'], $user->lang[strtoupper($mode)], $root_url . $script_path, $script_file, './' . $path_from_script);
+									$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+									continue;
+								}
+							}
+						}
+					}
+				} else {
+					// the script is not located where the config claims it is
+					$error[] = sprintf($user->lang['GYM_WRONG_SCRIPT_URL'], $user->lang[strtoupper($mode)], $script_file);
+					$error[] = sprintf($user->lang['GYM_GO_CONFIG_SCRIPT_URL'], $user->lang[strtoupper($mode) . '_URL'], $url_config_url);
+					continue;
+				}
+			}
+			// if we reach here, no error where found, unset the title
+			unset($error[$mode]);
+		}
+	}
+	/**
+	*  check_cache_folder Validates the cache folder status
+	*/
+	function check_cache_folder($cache_dir, $msg = true) {
+		global $user;
+		$exists = $write = false;
+		$cache_msg = '';
+		$cache_dir = rtrim($cache_dir, '/');
+		if (file_exists($cache_dir) && is_dir($cache_dir)) {
+			$exists = true;
+			if (!is_writeable($cache_dir)) {
+				phpbb_chmod($cache_dir, CHMOD_READ | CHMOD_WRITE);
+				$fp = @fopen($cache_dir . 'test_lock', 'wb');
+				if ($fp !== false) {
+					$write = true;
+				}
+				@fclose($fp);
+				@unlink($phpbb_root_path . $dir . 'test_lock');
+			} else {
+				$write = true;
+			}
+		}
+		if ($msg) {
+			$exists = ($exists) ? '<b style="color:green">' . $user->lang['SEO_CACHE_FOUND'] . '</b>' : '<b style="color:red">' . $user->lang['SEO_CACHE_NOT_FOUND'] . '</b>';
+			$write = ($write) ? '<br/> <b style="color:green">' . $user->lang['SEO_CACHE_WRITABLE'] . '</b>' : (($exists) ? '<br/> <b style="color:red">' . $user->lang['SEO_CACHE_UNWRITABLE'] . '</b>' : '');
+			$cache_msg = sprintf($user->lang['SEO_CACHE_STATUS'], $cache_dir) . '<br/>' . $exists . $write;
+			return '<br/><br/><b>' . $user->lang['SEO_CACHE_FILE_TITLE'] . ':</b><ul>' . $cache_msg . '</ul><br/>';
+		} else {
+			return ($exists && $write);
+		}
+	}
+} // End of acp class
+?>
\ No newline at end of file
Index: includes/acp/acp_phpbb_seo.php
===================================================================
--- includes/acp/acp_phpbb_seo.php	(phpBB 3.0.8)
+++ includes/acp/acp_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,1140 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: acp_phpbb_seo.php 277 2010-11-25 12:09:02Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+/**
+* phpBB_SEO Class
+* www.phpBB-SEO.com
+* @package Ultimate SEO URL phpBB SEO
+*/
+class acp_phpbb_seo {
+	var $u_action;
+	var $new_config = array();
+	var $dyn_select = array();
+	var $forum_ids = array();
+	var $array_type_cfg = array();
+	var $multiple_options = array();
+	var $modrtype_lang = array();
+	var $write_type = 'forum';
+	var $lengh_limit = 20;
+	var $word_limit = 3;
+	var $seo_unset_opts = array();
+
+	function main($id, $mode) {
+		global $config, $db, $user, $auth, $template, $cache;
+		global $phpbb_root_path, $phpbb_admin_path, $phpEx, $table_prefix, $phpbb_seo;
+		// Start the phpbb_seo class
+		if ( empty($phpbb_seo) ) {
+			include_once($phpbb_root_path . 'phpbb_seo/phpbb_seo_class.' . $phpEx);
+			$phpbb_seo = new phpbb_seo();
+		}
+		$user->add_lang('mods/acp_phpbb_seo');
+		$action	= request_var('action', '');
+		$submit = (isset($_POST['submit'])) ? true : false;
+		$form_key = 'acp_board';
+		add_form_key($form_key);
+		$display_vars = array();
+		// --> Zero Dupe
+		if (@isset($phpbb_seo->seo_opt['zero_dupe']) ) {
+			$this->multiple_options['zero_dupe']['post_redir_values'] = array('off' => 'off', 'post' => 'post', 'guest' => 'guest', 'all' => 'all'); // do not change
+			$this->multiple_options['zero_dupe']['post_redir_lang'] = array('off' => $user->lang['ACP_ZERO_DUPE_OFF'], 'post' => $user->lang['ACP_ZERO_DUPE_MSG'], 'guest' => $user->lang['ACP_ZERO_DUPE_GUEST'], 'all' => $user->lang['ACP_ZERO_DUPE_ALL']); // do not change
+		}
+		// <-- Mod rewrite selector
+		if ($phpbb_seo->modrtype == 1) {
+			$this->seo_unset_opts = array('cache_layer', 'rem_ids');
+		} elseif (!$phpbb_seo->seo_opt['cache_layer']) {
+			$this->seo_unset_opts = array('rem_ids');
+		}
+		$this->modrtype_lang = $this->set_phpbb_seo_links();
+		$this->multiple_options['modrtype_lang'] = $this->modrtype_lang['titles'];
+		if (@isset($phpbb_seo->seo_opt['modrtype']) ) {
+			$this->multiple_options['modrtype_values'] = array( 1 => 1, 2 => 2, 3 => 3 ); // do not change;
+		}
+		// <-- Mod rewrite selector
+		foreach ( $this->seo_unset_opts as $opt ) {
+			if ( $optkey = array_search($opt, $phpbb_seo->cache_config['dynamic_options']) ) {
+				unset($phpbb_seo->cache_config['dynamic_options'][$optkey]);
+			}
+		}
+		// We need shorter URLs with Virtual Folder Trick
+		if ($phpbb_seo->seo_opt['virtual_folder']) {
+			$this->lengh_limit = 20;
+			$this->word_limit = 3;
+		} else {
+			$this->lengh_limit = 30;
+			$this->word_limit = 5;
+		}
+		$related_installed = false;
+		switch ($mode) {
+			case 'settings':
+				$this->write_type = 'forum';
+				$display_vars['title'] = 'ACP_PHPBB_SEO_CLASS';
+				$user->lang['ACP_PHPBB_SEO_CLASS_EXPLAIN'] = sprintf($user->lang['ACP_PHPBB_SEO_CLASS_EXPLAIN'], $this->modrtype_lang['ulink'], $this->modrtype_lang['uforumlink'], '</p><hr/><p><b>' . $user->lang['ACP_PHPBB_SEO_MODE'] . ' : ' . $this->modrtype_lang['link'] . ' - ' . $phpbb_seo->version . ' ( ' . $this->modrtype_lang['forumlink'] . ' )</b></p><hr/><p>');
+				$display_vars['vars'] = array();
+				$i = 2;
+				$display_vars['vars']['legend1'] = 'ACP_PHPBB_SEO_CLASS';
+				foreach($phpbb_seo->cache_config['dynamic_options'] as $optionname => $optionvalue) {
+					if ( @is_bool($phpbb_seo->seo_opt[$optionvalue]) ) {
+						if ($optionvalue == 'virtual_root' && !$phpbb_seo->seo_path['phpbb_script']) {
+							continue;
+						}
+						$display_vars['vars'][$optionvalue] = array('lang' => $optionvalue, 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'lang_explain' => $optionvalue . '_explain');
+						$this->new_config[$optionvalue] = $phpbb_seo->seo_opt[$optionvalue];
+					} elseif ( @isset($this->multiple_options[$optionvalue . '_values']) ) {
+						$this->dyn_select[$optionvalue] = $this->multiple_options[$optionvalue . '_values'];
+						$display_vars['vars'][$optionvalue] = array('lang' => $optionvalue, 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'lang_explain' => $optionvalue . '_explain');
+						$this->new_config[$optionvalue] = $phpbb_seo->seo_opt[$optionvalue];
+					} elseif ( is_array($optionvalue)) {
+						$display_vars['vars']['legend' . $i] = $optionname;
+						$i++;
+						foreach ($optionvalue as $key => $value) {
+							$this->array_type_cfg[$optionname . '_' . $key] = array('main' => $optionname, 'sub' => $key);
+							if ( is_bool($value) ) {
+								$display_vars['vars'][$optionname . '_' . $key] = array('lang' => $optionname . '_' . $key, 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'lang_explain' => $optionname . '_' . $key . '_explain');
+								$this->new_config[$optionname . '_' . $key] = $phpbb_seo->seo_opt[$optionname][$key];
+							} elseif ( @isset($this->multiple_options[$optionname][$key . '_values'] )) {
+  								$this->dyn_select[$optionname . '_' . $key] = $this->multiple_options[$optionname][$key . '_values'];
+								$display_vars['vars'][$optionname . '_' . $key] = array('lang' => $optionname . '_' . $key, 'validate' => 'string', 'type' => 'select', 'method' => 'select_string', 'explain' => true, 'lang_explain' => $optionname . '_' . $key . '_explain');
+								$this->new_config[$optionname . '_' . $key] = $phpbb_seo->seo_opt[$optionname][$key];
+							} else {
+								$display_vars['vars'][$optionname . '_' . $key] = array('lang' => $optionname . '_' . $key, 'validate' => 'string:0:50', 'type' => 'text:50:50', 'explain' => true, 'lang_explain' => $optionname . '_' . $key . '_explain');
+								$this->new_config[$optionname . '_' . $key] = $phpbb_seo->seo_opt[$optionname][$key];
+							}
+
+						}
+					}
+				}
+				break;
+			case 'forum_url':
+				// used for cache
+				$this->write_type = 'forum';
+				$forbidden = array($phpbb_seo->seo_static['forum'], $phpbb_seo->seo_static['global_announce'], $phpbb_seo->seo_static['user'], $phpbb_seo->seo_static['topic'], $phpbb_seo->seo_static['atopic'], $phpbb_seo->seo_static['utopic'], $phpbb_seo->seo_static['leaders'], $phpbb_seo->seo_static['post'], $phpbb_seo->seo_static['group'], $phpbb_seo->seo_static['npost'], $phpbb_seo->seo_static['index']);
+				if ( $phpbb_seo->modrtype == 1 || !$phpbb_seo->seo_opt['cache_layer'] ) {
+					trigger_error($user->lang['ACP_NO_FORUM_URL'] . preg_replace('`(&amp;|&|\?)mode=forum_url`i', '', adm_back_link($this->u_action)));
+					break;
+				}
+				$display_vars['title'] = 'ACP_FORUM_URL';
+				$user->lang['ACP_FORUM_URL_EXPLAIN'] .= '</p><hr/><p><b>' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' : ' . $this->modrtype_lang['link'] . ' - ' . $phpbb_seo->version . ' ( ' . $this->modrtype_lang['forumlink'] . ' )</b></p><hr/><p>';
+				$display_vars['vars'] = array();
+				$display_vars['vars']['legend1'] = 'ACP_FORUM_URL';
+				$sql = "SELECT forum_id, forum_name
+					FROM " . FORUMS_TABLE . "
+					ORDER BY left_id ASC";
+				$result = $db->sql_query($sql);
+				$forum_url_title = $error_cust = '';
+				while( $row = $db->sql_fetchrow($result) ) {
+					$this->forum_ids[$row['forum_id']] = $row['forum_name'];
+				}
+				$db->sql_freeresult($result);
+				// take care of deleted forums
+				foreach ($phpbb_seo->cache_config['forum'] as $fid => $null) {
+					if (!isset($this->forum_ids[$fid])) {
+						unset($phpbb_seo->cache_config['forum'][$fid]);
+					}
+				}
+				foreach ($this->forum_ids as $forum_id => $forum_name) {
+					$error_cust = '';
+					// Is the URL cached already ?
+					if ( empty($phpbb_seo->cache_config['forum'][$forum_id]) ) {
+						// Suggest the one from the title
+						$forum_url_title = $phpbb_seo->format_url($forum_name, $phpbb_seo->seo_static['forum']);
+						if (!in_array($forum_url_title, $forbidden)) {
+							if (array_search($forum_url_title, $phpbb_seo->cache_config['forum'])) {
+								$this->new_config['forum_url' . $forum_id] = $forum_url_title .  $phpbb_seo->seo_delim['forum'] . $forum_id;
+								$error_cust = '<li>&nbsp;' . sprintf($user->lang['SEO_ADVICE_DUPE'], $forum_url_title) . '</li>';
+							} else {
+								$this->new_config['forum_url' . $forum_id] = $forum_url_title . (@$phpbb_seo->cache_config['settings']['rem_ids'] ? '': $phpbb_seo->seo_delim['forum'] . $forum_id);
+			}
+						} else {
+							$this->new_config['forum_url' . $forum_id] = $forum_url_title . $phpbb_seo->seo_delim['forum'] . $forum_id;
+							$error_cust = '<li>&nbsp;' . sprintf($user->lang['SEO_ADVICE_RESERVED'], $forum_url_title) . '</li>';
+						}
+						$title = '<b style="color:red">' . $forum_name . ' - ID ' . $forum_id . '</b>';
+						$status_msg = '<b style="color:red">' . $user->lang['SEO_CACHE_URL_NOT_OK'] . '</b>';
+						$status_msg .= '<br/><span style="color:red">' . $user->lang['SEO_CACHE_URL'] . '&nbsp;:</span>&nbsp;' . $this->new_config['forum_url' . $forum_id] . $phpbb_seo->seo_ext['forum'];
+						$display_vars['vars']['forum_url' . $forum_id] = array('lang' => $title, 'validate' => 'string', 'type' => 'custom', 'method' => 'forum_url_input', 'explain' => true, 'lang_explain_custom' => $status_msg, 'append' => $this->seo_advices($this->new_config['forum_url' . $forum_id], $forum_id,  false, $error_cust));
+					} else { // Cached
+						$this->new_config['forum_url' . $forum_id] = $phpbb_seo->cache_config['forum'][$forum_id];
+						$title = '<b style="color:green">' . $forum_name . ' - ID ' . $forum_id . '</b>';
+						$status_msg = '<span style="color:green">' . $user->lang['SEO_CACHE_URL_OK'] . '&nbsp;:</span>&nbsp;<b style="color:green">' . $this->new_config['forum_url' . $forum_id] . '</b>';
+						$status_msg .= '<br/><span style="color:green">' . $user->lang['SEO_CACHE_URL'] . '&nbsp;:</span>&nbsp;' . $this->new_config['forum_url' . $forum_id] . $phpbb_seo->seo_ext['forum'];
+						$display_vars['vars']['forum_url' . $forum_id] = array('lang' => $title, 'validate' => 'string:0:100', 'type' => 'custom', 'method' => 'forum_url_input', 'explain' => true, 'lang_explain_custom' => $status_msg,'append' => $this->seo_advices($this->new_config['forum_url' . $forum_id], $forum_id, true));
+					}
+				}
+				break;
+			case 'htaccess':
+				$this->write_type = 'htaccess';
+				$display_vars['title'] = 'ACP_HTACCESS';
+				$user->lang['ACP_HTACCESS_EXPLAIN'] .= '</p><hr/><p><b>' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' : ' . $this->modrtype_lang['link'] . ' - ' . $phpbb_seo->version . ' ( ' . $this->modrtype_lang['forumlink'] . ' )</b></p><p>';
+				$display_vars['vars'] = array();
+				$display_vars['vars']['legend1'] = 'ACP_HTACCESS';
+				$display_vars['vars']['save'] = array('lang' => 'SEO_HTACCESS_SAVE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,);
+				$display_vars['vars']['more_options'] = array('lang' => 'SEO_MORE_OPTION', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,);
+				$this->new_config['save'] = false;
+				$cfg_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : $this->new_config;
+				$this->new_config['more_options'] = isset($cfg_array['more_options']) ? $cfg_array['more_options'] : false;
+				$this->new_config['slash'] = isset($cfg_array['slash']) ? $cfg_array['slash'] : false;
+				$this->new_config['wslash'] = isset($cfg_array['wslash']) ? $cfg_array['wslash'] : false;
+				$this->new_config['rbase'] = isset($cfg_array['rbase']) ? $cfg_array['rbase'] : false;
+
+				if ($this->new_config['more_options']) {
+					$display_vars['vars']['slash'] = array('lang' => 'SEO_HTACCESS_SLASH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,);
+					$display_vars['vars']['wslash'] = array('lang' => 'SEO_HTACCESS_WSLASH', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,);
+					if ($phpbb_seo->seo_path['phpbb_script'] && !$phpbb_seo->seo_opt['virtual_root']) {
+						$display_vars['vars']['rbase'] = array('lang' => 'SEO_HTACCESS_RBASE', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true,);
+					}
+				}
+				// Dirty yet simple templating
+				$user->lang['ACP_HTACCESS_EXPLAIN'] .= $this->seo_htaccess();
+
+				break;
+			case 'extended':
+				$display_vars = array(
+					'title'	=> 'ACP_SEO_EXTENDED',
+					'vars'	=> array(
+						'legend1' => 'SEO_EXTERNAL_LINKS',
+						'seo_ext_links' => array('lang' => 'SEO_EXTERNAL_LINKS', 'validate' => 'bool', 'type' => 'radio:enabled_disabled', 'explain' => true, 'default' => 1),
+						'seo_ext_subdomain' => array('lang' => 'SEO_EXTERNAL_SUBDOMAIN', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'default' => 0),
+						'seo_ext_classes' =>  array('lang' => 'SEO_EXTERNAL_CLASSES', 'validate' => 'string', 'type' => 'text:25:150', 'explain' => true, 'default' => ''),
+					),
+				);
+				// Related topics
+				if (file_exists($phpbb_root_path . "phpbb_seo/phpbb_seo_related.$phpEx")) {
+					$related_installed = true;
+					$user->add_lang('mods/phpbb_seo_related_install');
+					$display_vars['vars'] += array(
+						'legend2' => 'RELATED_TOPICS',
+						'seo_related' => array('lang' => 'SEO_RELATED', 'validate' => 'bool', 'type' => 'radio:enabled_disabled', 'explain' => true, 'append' => !empty($config['seo_related']) ? '<br/>' . (!empty($config['seo_related_fulltext']) ? $user->lang['FULLTEXT_INSTALLED'] : $user->lang['FULLTEXT_NOT_INSTALLED']) : '', 'default' => 0),
+						'seo_related_check_ignore' => array('lang' => 'SEO_RELATED_CHECK_IGNORE', 'validate' => 'bool', 'type' => 'radio:enabled_disabled', 'explain' => true, 'default' => 0),
+						'seo_related_limit' => array('lang' => 'SEO_RELATED_LIMIT', 'validate' => 'int:2:25', 'type' => 'text:3:4', 'explain' => true, 'default' => 5),
+						'seo_related_allforums' => array('lang' => 'SEO_RELATED_ALLFORUMS', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'default' => 0),
+					);
+				}
+				// dynamic meta tag mod
+				if (class_exists('seo_meta')) {
+					$display_vars['vars'] += array(
+						'legend3' => 'SEO_META',
+						'seo_meta_title' =>  array('lang' => 'SEO_META_TITLE', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => $config['sitename']),
+						'seo_meta_desc' =>  array('lang' => 'SEO_META_DESC', 'validate' => 'string:0:225', 'type' => 'text:40:255', 'explain' => true, 'default' => $config['site_desc']),
+						'seo_meta_desc_limit' => array('lang' => 'SEO_META_DESC_LIMIT', 'validate' => 'int:5:40', 'type' => 'text:3:4', 'explain' => true, 'default' => 25),
+						'seo_meta_bbcode_filter' =>  array('lang' => 'SEO_META_BBCODE_FILTER', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => 'img|url|flash|code'),
+						'seo_meta_keywords' =>  array('lang' => 'SEO_META_KEYWORDS', 'validate' => 'string:0:225', 'type' => 'text:40:150', 'explain' => true, 'default' => $config['site_desc']),
+						'seo_meta_keywords_limit' => array('lang' => 'SEO_META_KEYWORDS_LIMIT', 'validate' => 'int:5:40', 'type' => 'text:3:4', 'explain' => true, 'default' => 15),
+						'seo_meta_min_len' => array('lang' => 'SEO_META_MIN_LEN', 'validate' => 'int:0:10', 'type' => 'text:3:4', 'explain' => true, 'default' => 2),
+						'seo_meta_check_ignore' => array('lang' => 'SEO_META_CHECK_IGNORE', 'validate' => 'bool', 'type' => 'radio:enabled_disabled', 'explain' => true, 'default' => 0),
+						'seo_meta_lang' =>  array('lang' => 'SEO_META_LANG', 'validate' => 'lang', 'type' => 'select', 'method' => 'language_select', 'params' => array('{CONFIG_VALUE}'), 'explain' => true,  'default' => $config['default_lang']),
+						'seo_meta_copy' =>  array('lang' => 'SEO_META_COPY', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => $config['sitename']),
+						'seo_meta_file_filter' =>  array('lang' => 'SEO_META_FILE_FILTER', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => 'ucp'),
+						'seo_meta_get_filter' =>  array('lang' => 'SEO_META_GET_FILTER', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => 'style,hilit,sid'),
+						'seo_meta_robots' =>  array('lang' => 'SEO_META_ROBOTS', 'validate' => 'string:0:225', 'type' => 'text:25:150', 'explain' => true, 'default' => 'index,follow'),
+						'seo_meta_noarchive' =>  array('lang' => 'SEO_META_NOARCHIVE', 'validate' => 'string:0:225', 'multiple_validate' => 'int', 'type' => 'custom', 'method' => 'select_multiple', 'params' => array('{CONFIG_VALUE}', '{KEY}', $this->forum_select()), 'explain' => true, 'default' => ''),
+					);
+				}
+				// Optimal title
+				if (isset($user->lang['Page'])) {
+					$display_vars['vars'] += array(
+						'legend4' => 'SEO_PAGE_TITLES',
+						'seo_append_sitename' =>  array('lang' => 'SEO_APPEND_SITENAME', 'validate' => 'bool', 'type' => 'radio:yes_no', 'explain' => true, 'default' => 0),
+					);
+				}
+				// install if necessary
+				foreach ($display_vars['vars'] as $config_name => $config_setup) {
+					if (strpos($config_name, 'legend') !== false) {
+						continue;
+					}
+					if (!isset($config[$config_name])) {
+						set_config($config_name, $config_setup['default']);
+						unset($display_vars['vars'][$config_name]['default']);
+					}
+				}
+				$this->new_config = $config;
+				break;
+			default:
+				trigger_error('NO_MODE', E_USER_ERROR);
+			break;
+		}
+		$error = array();
+		$seo_msg = array();
+		$cfg_array = (isset($_REQUEST['config'])) ? utf8_normalize_nfc(request_var('config', array('' => ''), true)) : $this->new_config;
+		if ($submit && !check_form_key($form_key)) {
+			$error[] = $user->lang['FORM_INVALID'];
+		}
+		// We validate the complete config if whished
+		validate_config_vars($display_vars['vars'], $cfg_array, $error);
+		// Do not write values if there is an error
+		if (!empty($error)) {
+			$submit = false;
+		}
+		$additional_notes = '';
+		// We go through the display_vars to make sure no one is trying to set variables he/she is not allowed to...
+		foreach ($display_vars['vars'] as $config_name => $cfg_setup) {
+			if ((!isset($cfg_array[$config_name]) && @$cfg_setup['method'] != 'select_multiple') || strpos($config_name, 'legend') !== false) {
+				continue;
+			}
+			// Handle multiple select options
+			if (!empty($cfg_setup['method']) && $cfg_setup['method'] == 'select_multiple') {
+				if (isset($_POST['multiple_' . $config_name])) {
+					$m_values = utf8_normalize_nfc(request_var('multiple_' . $config_name, array('' => '')));
+					$validate_int = !empty($cfg_setup['multiple_validate']) && $cfg_setup['multiple_validate'] == 'int' ? true : false;
+					foreach($m_values as $k => $v) {
+						if ($validate_int) {
+							$v = max(0, (int) $v);
+						}
+						if (empty($v)) {
+							unset($m_values[$k]);
+						} else {
+							$m_values[$k] = $v;
+						}
+					}
+					sort($m_values);
+					$this->new_config[$config_name] = $m_values;
+					$config_value = implode(',', $m_values);
+					if ( strlen($config_value) > 255 ) {
+						$error[] = sprintf($user->lang['SETTING_TOO_LONG'], $user->lang[$cfg_setup['lang']], 255);
+					}
+					$submit = empty($error);
+				} else {
+					if ($submit) {
+						$this->new_config[$config_name] = array();
+						$config_value = '';
+					} else {
+						$config_value = $this->new_config[$config_name];
+						$this->new_config[$config_name] = !empty($config_value) ? explode(',', $config_value) : array();
+					}
+				}
+			} else {
+				$this->new_config[$config_name] = $config_value = $cfg_array[$config_name];
+			}
+			if ($submit) {
+				// In case we deal with forum URLs
+				if ($mode == 'forum_url' && preg_match('`^forum_url([0-9]+)$`', $config_name, $matches)) {
+					// Check if this is an actual forum_id
+					if ( isset($this->forum_ids[$matches[1]]) ) {
+						$forum_id = intval($matches[1]);
+						$config_value = $phpbb_seo->format_url($config_value, $phpbb_seo->seo_static['forum']);
+						// Remove delim if required
+						while (preg_match('`^[a-z0-9_-]+' . $phpbb_seo->seo_delim['forum'] . '[0-9]+$`i', $config_value)) {
+							$config_value = preg_replace('`^([a-z0-9_-]+)' . $phpbb_seo->seo_delim['forum'] . '[0-9]+$`i', '\\1', $config_value);
+							if (@$phpbb_seo->cache_config['settings']['rem_ids']) {
+								$seo_msg['SEO_ADVICE_DELIM_REM'] = '<li>&nbsp;' . $user->lang['SEO_ADVICE_DELIM_REM'] . '</li>';
+							}
+						}
+						// Forums cannot end with the pagination param
+						while (preg_match('`^[a-z0-9_-]+' . $phpbb_seo->seo_delim['start'] . '[0-9]+$`i', $config_value)) {
+							$config_value = preg_replace('`^([a-z0-9_-]+)' . $phpbb_seo->seo_delim['start'] . '[0-9]+$`i', "\\1", $config_value);
+							$seo_msg['SEO_ADVICE_START'] = '<li>&nbsp;' . $user->lang['SEO_ADVICE_START'] . '</li>';
+						}
+						// Only update if the value is not a static one for forums
+						if (!in_array($config_value, $forbidden)) {
+							// and updated (sic)
+							if ($config_value != @$phpbb_seo->cache_config['forum'][$forum_id]) {
+								// and if not already set
+								if (!array_search($config_value, $phpbb_seo->cache_config['forum'])) {
+								$phpbb_seo->cache_config['forum'][$forum_id] = $config_value . (@$phpbb_seo->cache_config['settings']['rem_ids'] ? '': $phpbb_seo->seo_delim['forum'] . $forum_id);
+								} else {
+									$seo_msg['SEO_ADVICE_DUPE_' . $forum_id] = '<li>&nbsp;' . sprintf($user->lang['SEO_ADVICE_DUPE'], $config_value) . '</li>';
+								}
+							}
+						} else {
+							$seo_msg['SEO_ADVICE_RESERVED_' . $forum_id] = '<li>&nbsp;' . sprintf($user->lang['SEO_ADVICE_RESERVED'], $config_value) . '</li>';
+						}
+					}
+				} elseif ($mode == 'settings') {
+					if (isset($this->array_type_cfg[$config_name]) && isset($phpbb_seo->seo_opt[$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']])) {
+						if ( is_bool($phpbb_seo->seo_opt[$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']]) ) {
+							$phpbb_seo->cache_config['settings'][$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']] = ($config_value == 1) ? true : false;
+						} elseif (is_numeric($phpbb_seo->seo_opt[$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']])) {
+							$phpbb_seo->cache_config['settings'][$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']] = intval($config_value);
+						} elseif (is_string($phpbb_seo->seo_opt[$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']])) {
+							$phpbb_seo->cache_config['settings'][$this->array_type_cfg[$config_name]['main']][$this->array_type_cfg[$config_name]['sub']] = $config_value;
+						}
+					} elseif ( isset($phpbb_seo->seo_opt[$config_name]) ) {
+						if ( is_bool($phpbb_seo->seo_opt[$config_name]) ) {
+							$phpbb_seo->cache_config['settings'][$config_name] = ($config_value == 1) ? true : false;
+						} elseif ( is_numeric($phpbb_seo->seo_opt[$config_name]) ) {
+							$phpbb_seo->cache_config['settings'][$config_name] = intval($config_value);
+						} elseif ( is_string($phpbb_seo->seo_opt[$config_name]) ) {
+							$phpbb_seo->cache_config['settings'][$config_name] = $config_value;
+						}
+					}
+					// Let's make sure that the proper field was added to the topic table
+					if ($config_name === 'sql_rewrite' && $config_value == 1 && !$phpbb_seo->seo_opt['sql_rewrite']) {
+						if (!class_exists('phpbb_db_tools')) {
+							include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+						}
+						$db_tools = new phpbb_db_tools($db);
+						$db_tools->db->sql_return_on_error(true);
+						if (!$db_tools->sql_column_exists(TOPICS_TABLE, 'topic_url')) {
+							$db_tools->sql_column_add(TOPICS_TABLE, 'topic_url', array('VCHAR', ''));
+						}
+						$additional_notes = sprintf($user->lang['SYNC_TOPIC_URL_NOTE'], '<a href="' . $phpbb_seo->seo_path['phpbb_url'] . 'phpbb_seo/sync_url.' . $phpEx . '" onclick="window.open(this.href); return false;">', '</a>');
+						if ($db_tools->db->sql_error_triggered) {
+							$error[] = '<b>' . $user->lang['sql_rewrite'] . '</b> : ' . $user->lang['SEO_SQL_ERROR'] . ' [ ' . $db_tools->db->sql_layer . ' ] : ' . $db_tools->db->sql_error_returned['message'] . ' [' . $db_tools->db->sql_error_returned['code'] . ']' . '<br/>' . $user->lang['SEO_SQL_TRY_MANUALLY'] . '<br/>' . $db_tools->db->sql_error_sql;
+							$submit = false;
+						}
+						$db_tools->db->sql_return_on_error(false);
+					}
+					// Let's make sure the proper index is added for the no dupe (in case it is installed and activated)
+					if ($config_name === 'no_dupe_on' && $config_value == 1 && !$phpbb_seo->seo_opt['no_dupe']['on']) {
+						if (!class_exists('phpbb_db_tools')) {
+							include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+						}
+						// in case we already started the phpbb_db_tools class above
+						if (empty($db_tools)) {
+							$db_tools = new phpbb_db_tools($db);
+						}
+						$db_tools->db->sql_return_on_error(true);
+						$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+						$drop_index_name = 'topic_last_post_id';
+						$add_index_name = 'topic_lpid';
+						if (in_array($drop_index_name, $indexes)) {
+							$db_tools->sql_index_drop(TOPICS_TABLE, $drop_index_name);
+						}
+						if (!in_array($add_index_name, $indexes)) {
+							// Try to override some limits - maybe it helps some...
+							@set_time_limit(0);
+							@ini_set('memory_limit', '128M');
+							$db_tools->sql_create_index(TOPICS_TABLE, $add_index_name, array('topic_last_post_id'));
+						}
+						if ($db_tools->db->sql_error_triggered) {
+							$error[] = '<b>' . $user->lang['no_dupe'] . '</b> : ' . $user->lang['SEO_SQL_ERROR'] . ' [ ' . $db_tools->db->sql_layer . ' ] : ' . $db_tools->db->sql_error_returned['message'] . ' [' . $db_tools->db->sql_error_returned['code'] . ']' . '<br/>' . $user->lang['SEO_SQL_TRY_MANUALLY'] . '<br/>' . $db_tools->db->sql_error_sql;
+							$submit = false;
+						}
+						$db_tools->db->sql_return_on_error(false);
+					}
+				} elseif ($mode == 'extended') {
+					if ($related_installed && $config_name === 'seo_related') {
+						$fulltext = 0;
+						$nothing_to_do = false;
+						if ($db->sql_layer == 'mysql4' || $db->sql_layer == 'mysqli') {
+							$add = $remove = $alter = false;
+							if ($config_value && !$config['seo_related']) {
+								$alter = $add = true;
+							}
+							if (!$config_value && $config['seo_related']) {
+								$alter = $remove = true;
+							}
+							// let's go
+							if ($alter) {
+								// Try to override some limits - maybe it helps some...
+								@set_time_limit(0);
+								@ini_set('memory_limit', '128M');
+								// use db_tools to check the index
+								if (!class_exists('phpbb_db_tools')) {
+									include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+								}
+								if (empty($db_tools)) {
+									$db_tools = new phpbb_db_tools($db);
+								}
+								$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+								if (in_array('topic_tft', $indexes)) {
+									$nothing_to_do = $add ? true : false;
+									$fulltext = 1;
+								} else {
+									$nothing_to_do = $remove ? true : false;
+									$fulltext = 0;
+								}
+								// do not use db_tools since it does not support to add FullText indexes
+								if (!$nothing_to_do) {
+									// Here we use quite a basic approach to make sure that the index is not refused for bad reasons
+									if ($add) {
+										$sql = 'ALTER TABLE ' . TOPICS_TABLE . '
+											ADD FULLTEXT topic_tft (topic_title)';
+									} else {
+										$sql = 'ALTER TABLE ' . TOPICS_TABLE . '
+											DROP INDEX topic_tft';
+									}
+									$db->sql_return_on_error(true);
+									$db->sql_query($sql);
+									if ($db->sql_error_triggered) {
+										$error[] = '<b>' . $user->lang['RELATED_TOPICS'] . '</b> : ' . $user->lang['SEO_SQL_ERROR'] . ' [ ' . $db->sql_layer . ' ] : ' . $db->sql_error_returned['message'] . ' [' . $db->sql_error_returned['code'] . ']' . '<br/>' . $user->lang['SEO_SQL_TRY_MANUALLY'] . '<br/>' . $db->sql_error_sql;
+										$submit = false;
+										$config_value = 0;
+									}
+									// make *sure* about the index !
+									$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+									$fulltext = in_array('topic_tft', $indexes) ? 1 : 0;
+									$db->sql_return_on_error(false);
+								}
+							}
+						}
+						if ($alter) {
+							set_config('seo_related_fulltext', $fulltext);
+						}
+					}
+					set_config($config_name, $config_value);
+				}
+			}
+		}
+		if (sizeof($error)) {
+			$submit = false;
+		}
+		if ($submit) {
+			if ($mode == 'htaccess') {
+				if ($this->new_config['save']) {
+					$this->write_cache($this->write_type);
+					add_log('admin', 'SEO_LOG_CONFIG_' . strtoupper($mode));
+				}
+			} elseif ($mode == 'extended') {
+				add_log('admin', 'SEO_LOG_CONFIG_' . strtoupper($mode));
+				trigger_error($user->lang['CONFIG_UPDATED'] . adm_back_link($this->u_action));
+			} else {
+				if ( $this->write_cache($this->write_type) ) {
+					ksort($phpbb_seo->cache_config[$this->write_type]);
+					add_log('admin', 'SEO_LOG_CONFIG_' . strtoupper($mode));
+					$msg = !empty($seo_msg) ? '<br /><h1 style="color:red;text-align:left;">' . $user->lang['SEO_VALIDATE_INFO'] . '</h1><ul style="text-align:left;">' . implode(' ',$seo_msg) . '</ul><br />' : '';
+					global $msg_long_text;
+					$msg_long_text = $user->lang['SEO_CACHE_MSG_OK'] . $msg . adm_back_link($this->u_action);
+					if ($additional_notes) {
+						$msg_long_text .= "<br/><br/>$additional_notes";
+					}
+					trigger_error(false);
+				} else {
+					trigger_error($user->lang['SEO_CACHE_MSG_FAIL'] . adm_back_link($this->u_action));
+				}
+			}
+		}
+		$this->tpl_name = 'acp_board';
+		$this->page_title = $display_vars['title'];
+		$phpbb_seo->seo_end();
+		$l_title_explain = $user->lang[$display_vars['title'] . '_EXPLAIN'];
+		if ($mode != 'extended') {
+			$l_title_explain .= $mode == 'htaccess' ? '' : $this->check_cache_folder($phpbb_root_path . $phpbb_seo->seo_opt['cache_folder']);
+		}
+		$template->assign_vars(array(
+			'L_TITLE'			=> $user->lang[$display_vars['title']],
+			'L_TITLE_EXPLAIN'	=> $l_title_explain,
+
+			'S_ERROR'			=> (sizeof($error)) ? true : false,
+			'ERROR_MSG'			=> implode('<br />', $error),
+
+			'U_ACTION'			=> $this->u_action)
+		);
+		// Output relevant page
+		foreach ($display_vars['vars'] as $config_key => $vars) {
+			if (!is_array($vars) && strpos($config_key, 'legend') === false) {
+				continue;
+			}
+			if (strpos($config_key, 'legend') !== false) {
+				$template->assign_block_vars('options', array(
+					'S_LEGEND'		=> true,
+					'LEGEND'		=> (isset($user->lang[$vars])) ? $user->lang[$vars] : $vars)
+				);
+				continue;
+			}
+			$type = explode(':', $vars['type']);
+			$l_explain = '';
+			if ($vars['explain'] && isset($vars['lang_explain'])) {
+				$l_explain = (isset($user->lang[$vars['lang_explain']])) ? $user->lang[$vars['lang_explain']] : $vars['lang_explain'];
+			} elseif ($vars['explain'] && isset($vars['lang_explain_custom'])) {
+				$l_explain = $vars['lang_explain_custom'];
+			} elseif ($vars['explain']) {
+				$l_explain = (isset($user->lang[$vars['lang'] . '_EXPLAIN'])) ? $user->lang[$vars['lang'] . '_EXPLAIN'] : '';
+			}
+			$template->assign_block_vars('options', array(
+				'KEY'			=> $config_key,
+				'TITLE'			=> (isset($user->lang[$vars['lang']])) ? $user->lang[$vars['lang']] : $vars['lang'],
+				'S_EXPLAIN'		=> $vars['explain'],
+				'TITLE_EXPLAIN'	=> $l_explain,
+				'CONTENT'		=> build_cfg_template($type, $config_key, $this->new_config, $config_key, $vars),
+				)
+			);
+			unset($display_vars['vars'][$config_key]);
+		}
+	}
+	/**
+	*  forum_url_check validation
+	*/
+	function forum_url_input($value, $key) {
+		global $user, $phpbb_seo;
+
+		return '<input id="' . $key . '" type="text" size="40" maxlength="255" name="config[' . $key . ']" value="' . $value . '" /> ';
+	}
+	/**
+	*  select_string custom select string
+	*/
+	function select_string($value, $key) {
+		global $phpbb_seo;
+		$select_ary = $this->dyn_select[$key];
+		$html = '';
+		foreach ($select_ary as $sel_value) {
+			if ( @isset($this->array_type_cfg[$key]) ) {
+				$selected = ($sel_value == @$phpbb_seo->seo_opt[$this->array_type_cfg[$key]['main']][$this->array_type_cfg[$key]['sub']]) ? ' selected="selected"' : '';
+				$sel_title = @isset($this->multiple_options[$this->array_type_cfg[$key]['main']][$this->array_type_cfg[$key]['sub'] . '_lang'][$sel_value]) ? $this->multiple_options[$this->array_type_cfg[$key]['main']][$this->array_type_cfg[$key]['sub'] . '_lang'][$sel_value] : $sel_value;
+			} else {
+				$selected = ($sel_value == @$phpbb_seo->cache_config['settings'][$key]) ? ' selected="selected"' : '';
+				$sel_title = @isset($this->multiple_options[$key . '_lang'][$sel_value]) ? $this->multiple_options[$key . '_lang'][$sel_value] : $sel_value;
+			}
+			$html .= '<option value="' . $sel_value . '"' . $selected . '>' . $sel_title . '</option>';
+		}
+		return $html;
+	}
+	/**
+	*  seo_advices Always needed :-)
+	*/
+	function seo_advices($url, $forum_id, $cached = FALSE, $error_cust = '') {
+		global $phpbb_seo, $user;
+		$seo_advice = '';
+		// Check how well is the URL SEO wise
+		if ( !empty($error_cust) ) {
+			$seo_advice .= $error_cust;
+		}
+		if (strlen($url) > $this->lengh_limit) { // Size
+			$seo_advice .= '<li>&nbsp;' . $user->lang['SEO_ADVICE_LENGTH'] . '</li>';
+		}
+		if (preg_match('`^[a-z0-9_-]+' . $phpbb_seo->seo_delim['forum'] . '[0-9]+$`i', $url)) { // With delimiter and id
+			if (@$phpbb_seo->cache_config['settings']['rem_ids']) {
+				$seo_advice .= '<li style="color:red">&nbsp;' . $user->lang['SEO_ADVICE_DELIM'] . '</li>';
+			}
+		}
+		if ($phpbb_seo->seo_static['forum'] == $url) { // default
+			$seo_advice .= '<li>&nbsp;' . $user->lang['SEO_ADVICE_DEFAULT'] . '</li>';
+		}
+		// Check the number of word
+		$url_words = explode('-', $url);
+		if (count($url_words) > $this->word_limit) {
+			$seo_advice .= '<li>&nbsp;' . $user->lang['SEO_ADVICE_WORDS'] . '</li>';
+		}
+		return $seo_advice ? '<ul  style="color:red">' . $seo_advice . '</ul>' : '';
+	}
+	/**
+	*  seo_htaccess The evil one ;-)
+	*/
+	function seo_htaccess($html = true) {
+		global $phpbb_seo, $user, $error, $phpEx, $config, $phpbb_root_path, $config, $phpbb_admin_path;
+		static $htaccess_code = '';
+		$htaccess_tpl = '';
+		// GYM Sitemaps & RSS
+		$gym_installed = (boolean) (!empty($config['gym_installed']) && file_exists($phpbb_root_path . 'gym_sitemaps/includes/gym_sitemaps.' . $phpEx));
+		$rss_path = $google_path = $html_path = '';
+		$rss_commpat_note = $google_commpat_note = $html_commpat_note = $compat_path_note = '';
+		$rss_commpat_pre = $html_commpat_pre = $google_commpat_pre = '<b style="color:blue"># RewriteRule';
+		$rss_commpat_post = $html_commpat_post = $google_commpat_post = '</b>';
+		$google_comp_path = $rss_comp_path = $html_comp_path = false;
+		if ($gym_installed) {
+			$compat_path_note = '<b style="color:red"># NOTE : THE FOLLOWING REWRITERULE IS LEFT COMMENTED BECAUSE IT CANNOT' . "\n";
+			$compat_path_note .= '# BE IMPLEMENTED IN THIS .HTACCESS, BUT RATHER IN AN ABOVE ONE' . "\n";
+			$compat_path_note .= '# WITH PROPER SLASHES AND PATHS</b>' . "\n";
+			$rss_commpat_note = $google_commpat_note = $html_commpat_note = $compat_path_note;
+			require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+			obtain_gym_config('main', $gym_config);
+			$google_url = trim($gym_config['google_url'], '/') . '/';
+			if (utf8_strpos($google_url, $phpbb_seo->seo_path['phpbb_url']) !== false) {
+				$google_path = trim(str_replace($phpbb_seo->seo_path['root_url'], '', $google_url), '/');
+				$google_comp_path = true;
+				$google_commpat_pre = '<b style="color:green">RewriteRule</b>';
+				$google_commpat_post = $google_commpat_note = '';
+			}
+			$rss_url = trim($gym_config['rss_url'], '/') . '/';
+			if (utf8_strpos($rss_url, $phpbb_seo->seo_path['phpbb_url']) !== false) {
+				$rss_path = trim(str_replace($phpbb_seo->seo_path['root_url'], '', $rss_url), '/');
+				$rss_comp_path = true;
+				$rss_commpat_pre = '<b style="color:green">RewriteRule</b>';
+				$rss_commpat_post = $rss_commpat_note = '';
+			}
+			$html_url = trim($gym_config['html_url'], '/') . '/';
+			if (utf8_strpos($html_url, $phpbb_seo->seo_path['phpbb_url']) !== false) {
+				$html_path = trim(str_replace($phpbb_seo->seo_path['root_url'], '', $html_url), '/');
+				$html_comp_path = true;
+				$html_commpat_pre = '<b style="color:green">RewriteRule</b>';
+				$html_commpat_post = $html_commpat_note = '';
+			}
+		}
+		if ( empty($htaccess_code) ) {
+			// get mods .htaccess tpls
+			$mods_ht = $this->get_mods_ht();
+			$default_slash = '/';
+			$wierd_slash = '';
+			$phpbb_path = trim($phpbb_seo->seo_path['phpbb_script'], '/');
+			$show_rewritebase_opt = false;
+			$rewritebase = '';
+			$wierd_slash = $this->new_config['wslash'] ? '<b style="color:red">/</b>' : '';
+			$default_slash = $this->new_config['slash'] ? '' : '/';
+
+			if (!empty($phpbb_path )) {
+				$phpbb_path = $phpbb_path . '/';
+				if ($this->new_config['rbase']) {
+					$rewritebase = $phpbb_path;
+					$default_slash = $this->new_config['slash'] ? '/' : '';
+				}
+				$rewritebase = $this->new_config['rbase'] ? $phpbb_path : '';
+				$show_rewritebase_opt = $phpbb_seo->seo_opt['virtual_root'] ? false : true;
+			}
+			if (!empty($rewritebase)) {
+				$rss_path = trim(str_replace(trim($phpbb_path, '/'), '', $rss_path), '/');
+				$google_path = trim(str_replace(trim($phpbb_path, '/'), '', $google_path), '/');
+				$html_path = trim(str_replace(trim($phpbb_path, '/'), '', $html_path), '/');
+			}
+			$colors = array( 'color' => '<b style="color:%1$s">%2$s</b>',
+				'static' => '#A020F0',
+				'ext' => '#6A5ACD',
+				'delim' => '#FF00FF',
+			);
+			$tpl = array('paginpage' => '/?(<b style="color:' . $colors['static'] . '">%1$s</b>([0-9]+)<b style="color:' . $colors['ext'] . '">%2$s</b>)?',
+				'pagin' => '(<b style="color:' . $colors['delim'] . '">%1$s</b>([0-9]+))?<b style="color:' . $colors['ext'] . '">%2$s</b>',
+				'static' => sprintf($colors['color'] , $colors['static'], '%1$s'),
+				'ext' => sprintf($colors['color'] , $colors['ext'], '%1$s'),
+				'delim' => sprintf($colors['color'] , $colors['delim'], '%1$s'),
+			);
+			$modrtype = array( 1 => 'SIMPLE', 2 => 'MIXED', 1 => 'SIMPLE', 3 => 'ADVANCED', 'type' => intval($phpbb_seo->modrtype));
+			//
+			$htaccess_tpl = '<b style="color:blue"># Lines That should already be in your .htacess</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:brown">&lt;Files</b> <b style="color:#FF00FF">"config.{PHP_EX}"</b><b style="color:brown">&gt;</b>' . "\n";
+			$htaccess_tpl .= "\t" . 'Order Allow,Deny' . "\n";
+			$htaccess_tpl .= "\t" . 'Deny from All' . "\n";
+			$htaccess_tpl .= '<b style="color:brown">&lt;/Files&gt;</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:brown">&lt;Files</b> <b style="color:#FF00FF">"common.{PHP_EX}"</b><b style="color:brown">&gt;</b>' . "\n";
+			$htaccess_tpl .= "\t" . 'Order Allow,Deny' . "\n";
+			$htaccess_tpl .= "\t" . 'Deny from All' . "\n";
+			$htaccess_tpl .= '<b style="color:brown">&lt;/Files&gt;</b>' . "\n\n";
+			$htaccess_tpl .= '<b style="color:blue"># You may need to un-comment the following lines' . "\n";
+			$htaccess_tpl .= '# Options +FollowSymlinks' . "\n";
+			$htaccess_tpl .= '# To make sure that rewritten dir or file (/|.html) will not load dir.php in case it exist' . "\n";
+			$htaccess_tpl .= '# Options -MultiViews' . "\n";
+			$htaccess_tpl .= '# REMEBER YOU ONLY NEED TO STARD MOD REWRITE ONCE</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteEngine</b> <b style="color:#FF00FF">On</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># Uncomment the statement below if you want to make use of' . "\n";
+			$htaccess_tpl .= '# HTTP authentication and it does not already work.' . "\n";
+			$htaccess_tpl .= '# This could be required if you are for example using PHP via Apache CGI.' . "\n";
+			$htaccess_tpl .= '# RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># REWRITE BASE</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteBase</b> <b>/{REWRITEBASE}</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># HERE IS A GOOD PLACE TO FORCE CANONICAL DOMAIN</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># RewriteCond %{HTTP_HOST} !^' . str_replace(array('https://', 'http://', '.'), array('', '', '\\.'), trim($phpbb_seo->seo_path['root_url'], '/ ')) . '$ [NC]</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># RewriteRule ^(.*)$ ' . $phpbb_seo->seo_path['root_url'] . '{REWRITEBASE}$1 [QSA,L,R=301]</b>' . "\n\n";
+			$htaccess_tpl .= '<b style="color:blue"># DO NOT GO FURTHER IF THE REQUESTED FILE / DIR DOES EXISTS</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} -f' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} -d' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> . - [L]' . "\n";
+			$htaccess_tpl .= '<b style="color:blue">#####################################################' . "\n";
+			$htaccess_tpl .= '# PHPBB SEO REWRITE RULES ALL MODES' . "\n";
+			$htaccess_tpl .= '#####################################################' . "\n";
+			$htaccess_tpl .= '# AUTHOR : dcz www.phpbb-seo.com' . "\n";
+			$htaccess_tpl .= '# STARTED : 01/2006' . "\n";
+			$htaccess_tpl .= '#################################' . "\n";
+			$htaccess_tpl .= '# FORUMS PAGES' . "\n";
+			$htaccess_tpl .= '###############</b>' . "\n";
+			if (!empty($phpbb_seo->seo_static['index'])) {
+				$htaccess_tpl .= '<b style="color:blue"># FORUM INDEX</b>' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_INDEX}{EXT_INDEX}$ {DEFAULT_SLASH}{PHPBB_RPATH}index.{PHP_EX} [QSA,L,NC]' . "\n";
+			} else {
+				$htaccess_tpl .= '<b style="color:blue"># FORUM INDEX REWRITERULE WOULD STAND HERE IF USED. "forum" REQUIRES TO BE SET AS FORUM INDEX' . "\n";
+				$htaccess_tpl .= '# RewriteRule ^{WIERD_SLASH}{PHPBB_LPATH}<b style="color:#A020F0">forum</b>\.<b style="color:#6A5ACD">html</b>$ {DEFAULT_SLASH}{PHPBB_RPATH}index.{PHP_EX} [QSA,L,NC]</b>' . "\n";
+			}
+			$htaccess_common_tpl = '<b style="color:blue"># PHPBB FILES ALL MODES</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_FILE_INDEX}{DELIM_FILE}[a-z0-9_-]+{DELIM_FILE}({STATIC_THUMB}{DELIM_FILE})?([0-9]+)$ {DEFAULT_SLASH}{PHPBB_RPATH}download/file.{PHP_EX}?id=$2&amp;t=$1 [QSA,L,NC]' . "\n";
+			if ( $phpbb_seo->seo_opt['profile_noids'] ) {
+				$htaccess_common_tpl .= '<b style="color:blue"># PROFILES THROUGH USERNAME</b>' . "\n";
+				$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_USER}/([^/]+)/?$ {DEFAULT_SLASH}{PHPBB_RPATH}memberlist.{PHP_EX}?mode=viewprofile&amp;un=$1 [QSA,L,NC]' . "\n";
+				$htaccess_common_tpl .= '<b style="color:blue"># USER MESSAGES THROUGH USERNAME</b>' . "\n";
+				$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_USER}/([^/]+)/(topics|posts){USER_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?author=$1&amp;sr=$2&amp;start=$4 [QSA,L,NC]' . "\n";
+			} else {
+				$htaccess_common_tpl .= '<b style="color:blue"># PROFILES ALL MODES WITH ID</b>' . "\n";
+				$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}({STATIC_USER}|[a-z0-9_-]*{DELIM_USER})([0-9]+){EXT_USER}$ {DEFAULT_SLASH}{PHPBB_RPATH}memberlist.{PHP_EX}?mode=viewprofile&amp;u=$2 [QSA,L,NC]' . "\n";
+				$htaccess_common_tpl .= '<b style="color:blue"># USER MESSAGES ALL MODES WITH ID</b>' . "\n";
+				$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}({STATIC_USER}|[a-z0-9_-]*{DELIM_USER})([0-9]+){DELIM_SR}(topics|posts){USER_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?author_id=$2&amp;sr=$3&amp;start=$5 [QSA,L,NC]' . "\n";
+			}
+			$htaccess_common_tpl .= '<b style="color:blue"># GROUPS ALL MODES</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}({STATIC_GROUP}|[a-z0-9_-]*{DELIM_GROUP})([0-9]+){GROUP_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}memberlist.{PHP_EX}?mode=group&amp;g=$2&amp;start=$4 [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># POST</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_POST}([0-9]+){EXT_POST}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewtopic.{PHP_EX}?p=$1 [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># ACTIVE TOPICS</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_ATOPIC}{ATOPIC_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?search_id=active_topics&amp;start=$2&amp;sr=topics [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># UNANSWERED TOPICS</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_UTOPIC}{UTOPIC_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?search_id=unanswered&amp;start=$2&amp;sr=topics [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># NEW POSTS</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_NPOST}{NPOST_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?search_id=newposts&amp;start=$2&amp;sr=topics [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># UNREAD POSTS</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_URPOST}{URPOST_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}search.{PHP_EX}?search_id=unreadposts&amp;start=$2 [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># THE TEAM</b>' . "\n";
+			$htaccess_common_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_LEADERS}{EXT_LEADERS}$ {DEFAULT_SLASH}{PHPBB_RPATH}memberlist.{PHP_EX}?mode=leaders [QSA,L,NC]' . "\n";
+			$htaccess_common_tpl .= '<b style="color:blue"># HERE IS A GOOD PLACE TO ADD OTHER PHPBB RELATED REWRITERULES</b>' . "\n\n";
+			if ($gym_installed) {
+				$htaccess_common_tpl .= '<b style="color:blue">#####################################################' . "\n";
+				// RSS
+				$htaccess_common_tpl .= '# GYM Sitemaps &amp; RSS' . "\n";
+				$htaccess_common_tpl .= '# Global channels</b>' . "\n";
+				$htaccess_common_tpl .= $rss_commpat_note;
+				$htaccess_common_tpl .= $rss_commpat_pre . ' ^{WIERD_SLASH}{RSS_LPATH}rss(/(news)+)?(/(digest)+)?(/(short|long)+)?/?$ {DEFAULT_SLASH}{RSS_RPATH}gymrss.{PHP_EX}?channels&amp;$2&amp;$4&amp;$6 [QSA,L,NC]' . $rss_commpat_post . "\n";
+				// HTML
+				$htaccess_common_tpl .= '<b style="color:blue"># HTML Global news &amp; maps</b>' . "\n";
+				$htaccess_common_tpl .= $html_commpat_note;
+				$htaccess_common_tpl .= $html_commpat_pre . ' ^{WIERD_SLASH}{HTML_LPATH}(news|maps){PAGE_PAGINATION}$ {DEFAULT_SLASH}{HTML_RPATH}map.{PHP_EX}?$1&amp;start=$3 [QSA,L,NC]' . $html_commpat_post . "\n";
+				$htaccess_common_tpl .= '<b style="color:blue"># END GYM Sitemaps &amp; RSS' . "\n";
+				$htaccess_common_tpl .= '#####################################################</b>' . "\n\n";
+			}
+			// We now handle all modes at once (simple / mixed / advanced)
+			$htaccess_tpl .= '<b style="color:blue"># FORUM ALL MODES</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}({STATIC_FORUM}|[a-z0-9_-]*{DELIM_FORUM})([0-9]+){FORUM_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewforum.{PHP_EX}?f=$2&amp;start=$4 [QSA,L,NC]' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># TOPIC WITH VIRTUAL FOLDER ALL MODES</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}({STATIC_FORUM}|[a-z0-9_-]*{DELIM_FORUM})([0-9]+)/({STATIC_TOPIC}|[a-z0-9_-]*{DELIM_TOPIC})([0-9]+){TOPIC_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewtopic.{PHP_EX}?f=$2&amp;t=$4&amp;start=$6 [QSA,L,NC]' . "\n";
+		//	Not needed any more
+		//	$htaccess_tpl .= '<b style="color:blue"># GLOBAL ANNOUNCEMENTS WITH VIRTUAL FOLDER ALL MODES</b>' . "\n";
+		//	$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}{STATIC_GLOBAL_ANNOUNCE}{EXT_GLOBAL_ANNOUNCE}({STATIC_TOPIC}|[a-z0-9_-]*{DELIM_TOPIC})([0-9]+){TOPIC_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewtopic.{PHP_EX}?t=$2&amp;start=$4 [QSA,L,NC]' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># TOPIC WITHOUT FORUM ID &amp; DELIM ALL MODES</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}([a-z0-9_-]*)/?({STATIC_TOPIC}|[a-z0-9_-]*{DELIM_TOPIC})([0-9]+){TOPIC_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewtopic.{PHP_EX}?forum_uri=$1&amp;t=$3&amp;start=$5 [QSA,L,NC]' . "\n";
+			$htaccess_tpl .= $htaccess_common_tpl;
+			// mods .htaccess pos1
+			if (!empty($mods_ht['pos1'])) {
+				$htaccess_tpl .= $mods_ht['pos1'];
+			}
+			$htaccess_tpl .= '<b style="color:blue"># FORUM WITHOUT ID &amp; DELIM ALL MODES</b>' . "\n";
+			if ($phpbb_seo->seo_ext['forum'] != '/') {
+				$htaccess_tpl .= '<b style="color:blue"># THESE FOUR LINES MUST BE LOCATED AT THE END OF YOUR HTACCESS TO WORK PROPERLY</b>' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} !-f' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}([a-z0-9_-]+)(-([0-9]+)){EXT_FORUM}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewforum.{PHP_EX}?forum_uri=$1&amp;start=$3 [QSA,L,NC]' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} !-f' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}([a-z0-9_-]+){EXT_FORUM}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewforum.{PHP_EX}?forum_uri=$1 [QSA,L,NC]' . "\n";
+			} else {
+				$htaccess_tpl .= '<b style="color:blue"># THESE THREE LINES MUST BE LOCATED AT THE END OF YOUR HTACCESS TO WORK PROPERLY</b>' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} !-f' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteCond</b> %{REQUEST_FILENAME} !-d' . "\n";
+				$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_LPATH}([a-z0-9_-]+){FORUM_PAGINATION}$ {DEFAULT_SLASH}{PHPBB_RPATH}viewforum.{PHP_EX}?forum_uri=$1&amp;start=$3 [QSA,L,NC]' . "\n";
+			}
+			// fix for dumb clients unable to deal with base href
+			$htaccess_tpl .= '<b style="color:blue"># FIX RELATIVE PATHS : FILES</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_RPATH}.+/(style\.{PHP_EX}|ucp\.{PHP_EX}|mcp\.{PHP_EX}|faq\.{PHP_EX}|download/file.{PHP_EX})$ {DEFAULT_SLASH}{PHPBB_RPATH}$1 [QSA,L,NC,R=301]' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># FIX RELATIVE PATHS : IMAGES</b>' . "\n";
+			$htaccess_tpl .= '<b style="color:green">RewriteRule</b> ^{WIERD_SLASH}{PHPBB_RPATH}.+/(styles/.*|images/.*)/$ {DEFAULT_SLASH}{PHPBB_RPATH}$1 [QSA,L,NC,R=301]' . "\n";
+			$htaccess_tpl .= '<b style="color:blue"># END PHPBB PAGES' . "\n";
+			$htaccess_tpl .= '#####################################################</b>' . "\n\n";
+			// mods .htaccess pos2
+			if (!empty($mods_ht['pos2'])) {
+				$htaccess_tpl .= $mods_ht['pos2'];
+			}
+			if ($gym_installed) {
+				$htaccess_tpl .= '<b style="color:blue">#####################################################' . "\n";
+				$htaccess_tpl .= '# GYM Sitemaps &amp; RSS</b>' . "\n";
+				// HTML
+				$htaccess_tpl .= '<b style="color:blue"># HTML Module additional modes</b>' . "\n";
+				$htaccess_tpl .= $html_commpat_note;
+				$htaccess_tpl .= $html_commpat_pre . ' ^{WIERD_SLASH}{HTML_LPATH}(news|maps)/([a-z0-9_-]+)(/([a-z0-9_-]+))?{PAGE_PAGINATION}$ {DEFAULT_SLASH}{HTML_RPATH}map.{PHP_EX}?$2=$4&amp;$1&amp;start=$6 [QSA,L,NC]' . $html_commpat_post . "\n";
+				// RSS
+				$htaccess_tpl .= '<b style="color:blue"># Main feeds &amp; channels</b>' . "\n";
+				$htaccess_tpl .= $rss_commpat_note;
+				$htaccess_tpl .= $rss_commpat_pre . ' ^{WIERD_SLASH}{RSS_LPATH}rss(/(news)+)?(/(digest)+)?(/(short|long)+)?(/([a-z0-9_-]+))?/([a-z0-9_]+)\.xml(\.gz)?$ {DEFAULT_SLASH}{RSS_RPATH}gymrss.{PHP_EX}?$9=$8&amp;$2&amp;$4&amp;$6&amp;gzip=$10 [QSA,L,NC]' . $rss_commpat_post . "\n";
+				$htaccess_tpl .= '<b style="color:blue"># Module feeds</b>' . "\n";
+				$htaccess_tpl .= $rss_commpat_note;
+				$htaccess_tpl .= $rss_commpat_pre . ' ^{WIERD_SLASH}{RSS_LPATH}[a-z0-9_-]*-[a-z]{1,2}([0-9]+)(/(news)+)?(/(digest)+)?(/(short|long)+)?/([a-z0-9_]+)\.xml(\.gz)?$ {DEFAULT_SLASH}{RSS_RPATH}gymrss.{PHP_EX}?$8=$1&amp;$3&amp;$5&amp;$7&amp;gzip=$9 [QSA,L,NC]' . $rss_commpat_post . "\n";
+				$htaccess_tpl .= '<b style="color:blue"># Module feeds without ids</b>' . "\n";
+				$htaccess_tpl .= $rss_commpat_note;
+				$htaccess_tpl .= $rss_commpat_pre . ' ^{WIERD_SLASH}{RSS_LPATH}([a-z0-9_-]+)(/(news)+)?(/(digest)+)?(/(short|long)+)?/([a-z0-9_]+)\.xml(\.gz)?$ {DEFAULT_SLASH}{RSS_RPATH}gymrss.{PHP_EX}?nametoid=$1&amp;$3&amp;$5&amp;$7&amp;modulename=$8&amp;gzip=$9 [QSA,L,NC]' . $rss_commpat_post . "\n";
+				// Google
+				$htaccess_tpl .= '<b style="color:blue"># Google SitemapIndex</b>' . "\n";
+				$htaccess_tpl .= $google_commpat_note;
+				$htaccess_tpl .= $google_commpat_pre . ' ^{WIERD_SLASH}{GOOGLE_LPATH}sitemapindex\.xml(\.gz)?$ {DEFAULT_SLASH}{GOOGLE_RPATH}sitemap.{PHP_EX}?gzip=$1 [QSA,L,NC]' . $google_commpat_post . "\n";
+				$htaccess_tpl .= '<b style="color:blue"># Module cat sitemaps</b>' . "\n";
+				$htaccess_tpl .= $google_commpat_note;
+				$htaccess_tpl .= $google_commpat_pre . ' ^{WIERD_SLASH}{GOOGLE_LPATH}[a-z0-9_-]+-([a-z]{1,2})([0-9]+)\.xml(\.gz)?$ {DEFAULT_SLASH}{GOOGLE_RPATH}sitemap.{PHP_EX}?module_sep=$1&amp;module_sub=$2&amp;gzip=$3 [QSA,L,NC]' . $google_commpat_post . "\n";
+				$htaccess_tpl .= '<b style="color:blue"># Module sitemaps</b>' . "\n";
+				$htaccess_tpl .= $google_commpat_note;
+				$htaccess_tpl .= $google_commpat_pre . ' ^{WIERD_SLASH}{GOOGLE_LPATH}([a-z0-9_]+)-([a-z0-9_-]+)\.xml(\.gz)?$ {DEFAULT_SLASH}{GOOGLE_RPATH}sitemap.{PHP_EX}?$1=$2&amp;gzip=$3 [QSA,L,NC]' . $google_commpat_post . "\n";
+				$htaccess_tpl .= '<b style="color:blue"># END GYM Sitemaps &amp; RSS' . "\n";
+				$htaccess_tpl .= '#####################################################</b>' . "\n";
+			}
+
+			if (!empty($default_slash) && $this->new_config['more_options']) {
+				$default_slash = '<b style="color:red">' . $default_slash . '</b>';
+			}
+			// The tpl array
+			$htaccess_tpl_vars = array();
+
+			// handle the suffixes proper in the RegEx
+			// set up pagination reg ex
+			// set up ext bits
+			$seo_ext = array('pagination' => str_replace('.', '\\.', $phpbb_seo->seo_ext['pagination']));
+			$reg_ex_page = sprintf($tpl['paginpage'], $phpbb_seo->seo_static['pagination'], $seo_ext['pagination'] . ($seo_ext['pagination'] === '/' ? '?' : '') );
+			foreach ( $phpbb_seo->seo_ext as $type => $value) {
+				$seo_ext[$type] = str_replace('.', '\\.', $value);
+				$htaccess_tpl_vars['{' . strtoupper($type) . '_PAGINATION}'] = ($value === '/') ? $reg_ex_page : sprintf($tpl['pagin'], $phpbb_seo->seo_delim['start'], $seo_ext[$type]);
+				// use url/? to allow both url and url/ to work as expected
+				$htaccess_tpl_vars['{EXT_' . strtoupper($type) . '}'] = sprintf($tpl['ext'] , $seo_ext[$type]) . ($value === '/' ? '?' : '');
+
+			}
+			$htaccess_tpl_vars['{PAGE_PAGINATION}'] = $reg_ex_page;
+			// static bits
+			foreach ( $phpbb_seo->seo_static as $type => $value) {
+				if (!is_array($phpbb_seo->seo_static[$type])) {
+					$htaccess_tpl_vars['{STATIC_' . strtoupper($type) . '}'] = sprintf($tpl['static'] , $phpbb_seo->seo_static[$type]);
+				}
+			}
+			// delim bits
+			foreach ( $phpbb_seo->seo_delim as $type => $value) {
+				$htaccess_tpl_vars['{DELIM_' . strtoupper($type) . '}'] = sprintf($tpl['delim'] , $phpbb_seo->seo_delim[$type]);
+			}
+
+			// common .htaccess vars
+			$htaccess_tpl_vars += array(
+				'{REWRITEBASE}' => $rewritebase,
+				'{PHP_EX}' => $phpEx,
+				'{PHPBB_LPATH}' => ($this->new_config['rbase'] || $phpbb_seo->seo_opt['virtual_root']) ? '' : $phpbb_path,
+				'{PHPBB_RPATH}' => $this->new_config['rbase'] ? '' : $phpbb_path,
+				'{RSS_LPATH}' => $rss_path ? $rss_path . '/' : '',
+				'{RSS_RPATH}' => $rss_path ? $rss_path . '/' : '',
+				'{GOOGLE_LPATH}' => $google_path ? $google_path . '/' : '',
+				'{GOOGLE_RPATH}' => $google_path ? $google_path . '/' : '',
+				'{HTML_LPATH}' => $html_path ? $html_path . '/' : '',
+				'{HTML_RPATH}' => $html_path ? $html_path . '/' : '',
+				'{DEFAULT_SLASH}' => $default_slash,
+				'{WIERD_SLASH}' => $wierd_slash,
+				'{MOD_RTYPE}' => $modrtype[$modrtype['type']],
+			);
+			// Parse .htaccess
+			$htaccess_code = str_replace(array_keys($htaccess_tpl_vars), array_values($htaccess_tpl_vars), $htaccess_tpl);
+		} // else the .htaccess is already generated
+		if ( $html ) { // HTML output
+			$htaccess_output = "\n" . '<script type="text/javascript">' . "\n";
+			$htaccess_output .= '// <![CDATA[' . "\n";
+			$htaccess_output .= 'function selectCode(a) {' . "\n";
+			$htaccess_output .= "\t" . 'var e = a.parentNode.parentNode.getElementsByTagName(\'CODE\')[0]; // Get ID of code block' . "\n";
+			$htaccess_output .= "\t" . 'if (window.getSelection) { // Not IE' . "\n";
+			$htaccess_output .= "\t\t" . 'var s = window.getSelection();' . "\n";
+			$htaccess_output .= "\t\t" . 'if (s.setBaseAndExtent) { // Safari' . "\n";
+			$htaccess_output .= "\t\t\t" . 's.setBaseAndExtent(e, 0, e, e.innerText.length - 1);' . "\n";
+			$htaccess_output .= "\t\t" . '} else { // Firefox and Opera' . "\n";
+			$htaccess_output .= "\t\t\t" . 'var r = document.createRange();' . "\n";
+			$htaccess_output .= "\t\t\t" . 'r.selectNodeContents(e);' . "\n";
+			$htaccess_output .= "\t\t\t" . 's.removeAllRanges();' . "\n";
+			$htaccess_output .= "\t\t\t" . 's.addRange(r);' . "\n";
+			$htaccess_output .= "\t\t" . '}' . "\n";
+			$htaccess_output .= "\t" . '} else if (document.getSelection) { // Some older browsers' . "\n";
+			$htaccess_output .= "\t\t" . 'var s = document.getSelection();' . "\n";
+			$htaccess_output .= "\t\t" . 'var r = document.createRange();' . "\n";
+			$htaccess_output .= "\t\t" . 'r.selectNodeContents(e);' . "\n";
+			$htaccess_output .= "\t\t" . 's.removeAllRanges();' . "\n";
+			$htaccess_output .= "\t\t" . 's.addRange(r);' . "\n";
+			$htaccess_output .= "\t" . '} else if (document.selection) { // IE' . "\n";
+			$htaccess_output .= "\t\t" . 'var r = document.body.createTextRange();' . "\n";
+			$htaccess_output .= "\t\t" . 'r.moveToElementText(e);' . "\n";
+			$htaccess_output .= "\t\t" . 'r.select();' . "\n";
+			$htaccess_output .= "\t" . '}' . "\n";
+			$htaccess_output .= '}' . "\n";
+			$htaccess_output .= '// ]]>' . "\n";
+			$htaccess_output .= '</script>' . "\n";
+			// build location message
+			if ($show_rewritebase_opt && $this->new_config['rbase']) {
+				$msg_loc = sprintf($user->lang['SEO_HTACCESS_FOLDER_MSG'], '<em style="color:#000">' . $phpbb_seo->seo_path['phpbb_url'] . '</em>');
+			} else {
+				$msg_loc = sprintf($user->lang['SEO_HTACCESS_ROOT_MSG'], '<em style="color:#000">' . $phpbb_seo->seo_path['root_url'] . '</em>');
+			}
+			$htaccess_output .= '</p><div class="content"><hr/>' . "\n" . '<b style="color:red">&rArr;&nbsp;' . $msg_loc . '</b><br/><br/><hr/>' . "\n";
+			$htaccess_output .= '<b>.htaccess :&nbsp;<a href="#" onclick="dE(\'htaccess_code\',1); return false;">' . $user->lang['SEO_SHOW'] . '</a>&nbsp;/&nbsp;<a href="#" onclick="dE(\'htaccess_code\',-1); return false;">' . $user->lang['SEO_HIDE'] . '</a></b>' . "\n";
+			$htaccess_output .= '<div id="htaccess_code"><dl style="padding:5px;background-color:#FFFFFF;border:1px solid #d8d8d8;font-size:12px;"><dt style="border-bottom:1px solid #CCCCCC;margin-bottom:3px;font-weight:bold;display:block;">&nbsp;<a href="#" onclick="selectCode(this); return false;">' . $user->lang['SEO_SELECT_ALL'] . '</a></dt>' . "\n";
+			$htaccess_output .= '<dd ><code style="padding-top:5px;line-height:1.3em;color:#8b8b8b;font-weight:bold"><br/><br/>' . str_replace( "\n", '<br/>', $htaccess_code) . '</code></dd>' . "\n";
+			$htaccess_output .= '</dl>' . "\n";
+			$htaccess_output .= '<div style="padding:5px;margin-top:10px;background-color:#FFFFFF;border:1px solid #d8d8d8;font-size:12px;"><b>' . $user->lang['SEO_HTACCESS_CAPTION'] . ':</b><ul style="margin-left:30px;margin-top:10px;font-weight:bold;font-size:12px;">' . "\n";
+			$htaccess_output .= '<li style="color:blue">&nbsp;' . $user->lang['SEO_HTACCESS_CAPTION_COMMENT'] . '</li>' . "\n";
+			$htaccess_output .= '<li style="color:#A020F0">&nbsp;' . $user->lang['SEO_HTACCESS_CAPTION_STATIC'] . '</li>' . "\n";
+			$htaccess_output .= '<li style="color:#6A5ACD">&nbsp;' . $user->lang['SEO_HTACCESS_CAPTION_SUFFIX'] . '</li>' . "\n";
+			$htaccess_output .= '<li style="color:#FF00FF">&nbsp;' . $user->lang['SEO_HTACCESS_CAPTION_DELIM'] . '</li>' . "\n";
+			if ($this->new_config['more_options']) {
+				$htaccess_output .= '<li style="color:red">&nbsp;' . $user->lang['SEO_HTACCESS_CAPTION_SLASH'] . '</li>&nbsp;' . "\n";
+			}
+			$htaccess_output .= '</ul></div>' . "\n" . '</div></div><p>' . "\n";
+		} else { // File output
+			$htaccess_output = str_replace(array('&lt;', '&gt;', '&amp;'), array('<', '>', '&'), strip_tags($htaccess_code));
+		}
+		return $htaccess_output;
+	}
+	/**
+	*  get_mods_ht Get all mods htaccess tpls
+	*/
+	function get_mods_ht() {
+		global $phpEx, $config, $phpbb_root_path, $phpbb_seo;
+		$all_ht_tpl = array('pos1' => '', 'pos2' => '');
+		$path = $phpbb_root_path . 'phpbb_seo/includes/htmods';
+		if (!($dir = @opendir($path))) {
+			return false;
+		}
+		while( ($file = @readdir($dir)) !== false ) {
+			if (!trim($file, '. ')) {
+				continue;
+			}
+			if(preg_match('`^ht_([a-z0-9_-]+)\.' . $phpEx . '$`i', $file, $match)) {
+				$mode = $match[1];
+				$class = 'ht_' . $mode;
+				require_once("$path/$file");
+				$module = new $class();
+				if ($tpl = $module->get_tpl()) {
+					if (!empty($tpl['pos1'])) {
+						$all_ht_tpl['pos1'] .= $tpl['pos1'] . "\n";
+					}
+					if (!empty($tpl['pos2'])) {
+						$all_ht_tpl['pos2'] .= $tpl['pos2'] . "\n";
+					}
+				}
+			}
+		}
+		return !empty($all_ht_tpl['pos1']) || !empty($all_ht_tpl['pos2']) ? $all_ht_tpl : false;
+
+	}
+	/**
+	*  set_phpbb_seo_links Builds links to support threads
+	*/
+	function set_phpbb_seo_links() {
+		global $user, $phpbb_seo, $config;
+		$modrtype_lang = array();
+		$phpbb_seo->version = htmlspecialchars($phpbb_seo->version);
+		$phpbb_seo->modrtype = intval($phpbb_seo->modrtype);
+		if ($phpbb_seo->modrtype < 1 || $phpbb_seo->modrtype > 3) {
+			$phpbb_seo->modrtype = 1;
+		}
+		$modrtype_lang['titles'] = array( 1 => $user->lang['ACP_SEO_SIMPLE'], 2 =>  $user->lang['ACP_SEO_MIXED'], 3 =>  $user->lang['ACP_SEO_ADVANCED'], 'u' => $user->lang['ACP_ULTIMATE_SEO_URL']);
+		$modrtype_lang['title'] = $modrtype_lang['titles'][$phpbb_seo->modrtype];
+		$modrtype_lang['utitle'] = $modrtype_lang['titles']['u'];
+		$modrtype_lang['types'] = array( 1 => 'SIMPLE', 2 => 'MIXED', 1 => 'SIMPLE', 3 => 'ADVANCED');
+		$modrtype_lang['type'] = $modrtype_lang['types'][$phpbb_seo->modrtype];
+		$modrtype_lang['modrlinks_en'] = array( 1 =>  'http://www.phpbb-seo.com/en/simple-seo-url/simple-phpbb-seo-url-t1566.html', 2 =>  'http://www.phpbb-seo.com/en/mixed-seo-url/mixed-phpbb-seo-url-t1565.html', 3 =>  'http://www.phpbb-seo.com/en/advanced-seo-url/advanced-phpbb-seo-url-t1219.html', 'u' => 'http://www.phpbb-seo.com/en/phpbb-mod-rewrite/ultimate-seo-url-t4608.html' );
+		$modrtype_lang['modrlinks_fr'] = array( 1 =>  'http://www.phpbb-seo.com/fr/reecriture-url-simple/seo-url-phpbb-simple-t1945.html', 2 =>  'http://www.phpbb-seo.com/fr/reecriture-url-intermediaire/seo-url-intermediaire-t1946.html', 3 =>  'http://www.phpbb-seo.com/fr/reecriture-url-avancee/seo-url-phpbb-avance-t1501.html', 'u' => 'http://www.phpbb-seo.com/fr/mod-rewrite-phpbb/ultimate-seo-url-t4489.html' );
+		$modrtype_lang['modrforumlinks_en'] = array( 1 =>  'http://www.phpbb-seo.com/en/simple-seo-url/', 2 =>  'http://www.phpbb-seo.com/en/mixed-seo-url/', 3 =>  'http://www.phpbb-seo.com/en/advanced-seo-url/', 'u' => 'http://www.phpbb-seo.com/en/phpbb-mod-rewrite/' );
+		$modrtype_lang['modrforumlinks_fr'] = array( 1 =>  'http://www.phpbb-seo.com/fr/reecriture-url-simple/', 2 =>  'http://www.phpbb-seo.com/fr/reecriture-url-intermediaire/', 3 =>  'http://www.phpbb-seo.com/fr/reecriture-url-avancee/', 'u' => 'http://www.phpbb-seo.com/fr/mod-rewrite-phpbb/' );
+		if (strpos($config['default_lang'], 'fr') !== false ) {
+			$modrtype_lang['linkurl'] = $modrtype_lang['modrlinks_fr'][$phpbb_seo->modrtype];
+			$modrtype_lang['forumlinkurl'] = $modrtype_lang['modrforumlinks_fr'][$phpbb_seo->modrtype];
+			$modrtype_lang['ulinkurl'] = $modrtype_lang['modrlinks_fr']['u'];
+			$modrtype_lang['uforumlinkurl'] = $modrtype_lang['modrforumlinks_fr']['u'];
+		} else {
+			$modrtype_lang['linkurl'] = $modrtype_lang['modrlinks_en'][$phpbb_seo->modrtype];
+			$modrtype_lang['forumlinkurl'] = $modrtype_lang['modrforumlinks_en'][$phpbb_seo->modrtype];
+			$modrtype_lang['ulinkurl'] = $modrtype_lang['modrlinks_en']['u'];
+			$modrtype_lang['uforumlinkurl'] = $modrtype_lang['modrforumlinks_en']['u'];
+		}
+		$modrtype_lang['link'] = '<a href="' . $modrtype_lang['linkurl'] . '" title="' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' ' . $modrtype_lang['title'] . '" onclick="window.open(this.href); return false;"><b>' . $modrtype_lang['title'] . '</b></a>';
+		$modrtype_lang['forumlink'] = '<a href="' . $modrtype_lang['forumlinkurl'] . '" title="' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '" onclick="window.open(this.href); return false;"><b>' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '</b></a>';
+		$modrtype_lang['ulink'] = '<a href="' . $modrtype_lang['ulinkurl'] . '" title="' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' ' . $modrtype_lang['utitle'] . '" onclick="window.open(this.href); return false;"><b>' . $modrtype_lang['utitle'] . '</b></a>';
+		$modrtype_lang['uforumlink'] = '<a href="' . $modrtype_lang['uforumlinkurl'] . '" title="' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '" onclick="window.open(this.href); return false;"><b>' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '</b></a>';
+		return $modrtype_lang;
+	}
+	/**
+	*  check_cache_folder Validates the cache folder status
+	*/
+	function check_cache_folder($cache_dir, $msg = true) {
+		global $user, $phpEx;
+		$exists = $write = $inner_write = false;
+		$cache_msg = '';
+		if (file_exists($cache_dir) && is_dir($cache_dir)) {
+			$exists = true;
+			if (!is_writeable($cache_dir)) {
+				phpbb_chmod($cache_dir, CHMOD_READ | CHMOD_WRITE);
+				$fp = @fopen($cache_dir . 'test_lock', 'wb');
+				if ($fp !== false) {
+					$write = true;
+				}
+				@fclose($fp);
+				@unlink($phpbb_root_path . $dir . 'test_lock');
+			} else {
+				$write = true;
+			}
+			// check if the config cache file is here already and writeable
+			$check = $cache_dir . "phpbb_cache.$phpEx";
+			$checks = array("$check.old", "$check.current", "$cache_dir.htaccess", "$cache_dir.htaccess.old", "$cache_dir.htaccess.current");
+			// let's check all files
+			$inner_write = true;
+			foreach($checks as $check) {
+				if (file_exists($check)) {
+					if (!is_writeable($check)) {
+						$inner_write = false;
+						phpbb_chmod($check, CHMOD_READ | CHMOD_WRITE);
+						$fp = @fopen($check, 'wb');
+						if ($fp !== false) {
+							$inner_write = true;
+						}
+						@fclose($fp);
+					}
+				}
+			}
+		}
+		if ($msg) {
+			$exists = ($exists) ? '<b style="color:green">' . $user->lang['SEO_CACHE_FOUND'] . '</b>' : '<b style="color:red">' . $user->lang['SEO_CACHE_NOT_FOUND'] . '</b>';
+			$write = ($write) ? '<br/> <b style="color:green">' . $user->lang['SEO_CACHE_WRITABLE'] . '</b>' : (($exists) ? '<br/> <b style="color:red">' . $user->lang['SEO_CACHE_UNWRITABLE'] . '</b>' : '');
+			$inner_write = $inner_write ? '' : '<br/> <b style="color:red">' . $user->lang['SEO_CACHE_INNER_UNWRITABLE'] . '</b>';
+			$cache_msg = sprintf($user->lang['SEO_CACHE_STATUS'], $cache_dir) . '<br/>' . $exists . $write . $inner_write;
+			return '<br/><b>' . $user->lang['SEO_CACHE_FILE_TITLE'] . ':</b><br/>' . $cache_msg . '<br/><br/>';
+		} else {
+			return ($exists && $write);
+		}
+	}
+	/**
+	* write_cache( ) will write the cached file and keep backups.
+	*/
+	function write_cache( $type = 'forum' ) {
+		global $phpbb_seo;
+		if(!$phpbb_seo->cache_config['cache_enable'] || (!@is_array($phpbb_seo->cache_config[$type]) && $type != 'htaccess' ) || !array_key_exists($type, $phpbb_seo->cache_config['files'])) {
+			return FALSE;
+		}
+		$cache_tpl = '<'.'?php' . "\n" . '/**' . "\n" . '* phpBB_SEO Class' . "\n" . '* www.phpBB-SEO.com' . "\n" . '* @package Advanced phpBB3 SEO mod Rewrite' . "\n" . '*/' . "\n" . 'if (!defined(\'IN_PHPBB\')) {' . "\n\t" . 'exit;' . "\n" . '}' . "\n";
+		if ($type == 'forum') { // Add the phpbb_seo_config
+			$update = '$this->cache_config[\'settings\'] = ' . preg_replace('`[\s]+`', ' ', var_export($phpbb_seo->cache_config['settings'], true)) . ';'. "\n";
+			$update .= '$this->cache_config[\'forum\'] = ' . preg_replace('`[\s]+`', ' ', var_export($phpbb_seo->cache_config['forum'], true)) . ';'. "\n";
+			$update = $cache_tpl . $update . '?'.'>';
+		} elseif ($type == 'htaccess') { // .htaccess case
+			$update = $this->seo_htaccess(false);
+		} else { // Allow additional types
+			$update = '$this->cache_config[\'' . $type . '\'] = ' . preg_replace('`[\s]+`', ' ', var_export($phpbb_seo->cache_config[$type], true)) . ';'. "\n";
+			$update = $cache_tpl . $update . '?'.'>';
+		}
+		$file = SEO_CACHE_PATH . $phpbb_seo->cache_config['files'][$type];
+		// Keep a backup of the previous settings
+		@copy($file, $file . '.old');
+		$handle = @fopen($file, 'wb');
+		@fputs($handle, $update);
+		@fclose ($handle);
+		unset($update);
+		@umask(0000);
+		phpbb_chmod($file, CHMOD_READ | CHMOD_WRITE);
+		// Keep a backup of the current settings
+		@copy($file, $file . '.current');
+		return true;
+	}
+	/**
+	*  select_multiple($value, $key, $select_ary)
+	*/
+	function select_multiple($value, $key, $select_ary) {
+		$size = min(12,count($select_ary));
+		$html = '<select multiple="multiple" id="' . $key . '" name="multiple_' . $key . '[]" size="' . $size . '">';
+		foreach ($select_ary as $sel_key => $sel_data) {
+			if (empty($sel_data['disabled'])) {
+				$selected = array_search($sel_key, @$this->new_config[$key]) !== false ? 'selected="selected"' : '';
+				$disabled = '';
+			} else {
+				$disabled = 'disabled="disabled" class="disabled-option"';
+				$selected = '';
+			}
+			$sel_title = $sel_data['title'];
+			$html .= "<option value=\"$sel_key\" $disabled $selected>$sel_title</option>";
+		}
+		return $html . '</select>';
+	}
+	/**
+	*  forum_select() // custom forum select setup
+	*/
+	function forum_select($ignore_acl = true, $ignore_nonpost = false, $ignore_emptycat = false, $only_acl_post = false) {
+		$select_ary = make_forum_select(false, false, $ignore_acl, $ignore_nonpost, $ignore_emptycat, $only_acl_post, true);
+		foreach($select_ary as $f_id => $f_data) {
+			$select_ary[$f_id] = array(
+				'title' => $f_data['padding'] . $f_data['forum_name'],
+				'disabled' => $f_data['disabled'],
+			);
+		}
+		return $select_ary;
+	}
+	/**
+	* Pick a language, any language ... or no language
+	*/
+	function language_select($default = '') {
+		global $user;
+		return '<option value="">' . $user->lang['DISABLED'] . '</option>' . language_select($default);
+	}
+} // End of acp class
+?>
\ No newline at end of file
Index: includes/search/fulltext_native.php
===================================================================
--- includes/search/fulltext_native.php	(revision 1)
+++ includes/search/fulltext_native.php	(Premod 3.0.8)
@@ -1137,7 +1137,13 @@
 		// Split old and new post/subject to obtain array of 'words'
 		$split_text = $this->split_message($message);
 		$split_title = $this->split_message($subject);
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Enable search_ignore_words
+		$this->filter_nums($split_text);
+		$this->filter_nums($split_title);
+		$this->get_ignore_words();
+		$split_text = array_diff($split_text, $this->ignore_words);
+		$split_title = array_diff($split_title, $this->ignore_words);
+		// www.phpBB-SEO.com SEO TOOLKIT END - Enable search_ignore_words
 		$cur_words = array('post' => array(), 'title' => array());
 
 		$words = array();
@@ -1753,6 +1759,18 @@
 			'config'	=> array('fulltext_native_load_upd' => 'bool', 'fulltext_native_min_chars' => 'integer:0:255', 'fulltext_native_max_chars' => 'integer:0:255', 'fulltext_native_common_thres' => 'double:0:100')
 		);
 	}
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Enable search_ignore_words
+	/**
+	* Get rid of integers values in $input array
+	*/
+	function filter_nums(&$input) {
+		foreach ($input as $key => $word) {
+			if (preg_match('`^[0-9]+$`', $word)) {
+				unset($input[$key]);
+			}
+		}
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END - Enable search_ignore_words
 }
 
 ?>
\ No newline at end of file
Index: includes/functions_admin.php
===================================================================
--- includes/functions_admin.php	(revision 1)
+++ includes/functions_admin.php	(Premod 3.0.8)
@@ -3298,10 +3298,14 @@
 	{
 		$errstr = '';
 		$errno = 0;
-
-		$info = get_remote_file('version.phpbb.com', '/phpbb',
-				((defined('PHPBB_QA')) ? '30x_qa.txt' : '30x.txt'), $errstr, $errno);
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		global $config;
+		$url = 'www.phpbb-seo.com';
+		$dir = (strpos($config['default_lang'], 'fr') !== false ? '/fr' : '/en') . '/updatecheck';
+		$info = get_remote_file($url, $dir, ((defined('PHPBB_SEO_QA')) ? 'test_30x.txt' : 'premod_30x.txt'), $errstr, $errno);
+		//$info = get_remote_file('version.phpbb.com', '/phpbb',
+		//		((defined('PHPBB_QA')) ? '30x_qa.txt' : '30x.txt'), $errstr, $errno);
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		if ($info === false)
 		{
 			$cache->destroy('versioncheck');
Index: includes/session.php
===================================================================
--- includes/session.php	(revision 1)
+++ includes/session.php	(Premod 3.0.8)
@@ -619,12 +619,16 @@
 		}
 		else
 		{
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			// This part will be fixed in 3.0.9 (see http://tracker.phpbb.com/browse/PHPBB3-9908)
+			// But as is or updated, it will not mix well with USU and Zero Duplicate (which already removes them)
 			// Bot user, if they have a SID in the Request URI we need to get rid of it
 			// otherwise they'll index this page with the SID, duplicate content oh my!
-			if (isset($_GET['sid']))
+			/*if (isset($_GET['sid']))
 			{
 				redirect(build_url(array('sid')));
-			}
+			}*/
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			$this->data['session_last_visit'] = $this->time_now;
 		}
 
Index: includes/functions_display.php
===================================================================
--- includes/functions_display.php	(revision 1)
+++ includes/functions_display.php	(Premod 3.0.8)
@@ -23,7 +23,9 @@
 {
 	global $db, $auth, $user, $template;
 	global $phpbb_root_path, $phpEx, $config;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	$forum_rows = $subforums = $forum_ids = $forum_ids_moderator = $forum_moderators = $active_forum_ary = array();
 	$parent_id = $visible_forums = 0;
 	$sql_from = '';
@@ -87,7 +89,15 @@
 
 		$sql_array['SELECT'] .= ', fa.user_id';
 	}
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+	if (@$phpbb_seo->seo_opt['no_dupe']['on']) {
+		$sql_array['SELECT'] .= ', t.topic_id, t.topic_title, t.topic_replies, t.topic_replies_real, t.topic_status, t.topic_type, t.topic_moved_id' . (!empty($phpbb_seo->seo_opt['sql_rewrite']) ? ', t.topic_url ' : ' ');
+		$sql_array['LEFT_JOIN'][] = array(
+			'FROM'	=> array(TOPICS_TABLE => 't'),
+			'ON'	=> "f.forum_last_post_id = t.topic_last_post_id"
+		);
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 	$sql = $db->sql_build_query('SELECT', array(
 		'SELECT'	=> $sql_array['SELECT'],
 		'FROM'		=> $sql_array['FROM'],
@@ -118,7 +128,9 @@
 	while ($row = $db->sql_fetchrow($result))
 	{
 		$forum_id = $row['forum_id'];
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$phpbb_seo->set_url($row['forum_name'], $forum_id, 'forum');
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		// Mark forums read?
 		if ($mark_read == 'forums' || $mark_read == 'all')
 		{
@@ -169,7 +181,26 @@
 
 		// Count the difference of real to public topics, so we can display an information to moderators
 		$row['forum_id_unapproved_topics'] = ($auth->acl_get('m_approve', $forum_id) && ($row['forum_topics_real'] != $row['forum_topics'])) ? $forum_id : 0;
-		$row['forum_topics'] = ($auth->acl_get('m_approve', $forum_id)) ? $row['forum_topics_real'] : $row['forum_topics'];
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+		if (@$phpbb_seo->seo_opt['no_dupe']['on']) {
+			if ($row['topic_status'] == ITEM_MOVED) {
+				$row['topic_id'] = $row['topic_moved_id'];
+			}
+			$phpbb_seo->seo_opt['topic_forum_name'][$row['topic_id']] = $row['forum_name'];
+			if ($auth->acl_get('m_approve', $forum_id)) {
+				$row['forum_topics'] = $row['forum_topics_real'];
+				$replies = $row['topic_replies_real'];
+			} else {
+				$row['forum_topics'] = $row['forum_topics'];
+				$replies = $row['topic_replies'];
+			}
+			if (($replies + 1) > $phpbb_seo->seo_opt['topic_per_page']) {
+				$phpbb_seo->seo_opt['topic_last_page'][$row['topic_id']] = floor($replies / $phpbb_seo->seo_opt['topic_per_page']) * $phpbb_seo->seo_opt['topic_per_page'];
+			}
+		} else {
+			$row['forum_topics'] = ($auth->acl_get('m_approve', $forum_id)) ? $row['forum_topics_real'] : $row['forum_topics'];
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 
 		// Display active topics from this forum?
 		if ($show_active && $row['forum_type'] == FORUM_POST && $auth->acl_get('f_read', $forum_id) && ($row['forum_flags'] & FORUM_FLAG_ACTIVE_TOPICS))
@@ -249,6 +280,15 @@
 				$forum_rows[$parent_id]['forum_last_poster_name'] = $row['forum_last_poster_name'];
 				$forum_rows[$parent_id]['forum_last_poster_colour'] = $row['forum_last_poster_colour'];
 				$forum_rows[$parent_id]['forum_id_last_post'] = $forum_id;
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+				if (@$phpbb_seo->seo_opt['no_dupe']['on']) {
+					$forum_rows[$parent_id]['topic_id'] = $row['topic_id'];
+					$forum_rows[$parent_id]['topic_title'] = $row['topic_title'];
+					$forum_rows[$parent_id]['topic_type'] = $row['topic_type'];
+					$forum_rows[$parent_id]['forum_password'] = $row['forum_password'];
+					$forum_rows[$parent_id]['topic_url'] = isset($row['topic_url']) ? $row['topic_url'] : '';
+				}
+				// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 			}
 		}
 	}
@@ -404,11 +444,25 @@
 		{
 			$last_post_subject = $row['forum_last_post_subject'];
 			$last_post_time = $user->format_date($row['forum_last_post_time']);
-			$last_post_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' . $row['forum_id_last_post'] . '&amp;p=' . $row['forum_last_post_id']) . '#p' . $row['forum_last_post_id'];
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+			if (@$phpbb_seo->seo_opt['no_dupe']['on'] && !$row['forum_password'] && $auth->acl_get('f_read', $row['forum_id_last_post'])) {
+				$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id]);
+				$last_post_url =  append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' . $row['forum_id_last_post'] . '&amp;t=' . $row['topic_id'] . '&amp;start=' . @intval($phpbb_seo->seo_opt['topic_last_page'][$row['topic_id']]) ) . '#p' . $row['forum_last_post_id'];
+				$topic_title = censor_text($row['topic_title']);
+				// Limit in chars for the last post link text.
+				$char_limit = 25;
+				// Limit topic text link to $char_limit, without breacking words
+				$topic_text_lilnk = $char_limit > 0 && ( ( $length = utf8_strlen($topic_title) ) > $char_limit ) ? ( utf8_strlen($fragment = utf8_substr($topic_title, 0, $char_limit + 1 - 4)) < $length + 1 ? preg_replace('`\s*\S*$`', '', $fragment) . ' ...' : $topic_title ) : $topic_title;
+				$last_post_link = '<a href="' . append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' . $row['forum_id_last_post'] . '&amp;t=' . $row['topic_id']) . '" title="' . $topic_title . ' : ' . $phpbb_seo->seo_opt['topic_forum_name'][$row['topic_id']] . '">' . $topic_text_lilnk . '</a>';
+			} else {
+				$last_post_url =  append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' . $row['forum_id_last_post'] . '&amp;p=' . $row['forum_last_post_id']) . '#p' . $row['forum_last_post_id'];
+				$last_post_link = '';
+			}
 		}
 		else
 		{
-			$last_post_subject = $last_post_time = $last_post_url = '';
+			$last_post_subject = $last_post_time = $last_post_url = $last_post_link = '';
+			// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 		}
 
 		// Output moderator listing ... if applicable
@@ -483,6 +537,9 @@
 			'U_UNAPPROVED_TOPICS'	=> ($row['forum_id_unapproved_topics']) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=queue&amp;mode=unapproved_topics&amp;f=' . $row['forum_id_unapproved_topics']) : '',
 			'U_VIEWFORUM'		=> $u_viewforum,
 			'U_LAST_POSTER'		=> get_username_string('profile', $row['forum_last_poster_id'], $row['forum_last_poster_name'], $row['forum_last_poster_colour']),
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+			'LAST_POST_LINK'	=> $last_post_link,
+			// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 			'U_LAST_POST'		=> $last_post_url)
 		);
 
@@ -547,7 +604,9 @@
 {
 	global $db, $user, $template, $auth, $config;
 	global $phpEx, $phpbb_root_path;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	if (!$auth->acl_get('f_list', $forum_data['forum_id']))
 	{
 		return;
@@ -562,7 +621,9 @@
 		foreach ($forum_parents as $parent_forum_id => $parent_data)
 		{
 			list($parent_name, $parent_type) = array_values($parent_data);
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			$phpbb_seo->set_url($parent_name, $parent_forum_id, 'forum');
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			// Skip this parent if the user does not have the permission to view it
 			if (!$auth->acl_get('f_list', $parent_forum_id))
 			{
@@ -648,7 +709,9 @@
 function topic_generate_pagination($replies, $url)
 {
 	global $config, $user;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo, $phpEx;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Make sure $per_page is a valid value
 	$per_page = ($config['posts_per_page'] <= 0) ? 1 : $config['posts_per_page'];
 
@@ -675,6 +738,17 @@
 			}
 			$times++;
 		}
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+			static $pagin_find = array();
+			static $pagin_replace = array();
+			if (empty($pagin_find)) {
+				$pagin_find = array('`(https?\://[a-z0-9_/\.-]+/[a-z0-9_\.-]+)(\.(?!' . $phpEx . ')[a-z0-9]+)(\?[\w\#$%&~\-;:=,@+\.]+)?(&amp;|\?)start=([0-9]+)`i', '`(https?\://[a-z0-9_/\.-]+/[a-z0-9_\.-]+)/(\?[\w\#$%&~\-;:=,@+\.]+)?(&amp;|\?)start=([0-9]+)`i' );
+				$pagin_replace = array( '\1' . $phpbb_seo->seo_delim['start'] . '\5\2\3', '\1/' . $phpbb_seo->seo_static['pagination'] . '\4' . $phpbb_seo->seo_ext['pagination'] . '\2' );
+			}
+			$pagination = preg_replace( $pagin_find, $pagin_replace, $pagination );
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 	else
 	{
@@ -690,7 +764,9 @@
 function get_moderators(&$forum_moderators, $forum_id = false)
 {
 	global $config, $template, $db, $phpbb_root_path, $phpEx, $user, $auth;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	$forum_id_ary = array();
 
 	if ($forum_id !== false)
@@ -744,6 +820,9 @@
 		}
 		else
 		{
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			$phpbb_seo->prepare_url('group', $row['group_name'], $row['group_id']);
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			$group_name = (($row['group_type'] == GROUP_SPECIAL) ? $user->lang['G_' . $row['group_name']] : $row['group_name']);
 
 			if ($user->data['user_id'] != ANONYMOUS && !$auth->acl_get('u_viewprofile'))
@@ -946,7 +1025,9 @@
 {
 	global $auth, $template, $db, $user;
 	global $phpbb_root_path, $phpEx;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Do not display user activity for users having more than 5000 posts...
 	if ($userdata['user_posts'] > 5000)
 	{
@@ -1012,12 +1093,27 @@
 
 	if (!empty($active_t_row))
 	{
-		$sql = 'SELECT topic_title
-			FROM ' . TOPICS_TABLE . '
-			WHERE topic_id = ' . $active_t_row['topic_id'];
-		$result = $db->sql_query($sql);
-		$active_t_row['topic_title'] = (string) $db->sql_fetchfield('topic_title');
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$sql_array = array(
+			'SELECT'	=> 't.topic_title, t.topic_type ' . (!empty($phpbb_seo->seo_opt['sql_rewrite']) ? ', t.topic_url' : '') . ', f.forum_id, f.forum_name',
+			'FROM'		=> array(
+				TOPICS_TABLE	=> 't',
+			),
+			'LEFT_JOIN' => array(
+				array(
+					'FROM'	=> array(FORUMS_TABLE => 'f'),
+					'ON'	=> 'f.forum_id = t.forum_id',
+				),
+			),
+			'WHERE' => 't.topic_id = ' . (int) $active_t_row['topic_id']
+		);
+		$result = $db->sql_query($db->sql_build_query('SELECT', $sql_array));
+		$seo_active_t_row = $db->sql_fetchrow($result);
 		$db->sql_freeresult($result);
+		if ($seo_active_t_row) {
+			$active_t_row = array_merge($active_t_row, $seo_active_t_row);
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 
 	$userdata['active_t_row'] = $active_t_row;
@@ -1030,6 +1126,9 @@
 		$active_f_id = $active_f_row['forum_id'];
 		$active_f_count = $active_f_row['num_posts'];
 		$active_f_pct = ($userdata['user_posts']) ? ($active_f_count / $userdata['user_posts']) * 100 : 0;
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$phpbb_seo->set_url($active_f_name, $active_f_id, 'forum');
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 
 	$active_t_name = $active_t_id = $active_t_count = $active_t_pct = '';
@@ -1039,6 +1138,13 @@
 		$active_t_id = $active_t_row['topic_id'];
 		$active_t_count = $active_t_row['num_posts'];
 		$active_t_pct = ($userdata['user_posts']) ? ($active_t_count / $userdata['user_posts']) * 100 : 0;
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		if (!empty($seo_active_t_row)) {
+			$active_t_forum_id = (int) $active_t_row['forum_id'];
+			$phpbb_seo->set_url($active_t_row['forum_name'], $active_t_forum_id, 'forum');
+			$phpbb_seo->prepare_iurl($active_t_row, 'topic', $active_t_row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$active_t_forum_id]);
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END
 	}
 
 	$l_active_pct = ($userdata['user_id'] != ANONYMOUS && $userdata['user_id'] == $user->data['user_id']) ? $user->lang['POST_PCT_ACTIVE_OWN'] : $user->lang['POST_PCT_ACTIVE'];
Index: includes/functions.php
===================================================================
--- includes/functions.php	(revision 1)
+++ includes/functions.php	(Premod 3.0.8)
@@ -2034,7 +2034,9 @@
 function generate_pagination($base_url, $num_items, $per_page, $start_item, $add_prevnext_text = false, $tpl_prefix = '')
 {
 	global $template, $user;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo, $phpEx;
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Make sure $per_page is a valid value
 	$per_page = ($per_page <= 0) ? 1 : $per_page;
 
@@ -2098,16 +2100,57 @@
 		}
 	}
 
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	$prev =  ($on_page == 1) ? '' : $base_url . "{$url_delim}start=" . (($on_page - 2) * $per_page);
+	$next = ($on_page == $total_pages) ? '' : $base_url . "{$url_delim}start=" . ($on_page * $per_page);
+	if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+		static $pagin_find = array();
+		static $pagin_replace = array();
+		if (empty($pagin_replace)) {
+			$pagin_find = array('`(https?\://[a-z0-9_/\.-]+/[a-z0-9_\.-]+)(\.[a-z0-9]+)(\?[\w$%&~\-;:=,@+\.]+)?(#[a-z0-9_\.-]+)?(&amp;|\?)start=([0-9]+)`i', '`(https?\://[a-z0-9_/\.-]+/[a-z0-9_\-]+)/(\?[\w$%&~\-;:=,@+\.]+)?(#[a-z0-9_\.-]+)?(&amp;|\?)start=([0-9]+)`i');
+			$pagin_replace = array( '\1' . $phpbb_seo->seo_delim['start'] . '\6\2\3\4', '\1/' . $phpbb_seo->seo_static['pagination'] . '\5' . $phpbb_seo->seo_ext['pagination'] . '\2\3');
+		}
+		$rewrite_pagination = false;
+		// here we rewrite rewritten urls only, and they do hold the full url with http
+		if (preg_match('`^https?://[a-z0-9_\.-]+/(.*)$`i', $base_url, $match)) {
+			$rewrite_pagination = true;
+			if (!empty($match[1])) {
+				// though, we won't do it for .php files.
+				if (preg_match('`^.*\.' . $phpEx . '(|\?.*|#.*)$`i', trim($match[1]))) {
+					$rewrite_pagination = false;
+
+				}
+			}
+
+		}
+		// in all cases remove the start=0 dupe
+		$page_string = str_replace($url_delim . 'start=0', '', $page_string);
+		$prev = str_replace($url_delim . 'start=0', '', $prev);
+		if ($rewrite_pagination) {
+			$page_string = preg_replace($pagin_find, $pagin_replace, $page_string);
+			$prev = $prev ? preg_replace($pagin_find, $pagin_replace, $prev) : '';
+			$next = $next ? preg_replace( $pagin_find, $pagin_replace, $next) : '';
+		} else {
+			// take care about eventual hashes
+			if (strpos($base_url, '#') !== false) {
+				static $hash_find = '`((https?\://)?[a-z0-9_/\.-]+\.[a-z0-9]+)(\?[\w$%&~\-;:=,@+\.]+)?(#[a-z0-9_\.-]+)((&amp;|\?)start=[0-9]+)`';
+				static $hash_replace = '\1\3\5\4';
+				$page_string = preg_replace($hash_find, $hash_replace, $page_string);
+				$prev = $prev ? preg_replace($hash_find, $hash_replace, $prev) : '';
+				$next = $next ? preg_replace($hash_find, $hash_replace, $next) : '';
+			}
+		}
+	}
 	$template->assign_vars(array(
-		$tpl_prefix . 'BASE_URL'		=> $base_url,
+		$tpl_prefix . 'BASE_URL'	=> $base_url,
 		'A_' . $tpl_prefix . 'BASE_URL'	=> addslashes($base_url),
-		$tpl_prefix . 'PER_PAGE'		=> $per_page,
+		$tpl_prefix . 'PER_PAGE'	=> $per_page,
+		$tpl_prefix . 'PREVIOUS_PAGE'	=> $prev,
+		$tpl_prefix . 'NEXT_PAGE'	=> $next,
+		$tpl_prefix . 'TOTAL_PAGES'	=> $total_pages)
+	);
+	// www.phpBB-SEO.com SEO TOOLKIT END
 
-		$tpl_prefix . 'PREVIOUS_PAGE'	=> ($on_page == 1) ? '' : $base_url . "{$url_delim}start=" . (($on_page - 2) * $per_page),
-		$tpl_prefix . 'NEXT_PAGE'		=> ($on_page == $total_pages) ? '' : $base_url . "{$url_delim}start=" . ($on_page * $per_page),
-		$tpl_prefix . 'TOTAL_PAGES'		=> $total_pages,
-	));
-
 	return $page_string;
 }
 
@@ -2153,7 +2196,13 @@
 function append_sid($url, $params = false, $is_amp = true, $session_id = false)
 {
 	global $_SID, $_EXTRA_URL, $phpbb_hook;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	// We bypass the hook function here, the same effect as a standalone hook, which we want, but faster ;-)
+	global $phpbb_seo;
+	if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+		return $phpbb_seo->url_rewrite($url, $params, $is_amp, $session_id);
+	} else
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Developers using the hook function need to globalise the $_SID and $_EXTRA_URL on their own and also handle it appropriately.
 	// They could mimic most of what is within this function
 	if (!empty($phpbb_hook) && $phpbb_hook->call_hook(__FUNCTION__, $url, $params, $is_amp, $session_id))
@@ -4252,7 +4301,35 @@
 	{
 		return;
 	}
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	$template->assign_vars( array( 'PHPBB_FULL_URL' => $phpbb_seo->seo_path['phpbb_url'],
+		'SEO_BASE_HREF' => $phpbb_seo->seo_opt['seo_base_href'],
+		'SEO_START_DELIM' => $phpbb_seo->seo_delim['start'],
+		'SEO_SATIC_PAGE' => $phpbb_seo->seo_static['pagination'],
+		'SEO_EXT_PAGE' => $phpbb_seo->seo_ext['pagination'],
+		'SEO_CANONICAL_URL' => !empty($phpbb_seo->seo_opt['no_dupe']['on']) ? $phpbb_seo->get_canonical() : '',
+		'SEO_EXTERNAL' => !empty($config['seo_ext_links']) ? 'true' : 'false',
+		'SEO_EXTERNAL_SUB' => !empty($config['seo_ext_subdomain']) ? 'true' : 'false',
+		'SEO_EXT_CLASSES' => !empty($config['seo_ext_classes']) ? "'" . preg_replace('`[^a-z0-9_|-]+`', '', str_replace(',', '|', trim($config['seo_ext_classes'], ', '))) . "'" : 'false',
+		'SEO_HASHFIX' => $phpbb_seo->seo_opt['url_rewrite'] && $phpbb_seo->seo_opt['virtual_folder'] ? 'true' : 'false',
+	));
+	if (isset($user->lang['Page']) && !empty($config['seo_append_sitename']) && !empty($config['sitename'])) {
+		$page_title = $page_title && strpos($page_title, $config['sitename']) === false ? $page_title . ' - ' . $config['sitename'] : $page_title;
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN  - META
+	global $seo_meta;
+	$seo_meta->build_meta($page_title);
+	// www.phpBB-SEO.com SEO TOOLKIT END  - META
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN - GYM LINKS
+	if (!empty($config['gym_installed'])) {
+		if (!function_exists('obtain_gym_links')) {
+			require_once($phpbb_root_path . 'gym_sitemaps/includes/gym_common.' . $phpEx);
+		}
+		$gym_setup = obtain_gym_links();
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END - GYM LINKS
 	define('HEADER_INC', true);
 
 	// gzip_compression
@@ -4411,7 +4488,9 @@
 		'U_PRIVATEMSGS'			=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;folder=inbox'),
 		'U_RETURN_INBOX'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;folder=inbox'),
 		'U_POPUP_PM'			=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;mode=popup'),
-		'UA_POPUP_PM'			=> addslashes(append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;mode=popup')),
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		'UA_POPUP_PM'			=> addslashes(append_sid($phpbb_seo->seo_path['phpbb_url'] . "ucp.$phpEx", 'i=pm&amp;mode=popup')),
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		'U_MEMBERLIST'			=> append_sid("{$phpbb_root_path}memberlist.$phpEx"),
 		'U_VIEWONLINE'			=> ($auth->acl_gets('u_viewprofile', 'a_user', 'a_useradd', 'a_userdel')) ? append_sid("{$phpbb_root_path}viewonline.$phpEx") : '',
 		'U_LOGIN_LOGOUT'		=> $u_login_logout,
@@ -4517,7 +4596,12 @@
 function page_footer($run_cron = true)
 {
 	global $db, $config, $template, $user, $auth, $cache, $starttime, $phpbb_root_path, $phpEx;
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	global $phpbb_seo;
+	if (!empty($phpbb_seo)) {
+		$phpbb_seo->seo_end();
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	// Output page creation time
 	if (defined('DEBUG'))
 	{
@@ -4685,5 +4769,11 @@
 
 	return;
 }
-
+function nice_print($input) {
+	if (is_array($input) || is_object($input) ) {
+		echo '<pre>' . var_export($input, true) . '</pre>';
+	} else {
+		echo '<pre>' . $input . '</pre>';
+	}
+}
 ?>
\ No newline at end of file
Index: includes/constants.php
===================================================================
--- includes/constants.php	(revision 1)
+++ includes/constants.php	(Premod 3.0.8)
@@ -28,7 +28,7 @@
 define('PHPBB_VERSION', '3.0.8');
 
 // QA-related
-// define('PHPBB_QA', 1);
+// define('PHPBB_SEO_QA', 1);
 
 // User related
 define('ANONYMOUS', 1);
Index: download/file.php
===================================================================
--- download/file.php	(revision 1)
+++ download/file.php	(Premod 3.0.8)
@@ -243,10 +243,13 @@
 
 $download_mode = (int) $extensions[$attachment['extension']]['download_mode'];
 
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+// Added , attach_comment
 // Fetching filename here to prevent sniffing of filename
-$sql = 'SELECT attach_id, is_orphan, in_message, post_msg_id, extension, physical_filename, real_filename, mimetype, filetime
+$sql = 'SELECT attach_id, is_orphan, in_message, post_msg_id, extension, physical_filename, real_filename, mimetype, filetime, attach_comment
 	FROM ' . ATTACHMENTS_TABLE . "
 	WHERE attach_id = $download_id";
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 $result = $db->sql_query_limit($sql, 1);
 $attachment = $db->sql_fetchrow($result);
 $db->sql_freeresult($result);
@@ -268,7 +271,28 @@
 {
 	$display_cat = ATTACHMENT_CATEGORY_NONE;
 }
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+if (!empty($phpbb_seo->seo_opt['rewrite_files'])) {
+	if (empty($phpbb_seo->seo_url['file'][$download_id])) {
+		$comment = bbcode_nl2br(censor_text($attachment['attach_comment']));
+		$comment_clean = preg_replace('`<[^>]*>`Ui', ' ', $comment);
+		$_display_cat =  ($thumbnail && $display_cat != ATTACHMENT_CATEGORY_NONE) ? ATTACHMENT_CATEGORY_THUMB : $display_cat;
+		if (($_pos = utf8_strpos($comment, '<br')) !== false) {
+			$comment_url = strip_tags(utf8_substr($comment, 0, $_pos));
+		} else {
+			$comment_url = $comment_clean;
+		}
+		$comment_url = utf8_strlen($comment_url) > 60 ? utf8_substr($comment_url, 0, 60) : $comment_url; 
+		$phpbb_seo->seo_url['file'][$download_id] = $phpbb_seo->format_url($comment_url, $phpbb_seo->seo_static['file'][$display_cat]);
+	}
+	$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+		'id' => array('val' => $download_id, 'keep' => true),
+		'mode' => array('val' => $mode, 'keep' => (boolean) ($mode == 'view')),
+		't' => array('val' => $thumbnail, 'keep' => $thumbnail),
+	);
+	$phpbb_seo->seo_chk_dupe('', '', $phpbb_root_path . 'download/');
+}
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 if ($thumbnail)
 {
 	$attachment['physical_filename'] = 'thumb_' . $attachment['physical_filename'];
Index: posting.php
===================================================================
--- posting.php	(revision 1)
+++ posting.php	(Premod 3.0.8)
@@ -678,7 +678,30 @@
 	$post_data['enable_smilies']	= (!$smilies_status || isset($_POST['disable_smilies'])) ? false : true;
 	$post_data['enable_urls']		= (isset($_POST['disable_magic_url'])) ? 0 : 1;
 	$post_data['enable_sig']		= (!$config['allow_sig'] || !$auth->acl_get('f_sigs', $forum_id) || !$auth->acl_get('u_sig')) ? false : ((isset($_POST['attach_sig']) && $user->data['is_registered']) ? true : false);
-
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	if (!empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+		if ($mode == 'post' || ($mode == 'edit' && $post_data['topic_first_post_id'] == $post_id)) {
+			$phpbb_seo->set_url($post_data['forum_name'], $forum_id, 'forum');
+			$_parent = $post_data['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id];
+			$_t = !empty($post_data['topic_id']) ? max(0, (int) $post_data['topic_id'] ) : 0;
+			$_url = $phpbb_seo->url_can_edit($forum_id) ? utf8_normalize_nfc(request_var('url', '', true)) : ( isset($post_data['topic_url']) ? $post_data['topic_url'] : '' );
+			if (!$phpbb_seo->check_url('topic', $_url, $_parent)) {
+				if (!empty($_url)) {
+					// Here we get rid of the seo delim (-t) and put it back even in simple mod
+					// to be able to handle all cases at once
+					$_url = preg_replace('`' . $phpbb_seo->seo_delim['topic'] . '$`i', '', $_url);
+					$_title = $phpbb_seo->get_url_info('topic', $_url . $phpbb_seo->seo_delim['topic'] . $_t);
+				} else {
+					$_title = $phpbb_seo->modrtype > 2 ? censor_text($post_data['post_subject']) : '';
+				}
+				unset($phpbb_seo->seo_url['topic'][$_t]);
+				$_url = $phpbb_seo->get_url_info('topic', $phpbb_seo->prepare_url( 'topic', $_title, $_t, $_parent ,  (( empty($_title) || ($_title == $phpbb_seo->seo_static['topic']) ) ? true : false)), 'url');
+				unset($phpbb_seo->seo_url['topic'][$_t]);
+			}
+			$post_data['topic_url'] = $_url;
+		}
+	}
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	if ($config['allow_topic_notify'] && $user->data['is_registered'])
 	{
 		$notify = (isset($_POST['notify'])) ? true : false;
@@ -1126,7 +1149,11 @@
 				'topic_approved'		=> (isset($post_data['topic_approved'])) ? $post_data['topic_approved'] : false,
 				'post_approved'			=> (isset($post_data['post_approved'])) ? $post_data['post_approved'] : false,
 			);
-
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			if (!empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+				$data += array('topic_url' => isset($post_data['topic_url']) ? $post_data['topic_url'] : '');
+			}
+			// www.phpBB-SEO.com SEO TOOLKIT END
 			if ($mode == 'edit')
 			{
 				$data['topic_replies_real'] = $post_data['topic_replies_real'];
@@ -1422,6 +1449,10 @@
 	'FORUM_NAME'			=> $post_data['forum_name'],
 	'FORUM_DESC'			=> ($post_data['forum_desc']) ? generate_text_for_display($post_data['forum_desc'], $post_data['forum_desc_uid'], $post_data['forum_desc_bitfield'], $post_data['forum_desc_options']) : '',
 	'TOPIC_TITLE'			=> censor_text($post_data['topic_title']),
+	// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+	'TOPIC_URL'		=> isset($post_data['topic_url']) ? preg_replace('`' . $phpbb_seo->seo_delim['topic'] . '$`i', '', $post_data['topic_url']) : '',
+	'S_URL'			=> ($mode == 'post' || ($mode == 'edit' && $post_id == $post_data['topic_first_post_id'])) ? $phpbb_seo->url_can_edit($forum_id) : false,
+	// www.phpBB-SEO.com SEO TOOLKIT END
 	'MODERATORS'			=> (sizeof($moderators)) ? implode(', ', $moderators[$forum_id]) : '',
 	'USERNAME'				=> ((!$preview && $mode != 'quote') || $preview) ? $post_data['username'] : '',
 	'SUBJECT'				=> $post_data['post_subject'],
Index: viewforum.php
===================================================================
--- viewforum.php	(revision 1)
+++ viewforum.php	(Premod 3.0.8)
@@ -16,7 +16,16 @@
 $phpEx = substr(strrchr(__FILE__, '.'), 1);
 include($phpbb_root_path . 'common.' . $phpEx);
 include($phpbb_root_path . 'includes/functions_display.' . $phpEx);
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+if (empty($_REQUEST['f'])) {
+	$phpbb_seo->get_forum_id($session_forum_id);
+	if ($session_forum_id == 0) {
+		header('HTTP/1.1 404 Not Found');
+	} else {
+		$_REQUEST['f'] = (int) $session_forum_id;
+	}
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 // Start session
 $user->session_begin();
 $auth->acl($user->data);
@@ -69,8 +78,10 @@
 {
 	trigger_error('NO_FORUM');
 }
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+$phpbb_seo->set_url($forum_data['forum_name'], $forum_data['forum_id'], 'forum');
+// www.phpBB-SEO.com SEO TOOLKIT END
 
-
 // Configure style, language, etc.
 $user->setup('viewforum', $forum_data['forum_style']);
 
@@ -115,7 +126,44 @@
 	redirect($forum_data['forum_link'], false, true);
 	return;
 }
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+if ($forum_data['forum_topics_per_page']) {
+	$config['topics_per_page'] = $forum_data['forum_topics_per_page'];
+}
+$phpbb_seo->seo_opt['zero_dupe']['start'] = $phpbb_seo->seo_chk_start( $start, $config['topics_per_page'] );
+if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+	$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$forum_id&amp;start=$start"));
+}
+$seo_watch = request_var('watch', '');
+$seo_unwatch = request_var('unwatch', '');
+$keep_watch = (boolean) ($seo_watch == 'forum' && $user->data['is_registered']);
+$keep_unwatch = (boolean) ($seo_unwatch == 'forum' && $user->data['is_registered']);
+$keep_mark = in_array($mark_read, array('topics', 'topic', 'forums', 'all')) ? (boolean) ($user->data['is_registered'] || $config['load_anon_lastread']) : false;
+$keep_hash = (boolean) ($keep_watch || $keep_unwatch || $keep_mark);
+$seo_uid = max(0, request_var('uid', 0));
+$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+	'uid' => array('val' => $seo_uid, 'keep' => (boolean) ($keep_hash && $seo_uid) ),
+	'hash' => array('val' => request_var('hash', ''), 'keep' => $keep_hash),
+	'f' => array('val' => $forum_id, 'keep' => true, 'force' => true),
+	'st' => array('val' => $sort_days, 'keep' => true),
+	'sk' => array('val' => $sort_key, 'keep' => true),
+	'sd' => array('val' => $sort_dir, 'keep' => true),
+	'mark' => array('val' => $mark_read, 'keep' => $keep_mark),
+	'watch' => array('val' => $seo_watch, 'keep' => $keep_watch),
+	'unwatch' => array('val' => $seo_unwatch, 'keep' => $keep_unwatch),
+	'start' => array('val' => $phpbb_seo->seo_opt['zero_dupe']['start'], 'keep' => true),
+);
+if ($seo_uid) { // Reorder vars a bit as required
+	// Note : watch and unwatch cases could just not be handled by the zero dupe (no redirect at all when used),
+	// but the handling as well acts as a poweful security shield so, it's worth it ;)
+	$_hash_tmp = $phpbb_seo->seo_opt['zero_dupe']['redir_def']['hash'];
+	unset($phpbb_seo->seo_opt['zero_dupe']['redir_def']['hash']);
+	$phpbb_seo->seo_opt['zero_dupe']['redir_def']['hash'] = $_hash_tmp;
+} else {
+	unset($phpbb_seo->seo_opt['zero_dupe']['redir_def']['uid']);
+}
+$phpbb_seo->seo_chk_dupe();
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 // Build navigation links
 generate_forum_nav($forum_data);
 
@@ -142,7 +190,14 @@
 }
 
 // Dump out the page header and load viewforum template
-page_header($user->lang['VIEW_FORUM'] . ' - ' . $forum_data['forum_name'], true, $forum_id);
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+$extra_title = ($start > 0) ? ' - ' . $user->lang['Page'] . ( floor( $start / $config['topics_per_page'] ) + 1 ) : '';
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - META
+$seo_meta->collect('description', $forum_data['forum_name'] . ' : ' . (!empty($forum_data['forum_desc']) ? $forum_data['forum_desc'] : $seo_meta->meta_def['description']));
+$seo_meta->collect('keywords', $forum_data['forum_name'] . ' ' . $seo_meta->meta['description']);
+// www.phpBB-SEO.com SEO TOOLKIT END - META
+page_header($forum_data['forum_name'] . $extra_title, true, $forum_id);
+// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
 
 $template->set_filenames(array(
 	'body' => 'viewforum_body.html')
@@ -186,11 +241,14 @@
 	trigger_error($user->lang['TOPICS_MARKED'] . '<br /><br />' . sprintf($user->lang['RETURN_FORUM'], '<a href="' . $redirect_url . '">', '</a>'));
 }
 
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+// Moved this a little above for the zero dupe
 // Is a forum specific topic count required?
-if ($forum_data['forum_topics_per_page'])
-{
-	$config['topics_per_page'] = $forum_data['forum_topics_per_page'];
-}
+//if ($forum_data['forum_topics_per_page'])
+//{
+//	$config['topics_per_page'] = $forum_data['forum_topics_per_page'];
+//}
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 
 // Do the forum Prune thang - cron type job ...
 if ($forum_data['prune_next'] < time() && $forum_data['enable_prune'])
@@ -260,7 +318,12 @@
 {
 	$start = ($start < 0) ? 0 : floor(($topics_count - 1) / $config['topics_per_page']) * $config['topics_per_page'];
 }
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+if ($start != $phpbb_seo->seo_opt['zero_dupe']['start']) {
+	$phpbb_seo->seo_opt['zero_dupe']['redir_def']['start'] = array('val' => $start, 'keep' => true);
+	$phpbb_seo->seo_chk_dupe();
+}
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 // Basic pagewide vars
 $post_alt = ($forum_data['forum_status'] == ITEM_LOCKED) ? $user->lang['FORUM_LOCKED'] : $user->lang['POST_NEW_TOPIC'];
 
@@ -594,7 +657,19 @@
 		$row = &$rowset[$topic_id];
 
 		$topic_forum_id = ($row['forum_id']) ? (int) $row['forum_id'] : $forum_id;
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		if (!empty($row['topic_url'])) {
+			$phpbb_seo->prepare_iurl($row, 'topic', '');
+		} else {
+			if ($phpbb_seo->modrtype > 2) {
+				$row['topic_title'] = censor_text($row['topic_title']);
+			}
+			$parent_forum = $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : (!empty($phpbb_seo->seo_url['forum'][$topic_forum_id]) ? $phpbb_seo->seo_url['forum'][$topic_forum_id] : false);
+			if ($parent_forum) {
+				$phpbb_seo->prepare_iurl($row, 'topic', $parent_forum);
+			}
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		// This will allow the style designer to output a different header
 		// or even separate the list of announcements from sticky and normal topics
 		$s_type_switch_test = ($row['topic_type'] == POST_ANNOUNCE || $row['topic_type'] == POST_GLOBAL) ? 1 : 0;
@@ -623,7 +698,13 @@
 		$topic_unapproved = (!$row['topic_approved'] && $auth->acl_get('m_approve', $topic_forum_id)) ? true : false;
 		$posts_unapproved = ($row['topic_approved'] && $row['topic_replies'] < $row['topic_replies_real'] && $auth->acl_get('m_approve', $topic_forum_id)) ? true : false;
 		$u_mcp_queue = ($topic_unapproved || $posts_unapproved) ? append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=queue&amp;mode=' . (($topic_unapproved) ? 'approve_details' : 'unapproved_posts') . "&amp;t=$topic_id", true, $user->session_id) : '';
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+		if (@$phpbb_seo->seo_opt['no_dupe']['on']) {
+			if (($replies + 1) > $phpbb_seo->seo_opt['topic_per_page']) {
+				$phpbb_seo->seo_opt['topic_last_page'][$topic_id] = floor($replies / $phpbb_seo->seo_opt['topic_per_page']) * $phpbb_seo->seo_opt['topic_per_page'];
+			}
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 		// Send vars to template
 		$template->assign_block_vars('topicrow', array(
 			'FORUM_ID'					=> $topic_forum_id,
@@ -671,7 +752,9 @@
 			'S_TOPIC_MOVED'			=> ($row['topic_status'] == ITEM_MOVED) ? true : false,
 
 			'U_NEWEST_POST'			=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", $view_topic_url_params . '&amp;view=unread') . '#unread',
-			'U_LAST_POST'			=> append_sid("{$phpbb_root_path}viewtopic.$phpEx", $view_topic_url_params . '&amp;p=' . $row['topic_last_post_id']) . '#p' . $row['topic_last_post_id'],
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+			'U_LAST_POST' => @$phpbb_seo->seo_opt['no_dupe']['on'] ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", 'f=' . $topic_forum_id . '&amp;t=' . $topic_id . '&amp;start=' . @intval($phpbb_seo->seo_opt['topic_last_page'][$topic_id])) . '#p' . $row['topic_last_post_id'] : append_sid("{$phpbb_root_path}viewtopic.$phpEx", $view_topic_url_params . '&amp;p=' . $row['topic_last_post_id']) . '#p' . $row['topic_last_post_id'],
+			// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
 			'U_LAST_POST_AUTHOR'	=> get_username_string('profile', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),
 			'U_TOPIC_AUTHOR'		=> get_username_string('profile', $row['topic_poster'], $row['topic_first_poster_name'], $row['topic_first_poster_colour']),
 			'U_VIEW_TOPIC'			=> $view_topic_url,
Index: common.php
===================================================================
--- common.php	(revision 1)
+++ common.php	(Premod 3.0.8)
@@ -217,7 +217,17 @@
 
 // Grab global variables, re-cache if necessary
 $config = $cache->obtain_config();
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+if (empty($phpbb_seo) ) {
+	require_once($phpbb_root_path . 'phpbb_seo/phpbb_seo_class.'.$phpEx);
+	$phpbb_seo = new phpbb_seo();
+	@define('PHPBB_USE_BOARD_URL_PATH', true);
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - META
+require_once($phpbb_root_path . 'phpbb_seo/phpbb_seo_meta.'.$phpEx);
+$seo_meta = new seo_meta();
+// www.phpBB-SEO.com SEO TOOLKIT END - META
 // Add own hook handler
 require($phpbb_root_path . 'includes/hooks/index.' . $phpEx);
 $phpbb_hook = new phpbb_hook(array('exit_handler', 'phpbb_user_session_handler', 'append_sid', array('template', 'display')));
Index: memberlist.php
===================================================================
--- memberlist.php	(revision 1)
+++ memberlist.php	(Premod 3.0.8)
@@ -21,7 +21,14 @@
 $user->session_begin();
 $auth->acl($user->data);
 $user->setup(array('memberlist', 'groups'));
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+if (!empty($_REQUEST['un'])) {
+	$_REQUEST['un'] = rawurldecode($_REQUEST['un']);
+	if (!$phpbb_seo->is_utf8($_REQUEST['un'])) {
+		$_REQUEST['un'] = utf8_normalize_nfc(utf8_recode($_REQUEST['un'], 'ISO-8859-1'));
+	}
+}
+// www.phpBB-SEO.com SEO TOOLKIT END
 // Grab data
 $mode		= request_var('mode', '');
 $action		= request_var('action', '');
@@ -71,6 +78,15 @@
 switch ($mode)
 {
 	case 'leaders':
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+		if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+			$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}memberlist.$phpEx", 'mode=leaders'));
+		}
+		$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+			'mode' => array('val' => 'leaders', 'keep' => true),
+		);
+		$phpbb_seo->seo_chk_dupe();
+		// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 		// Display a listing of board admins, moderators
 		include($phpbb_root_path . 'includes/functions_user.' . $phpEx);
 
@@ -234,6 +250,9 @@
 			else
 			{
 				$group_name = ($row['group_type'] == GROUP_SPECIAL) ? $user->lang['G_' . $row['group_name']] : $row['group_name'];
+				// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+				$phpbb_seo->prepare_url('group', $row['group_name'], $row['group_id']);
+				// www.phpBB-SEO.com SEO TOOLKIT END
 				$u_group = append_sid("{$phpbb_root_path}memberlist.$phpEx", 'mode=group&amp;g=' . $row['group_id']);
 			}
 
@@ -429,7 +448,19 @@
 		}
 
 		$user_id = (int) $member['user_id'];
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$phpbb_seo->set_user_url( $member['username'], $user_id );
+		// www.phpBB-SEO.com SEO TOOLKIT END
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+		if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+			$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=viewprofile&amp;u=$user_id"));
+		}
+		$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+			'mode' => array('val' => 'viewprofile', 'keep' => true),
+			'u' => array('val' => $user_id, 'keep' => true, 'force' => true),
+		);
+		$phpbb_seo->seo_chk_dupe();
+		// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 		// Get group memberships
 		// Also get visiting user's groups to determine hidden group memberships if necessary.
 		$auth_hidden_groups = ($user_id === (int) $user->data['user_id'] || $auth->acl_gets('a_group', 'a_groupadd', 'a_groupdel')) ? true : false;
@@ -1333,6 +1364,17 @@
 		$pagination_url = append_sid("{$phpbb_root_path}memberlist.$phpEx", implode('&amp;', $params));
 		$sort_url = append_sid("{$phpbb_root_path}memberlist.$phpEx", implode('&amp;', $sort_params));
 
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN - Zero dupe
+		if ($mode == 'group') {
+			$phpbb_seo->prepare_url('group', $group_row['group_name'], $group_row['group_id']);
+			$phpbb_seo->seo_opt['zero_dupe']['start'] = $phpbb_seo->seo_chk_start( $start, $config['topics_per_page'] );
+
+			$phpbb_seo->seo_chk_dupe("{$phpbb_root_path}memberlist.$phpEx?" . implode('&amp;', $params) . '&amp;start=' . $phpbb_seo->seo_opt['zero_dupe']['start']);
+			if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+				$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}memberlist.$phpEx", "mode=group&amp;g={$group_row['group_id']}&amp;start=" . $phpbb_seo->seo_opt['zero_dupe']['start']));
+			}
+		}
+		// www.phpBB-SEO.com SEO TOOLKIT END - Zero dupe
 		unset($search_params, $sort_params);
 
 		// Some search user specific data
@@ -1539,7 +1581,9 @@
 				unset($id_cache[$user_id]);
 			}
 		}
-
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$seo_sep = strpos($sort_url, '?') === false ? '?' : '&amp;';
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		// Generate page
 		$template->assign_vars(array(
 			'PAGINATION'	=> generate_pagination($pagination_url, $total_users, $config['topics_per_page'], $start),
@@ -1559,20 +1603,22 @@
 
 			'U_FIND_MEMBER'			=> ($config['load_search'] || $auth->acl_get('a_')) ? append_sid("{$phpbb_root_path}memberlist.$phpEx", 'mode=searchuser' . (($start) ? "&amp;start=$start" : '') . (!empty($params) ? '&amp;' . implode('&amp;', $params) : '')) : '',
 			'U_HIDE_FIND_MEMBER'	=> ($mode == 'searchuser') ? $u_hide_find_member : '',
-			'U_SORT_USERNAME'		=> $sort_url . '&amp;sk=a&amp;sd=' . (($sort_key == 'a' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_FROM'			=> $sort_url . '&amp;sk=b&amp;sd=' . (($sort_key == 'b' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_JOINED'			=> $sort_url . '&amp;sk=c&amp;sd=' . (($sort_key == 'c' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_POSTS'			=> $sort_url . '&amp;sk=d&amp;sd=' . (($sort_key == 'd' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_EMAIL'			=> $sort_url . '&amp;sk=e&amp;sd=' . (($sort_key == 'e' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_WEBSITE'		=> $sort_url . '&amp;sk=f&amp;sd=' . (($sort_key == 'f' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_LOCATION'		=> $sort_url . '&amp;sk=b&amp;sd=' . (($sort_key == 'b' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_ICQ'			=> $sort_url . '&amp;sk=g&amp;sd=' . (($sort_key == 'g' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_AIM'			=> $sort_url . '&amp;sk=h&amp;sd=' . (($sort_key == 'h' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_MSN'			=> $sort_url . '&amp;sk=i&amp;sd=' . (($sort_key == 'i' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_YIM'			=> $sort_url . '&amp;sk=j&amp;sd=' . (($sort_key == 'j' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_SORT_ACTIVE'			=> ($auth->acl_get('u_viewonline')) ? $sort_url . '&amp;sk=l&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a') : '',
-			'U_SORT_RANK'			=> $sort_url . '&amp;sk=m&amp;sd=' . (($sort_key == 'm' && $sort_dir == 'a') ? 'd' : 'a'),
-			'U_LIST_CHAR'			=> $sort_url . '&amp;sk=a&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a'),
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			'U_SORT_USERNAME'		=> $sort_url . $seo_sep . 'sk=a&amp;sd=' . (($sort_key == 'a' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_FROM'			=> $sort_url . $seo_sep . 'sk=b&amp;sd=' . (($sort_key == 'b' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_JOINED'			=> $sort_url . $seo_sep . 'sk=c&amp;sd=' . (($sort_key == 'c' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_POSTS'			=> $sort_url . $seo_sep . 'sk=d&amp;sd=' . (($sort_key == 'd' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_EMAIL'			=> $sort_url . $seo_sep . 'sk=e&amp;sd=' . (($sort_key == 'e' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_WEBSITE'		=> $sort_url . $seo_sep . 'sk=f&amp;sd=' . (($sort_key == 'f' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_LOCATION'		=> $sort_url . $seo_sep . 'sk=b&amp;sd=' . (($sort_key == 'b' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_ICQ'			=> $sort_url . $seo_sep . 'sk=g&amp;sd=' . (($sort_key == 'g' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_AIM'			=> $sort_url . $seo_sep . 'sk=h&amp;sd=' . (($sort_key == 'h' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_MSN'			=> $sort_url . $seo_sep . 'sk=i&amp;sd=' . (($sort_key == 'i' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_YIM'			=> $sort_url . $seo_sep . 'sk=j&amp;sd=' . (($sort_key == 'j' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_SORT_ACTIVE'			=> ($auth->acl_get('u_viewonline')) ? $sort_url . $seo_sep . 'sk=l&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a') : '',
+			'U_SORT_RANK'			=> $sort_url . $seo_sep . 'sk=m&amp;sd=' . (($sort_key == 'm' && $sort_dir == 'a') ? 'd' : 'a'),
+			'U_LIST_CHAR'			=> $sort_url . $seo_sep . 'sk=a&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a'),
+			// www.phpBB-SEO.com SEO TOOLKIT END
 
 			'S_SHOW_GROUP'		=> ($mode == 'group') ? true : false,
 			'S_VIEWONLINE'		=> $auth->acl_get('u_viewonline'),
@@ -1580,7 +1626,11 @@
 			'S_MODE_SELECT'		=> $s_sort_key,
 			'S_ORDER_SELECT'	=> $s_sort_dir,
 			'S_CHAR_OPTIONS'	=> $s_char_options,
-			'S_MODE_ACTION'		=> $pagination_url)
+			// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+			// Here we circumvent because our append_sid does not allow
+			// an url to end with an ?, as it should.
+			'S_MODE_ACTION'		=> $pagination_url . (strpos($pagination_url, '?') !== false ? '' : '?') )
+			// www.phpBB-SEO.com SEO TOOLKIT END
 		);
 }
 
Index: index.php
===================================================================
--- index.php	(revision 1)
+++ index.php	(Premod 3.0.8)
@@ -24,7 +24,25 @@
 $user->session_begin();
 $auth->acl($user->data);
 $user->setup('viewforum');
-
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> Zero dupe
+if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+	$phpbb_seo->seo_path['canonical'] = $phpbb_seo->drop_sid(append_sid("{$phpbb_root_path}index.$phpEx"));
+}
+$seo_mark = request_var('mark', '');
+$keep_mark = in_array($seo_mark, array('topics', 'topic', 'forums', 'all')) ? (boolean) ($user->data['is_registered'] || $config['load_anon_lastread']) : false;
+$phpbb_seo->seo_opt['zero_dupe']['redir_def'] = array(
+	'hash' => array('val' => request_var('hash', ''), 'keep' => $keep_mark),
+	'mark' => array('val' => $seo_mark, 'keep' => $keep_mark),
+);
+if ( !$phpbb_seo->seo_opt['zero_dupe']['strict'] ) { // strict mode is here a bit faster
+	if ( !empty($phpbb_seo->seo_static['index']) ) {
+		$phpbb_seo->set_cond( (boolean) (utf8_strpos($phpbb_seo->seo_path['uri'], $phpbb_seo->seo_static['index']) === false), 'do_redir', (empty($_GET) || (!empty($seo_mark) && !$keep_mark)));
+	} else {
+		$phpbb_seo->set_cond( (boolean) (utf8_strpos($phpbb_seo->seo_path['uri'], "index.$phpEx") !== false), 'do_redir', (empty($_GET) || (!empty($seo_mark) && !$keep_mark)));
+	}
+}
+$phpbb_seo->seo_chk_dupe();
+// www.phpBB-SEO.com SEO TOOLKIT END -> Zero dupe
 display_forums('', $config['load_moderators']);
 
 // Set some stats, get posts count from forums data if we... hum... retrieve all forums data
@@ -72,6 +90,9 @@
 	}
 	else
 	{
+		// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+		$phpbb_seo->prepare_url('group', $row['group_name'], $row['group_id']);
+		// www.phpBB-SEO.com SEO TOOLKIT END
 		$legend[] = '<a' . $colour_text . ' href="' . append_sid("{$phpbb_root_path}memberlist.$phpEx", 'mode=group&amp;g=' . $row['group_id']) . '">' . $group_name . '</a>';
 	}
 }
@@ -128,7 +149,13 @@
 );
 
 // Output page
-page_header($user->lang['INDEX']);
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - META
+$seo_meta->collect('description', $config['sitename'] . ' : ' .  $config['site_desc']);
+$seo_meta->collect('keywords', $config['sitename'] . ' ' . $seo_meta->meta['description']);
+// www.phpBB-SEO.com SEO TOOLKIT END - META
+// www.phpBB-SEO.com SEO TOOLKIT BEGIN - TITLE
+page_header($config['sitename']);
+// www.phpBB-SEO.com SEO TOOLKIT END - TITLE
 
 $template->set_filenames(array(
 	'body' => 'index_body.html')
Index: adm/style/admin.css
===================================================================
--- adm/style/admin.css	(revision 1)
+++ adm/style/admin.css	(Premod 3.0.8)
@@ -211,7 +211,124 @@
 	padding-right: 10px;
 	min-width: 0;
 }
+/* www.phpbb-seo.com GYM Sitemaps & RSS 
+ * Just some more indepth tabbing */
+#gymtab, #gymtabs {
+	line-height: normal;
+	margin: 0 0 -6px 7px;
+	min-width: 600px;
+	height: 1%;
+	overflow: hidden;
+}
 
+.rtl #gymtab, .rtl #gymtabs {
+	margin: 0 7px -6px 0;
+}
+
+#gymtab ul, #gymtabs ul {
+	margin:0;
+	padding: 0;
+	list-style: none;
+}
+
+#gymtab li, #gymtabs li {
+	display: inline;
+	margin: 0;
+	padding: 0;
+	font-size: 0.85em;
+	font-weight: bold;
+}
+
+#gymtab a, #gymtabs a {
+	float: left;
+	background:url("../images/bg_tabs1.gif") no-repeat 0% -34px;
+	margin: 0 1px 0 0;
+	padding: 0 0 0 7px;
+	text-decoration: none;
+	position: relative;
+}
+
+.rtl #gymtab a, .rtl #gymtabs a {
+	float: right;
+}
+
+#gymtab a span, #gymtabs a span {
+	float: left;
+	display: block;
+	background: url("../images/bg_tabs2.gif") no-repeat 100% -34px;
+	padding: 7px 10px 4px 4px;
+	color: #767676;
+	white-space: nowrap;
+	font-family: Arial, Helvetica, sans-serif;
+	text-transform: uppercase;
+	font-weight: bold;
+}
+
+.rtl #gymtab a span, .rtl #gymtabs a span {
+	float: right;
+}
+
+/* Commented Backslash Hack hides rule from IE5-Mac \*/
+#gymtab  a span, #gymtabs a span, .rtl #gymtab a span, .rtl #gymtabs a span { float:none;}
+/* End hack */
+
+#gymtab a:hover span, #gymtabs a:hover span {
+	color: #BC2A4D;
+}
+
+#gymtab #gymactivetab a, #gymtabs #gymactivetabs a {
+	background-position: 0 0;
+	border-bottom: 1px solid #DCDEE2;
+}
+
+#gymtab #gymactivetab a span, #gymtabs #gymactivetabs a span {
+	background-position: 100% 0;
+	padding-bottom: 5px;
+	color: #23649F;
+}
+
+#gymtab  a:hover, #gymtabs a:hover {
+	background-position: 0 -69px;
+}
+
+#gymtab a:hover span, #gymtabs a:hover span {
+	background-position: 100% -69px;
+}
+
+#gymtab #gymactivetab a:hover span , #gymtabs #gymactivetabs a:hover span {
+	color: #115098;
+}
+#gymacp, #gymacps {
+	margin: 4px 0;
+	padding: 3px 1px;
+	min-width: 550px;
+	background-color: #FFFFFF;
+	border: 1px #999999 solid;
+}
+#gymcontent, #gymcontents {
+	padding: 30px 10px 10px;
+	position: relative;
+	padding-top: 10px;
+	height: 1%;
+	overflow: hidden;
+}
+
+
+#gymcontent h1, #gymcontents h1 {
+	line-height: 1.2em;
+	margin-bottom: 0;
+	color: #115098;
+}
+
+#gymcontent h2, #gymcontents h2 {
+	margin-top: 20px;
+	margin-bottom: 5px;
+	border-bottom: 1px solid #CCCCCC;
+	padding-bottom: 5px;
+	color: #333333;
+}
+/* www.phpbb-seo.com GYM Sitemaps & RSS 
+ * Just some more indepth tabbing */
 /* Tabbed menu
 	Based on: http://www.alistapart.com/articles/slidingdoors2/
 ----------------------------------------*/
Index: adm/style/acp_gym_sitemaps.html
===================================================================
--- adm/style/acp_gym_sitemaps.html	(phpBB 3.0.8)
+++ adm/style/acp_gym_sitemaps.html	(Premod 3.0.8)
@@ -0,0 +1,93 @@
+<!-- INCLUDE overall_header.html -->
+<a name="maincontent"></a>
+<div style="float:right;">{L_MAIN} V {GYM_VERSION} {INSTALL_LINK}</div>
+<h1>{L_MODE_TITLE}</h1>
+<p>{L_MODE_ITLE_EXPLAIN}</p>
+<br/>
+<!-- IF S_MENU_MODULE -->
+<div id="gymtab">
+	<ul>
+	<!-- BEGIN menu_module -->
+	<li<!-- IF menu_module.S_SELECTED --> id="gymactivetab"<!-- ENDIF -->> <a href="{menu_module.U_TITLE}"><span>{menu_module.L_TITLE}</span></a></li>
+	<!-- END menu_module -->
+	</ul>
+</div>
+<div id="gymacp">
+		<div class="panel">
+			<span class="corners-top"><span></span></span>
+				<div id="gymcontent">
+<!-- ENDIF -->
+
+<div style="float:right;">{MAINTENANCE_LINKS}</div>
+<!-- IF S_MENU -->
+<h1>{L_MODULE_TITLE}</h1>
+
+<p>{L_MODULE_ITLE_EXPLAIN}</p>
+<br/>
+<div id="gymtabs">
+	<ul>
+	<!-- BEGIN menu -->
+	<li<!-- IF menu.S_SELECTED --> id="gymactivetabs"<!-- ENDIF -->> <a href="{menu.U_TITLE}"><span>{menu.L_TITLE}</span></a></li>
+	<!-- END menu -->
+	</ul>
+</div>
+<div id="gymacps">
+		<div class="panel">
+			<span class="corners-top"><span></span></span>
+				<div id="gymcontents">
+<!-- ENDIF -->
+<h1>{L_TITLE}</h1>
+
+<p>{L_TITLE_EXPLAIN}</p>
+
+<!-- IF S_ERROR -->
+	<div class="errorbox">
+		<h3>{L_WARNING}</h3>
+		<p>{ERROR_MSG}</p>
+	</div>
+<!-- ENDIF -->
+<form id="acp_gym" method="post" action="{U_ACTION}">
+
+<!-- BEGIN options -->
+	<!-- IF options.S_LEGEND -->
+		<!-- IF not options.S_FIRST_ROW -->
+			</fieldset>
+		<!-- ENDIF -->
+		<fieldset>
+			<legend>{options.LEGEND}</legend>
+	<!-- ELSE -->
+
+		<dl>
+			<dt><label for="{options.KEY}">{options.TITLE}:</label><!-- IF options.S_EXPLAIN --><br /><span>{options.TITLE_EXPLAIN}</span><!-- ENDIF --></dt>
+			<dd>{options.CONTENT}</dd>
+		</dl>
+
+	<!-- ENDIF -->
+<!-- END options -->
+</fieldset>
+<!-- IF S_SUBMIT_BUTTON -->
+<fieldset>
+	<p class="submit-buttons">
+		<input class="button1" type="submit" id="submit" name="submit" value="{L_SUBMIT}" />&nbsp;
+		<input class="button2" type="reset" id="reset" name="reset" value="{L_RESET}" />
+	</p>
+	{S_FORM_TOKEN}
+</fieldset>
+<!-- ENDIF -->
+</form>
+<!-- IF S_MENU_MODULE -->
+				</div>
+			<span class="corners-bottom"><span></span></span>
+		</div>
+		</div>
+<!-- ENDIF -->
+<!-- IF S_MENU -->
+				</div>
+			<span class="corners-bottom"><span></span></span>
+		</div>
+		</div>
+		<!-- ENDIF -->
+<div style="float:right;">
+{SUPPORT_LINKS}
+</div>
+<!-- INCLUDE overall_footer.html -->
Index: phpbb_seo/sync_url.php
===================================================================
--- phpbb_seo/sync_url.php	(phpBB 3.0.8)
+++ phpbb_seo/sync_url.php	(Premod 3.0.8)
@@ -0,0 +1,141 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: sync_url.php 222 2010-02-27 13:08:48Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+define('IN_PHPBB', true);
+$phpbb_root_path = (defined('PHPBB_ROOT_PATH')) ? PHPBB_ROOT_PATH : './../';
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+// Try to override some limits - maybe it helps some...
+@set_time_limit(0);
+$mem_limit = @ini_get('memory_limit');
+if (!empty($mem_limit)) {
+	$unit = strtolower(substr($mem_limit, -1, 1));
+	$mem_limit = (int) $mem_limit;
+	if ($unit == 'k') {
+		$mem_limit = floor($mem_limit / 1024);
+	} else if ($unit == 'g') {
+		$mem_limit *= 1024;
+	} else if (is_numeric($unit)) {
+		$mem_limit = floor((int) ($mem_limit . $unit) / 1048576);
+	}
+	$mem_limit = max(128, $mem_limit) . 'M';
+} else {
+	$mem_limit = '128M';
+}
+@ini_set('memory_limit', $mem_limit);
+include($phpbb_root_path . 'common.' . $phpEx);
+
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('mods/acp_phpbb_seo');
+// Security check
+// Circumvent a potential phpbb bug with paths
+$redirect = append_sid(generate_board_url() . "/phpbb_seo/sync_url.$phpEx");
+if (!$user->data['is_registered']) {
+	login_box($redirect, $user->lang['SEO_LOGIN'],'', false, false);
+}
+if (!$auth->acl_get('a_')) {
+	$user->session_kill(true);
+	login_box($redirect, $user->lang['SEO_LOGIN_ADMIN'],'', false, false);
+}
+if ($user->data['user_type'] != USER_FOUNDER) {
+	login_box($redirect, $user->lang['SEO_LOGIN_FOUNDER'],'', false, false);
+}
+$start = max(0, request_var('start', 0));
+$limit = max(100, request_var('limit', 0));
+// Do not go over 1000 topic in a row
+$limit = min(1000, $limit);
+$go = max(0, request_var('go', 0));
+$mode = request_var('mode', '');
+$poll_processed = 0;
+// Add navigation links
+$template->assign_block_vars('navlinks', array(
+	'FORUM_NAME' => "Sync Topic URL",
+	'U_VIEW_FORUM'	=> append_sid("./sync_url.$phpEx"))
+);
+$msg_title = $user->lang['SYNC_TITLE'];
+if (empty($phpbb_seo->seo_opt['sql_rewrite'])) {
+	trigger_error($user->lang['SYNC_REQ_SQL_REW'], E_USER_WARNING);
+}
+if(!$go) {
+	trigger_error($user->lang['SYNC_WARN'] . '<br/><br/><b> &bull; <a href="' . append_sid("./sync_url.$phpEx?go=1&amp;mode=sync") . '">' . $user->lang['SYNC_TOPIC_URLS'] . '</a><br/><br/> &bull; <a href="' . append_sid("./sync_url.$phpEx?go=1&amp;mode=reset") . '" >' . $user->lang['SYNC_RESET_TOPIC_URLS'] . '</a></b>');
+}
+
+$forum_data = array();
+$url_updated = 0;
+if ($mode === 'sync') {
+	// get all forum info
+	$sql = 'SELECT forum_id, forum_name FROM ' . FORUMS_TABLE;
+	$result = $db->sql_query($sql);
+	while ($row = $db->sql_fetchrow($result)) {
+		$forum_data[$row['forum_id']] = $row['forum_name'];
+		$phpbb_seo->set_url($row['forum_name'], $row['forum_id'], $phpbb_seo->seo_static['forum']);
+	}
+	$db->sql_freeresult($result);
+	// let's work
+	$sql = 'SELECT * FROM ' . TOPICS_TABLE . '
+			ORDER BY topic_id ASC';
+	$result = $db->sql_query_limit($sql, $limit, $start);
+	while ($row = $db->sql_fetchrow($result)) {
+		$forum_id = (int) $row['forum_id'];
+		$topic_id = (int) $row['topic_id'];
+		$_parent = $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$forum_id];
+		if ( !$phpbb_seo->check_url('topic', $row['topic_url'], $_parent)) {
+			if (!empty($row['topic_url'])) {
+				// Here we get rid of the seo delim (-t) and put it back even in simple mod
+				// to be able to handle all cases at once
+				$_url = preg_replace('`' . $phpbb_seo->seo_delim['topic'] . '$`i', '', $row['topic_url']);
+				$_title = $phpbb_seo->get_url_info('topic', $_url . $phpbb_seo->seo_delim['topic'] . $topic_id, 'title');
+			} else {
+				$_title = $phpbb_seo->modrtype > 2 ? censor_text($row['topic_title']) : '';
+			}
+			unset($phpbb_seo->seo_url['topic'][$topic_id]);
+			$row['topic_url'] = $phpbb_seo->get_url_info('topic', $phpbb_seo->prepare_url( 'topic', $_title, $topic_id, $_parent, (( empty($_title) || ($_title == $phpbb_seo->seo_static['topic']) ) ? true : false) ), 'url');
+			unset($phpbb_seo->seo_url['topic'][$topic_id]);
+			if ($row['topic_url']) {
+				// Update the topic_url field for later re-use
+				$sql = "UPDATE " . TOPICS_TABLE . " SET topic_url = '" . $db->sql_escape($row['topic_url']) . "'
+					WHERE topic_id = $topic_id";
+				$db->sql_query($sql);
+				$url_updated++;
+			}
+		}
+	}
+	$db->sql_freeresult($result);
+	$sql = 'SELECT count(topic_id) as topic_cnt FROM ' . TOPICS_TABLE;
+	$result = $db->sql_query($sql);
+	$cnt = $db->sql_fetchrow($result);
+	$db->sql_freeresult($result);
+	if ($cnt['topic_cnt'] > ($start + $limit)) {
+		$endtime = array_sum(explode(' ', microtime()));
+		$duration = $endtime - $starttime;
+		$speed = round($limit/$duration, 2);
+		$percent = round((($start + $limit) / $cnt['topic_cnt']) * 100, 2);
+		$message = sprintf($user->lang['SYNC_PROCESSING'], $percent, ($start + $limit), $cnt['topic_cnt'], $limit, $speed, round($duration, 2) , round((($cnt['topic_cnt'] - $start)/$speed)/60, 2));
+		if ($url_updated) {
+			$message.= sprintf($user->lang['SYNC_ITEM_UPDATED'], '<br/>' . $url_updated);
+		}
+		$new_limit = ($duration < 10) ? $limit + 50 : $limit - 10;
+		meta_refresh(1, append_sid('./sync_url.' . $phpEx . '?go=1&amp;start=' . ($start + $limit) . "&amp;limit=$new_limit&amp;mode=sync"));
+		trigger_error("$message<br/>");
+	} else {
+		trigger_error($user->lang['SYNC_COMPLETE'] . sprintf($user->lang['RETURN_INDEX'], '<br/><br/><a href="' . append_sid($phpbb_root_path) . '" >', '</a>'));
+	}
+} elseif ($mode === 'reset') {
+	if (confirm_box(true)) {
+		$sql = "UPDATE " . TOPICS_TABLE . " SET topic_url = ''";
+		$db->sql_query($sql);
+		trigger_error($user->lang['SYNC_RESET_COMPLETE'] . '<br/><br/><b> &bull; <a href="' . append_sid("./sync_url.$phpEx?go=1&amp;mode=sync") . '">' . $user->lang['SYNC_TOPIC_URLS'] . '</a><br/><br/> &bull; ' . sprintf($user->lang['RETURN_INDEX'], '<a href="' . append_sid($phpbb_root_path) . '" >', '</a></b>'));
+	} else {
+		confirm_box(false, $user->lang['CONFIRM_OPERATION'], build_hidden_fields(array('go' => '1', 'mode' => 'reset')), 'confirm_body.html', append_sid("./phpbb_seo/sync_url.$phpEx"));
+	}
+} else {
+	trigger_error($user->lang['SYNC_WARN'] . '<br/><br/><b> &bull; <a href="' . append_sid("./sync_url.$phpEx?go=1&amp;mode=sync") . '">' . $user->lang['SYNC_TOPIC_URLS'] . '</a><br/><br/> &bull; <a href="' . append_sid("./sync_url.$phpEx?go=1&amp;mode=reset") . '" >' . $user->lang['SYNC_RESET_TOPIC_URLS'] . '</a></b>');
+}
+?>
\ No newline at end of file
Index: phpbb_seo/includes/setup_phpbb_seo.php
===================================================================
--- phpbb_seo/includes/setup_phpbb_seo.php	(phpBB 3.0.8)
+++ phpbb_seo/includes/setup_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,262 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: setup_phpbb_seo.php 262 2010-04-20 11:06:58Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+/**
+* setup_phpbb_seo Class
+* www.phpBB-SEO.com
+* @package Ultimate SEO URL phpBB SEO
+*/
+class setup_phpbb_seo {
+	/**
+	* Do the init
+	*/
+	function init_phpbb_seo() {
+		global $phpEx, $config, $phpbb_root_path;
+		// --> No Dupe
+		$this->seo_opt['no_dupe']['on'] = $this->cache_config['dynamic_options']['no_dupe']['on'] = false;
+		// <-- No Dupe
+		// --> Zero Dupe
+		$this->seo_opt['zero_dupe'] = array( 'on' => false, // Activate or not the redirections : true / false
+			'strict' => false, // strict compare, == VS strpos() : true / false
+			'post_redir' => 'guest', // Redirect post urls if not valid ? : guest / all / post / off
+		);
+		$this->cache_config['dynamic_options']['zero_dupe'] = $this->seo_opt['zero_dupe']; // Do not change
+		$this->seo_opt['zero_dupe']['do_redir'] = false; // do not change
+		$this->seo_opt['zero_dupe']['go_redir'] = true; // do not change
+		$this->seo_opt['zero_dupe']['do_redir_post'] = false; // do not change
+		$this->seo_opt['zero_dupe']['start'] = 0; // do not change
+		$this->seo_opt['zero_dupe']['redir_def'] = array(); // do not change
+		// <-- Zero Dupe
+		// Let's load config and forum urls, mods adding options in the cache file must do it before
+		if ($this->check_cache()) {
+			foreach($this->cache_config['dynamic_options'] as $optionname => $optionvalue ) {
+				if (@is_array($this->cache_config['settings'][$optionname])) {
+					$this->seo_opt[$optionname] = array_merge($this->seo_opt[$optionname], $this->cache_config['settings'][$optionname]);
+				} elseif ( @isset($this->cache_config['settings'][$optionvalue]) ) {
+					$this->seo_opt[$optionvalue] = $this->cache_config['settings'][$optionvalue];
+				}
+			}
+			$this->modrtype = @isset($this->seo_opt['modrtype']) ? $this->seo_opt['modrtype'] : $this->modrtype;
+			if ( $this->modrtype > 1 ) { // Load cached URLs
+				$this->seo_url['forum'] =& $this->cache_config['forum'];
+			}
+		}
+		// ====> here starts the add-on and custom set up <====
+
+		// ===> Custom url replacements <===
+		// Here you can set up custom replacements to be used in title injection.
+		// Example : array( 'find' => 'replace')
+		//	$this->url_replace = array(
+		//		// Purely cosmetic replace
+		//		'$' => 'dollar', '' => 'euro',
+		//		'\'s' => 's', // it's => its / mary's => marys ...
+		//		// Language specific replace (German example)
+		//		'' => 'ss',
+		//		'' => 'Ae', '' => 'ae',
+		//		'' => 'Oe', '' => 'oe',
+		//		'' => 'Ue', '' => 'ue',
+		//	);
+
+		// ===> Custom values Delimiters, Static parts and Suffixes <===
+		// ==> Delimiters <==
+		// Can be overridden, requires .htaccess update <=
+		// Example :
+		//	$this->seo_delim['forum'] = '-mydelim'; // instead of the default "-f"
+
+		// ==> Static parts <==
+		// Can be overridden, requires .htaccess update.
+		// Example :
+		//	$this->seo_static['post'] = 'message'; // instead of the default "post"
+		// !! phpBB files must be treated a bit differently !!
+		// Example :
+		//	$this->seo_static['file'][ATTACHMENT_CATEGORY_QUICKTIME] = 'quicktime'; // instead of the default "qt"
+		//	$this->seo_static['file_index'] = 'my_files_virtual_dir'; // instead of the default "resources"
+
+		// ==> Suffixes <==
+		// Can be overridden, requires .htaccess update <=
+		// Example :
+		// 	$this->seo_ext['topic'] = '/'; // instead of the default ".html"
+
+		// ==> Special for lazy French, others may delete this part
+		if ( strpos($config['default_lang'], 'fr') !== false ) {
+			$this->seo_static['user'] = 'membre';
+			$this->seo_static['group'] = 'groupe';
+			$this->seo_static['global_announce'] = 'annonces';
+			$this->seo_static['leaders'] = 'equipe';
+			$this->seo_static['atopic'] = 'sujets-actifs';
+			$this->seo_static['utopic'] = 'sans-reponses';
+			$this->seo_static['npost'] = 'nouveaux-messages';
+			$this->seo_static['urpost'] = 'non-lu';
+			$this->seo_static['file_index'] = 'ressources';
+		}
+		// <== Special for lazy French, others may delete this part
+
+		// Let's make sure that settings are consistent
+		$this->check_config();
+	}
+	// Here start the add-on methods
+	// --> Zero Duplicate
+	/**
+	* Custom HTTP 301 redirections.
+	* To kill duplicates
+	*/
+	function seo_redirect($url, $header = '301 Moved Permanently', $code = 301, $replace = true) {
+		global $db;
+		if (!$this->seo_opt['zero_dupe']['on'] || @headers_sent()) {
+			return false;
+		}
+		garbage_collection();
+		$url = str_replace('&amp;', '&', $url);
+		// Behave as redirect() for checks to provide with the same level of protection
+		// Make sure no linebreaks are there... to prevent http response splitting for PHP < 4.4.2
+		if (strpos(urldecode($url), "\n") !== false || strpos(urldecode($url), "\r") !== false || strpos($url, ';') !== false) {
+			trigger_error('Tried to redirect to potentially insecure url.', E_USER_ERROR);
+		}
+		// Now, also check the protocol and for a valid url the last time...
+		$allowed_protocols = array('http', 'https'/*, 'ftp', 'ftps'*/);
+		$url_parts = parse_url($url);
+		if ($url_parts === false || empty($url_parts['scheme']) || !in_array($url_parts['scheme'], $allowed_protocols)) {
+			trigger_error('Tried to redirect to potentially insecure url.', E_USER_ERROR);
+		}
+		$http = 'HTTP/1.1 ';
+		header($http . $header, $replace, $code);
+		header('Location: ' . $url);
+		exit_handler();
+	}
+	/**
+	* Set the do_redir_post option right
+	*/
+	function set_do_redir_post() {
+		global $user;
+		switch ($this->seo_opt['zero_dupe']['post_redir']) {
+			case 'guest':
+				if ( empty($user->data['is_registered']) ) {
+					$this->seo_opt['zero_dupe']['do_redir_post'] = true;
+				}
+				break;
+			case 'all':
+				$this->seo_opt['zero_dupe']['do_redir_post'] = true;
+				break;
+			case 'off': // Do not redirect
+				$this->seo_opt['zero_dupe']['do_redir'] = false;
+				$this->seo_opt['zero_dupe']['go_redir'] = false;
+				$this->seo_opt['zero_dupe']['do_redir_post'] = false;
+				break;
+			default:
+				$this->seo_opt['zero_dupe']['do_redir_post'] = false;
+				break;
+		}
+		return $this->seo_opt['zero_dupe']['do_redir_post'];
+	}
+	/**
+	* Redirects if the uri sent does not match (fully) the
+	* attended url
+	*/
+	function seo_chk_dupe($url = '', $uri = '', $path = '') {
+		global $auth, $user, $_SID, $phpbb_root_path, $config;
+		if (empty($this->seo_opt['req_file']) || (!$this->seo_opt['rewrite_usermsg'] && $this->seo_opt['req_file'] == 'search') ) {
+			return false;
+		}
+		if (!empty($_REQUEST['explain']) && (boolean) ($auth->acl_get('a_') && defined('DEBUG_EXTRA'))) {
+			if ($_REQUEST['explain'] == 1) {
+				return true;
+			}
+		}
+		$path = empty($path) ? $phpbb_root_path : $path;
+		$uri = !empty($uri) ? $uri : $this->seo_path['uri'];
+		$reg = !empty($user->data['is_registered']) ? true : false;
+		$url = empty($url) ? $this->expected_url($path) : str_replace('&amp;', '&', append_sid($url, false, true, 0));
+		$url = $this->drop_sid($url);
+		// Only add sid if user is registered and needs it to keep session
+		if (!empty($_GET['sid']) && !empty($_SID) && ($reg || !$this->seo_opt['rem_sid']) ) {
+			if ($_GET['sid'] == $user->session_id) {
+				$url .=  (utf8_strpos( $url, '?' ) !== false ? '&' : '?') . 'sid=' . $user->session_id;
+			}
+		}
+		$url = str_replace( '%26', '&', urldecode($url));
+		if ($this->seo_opt['zero_dupe']['do_redir']) {
+			$this->seo_redirect($url);
+		} else {
+			$url_check = $url;
+			// we remove url hash for comparison, but keep it for redirect
+			if (strpos($url, '#') !== false) {
+				list($url_check, $hash) = explode('#', $url, 2);
+			}
+			if ($this->seo_opt['zero_dupe']['strict']) {
+				return $this->seo_opt['zero_dupe']['go_redir'] && ( ($uri != $url_check) ? $this->seo_redirect($url) : false );
+			} else {
+				return $this->seo_opt['zero_dupe']['go_redir'] && ( (utf8_strpos( $uri, $url_check ) === false) ? $this->seo_redirect($url) : false );
+			}
+		}
+	}
+	/**
+	* expected_url($path = '')
+	* build expected url
+	*/
+	function expected_url($path = '') {
+		global $phpbb_root_path, $phpEx;
+		$path = empty($path) ? $phpbb_root_path : $path;
+		$params = array();
+		foreach ($this->seo_opt['zero_dupe']['redir_def'] as $get => $def) {
+			if ((isset($_GET[$get]) && $def['keep']) || !empty($def['force'])) {
+				$params[$get] = $def['val'];
+				if (!empty($def['hash'])) {
+					$params['#'] = $def['hash'];
+				}
+			}
+		}
+		$this->page_url = append_sid($path . $this->seo_opt['req_file'] . ".$phpEx", $params, false, 0);
+		return $this->page_url;
+	}
+	/**
+	* set_cond($bool, $type = 'bool_redir', $or = true)
+	* Helps out grabbing boolean vars
+	*/
+	function set_cond($bool, $type = 'do_redir', $or = true) {
+		if ( $or ) {
+			$this->seo_opt['zero_dupe'][$type] = (boolean) ($bool || $this->seo_opt['zero_dupe'][$type]);
+		} else {
+			$this->seo_opt['zero_dupe'][$type] = (boolean) ($bool && $this->seo_opt['zero_dupe'][$type]);
+		}
+		return;
+	}
+	/**
+	* check start var consistency
+	* Returns our best guess for $start, eg the first valid page
+	*/
+	function seo_chk_start($start = 0, $limit = 0) {
+		if ($limit > 0) {
+			$start = is_int($start/$limit) ? $start : intval($start/$limit)*$limit;
+		}
+		if ( $start >= 1 ) {
+			$this->start = $this->seo_delim['start'] . (int) $start;
+			return (int) $start;
+		}
+		$this->start = '';
+		return 0;
+	}
+	/**
+	* get_canonical
+	* Returns the canonical url if ever built
+	* Beware with ssl :
+	* 	Since we want zero duplicate, the canonical element will only use https when ssl is forced
+	* 	(eg set as THE server protocol in config) and will use http in other cases.
+	*/
+	function get_canonical() {
+		return $this->sslify($this->seo_path['canonical'], $this->ssl['forced'], true);
+	}
+	// <-- Zero Duplicate
+}
+?>
\ No newline at end of file
Index: phpbb_seo/includes/.htaccess
===================================================================
--- phpbb_seo/includes/.htaccess	(phpBB 3.0.8)
+++ phpbb_seo/includes/.htaccess	(Premod 3.0.8)
@@ -0,0 +1,4 @@
+<Files *>
+	Order Allow,Deny
+	Deny from All
+</Files>
\ No newline at end of file
Index: phpbb_seo/phpbb_seo_related.php
===================================================================
--- phpbb_seo/phpbb_seo_related.php	(phpBB 3.0.8)
+++ phpbb_seo/phpbb_seo_related.php	(Premod 3.0.8)
@@ -0,0 +1,243 @@
+<?php
+/**
+*
+* @package phpBB SEO Related topics
+* @version $Id: phpbb_seo_related.php 222 2010-02-27 13:08:48Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/licenses/gpl-license.php GNU Public License v2
+*
+*/
+
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+/**
+* seo_related Class
+* www.phpBB-SEO.com
+* @package phpBB SEO Related topics
+*/
+class seo_related {
+	var $fulltext = true;
+	var $limit = 5;
+	var $allforums = false;
+	var $check_ignore = false;
+	/**
+	* constructor
+	*/
+	function seo_related() {
+		global $db, $config;
+		if (empty($config['seo_related'])) {
+			return;
+		}
+		// override the above defaults when the acp is in use
+		$this->limit = !empty($config['seo_related_limit']) ? max(1, (int) $config['seo_related_limit']) : $this->limit;
+		$this->allforums = isset($config['seo_related_allforums']) ? max(0, (int) $config['seo_related_allforums']) : $this->allforums;
+		$this->check_ignore = isset($config['seo_related_check_ignore']) ?  max(0, (int) $config['seo_related_check_ignore']) : $this->check_ignore;
+		//  better to always check, since it's fast
+		if ($db->sql_layer != 'mysql4' && $db->sql_layer != 'mysqli') {
+			$this->fulltext = false;
+		} else {
+			$this->fulltext = isset($config['seo_related_fulltext']) ? max(0, (int) $config['seo_related_fulltext']) : $this->fulltext;
+		}
+	}
+	/**
+	* get related topic list
+	* @param	array	$topic_data	shuld at least provide with topic_id and topic_title
+	* @param 	mixed 	$forum_id 	The forum id to search in (false / 0 / null to search into all forums)
+	* */
+	function get($topic_data, $forum_id = false) {
+		global $db, $auth, $cache, $template, $user, $phpEx, $phpbb_root_path, $topic_tracking_info, $config, $phpbb_seo;
+		if (empty($config['seo_related'])) {
+			return;
+		}
+		$related_result = false;
+		$enable_icons = 0;
+		$this->allforums = !$forum_id ? true : $this->allforums;
+		$sql = $this->build_query($topic_data, $forum_id);
+		if ($sql && ($result = $db->sql_query_limit($sql, $this->limit))) {
+			// Grab icons
+			$icons = $cache->obtain_icons();
+			$attachement_icon = $user->img('icon_topic_attach', $user->lang['TOTAL_ATTACHMENTS']);
+			$s_attachement = $auth->acl_get('u_download');
+			while($row = $db->sql_fetchrow($result)) {
+				$related_forum_id = (int) $row['forum_id'];
+				$related_topic_id = (int) $row['topic_id'];
+				$enable_icons = max($enable_icons, $row['enable_icons']);
+				if ($auth->acl_get('f_list', $related_forum_id)) {
+					$row['topic_title'] = censor_text($row['topic_title']);
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN
+					if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+						$phpbb_seo->set_url($row['forum_name'], $related_forum_id, $phpbb_seo->seo_static['forum']);
+						$phpbb_seo->prepare_iurl($row, 'topic', $row['topic_type'] == POST_GLOBAL ? $phpbb_seo->seo_static['global_announce'] : $phpbb_seo->seo_url['forum'][$related_forum_id]);
+					}
+					// www.phpBB-SEO.com SEO TOOLKIT END
+					// Replies
+					$replies = ($auth->acl_get('m_approve', $related_forum_id)) ? $row['topic_replies_real'] : $row['topic_replies'];
+					$unread_topic = (isset($topic_tracking_info[$related_topic_id]) && $row['topic_last_post_time'] > $topic_tracking_info[$related_topic_id]) ? true : false;
+					$view_topic_url = append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$related_forum_id&amp;t=$related_topic_id");
+					$topic_unapproved = (!$row['topic_approved'] && $auth->acl_get('m_approve', $related_forum_id)) ? true : false;
+					$u_mcp_queue = ($topic_unapproved) ? append_sid("{$phpbb_root_path}mcp.$phpEx", "i=queue&amp;mode=approve_details&amp;t=$related_topic_id", true, $user->session_id) : '';
+					// Get folder img, topic status/type related information
+					$folder_img = $folder_alt = $topic_type = '';
+					topic_status($row, $replies, $unread_topic, $folder_img, $folder_alt, $topic_type);
+					// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+					if (!empty($phpbb_seo->seo_opt['no_dupe']['on'])) {
+						if (($replies + 1) > $phpbb_seo->seo_opt['topic_per_page']) {
+							$phpbb_seo->seo_opt['topic_last_page'][$related_topic_id] = floor($replies / $phpbb_seo->seo_opt['topic_per_page']) * $phpbb_seo->seo_opt['topic_per_page'];
+						}
+					}
+					// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
+					$template->assign_block_vars('related', array(
+						'TOPIC_TITLE' => $row['topic_title'],
+						'U_TOPIC' => $view_topic_url,
+						'U_FORUM' => $this->allforums ? append_sid("{$phpbb_root_path}viewforum.$phpEx", "f=$related_forum_id") : '',
+						'FORUM' => $row['forum_name'],
+						'PAGINATION' => topic_generate_pagination($replies, $view_topic_url),
+						'REPLIES' => $replies,
+						'VIEWS' => $row['topic_views'],
+						'FIRST_POST_TIME' => $user->format_date($row['topic_time']),
+						'LAST_POST_TIME' => $user->format_date($row['topic_last_post_time']),
+						'TOPIC_AUTHOR_FULL' =>  get_username_string('full', $row['topic_poster'], $row['topic_first_poster_name'], $row['topic_first_poster_colour']),
+						'LAST_POST_AUTHOR_FULL' =>  get_username_string('full', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),
+						// www.phpBB-SEO.com SEO TOOLKIT BEGIN -> no dupe
+						'U_LAST_POST' => !empty($phpbb_seo->seo_opt['no_dupe']['on']) ? append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$related_forum_id&amp;t=$related_topic_id&amp;start=" . @intval($phpbb_seo->seo_opt['topic_last_page'][$related_topic_id])) . '#p' . $row['topic_last_post_id'] : append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$related_forum_id&amp;t=$related_topic_id&amp;p=" . $row['topic_last_post_id']) . '#p' . $row['topic_last_post_id'],
+						// www.phpBB-SEO.com SEO TOOLKIT END -> no dupe
+						'TOPIC_FOLDER_IMG_SRC'	=> $user->img($folder_img, $folder_alt, false, '', 'src'),
+						'TOPIC_FOLDER_IMG'	=> $user->img($folder_img, $folder_alt, false),
+						'TOPIC_ICON_IMG' => (!empty($icons[$row['icon_id']])) ? $icons[$row['icon_id']]['img'] : '',
+						'ATTACH_ICON_IMG' => ($row['topic_attachment'] && $s_attachement) ? $attachement_icon : '',
+						'S_TOPIC_REPORTED' => (!empty($row['topic_reported']) && $auth->acl_get('m_report', $related_forum_id)) ? true : false,
+						'S_UNREAD_TOPIC' => $unread_topic,
+						'S_POST_ANNOUNCE' => ($row['topic_type'] == POST_ANNOUNCE) ? true : false,
+						'S_POST_GLOBAL' => ($row['topic_type'] == POST_GLOBAL) ? true : false,
+						'S_POST_STICKY' => ($row['topic_type'] == POST_STICKY) ? true : false,
+						'S_TOPIC_LOCKED' => ($row['topic_status'] == ITEM_LOCKED) ? true : false,
+						'S_TOPIC_UNAPPROVED' => $topic_unapproved,
+						'U_MCP_REPORT' => append_sid("{$phpbb_root_path}mcp.$phpEx", 'i=reports&amp;mode=reports&amp;f=' . $related_forum_id . '&amp;t=' . $related_topic_id, true, $user->session_id),
+						'U_MCP_QUEUE' => $u_mcp_queue,
+					));
+					$related_result = true;
+				}
+			}
+			$db->sql_freeresult($result);
+		}
+		if ($related_result) {
+			$template->assign_vars(array(
+				'S_RELATED_RESULTS' => $related_result,
+				'LAST_POST_IMG' => $user->img('icon_topic_latest', 'VIEW_LATEST_POST'),
+				'NEWEST_POST_IMG' => $user->img('icon_topic_newest', 'VIEW_NEWEST_POST'),
+				'UNAPPROVED_IMG' => $user->img('icon_topic_unapproved', 'TOPIC_UNAPPROVED'),
+				'REPORTED_IMG' => $user->img('icon_topic_reported', 'TOPIC_REPORTED'),
+				'GOTO_PAGE_IMG' => $user->img('icon_post_target', 'GOTO_PAGE'),
+				'S_TOPIC_ICONS' => $enable_icons,
+			));
+		}
+	}
+	/**
+	* build_query
+	* @param	array	$topic_data	shuld at least provide with topic_id and topic_title
+	* @param 	mixed 	$forum_id 	The forum id to search in (false / 0 / null to search into all forums)
+	*/
+	function build_query($topic_data, $forum_id = false) {
+		global $db;
+		if (!($match = $this->prepare_match($topic_data['topic_title']))) {
+			return false;
+		}
+		if (!$forum_id || $this->allforums) {
+			global $auth;
+			// Do not include those forums the user is not having read access to...
+			$related_read_ary = $auth->acl_getf('f_read', true);
+			$related_forum_ids = array();
+			foreach ($related_read_ary as $_forum_id => $null) {
+				$related_forum_ids[$_forum_id] = (int) $_forum_id;
+			}
+			$forum_sql = sizeof($related_forum_ids) ? $db->sql_in_set('t.forum_id', $related_forum_ids, false, true) . ' AND ' : '';
+		} else {
+			$forum_sql = ' t.forum_id = ' . (int) $forum_id . ' AND ';
+		}
+		$sql_array = array(
+			'SELECT' => 't.*, f.forum_name, f.enable_icons',
+			'FROM' => array(
+				TOPICS_TABLE => 't',
+				FORUMS_TABLE => 'f'
+			),
+			'WHERE' => "$forum_sql f.forum_id = t.forum_id",
+		);
+		if ($this->fulltext) {
+			$sql_array['SELECT'] .= ", MATCH (t.topic_title) AGAINST ('" . $db->sql_escape($match) . "') relevancy";
+			$sql_array['WHERE'] .= " AND MATCH (t.topic_title) AGAINST ('" . $db->sql_escape($match) . "')";
+			$sql_array['ORDER_BY'] = 'relevancy DESC';
+		} else {
+			$sql_like = $this->buil_sql_like($match);
+			if (!$sql_like) {
+				return false;
+			}
+			$sql_array['WHERE'] .= " AND t.topic_title $sql_like";
+			$sql_array['ORDER_BY'] = 't.topic_id DESC';
+		}
+		$sql_array['WHERE'] .= " AND t.topic_status <> " . ITEM_MOVED . "
+			AND t.topic_id <> " . (int) $topic_data['topic_id'];
+		return $db->sql_build_query('SELECT', $sql_array);
+	}
+	/**
+	* prepare_match : Prepares the word list to search for
+	* @param	string	$text		the string of all words to search for, eg topic_title
+	* @param	int	$min_lenght	word with less than $min_lenght letters will be dropped
+	* @param	int	$max_lenght	word with more than $max_lenght letters will be dropped
+	*/
+	function prepare_match($text, $min_lenght = 3, $max_lenght = 14) {
+		$word_list = array();
+		$text = trim(preg_replace('`[\s]+`', ' ', $text));
+		if (!empty($text)) {
+			$word_list = array_unique(explode(' ', utf8_strtolower($text)));
+			foreach ($word_list as $k => $word) {
+				$len = utf8_strlen(trim($word));
+				if ( ($len < $min_lenght) || ($len > $max_lenght) ) {
+					unset($word_list[$k]);
+				}
+			}
+		}
+		if (!empty($word_list) && $this->check_ignore) {
+			global $phpbb_root_path, $user, $phpEx;
+			// add stop words to $user to allow reuse
+			if (empty($user->stop_words)) {
+				$words = array();
+				if (file_exists("{$user->lang_path}{$user->lang_name}/search_ignore_words.$phpEx")){
+					// include the file containing ignore words
+					include("{$user->lang_path}{$user->lang_name}/search_ignore_words.$phpEx");
+				}
+				$user->stop_words = & $words;
+			}
+			$word_list = array_diff($word_list, $user->stop_words);
+		}
+		return !empty($word_list) ? implode(' ', $word_list) : '';
+	}
+	/**
+	* buil_sql_like
+	* @param	string	$text		the string of all words to search for,prepared with prepare_match
+	* @param	int	$limit		maxximum number of words to use in the query
+	*/
+	function buil_sql_like($text, $limit = 3) {
+		global $db;
+		$sql_like = '';
+		$i = 0;
+		$text = str_replace(array('_', '%'), array("\_", "\%"), $text);
+		$text = str_replace(array(chr(0) . "\_", chr(0) . "\%"), array('_', '%'), $text);
+		$text = explode(' ', trim(preg_replace('`[\s]+`', ' ', $text)));
+		if ( !empty($text) ) {
+			foreach ($text as $word) {
+				$word = $db->sql_escape(trim($word));
+				$sql_like .= empty($sql_like) ? " LIKE '%$word%'" : " OR  '%$word%'";
+				$i++;
+				if ($i >= $limit) {
+					return $sql_like;
+				}
+			}
+		}
+		return $sql_like;
+	}
+}
+?>
\ No newline at end of file
Index: phpbb_seo/docs/COPYING
===================================================================
--- phpbb_seo/docs/COPYING	(phpBB 3.0.8)
+++ phpbb_seo/docs/COPYING	(Premod 3.0.8)
@@ -0,0 +1,545 @@
+Reciprocal Public License 1.5 (RPL1.5)
+[OSI Approved License]
+
+Reciprocal Public License (RPL)
+
+Version 1.5, July 15, 2007
+
+Copyright (C) 2001-2007
+Technical Pursuit Inc.,
+All Rights Reserved.
+
+PREAMBLE
+
+The Reciprocal Public License (RPL) is based on the concept of reciprocity or,
+if you prefer, fairness.
+
+In short, this license grew out of a desire to close loopholes in previous open
+source licenses, loopholes that allowed parties to acquire open source software
+and derive financial benefit from it without having to release their
+improvements or derivatives to the community which enabled them. This occurred
+any time an entity did not release their application to a "third party".
+
+While there is a certain freedom in this model of licensing, it struck the
+authors of the RPL as being unfair to the open source community at large and to
+the original authors of the works in particular. After all, bug fixes,
+extensions, and meaningful and valuable derivatives were not consistently
+finding their way back into the community where they could fuel further, and
+faster, growth and expansion of the overall open source software base.
+
+While you should clearly read and understand the entire license, the essence of
+the RPL is found in two definitions: "Deploy" and "Required Components".
+
+Regarding deployment, under the RPL your changes, bug fixes, extensions, etc.
+must be made available to the open source community at large when you Deploy in
+any form -- either internally or to an outside party. Once you start running
+the software you have to start sharing the software.
+
+Further, under the RPL all components you author including schemas, scripts,
+source code, etc. -- regardless of whether they're compiled into a single
+binary or used as two halves of client/server application -- must be shared.
+You have to share the whole pie, not an isolated slice of it.
+
+In addition to these goals, the RPL was authored to meet the requirements of
+the Open Source Definition as maintained by the Open Source Initiative (OSI).
+
+The specific terms and conditions of the license are defined in the remainder
+of this document.
+
+LICENSE TERMS
+
+1.0 General; Applicability & Definitions. This Reciprocal Public License
+Version 1.5 ("License") applies to any programs or other works as well as any
+and all updates or maintenance releases of said programs or works ("Software")
+not already covered by this License which the Software copyright holder
+("Licensor") makes available containing a License Notice (hereinafter defined)
+from the Licensor specifying or allowing use or distribution under the terms of
+this License. As used in this License:
+
+1.1 "Contributor" means any person or entity who created or contributed to the
+creation of an Extension.
+
+1.2 "Deploy" means to use, Serve, sublicense or distribute Licensed Software
+other than for Your internal Research and/or Personal Use, and includes
+without limitation, any and all internal use or distribution of Licensed
+Software within Your business or organization other than for Research and/or
+Personal Use, as well as direct or indirect sublicensing or distribution of
+Licensed Software by You to any third party in any form or manner.
+
+1.3 "Derivative Works" as used in this License is defined under U.S. copyright
+law.
+
+1.4 "Electronic Distribution Mechanism" means a mechanism generally accepted
+in the software development community for the electronic transfer of data such
+as download from an FTP server or web site, where such mechanism is publicly
+accessible.
+
+1.5 "Extensions" means any Modifications, Derivative Works, or Required
+Components as those terms are defined in this License.
+
+1.6 "License" means this Reciprocal Public License.
+
+1.7 "License Notice" means any notice contained in EXHIBIT A.
+
+1.8 "Licensed Software" means any Software licensed pursuant to this License.
+Licensed Software also includes all previous Extensions from any Contributor
+that You receive.
+
+1.9 "Licensor" means the copyright holder of any Software previously not
+covered by this License who releases the Software under the terms of this
+License.
+
+1.10 "Modifications" means any additions to or deletions from the substance or
+structure of (i) a file or other storage containing Licensed Software, or (ii)
+any new file or storage that contains any part of Licensed Software, or (iii)
+any file or storage which replaces or otherwise alters the original
+functionality of Licensed Software at runtime.
+
+1.11 "Personal Use" means use of Licensed Software by an individual solely for
+his or her personal, private and non-commercial purposes. An individual's use
+of Licensed Software in his or her capacity as an officer, employee, member,
+independent contractor or agent of a corporation, business or organization
+(commercial or non-commercial) does not qualify as Personal Use.
+
+1.12 "Required Components" means any text, programs, scripts, schema,
+interface definitions, control files, or other works created by You which are
+required by a third party of average skill to successfully install and run
+Licensed Software containing Your Modifications, or to install and run Your
+Derivative Works.
+
+1.13 "Research" means investigation or experimentation for the purpose of
+understanding the nature and limits of the Licensed Software and its potential
+uses.
+
+1.14 "Serve" means to deliver Licensed Software and/or Your Extensions by
+means of a computer network to one or more computers for purposes of execution
+of Licensed Software and/or Your Extensions.
+
+1.15 "Software" means any computer programs or other works as well as any
+updates or maintenance releases of those programs or works which are
+distributed publicly by Licensor.
+
+1.16 "Source Code" means the preferred form for making modifications to the
+Licensed Software and/or Your Extensions, including all modules contained
+therein, plus any associated text, interface definition files, scripts used to
+control compilation and installation of an executable program or other
+components required by a third party of average skill to build a running
+version of the Licensed Software or Your Extensions.
+
+1.17 "User-Visible Attribution Notice" means any notice contained in EXHIBIT B.
+
+1.18 "You" or "Your" means an individual or a legal entity exercising rights
+under this License. For legal entities, "You" or "Your" includes any entity
+which controls, is controlled by, or is under common control with, You, where
+"control" means (a) the power, direct or indirect, to cause the direction or
+management of such entity, whether by contract or otherwise, or (b) ownership
+of fifty percent (50%) or more of the outstanding shares or beneficial
+ownership of such entity.
+
+2.0 Acceptance Of License. You are not required to accept this License since
+you have not signed it, however nothing else grants you permission to use,
+copy, distribute, modify, or create derivatives of either the Software or any
+Extensions created by a Contributor. These actions are prohibited by law if
+you do not accept this License. Therefore, by performing any of these actions
+You indicate Your acceptance of this License and Your agreement to be bound by
+all its terms and conditions. IF YOU DO NOT AGREE WITH ALL THE TERMS AND
+CONDITIONS OF THIS LICENSE DO NOT USE, MODIFY, CREATE DERIVATIVES, OR
+DISTRIBUTE THE SOFTWARE. IF IT IS IMPOSSIBLE FOR YOU TO COMPLY WITH ALL THE
+TERMS AND CONDITIONS OF THIS LICENSE THEN YOU CAN NOT USE, MODIFY, CREATE
+DERIVATIVES, OR DISTRIBUTE THE SOFTWARE.
+
+3.0 Grant of License From Licensor. Subject to the terms and conditions of
+this License, Licensor hereby grants You a world-wide, royalty-free, non-
+exclusive license, subject to Licensor's intellectual property rights, and any
+third party intellectual property claims derived from the Licensed Software
+under this License, to do the following:
+
+3.1 Use, reproduce, modify, display, perform, sublicense and distribute
+Licensed Software and Your Extensions in both Source Code form or as an
+executable program.
+
+3.2 Create Derivative Works (as that term is defined under U.S. copyright law)
+of Licensed Software by adding to or deleting from the substance or structure
+of said Licensed Software.
+
+3.3 Under claims of patents now or hereafter owned or controlled by Licensor,
+to make, use, have made, and/or otherwise dispose of Licensed Software or
+portions thereof, but solely to the extent that any such claim is necessary to
+enable You to make, use, have made, and/or otherwise dispose of Licensed
+Software or portions thereof.
+
+3.4 Licensor reserves the right to release new versions of the Software with
+different features, specifications, capabilities, functions, licensing terms,
+general availability or other characteristics. Title, ownership rights, and
+intellectual property rights in and to the Licensed Software shall remain in
+Licensor and/or its Contributors.
+
+4.0 Grant of License From Contributor. By application of the provisions in
+Section 6 below, each Contributor hereby grants You a world-wide, royalty-
+free, non-exclusive license, subject to said Contributor's intellectual
+property rights, and any third party intellectual property claims derived from
+the Licensed Software under this License, to do the following:
+
+4.1 Use, reproduce, modify, display, perform, sublicense and distribute any
+Extensions Deployed by such Contributor or portions thereof, in both Source
+Code form or as an executable program, either on an unmodified basis or as
+part of Derivative Works.
+
+4.2 Under claims of patents now or hereafter owned or controlled by
+Contributor, to make, use, have made, and/or otherwise dispose of Extensions
+or portions thereof, but solely to the extent that any such claim is necessary
+to enable You to make, use, have made, and/or otherwise dispose of
+Licensed Software or portions thereof.
+
+5.0 Exclusions From License Grant. Nothing in this License shall be deemed to
+grant any rights to trademarks, copyrights, patents, trade secrets or any
+other intellectual property of Licensor or any Contributor except as expressly
+stated herein. Except as expressly stated in Sections 3 and 4, no other patent
+rights, express or implied, are granted herein. Your Extensions may require
+additional patent licenses from Licensor or Contributors which each may grant
+in its sole discretion. No right is granted to the trademarks of Licensor or
+any Contributor even if such marks are included in the Licensed Software.
+Nothing in this License shall be interpreted to prohibit Licensor from
+licensing under different terms from this License any code that Licensor
+otherwise would have a right to license.
+
+5.1 You expressly acknowledge and agree that although Licensor and each
+Contributor grants the licenses to their respective portions of the Licensed
+Software set forth herein, no assurances are provided by Licensor or any
+Contributor that the Licensed Software does not infringe the patent or other
+intellectual property rights of any other entity. Licensor and each
+Contributor disclaim any liability to You for claims brought by any other
+entity based on infringement of intellectual property rights or otherwise. As
+a condition to exercising the rights and licenses granted hereunder, You
+hereby assume sole responsibility to secure any other intellectual property
+rights needed, if any. For example, if a third party patent license is
+required to allow You to distribute the Licensed Software, it is Your
+responsibility to acquire that license before distributing the Licensed
+Software.
+
+6.0 Your Obligations And Grants. In consideration of, and as an express
+condition to, the licenses granted to You under this License You hereby agree
+that any Modifications, Derivative Works, or Required Components (collectively
+Extensions) that You create or to which You contribute are governed by the
+terms of this License including, without limitation, Section 4. Any Extensions
+that You create or to which You contribute must be Deployed under the terms of
+this License or a future version of this License released under Section 7. You
+hereby grant to Licensor and all third parties a world-wide, non-exclusive,
+royalty-free license under those intellectual property rights You own or
+control to use, reproduce, display, perform, modify, create derivatives,
+sublicense, and distribute Licensed Software, in any form. Any Extensions You
+make and Deploy must have a distinct title so as to readily tell any
+subsequent user or Contributor that the Extensions are by You. You must
+include a copy of this License or directions on how to obtain a copy with
+every copy of the Extensions You distribute. You agree not to offer or impose
+any terms on any Source Code or executable version of the Licensed Software,
+or its Extensions that alter or restrict the applicable version of this
+License or the recipients' rights hereunder.
+
+6.1 Availability of Source Code. You must make available, under the terms of
+this License, the Source Code of any Extensions that You Deploy, via an
+Electronic Distribution Mechanism. The Source Code for any version that You
+Deploy must be made available within one (1) month of when you Deploy and must
+remain available for no less than twelve (12) months after the date You cease
+to Deploy. You are responsible for ensuring that the Source Code to each
+version You Deploy remains available even if the Electronic Distribution
+Mechanism is maintained by a third party. You may not charge a fee for any
+copy of the Source Code distributed under this Section in excess of Your
+actual cost of duplication and distribution of said copy.
+
+6.2 Description of Modifications. You must cause any Modifications that You
+create or to which You contribute to be documented in the Source Code, clearly
+describing the additions, changes or deletions You made. You must include a
+prominent statement that the Modifications are derived, directly or indirectly,
+from the Licensed Software and include the names of the Licensor and any
+Contributor to the Licensed Software in (i) the Source Code and (ii) in any
+notice displayed by the Licensed Software You distribute or in related
+documentation in which You describe the origin or ownership of the Licensed
+Software. You may not modify or delete any pre-existing copyright notices,
+change notices or License text in the Licensed Software without written
+permission of the respective Licensor or Contributor.
+
+6.3 Intellectual Property Matters.
+
+a. Third Party Claims. If You have knowledge that a license to a third party's
+intellectual property right is required to exercise the rights granted by this
+License, You must include a human-readable file with Your distribution that
+describes the claim and the party making the claim in sufficient detail that a
+recipient will know whom to contact.
+
+b. Contributor APIs. If Your Extensions include an application programming
+interface ("API") and You have knowledge of patent licenses that are
+reasonably necessary to implement that API, You must also include this
+information in a human-readable file supplied with Your distribution.
+
+c. Representations. You represent that, except as disclosed pursuant to 6.3(a)
+above, You believe that any Extensions You distribute are Your original
+creations and that You have sufficient rights to grant the rights conveyed by
+this License.
+
+6.4 Required Notices.
+
+a. License Text. You must duplicate this License or instructions on how to
+acquire a copy in any documentation You provide along with the Source Code of
+any Extensions You create or to which You contribute, wherever You describe
+recipients' rights relating to Licensed Software.
+
+b. License Notice. You must duplicate any notice contained in EXHIBIT A (the
+"License Notice") in each file of the Source Code of any copy You distribute
+of the Licensed Software and Your Extensions. If You create an Extension, You
+may add Your name as a Contributor to the Source Code and accompanying
+documentation along with a description of the contribution. If it is not
+possible to put the License Notice in a particular Source Code file due to its
+structure, then You must include such License Notice in a location where a
+user would be likely to look for such a notice.
+
+c. Source Code Availability. You must notify the software community of the
+availability of Source Code to Your Extensions within one (1) month of the date
+You initially Deploy and include in such notification a description of the
+Extensions, and instructions on how to acquire the Source Code. Should such
+instructions change you must notify the software community of revised
+instructions within one (1) month of the date of change. You must provide
+notification by posting to appropriate news groups, mailing lists, weblogs, or
+other sites where a publicly accessible search engine would reasonably be
+expected to index your post in relationship to queries regarding the Licensed
+Software and/or Your Extensions.
+
+d. User-Visible Attribution. You must duplicate any notice contained in
+EXHIBIT B (the "User-Visible Attribution Notice") in each user-visible display
+of the Licensed Software and Your Extensions which delineates copyright,
+ownership, or similar attribution information. If You create an Extension,
+You may add Your name as a Contributor, and add Your attribution notice, as an
+equally visible and functional element of any User-Visible Attribution Notice
+content. To ensure proper attribution, You must also include such User-Visible
+Attribution Notice in at least one location in the Software documentation
+where a user would be likely to look for such notice.
+
+6.5 Additional Terms. You may choose to offer, and charge a fee for, warranty,
+support, indemnity or liability obligations to one or more recipients of
+Licensed Software. However, You may do so only on Your own behalf, and not on
+behalf of the Licensor or any Contributor except as permitted under other
+agreements between you and Licensor or Contributor. You must make it clear that
+any such warranty, support, indemnity or liability obligation is offered by You
+alone, and You hereby agree to indemnify the Licensor and every Contributor for
+any liability plus attorney fees, costs, and related expenses due to any such
+action or claim incurred by the Licensor or such Contributor as a result of
+warranty, support, indemnity or liability terms You offer.
+
+6.6 Conflicts With Other Licenses. Where any portion of Your Extensions, by
+virtue of being Derivative Works of another product or similar circumstance,
+fall under the terms of another license, the terms of that license should be
+honored however You must also make Your Extensions available under this
+License. If the terms of this License continue to conflict with the terms of
+the other license you may write the Licensor for permission to resolve the
+conflict in a fashion that remains consistent with the intent of this License.
+Such permission will be granted at the sole discretion of the Licensor.
+
+7.0 Versions of This License. Licensor may publish from time to time revised
+versions of the License. Once Licensed Software has been published under a
+particular version of the License, You may always continue to use it under the
+terms of that version. You may also choose to use such Licensed Software under
+the terms of any subsequent version of the License published by Licensor. No
+one other than Licensor has the right to modify the terms applicable to
+Licensed Software created under this License.
+
+7.1 If You create or use a modified version of this License, which You may do
+only in order to apply it to software that is not already Licensed Software
+under this License, You must rename Your license so that it is not confusingly
+similar to this License, and must make it clear that Your license contains
+terms that differ from this License. In so naming Your license, You may not
+use any trademark of Licensor or of any Contributor. Should Your modifications
+to this License be limited to alteration of a) Section 13.8 solely to modify
+the legal Jurisdiction or Venue for disputes, b) EXHIBIT A solely to define
+License Notice text, or c) to EXHIBIT B solely to define a User-Visible
+Attribution Notice, You may continue to refer to Your License as the
+Reciprocal Public License or simply the RPL.
+
+8.0 Disclaimer of Warranty. LICENSED SOFTWARE IS PROVIDED UNDER THIS LICENSE
+ON AN "AS IS" BASIS, WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
+INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT THE LICENSED SOFTWARE IS FREE
+OF DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.
+FURTHER THERE IS NO WARRANTY MADE AND ALL IMPLIED WARRANTIES ARE DISCLAIMED
+THAT THE LICENSED SOFTWARE MEETS OR COMPLIES WITH ANY DESCRIPTION OF
+PERFORMANCE OR OPERATION, SAID COMPATIBILITY AND SUITABILITY BEING YOUR
+RESPONSIBILITY. LICENSOR DISCLAIMS ANY WARRANTY, IMPLIED OR EXPRESSED, THAT
+ANY CONTRIBUTOR'S EXTENSIONS MEET ANY STANDARD OF COMPATIBILITY OR DESCRIPTION
+OF PERFORMANCE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE
+LICENSED SOFTWARE IS WITH YOU. SHOULD LICENSED SOFTWARE PROVE DEFECTIVE IN ANY
+RESPECT, YOU (AND NOT THE LICENSOR OR ANY OTHER CONTRIBUTOR) ASSUME THE COST
+OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. UNDER THE TERMS OF THIS
+LICENSOR WILL NOT SUPPORT THIS SOFTWARE AND IS UNDER NO OBLIGATION TO ISSUE
+UPDATES TO THIS SOFTWARE. LICENSOR HAS NO KNOWLEDGE OF ERRANT CODE OR VIRUS IN
+THIS SOFTWARE, BUT DOES NOT WARRANT THAT THE SOFTWARE IS FREE FROM SUCH ERRORS
+OR VIRUSES. THIS DISCLAIMER OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS
+LICENSE. NO USE OF LICENSED SOFTWARE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS
+DISCLAIMER.
+
+9.0 Limitation of Liability. UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY,
+WHETHER TORT (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL THE
+LICENSOR, ANY CONTRIBUTOR, OR ANY DISTRIBUTOR OF LICENSED SOFTWARE, OR ANY
+SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR ANY INDIRECT,
+SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY CHARACTER INCLUDING,
+WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL, WORK STOPPAGE, COMPUTER
+FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER COMMERCIAL DAMAGES OR LOSSES,
+EVEN IF SUCH PARTY SHALL HAVE BEEN INFORMED OF THE POSSIBILITY OF SUCH
+DAMAGES. THIS LIMITATION OF LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH
+OR PERSONAL INJURY RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT
+APPLICABLE LAW PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE
+EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THIS
+EXCLUSION AND LIMITATION MAY NOT APPLY TO YOU.
+
+10.0 High Risk Activities. THE LICENSED SOFTWARE IS NOT FAULT-TOLERANT AND IS
+NOT DESIGNED, MANUFACTURED, OR INTENDED FOR USE OR DISTRIBUTION AS ON-LINE
+CONTROL EQUIPMENT IN HAZARDOUS ENVIRONMENTS REQUIRING FAIL-SAFE PERFORMANCE,
+SUCH AS IN THE OPERATION OF NUCLEAR FACILITIES, AIRCRAFT NAVIGATION OR
+COMMUNICATIONS SYSTEMS, AIR TRAFFIC CONTROL, DIRECT LIFE SUPPORT MACHINES, OR
+WEAPONS SYSTEMS, IN WHICH THE FAILURE OF THE LICENSED SOFTWARE COULD LEAD
+DIRECTLY TO DEATH, PERSONAL INJURY, OR SEVERE PHYSICAL OR ENVIRONMENTAL DAMAGE
+("HIGH RISK ACTIVITIES"). LICENSOR AND CONTRIBUTORS SPECIFICALLY DISCLAIM ANY
+EXPRESS OR IMPLIED WARRANTY OF FITNESS FOR HIGH RISK ACTIVITIES.
+
+11.0 Responsibility for Claims. As between Licensor and Contributors, each
+party is responsible for claims and damages arising, directly or indirectly,
+out of its utilization of rights under this License which specifically
+disclaims warranties and limits any liability of the Licensor. This paragraph
+is to be used in conjunction with and controlled by the Disclaimer Of
+Warranties of Section 8, the Limitation Of Damages in Section 9, and the
+disclaimer against use for High Risk Activities in Section 10. The Licensor
+has thereby disclaimed all warranties and limited any damages that it is or
+may be liable for. You agree to work with Licensor and Contributors to
+distribute such responsibility on an equitable basis consistent with the terms
+of this License including Sections 8, 9, and 10. Nothing herein is intended or
+shall be deemed to constitute any admission of liability.
+
+12.0 Termination. This License and all rights granted hereunder will terminate
+immediately in the event of the circumstances described in Section 13.6 or if
+applicable law prohibits or restricts You from fully and or specifically
+complying with Sections 3, 4 and/or 6, or prevents the enforceability of any
+of those Sections, and You must immediately discontinue any use of Licensed
+Software.
+
+12.1 Automatic Termination Upon Breach. This License and the rights granted
+hereunder will terminate automatically if You fail to comply with the terms
+herein and fail to cure such breach within thirty (30) days of becoming aware
+of the breach. All sublicenses to the Licensed Software that are properly
+granted shall survive any termination of this License. Provisions that, by
+their nature, must remain in effect beyond the termination of this License,
+shall survive.
+
+12.2 Termination Upon Assertion of Patent Infringement. If You initiate
+litigation by asserting a patent infringement claim (excluding declaratory
+judgment actions) against Licensor or a Contributor (Licensor or Contributor
+against whom You file such an action is referred to herein as "Respondent")
+alleging that Licensed Software directly or indirectly infringes any patent,
+then any and all rights granted by such Respondent to You under Sections 3 or
+4 of this License shall terminate prospectively upon sixty (60) days notice
+from Respondent (the "Notice Period") unless within that Notice Period You
+either agree in writing (i) to pay Respondent a mutually agreeable reasonably
+royalty for Your past or future use of Licensed Software made by such
+Respondent, or (ii) withdraw Your litigation claim with respect to Licensed
+Software against such Respondent. If within said Notice Period a reasonable
+royalty and payment arrangement are not mutually agreed upon in writing by the
+parties or the litigation claim is not withdrawn, the rights granted by
+Licensor to You under Sections 3 and 4 automatically terminate at the
+expiration of said Notice Period.
+
+12.3 Reasonable Value of This License. If You assert a patent infringement
+claim against Respondent alleging that Licensed Software directly or
+indirectly infringes any patent where such claim is resolved (such as by
+license or settlement) prior to the initiation of patent infringement
+litigation, then the reasonable value of the licenses granted by said
+Respondent under Sections 3 and 4 shall be taken into account in determining
+the amount or value of any payment or license.
+
+12.4 No Retroactive Effect of Termination. In the event of termination under
+this Section all end user license agreements (excluding licenses to
+distributors and resellers) that have been validly granted by You or any
+distributor hereunder prior to termination shall survive termination.
+
+13.0 Miscellaneous.
+
+13.1 U.S. Government End Users. The Licensed Software is a "commercial item,"
+as that term is defined in 48 C.F.R. 2.101 (Oct. 1995), consisting of
+"commercial computer software" and "commercial computer software
+documentation," as such terms are used in 48 C.F.R. 12.212 (Sept. 1995).
+Consistent with 48 C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4
+(June 1995), all U.S. Government End Users acquire Licensed Software with only
+those rights set forth herein.
+
+13.2 Relationship of Parties. This License will not be construed as creating
+an agency, partnership, joint venture, or any other form of legal association
+between or among You, Licensor, or any Contributor, and You will not represent
+to the contrary, whether expressly, by implication, appearance, or otherwise.
+
+13.3 Independent Development. Nothing in this License will impair Licensor's
+right to acquire, license, develop, subcontract, market, or distribute
+technology or products that perform the same or similar functions as, or
+otherwise compete with, Extensions that You may develop, produce, market, or
+distribute.
+
+13.4 Consent To Breach Not Waiver. Failure by Licensor or Contributor to
+enforce any provision of this License will not be deemed a waiver of future enforcement
+of that or any other provision.
+
+13.5 Severability. This License represents the complete agreement concerning
+the subject matter hereof. If any provision of this License is held to be
+unenforceable, such provision shall be reformed only to the extent necessary
+to make it enforceable.
+
+13.6 Inability to Comply Due to Statute or Regulation. If it is impossible for
+You to comply with any of the terms of this License with respect to some or
+all of the Licensed Software due to statute, judicial order, or regulation,
+then You cannot use, modify, or distribute the software.
+
+13.7 Export Restrictions. You may be restricted with respect to downloading or
+otherwise acquiring, exporting, or reexporting the Licensed Software or any
+underlying information or technology by United States and other applicable
+laws and regulations. By downloading or by otherwise obtaining the Licensed
+Software, You are agreeing to be responsible for compliance with all
+applicable laws and regulations.
+
+13.8 Arbitration, Jurisdiction & Venue. This License shall be governed by
+Colorado law provisions (except to the extent applicable law, if any, provides
+otherwise), excluding its conflict-of-law provisions. You expressly agree that
+any dispute relating to this License shall be submitted to binding arbitration
+under the rules then prevailing of the American Arbitration Association. You
+further agree that Adams County, Colorado USA is proper venue and grant such
+arbitration proceeding jurisdiction as may be appropriate for purposes of
+resolving any dispute under this License. Judgement upon any award made in
+arbitration may be entered and enforced in any court of competent
+jurisdiction. The arbitrator shall award attorney's fees and costs of
+arbitration to the prevailing party. Should either party find it necessary to
+enforce its arbitration award or seek specific performance of such award in a
+civil court of competent jurisdiction, the prevailing party shall be entitled
+to reasonable attorney's fees and costs. The application of the United Nations
+Convention on Contracts for the International Sale of Goods is expressly
+excluded. You and Licensor expressly waive any rights to a jury trial in any
+litigation concerning Licensed Software or this License. Any law or regulation
+that provides that the language of a contract shall be construed against the
+drafter shall not apply to this License.
+
+13.9 Entire Agreement. This License constitutes the entire agreement between
+the parties with respect to the subject matter hereof.
+
+EXHIBIT A
+
+The License Notice below must appear in each file of the Source Code of any
+copy You distribute of the Licensed Software or any Extensions thereto:
+
+Unless explicitly acquired and licensed from Licensor under another
+license, the contents of this file are subject to the Reciprocal Public
+License ("RPL") Version 1.5, or subsequent versions as allowed by the RPL,
+and You may not copy or use this file in either source code or executable
+form, except in compliance with the terms and conditions of the RPL.
+
+All software distributed under the RPL is provided strictly on an "AS
+IS" basis, WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, AND
+LICENSOR HEREBY DISCLAIMS ALL SUCH WARRANTIES, INCLUDING WITHOUT
+LIMITATION, ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
+PURPOSE, QUIET ENJOYMENT, OR NON-INFRINGEMENT. See the RPL for specific
+language governing rights and limitations under the RPL.
+
+EXHIBIT B
+
+The User-Visible Attribution Notice below, when provided, must appear in each
+user-visible display as defined in Section 6.4 (d):
Index: phpbb_seo/phpbb_seo_class.php
===================================================================
--- phpbb_seo/phpbb_seo_class.php	(phpBB 3.0.8)
+++ phpbb_seo/phpbb_seo_class.php	(Premod 3.0.8)
@@ -0,0 +1,886 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: phpbb_seo_class.php 277 2010-11-25 12:09:02Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+require($phpbb_root_path . "phpbb_seo/includes/setup_phpbb_seo.$phpEx");
+/**
+* phpBB_SEO Class
+* www.phpBB-SEO.com
+* @package Ultimate SEO URL phpBB SEO
+*/
+class phpbb_seo extends setup_phpbb_seo {
+	var	$version = '0.6.6';
+	var	$modrtype = 2; // We set it to mixed as a default value
+	var	$seo_path = array();
+	var	$seo_url = array( 'forum' =>  array(), 'topic' =>  array(), 'user' => array(), 'username' => array(), 'group' => array(), 'file' => array() );
+	var	$phpbb_filter = array(
+			'forum' => array('st' => 0, 'sk' => 't', 'sd' => 'd'),
+			'topic' => array('st' => 0, 'sk' => 't', 'sd' => 'a', 'hilit' => ''),
+			'search' => array('st' => 0, 'sk' => 't', 'sd' => 'd', 'ch' => ''),
+		);
+	var	$seo_stop_files = array('posting' => 1, 'faq' => 1, 'ucp' => 1, 'swatch' => 1, 'mcp' => 1, 'style' => 1, 'cron' => 1);
+	var	$seo_stop_vars = array('view=', 'mark=', 'watch=', 'hash=');
+	var	$seo_stop_dirs = array();
+	var	$seo_delim = array( 'forum' => '-f', 'topic' => '-t', 'user' => '-u', 'group' => '-g', 'start' => '-', 'sr' => '-', 'file' => '/');
+	var	$seo_ext = array( 'forum' => '.html', 'topic' => '.html', 'post' => '.html', 'user' => '.html', 'group' => '.html',  'index' => '', 'global_announce' => '/', 'leaders' => '.html', 'atopic' => '.html', 'utopic' => '.html', 'npost' => '.html', 'urpost' => '.html', 'pagination' => '.html', 'gz_ext' => '');
+	var	$seo_static = array( 'forum' => 'forum', 'topic' => 'topic', 'post' => 'post', 'user' => 'member', 'group' => 'group', 'index' => '', 'global_announce' => 'announces', 'leaders' => 'the-team', 'atopic' => 'active-topics', 'utopic' => 'unanswered', 'npost' => 'newposts', 'urpost' => 'unreadposts', 'pagination' => 'page', 'gz_ext' => '.gz' );
+	var	$file_hbase = array();
+	var	$get_vars = array();
+	var	$path = '';
+	var	$start = '';
+	var	$filename = '';
+	var	$file = '';
+	var	$url_in = '';
+	var	$url = '';
+	var	$page_url = '';
+	var	$seo_opt = array( 'url_rewrite' => false, 'modrtype' => 2, 'sql_rewrite' => false, 'profile_inj' => false, 'profile_vfolder' => false, 'profile_noids' => false, 'rewrite_usermsg' => false, 'rewrite_files' => false, 'rem_sid' => false, 'rem_hilit' => true, 'rem_small_words' => false, 'virtual_folder' => false, 'virtual_root' => false, 'cache_layer' => true, 'rem_ids' => false, );
+	var	$rewrite_method = array();
+	var	$paginate_method = array();
+	var	$seo_cache = array();
+	var	$cache_config = array();
+	var	$RegEx = array();
+	var	$sftpl = array();
+	var	$url_replace = array();
+	var	$ssl = array('requested' => false, 'forced' => false);
+	/**
+	* constuctor
+	*/
+	function phpbb_seo() {
+		global $phpEx, $config, $phpbb_root_path;
+		// fix for an interesting bug with parse_str http://bugs.php.net/bug.php?id=48697
+		// and apparently, the bug is still here in php5.3
+		@ini_set("mbstring.internal_encoding", 'UTF-8');
+		// Nothing should be edited here, please do your custom settings in the
+		// phpbb_seo/includes/setup_phpbb_seo.php instead to make your updates easier.
+		// reset the rewrite_method for $phpbb_root_path
+		$this->rewrite_method[$phpbb_root_path] = array();
+		// phpBB files must be treated a bit differently
+		$this->seo_static['file'] = array(ATTACHMENT_CATEGORY_NONE => 'file', ATTACHMENT_CATEGORY_IMAGE => 'image', ATTACHMENT_CATEGORY_WM => 'wm', ATTACHMENT_CATEGORY_RM => 'rm',  ATTACHMENT_CATEGORY_THUMB => 'image', ATTACHMENT_CATEGORY_FLASH => 'flash', ATTACHMENT_CATEGORY_QUICKTIME => 'qt');
+		$this->seo_static['file_index'] = 'resources';
+		$this->seo_static['thumb'] = 'thumb';
+		// Options that may be bypassed by the cached settings.
+		$this->cache_config['dynamic_options'] = array_keys($this->seo_opt); // Do not change
+		// copyright notice, do not change
+		$this->cache_config['dynamic_options']['copyrights'] = $this->seo_opt['copyrights'] = array('img' => true, 'txt' => '', 'title' => '');
+		// Caching config
+		$this->seo_opt['cache_folder'] = 'phpbb_seo/cache/'; // Folder where the cache file is stored
+		define('SEO_CACHE_PATH', rtrim(phpbb_realpath($phpbb_root_path . $this->seo_opt['cache_folder']), '/') . '/'); // do not change
+		$this->seo_opt['topic_type'] = array(); // do not change
+		$this->seo_opt['topic_last_page'] = array(); // do not change
+		$this->cache_config['cache_enable'] = true; // do not change
+		$this->cache_config['rem_ids'] = $this->seo_opt['rem_ids']; // do not change, set up above
+		$this->cache_config['files'] = array('forum' => 'phpbb_cache.' . $phpEx, 'htaccess' => '.htaccess');
+		$this->cache_config['cached'] = false; // do not change
+		$this->cache_config['forum'] = array(); // do not change
+		$this->cache_config['topic'] = array(); // do not change
+		$this->cache_config['settings'] = array(); // do not change
+		// --> DOMAIN SETTING <-- //
+		// SSL, beware with cookie secure, it won't force ssl here,
+		// so you will need to switch to ssl for your user to use cookie based session (no sid)
+		// could be done by using an https link to login form (or within the redirect after login)
+		$this->ssl['requested'] = (bool) ((isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] === 'on' || $_SERVER['HTTPS'] === true)) || (isset($_SERVER['SERVER_PORT']) && (int) $_SERVER['SERVER_PORT'] === 443));
+		$this->ssl['forced'] = (bool) (($config['server_protocol'] === 'https//'));
+		$this->ssl['use'] = (bool) ($this->ssl['requested'] || $this->ssl['forced']);
+		// Server Settings, rely on DB
+		$server_protocol = $this->ssl['use'] ? 'https://' : 'http://';
+		$server_name = trim($config['server_name'], '/ ');
+		$server_port = max(0, (int) $config['server_port']);
+		$server_port = ($server_port && $server_port <> 80) ? ':' . $server_port : '';
+		$script_path = trim($config['script_path'], './ ');
+		$script_path = (empty($script_path) ) ? '' : $script_path . '/';
+		$this->seo_path['root_url'] = strtolower($server_protocol . $server_name . $server_port . '/');
+		$this->seo_path['phpbb_urlR'] = $this->seo_path['phpbb_url'] =  $this->seo_path['root_url'] . $script_path;
+		$this->seo_path['phpbb_script'] = $script_path;
+		$this->seo_path['phpbb_files'] = $this->seo_path['phpbb_url'] . 'download/';
+		$this->seo_path['canonical'] = '';
+		// magic quotes, do it like this in case phpbb_seo class is not started in common.php
+		if (!defined('STRIP')) {
+			if (version_compare(PHP_VERSION, '6.0.0-dev', '<') ) {
+				if (get_magic_quotes_gpc()) {
+					define('SEO_STRIP', true);
+				}
+			}
+		} elseif (STRIP) {
+			define('SEO_STRIP', true);
+		}
+		// File setting
+		$this->seo_req_uri();
+		$this->seo_opt['seo_base_href'] = $this->seo_opt['req_file'] = $this->seo_opt['req_self'] = '';
+		if ($script_name = (!empty($_SERVER['PHP_SELF'])) ? $_SERVER['PHP_SELF'] : getenv('PHP_SELF')) {
+			// From session.php
+			// Replace backslashes and doubled slashes (could happen on some proxy setups)
+			$this->seo_opt['req_self'] = str_replace(array('\\', '//'), '/', $script_name);
+			// basenamed page name (for example: index)
+			$this->seo_opt['req_file'] = urlencode(htmlspecialchars(str_replace(".$phpEx", '', basename($this->seo_opt['req_self']))));
+		}
+		// Load settings from phpbb_seo/includes/setup_phpbb_seo.php
+		$this->init_phpbb_seo();
+		$this->seo_path['phpbb_filesR'] = $this->seo_path['phpbb_urlR'] . $this->seo_static['file_index'] . $this->seo_delim['file'];
+		// see if we have some custom replacement
+		if (!empty($this->url_replace)) {
+			$this->url_replace = array(
+				'find' => array_keys($this->url_replace),
+				'replace' => array_values($this->url_replace)
+			);
+		}
+		$this->seo_opt['topic_per_page'] = ($config['posts_per_page'] <= 0) ? 1 : $config['posts_per_page']; // do not change
+		// Array of the filenames that require the use of a base href tag.
+		$this->file_hbase = array_merge(array('viewtopic' => $this->seo_path['phpbb_url'], 'viewforum' => $this->seo_path['phpbb_url'], 'memberlist' => $this->seo_path['phpbb_url'], 'search' => $this->seo_path['phpbb_url']), $this->file_hbase);
+		// Stop dirs
+		$this->seo_stop_dirs = array_merge(array($phpbb_root_path . 'adm/' => false), $this->seo_stop_dirs);
+		// Rewrite functions array : array( 'path' => array('file_name' => 'function_name'));
+		// Warning, this way of doing things is path aware, this implies path to be properly sent to append_sid()
+		// Allow to add options without slowing down the URL rewriting process
+		$this->rewrite_method[$phpbb_root_path] = array_merge(
+			array(
+				'viewtopic' => 'viewtopic',
+				'viewforum' => 'viewforum',
+				'index' => 'index',
+				'memberlist' => 'memberlist',
+				'search' => $this->seo_opt['rewrite_usermsg'] ? 'search' : '',
+			),
+			$this->rewrite_method[$phpbb_root_path]
+		);
+		$this->rewrite_method[$phpbb_root_path . 'download/']['file'] = $this->seo_opt['rewrite_files'] ? 'phpbb_files' : '';
+		$this->paginate_method = array_merge(
+			array(
+				'topic' => $this->seo_ext['topic'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'forum' => $this->seo_ext['forum'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'group' => $this->seo_ext['group'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'user' => $this->seo_ext['user'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'atopic' => $this->seo_ext['atopic'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'utopic' => $this->seo_ext['utopic'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'npost' => $this->seo_ext['npost'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+				'urpost' => $this->seo_ext['urpost'] === '/' ? 'rewrite_pagination_page' : 'rewrite_pagination',
+			),
+			$this->paginate_method
+		);
+		$this->RegEx = array_merge(
+			array(
+				'topic' => array(
+					'check' => '`^' . ($this->seo_opt['virtual_folder'] ? '%1$s/' : '') . '(' . $this->seo_static['topic'] . '|[a-z0-9_-]+' . $this->seo_delim['topic'] . ')$`i',
+					'match' => '`^((([a-z0-9_-]+)(' . $this->seo_delim['forum'] . '([0-9]+))?/)?(' . $this->seo_static['topic'] . '(?!=' . $this->seo_delim['topic'] . ')|.+(?=' . $this->seo_delim['topic'] . '))(' . $this->seo_delim['topic'] . ')?)([0-9]+)$`i',
+					'parent' => 2,
+					'parent_id' => 5,
+					'title' => 6,
+					'id' => 8,
+					'url' => 1,
+				),
+				'forum' => array(
+					'check' => $this->modrtype >= 2 ? '`^[a-z0-9_-]+(' . $this->seo_delim['forum'] . '[0-9]+)?$`i' : '`^' . $this->seo_static['forum'] . '[0-9]+$`i',
+					'match' => '`^((' . $this->seo_static['forum'] . '|.+)(' . $this->seo_delim['forum'] . '([0-9]+))?)$`i',
+					'title' => '\2',
+					'id' => '\4',
+				),
+			),
+			$this->RegEx
+		);
+		// preg_replace() patterns for format_url()
+		// One could want to add |th|horn after |slash, but I'm not sure that  should be replaced with t and  with e
+		$this->RegEx['url_find'] = array('`&([a-z]+)(acute|grave|circ|cedil|tilde|uml|lig|ring|caron|slash);`i', '`&(amp;)?[^;]+;`i', '`[^a-z0-9]`i'); // Do not remove : deaccentuation, html/xml entities & non a-z chars
+		$this->RegEx['url_replace'] = array('\1', '-', '-');
+		if ($this->seo_opt['rem_small_words']) {
+			$this->RegEx['url_find'][] = '`(^|-)[a-z0-9]{1,2}(?=-|$)`i';
+			$this->RegEx['url_replace'][] = '-';
+		}
+		$this->RegEx['url_find'][] ='`[-]+`'; // Do not remove : multi hyphen reduction
+		$this->RegEx['url_replace'][] = '-';
+		// $1 parent : string/
+		// $2 title / url : topic-title / forum-url-fxx
+		// $3 id
+		$this->sftpl = array_merge(
+			array(
+				'topic' => ($this->seo_opt['virtual_folder'] ? '%1$s/' : '') . '%2$s' . $this->seo_delim['topic'] . '%3$s',
+				'topic_smpl' => ($this->seo_opt['virtual_folder'] ? '%1$s/' : '') . $this->seo_static['topic'] . '%3$s',
+				'forum' => $this->modrtype >= 2 ? '%2$s' : $this->seo_static['forum'] . '%3$s',
+				'group' => $this->seo_opt['profile_inj'] ? '%2$s' . $this->seo_delim['group'] . '%3$s' : $this->seo_static['group'] . '%3$s',
+			),
+			$this->sftpl
+		);
+		if ( $this->seo_opt['url_rewrite'] && !defined('ADMIN_START') && isset($this->file_hbase[$this->seo_opt['req_file']])) {
+			$this->seo_opt['seo_base_href'] = '<base href="' . $this->file_hbase[$this->seo_opt['req_file']] . '"/>';
+		}
+		return;
+	}
+	/**
+	* will make sure that configured options are consistent
+	* @access private
+	*/
+	function check_config() {
+		$this->modrtype = max(0, (int) $this->modrtype);
+		// For profiles and user messages pages, if we do not inject, we do not get rid of ids
+		$this->seo_opt['profile_noids'] = $this->seo_opt['profile_inj'] ? $this->seo_opt['profile_noids'] : false;
+		// If profile noids ...
+		if ($this->seo_opt['profile_noids']) {
+			$this->seo_ext['user'] = '/';
+		}
+		// Profile ans user messages virtual folder
+		if ($this->seo_opt['profile_vfolder']) {
+			$this->seo_ext['user'] = '/';
+		}
+		$this->seo_delim['sr'] = $this->seo_ext['user'] == '/' ? '/' : $this->seo_delim['sr'];
+		// If we use virtual folder, we need '/' at the end of the forum URLs
+		if ($this->seo_opt['virtual_folder']) {
+			$this->seo_ext['forum'] = $this->seo_ext['global_announce'] = '/';
+		}
+		// If the forum cache is not activated
+		if (!$this->seo_opt['cache_layer']) {
+			$this->seo_opt['rem_ids'] = false;
+		}
+		// virtual root option
+		if ($this->seo_opt['virtual_root'] && $this->seo_path['phpbb_script']) {
+			// virtual root is available and activated
+			$this->seo_path['phpbb_urlR'] = $this->seo_path['root_url'];
+			$this->file_hbase['index'] = $this->seo_path['phpbb_url'];
+			$this->seo_static['index'] = empty($this->seo_static['index']) ? 'forum' : $this->seo_static['index'];
+		} else {
+			// virtual root is not used or usable
+			$this->seo_opt['virtual_root'] = false;
+		}
+		$this->seo_ext['index'] = empty($this->seo_static['index']) ? '' : ( empty($this->seo_ext['index']) ? '.html' : $this->seo_ext['index']);
+		// In case url rewriting is deactivated
+		if (!$this->seo_opt['url_rewrite'] || $this->modrtype == 0) {
+			$this->seo_opt['sql_rewrite'] = false;
+			$this->seo_opt['zero_dupe']['on'] = false;
+		}
+	}
+	// --> URL rewriting functions <--
+	/**
+	* format_url( $url, $type = 'topic' )
+	* Prepare Titles for URL injection
+	*/
+	function format_url( $url, $type = 'topic' ) {
+		$url = preg_replace('`\[.*\]`U','',$url);
+		if (isset($this->url_replace['find'])) {
+			$url = str_replace($this->url_replace['find'], $this->url_replace['replace'], $url);
+		}
+		$url = htmlentities($url, ENT_COMPAT, 'UTF-8');
+		$url = preg_replace($this->RegEx['url_find'] , $this->RegEx['url_replace'], $url);
+		$url = strtolower(trim($url, '-'));
+		return empty($url) ? $type : $url;
+	}
+	/**
+	* set_url( $url, $id = 0, $type = 'forum', $parent = '' )
+	* Prepare url first part and checks cache
+	*/
+	function set_url( $url, $id = 0, $type = 'forum',  $parent = '') {
+		if ( empty($this->seo_url[$type][$id]) ) {
+			return ( $this->seo_url[$type][$id] = !empty($this->cache_config[$type][$id]) ? $this->cache_config[$type][$id] : sprintf($this->sftpl[$type], $parent, $this->format_url($url, $this->seo_static[$type]) . $this->seo_delim[$type] . $id, $id) );
+		}
+		return $this->seo_url[$type][$id];
+	}
+	/**
+	* prepare_url( $type, $title, $id, $parent = '', $smpl = false )
+	* Prepare url first part
+	*/
+	function prepare_url( $type, $title, $id, $parent = '', $smpl = false ) {
+		return empty($this->seo_url[$type][$id]) ? ($this->seo_url[$type][$id] = sprintf($this->sftpl[$type . ($smpl ? '_smpl' : '')], $parent, !$smpl ? $this->format_url($title, $this->seo_static[$type]) : '', $id)) : $this->seo_url[$type][$id];
+	}
+	/**
+	* set_title( $type, $title, $id, $parent = '' )
+	* Set title for url injection
+	*/
+	function set_title( $type, $title, $id, $parent = '' ) {
+		return empty($this->seo_url[$type][$id]) ? ($this->seo_url[$type][$id] = ($parent ? $parent . '/' : '') . $this->format_url($title, $this->seo_static[$type])) : $this->seo_url[$type][$id];
+	}
+	/**
+	* get_url_info($type, $url, $info = 'title')
+	* Get info from url (title, id, parent etc ...)
+	*/
+	function get_url_info($type, $url, $info = 'title') {
+		$url = trim($url, '/ ');
+		if (preg_match($this->RegEx[$type]['match'], $url, $matches)) {
+			return !empty($matches[$this->RegEx[$type][$info]]) ? $matches[$this->RegEx[$type][$info]] : '';
+		}
+		return '';
+	}
+	/**
+	* check_url( $type, $url, $parent = '')
+	* Validate a prepared url
+	*/
+	function check_url( $type, $url, $parent = '') {
+		if (empty($url)) {
+			return false;
+		}
+		$parent = !empty($parent) ? (string) $parent : '[a-z0-9/_-]+';
+		return !empty($this->RegEx[$type]['check']) ? preg_match(sprintf($this->RegEx[$type]['check'], $parent), $url) : false;
+	}
+	/**
+	* prepare_iurl( $data, $type, $parent = '' )
+	* Prepare url first part (not for forums) with SQL based URL rewriting
+	*/
+	function prepare_iurl( $data, $type, $parent = '' ) {
+		$id = max(0, (int) $data[$type . '_id']);
+		if ( empty($this->seo_url[$type][$id]) ) {
+			if (!empty($data[$type . '_url'])) {
+				return ($this->seo_url[$type][$id] = $data[$type . '_url'] . $id);
+			} else {
+				return ($this->seo_url[$type][$id] = sprintf($this->sftpl[$type . ($this->modrtype > 2 ? '' : '_smpl')], $parent, $this->modrtype > 2 ? $this->format_url($data[$type . '_title'], $this->seo_static[$type]) : '', $id));
+			}
+		}
+		return $this->seo_url[$type][$id];
+	}
+	/**
+	* drop_sid( $url )
+	* drop the sid's in url
+	*/
+	function drop_sid( $url ) {
+		return (strpos($url, 'sid=') !== false) ? trim(preg_replace(array('`&(amp;)?sid=[a-z0-9]*(&amp;|&)?`', '`(\?)sid=[a-z0-9]*`'), array('\2', '\1'), $url), '?') : $url;
+	}
+	/**
+	* set_user_url( $username, $user_id = 0 )
+	* Prepare profile url
+	*/
+	function set_user_url( $username, $user_id = 0 ) {
+		if (empty($this->seo_url['user'][$user_id])) {
+			$username = strip_tags($username);
+			$this->seo_url['username'][$username] = $user_id;
+			if ( $this->seo_opt['profile_inj'] ) {
+				if ( $this->seo_opt['profile_noids'] ) {
+					$this->seo_url['user'][$user_id] = $this->seo_static['user'] . '/' . $this->seo_url_encode($username);
+				} else {
+					$this->seo_url['user'][$user_id] = $this->format_url($username,  $this->seo_delim['user']) . $this->seo_delim['user'] . $user_id;
+				}
+			} else {
+				$this->seo_url['user'][$user_id] = $this->seo_static['user'] . $user_id;
+			}
+		}
+	}
+	/**
+	* seo_url_encode( $url )
+	* custom urlencoding
+	*/
+	function seo_url_encode( $url ) {
+		// can be faster to return $url directly if you do not allow more chars than
+		// [a-zA-Z0-9_\.-] in your usernames
+		// return $url;
+		// Here we hanlde the "&", "/", "+" and "#" case proper ( http://www.php.net/urlencode => http://issues.apache.org/bugzilla/show_bug.cgi?id=34602 )
+		static $find = array('&', '/', '#', '+');
+		static $replace = array('%26', '%2F', '%23', '%2b');
+		return rawurlencode(str_replace( $find, $replace, utf8_normalize_nfc(htmlspecialchars_decode(str_replace('&amp;amp;', '%26', rawurldecode($url))))));
+	}
+	/**
+	* url_rewrite($url, $params = false, $is_amp = true, $session_id = false)
+	* builds and Rewrite URLs.
+	* Allow adding of many more cases than just the
+	* regular phpBB URL rewritting without slowing down the process.
+	* Mimics append_sid with some shortcuts related to how url are rewritten
+	*/
+	function url_rewrite($url, $params = false, $is_amp = true, $session_id = false) {
+		global $phpEx, $user, $_SID, $_EXTRA_URL, $phpbb_root_path;
+		$qs = $anchor = '';
+		$this->get_vars = array();
+		$amp_delim = ($is_amp) ? '&amp;' : '&';
+		if (strpos($url, '#') !== false) {
+			list($url, $anchor) = explode('#', $url, 2);
+			$anchor = '#' . $anchor;
+		}
+		@list($this->path, $qs) = explode('?', $url, 2);
+		if (is_array($params)) {
+			if (!empty($params['#'])) {
+				$anchor = '#' . $params['#'];
+				unset($params['#']);
+			}
+			$qs .= ($qs ? $amp_delim : '') . $this->query_string($params, $amp_delim, '');
+		} elseif ($params) {
+			if (strpos($params, '#') !== false) {
+				list($params, $anchor) = explode('#', $params, 2);
+				$anchor = '#' . $anchor;
+			}
+			$qs .= ($qs ? $amp_delim : '') . $params;
+		}
+		// Appending custom url parameter?
+		if (!empty($_EXTRA_URL)) {
+			$qs .= ($qs ? $amp_delim : '') . implode($amp_delim, $_EXTRA_URL);
+		}
+		// Sid ?
+		if ($session_id === false && !empty($_SID)) {
+			$qs .= ($qs ? $amp_delim : '') . "sid=$_SID";
+		} else if ($session_id) {
+			$qs .= ($qs ? $amp_delim : '') . "sid=$session_id";
+		}
+		// Build vanilla URL
+		if (preg_match("`\.[a-z0-9]+$`i", $this->path) ) {
+			$this->file = basename($this->path);
+			$this->path = ltrim(str_replace($this->file, '', $this->path), '/');
+		} else {
+			$this->file = '';
+			$this->path = ltrim($this->path, '/');
+		}
+		$this->url_in = $this->file . ($qs ? '?' . $qs : '');
+		$url = $this->path . $this->url_in . $anchor;
+		if (isset($this->seo_cache[$url])) {
+			return $this->seo_cache[$url];
+		}
+		if ( !$this->seo_opt['url_rewrite'] || defined('ADMIN_START') || isset($this->seo_stop_dirs[$this->path]) ) {
+			return ($this->seo_cache[$url] = $url);
+		}
+		$this->filename = trim(str_replace(".$phpEx", '', $this->file));
+		if ( isset($this->seo_stop_files[$this->filename]) ) {
+			// add full url
+			$url = $this->path == $phpbb_root_path ? $this->seo_path['phpbb_url'] . preg_replace('`^' . $phpbb_root_path . '`', '', $url) : $url;
+			return ($this->seo_cache[$url] = $url);
+		}
+		parse_str(str_replace('&amp;', '&', $qs), $this->get_vars);
+		// strp slashes if necessary
+		if (defined('SEO_STRIP')) {
+			$this->get_vars = array_map(array(&$this, 'stripslashes'), $this->get_vars);
+		}
+		if (empty($user->data['is_registered'])) {
+			if ( $this->seo_opt['rem_sid'] ) {
+				unset($this->get_vars['sid']);
+			}
+			if ( $this->seo_opt['rem_hilit'] ) {
+				unset($this->get_vars['hilit']);
+			}
+		}
+		$this->url = $this->file;
+		if ( !empty($this->rewrite_method[$this->path][$this->filename]) ) {
+			$this->{$this->rewrite_method[$this->path][$this->filename]}();
+			return ($this->seo_cache[$url] = $this->path . $this->url . $this->query_string($this->get_vars, $amp_delim, '?') . $anchor);
+		} else {
+			return ($this->seo_cache[$url] = $url);
+		}
+	}
+	/**
+	* URL rewritting for viewtopic.php
+	* With Virtual Folder Injection
+	* @access private
+	*/
+	function viewtopic() {
+		global $phpbb_root_path;
+		$this->filter_url($this->seo_stop_vars);
+		$this->path = $this->seo_path['phpbb_urlR'];
+		if ( !empty($this->get_vars['p']) ) {
+			$this->url = $this->seo_static['post'] . $this->get_vars['p'] . $this->seo_ext['post'];
+			unset($this->get_vars['p'], $this->get_vars['f'], $this->get_vars['t'], $this->get_vars['start']);
+			return;
+		}
+		if ( isset($this->get_vars['t']) && !empty($this->seo_url['topic'][$this->get_vars['t']]) ) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['topic']);
+			$this->{$this->paginate_method['topic']}($this->seo_ext['topic']);
+			$this->url = $this->seo_url['topic'][$this->get_vars['t']] . $this->start;
+			unset($this->get_vars['t'], $this->get_vars['f'], $this->get_vars['p']);
+			return;
+		} else if (!empty($this->get_vars['t'])) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['topic']);
+			$this->{$this->paginate_method['topic']}($this->seo_ext['topic']);
+			$this->url = $this->seo_static['topic'] . $this->get_vars['t'] . $this->start;
+			unset($this->get_vars['t'], $this->get_vars['f'], $this->get_vars['p']);
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_url'];
+		return;
+	}
+	/**
+	* URL rewritting for viewforum.php
+	* @access private
+	*/
+	function viewforum() {
+		global $phpbb_root_path;
+		$this->path = $this->seo_path['phpbb_urlR'];
+		$this->filter_url($this->seo_stop_vars);
+		if ( isset($this->get_vars['f']) && !empty($this->seo_url['forum'][$this->get_vars['f']]) ) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['forum']);
+			$this->{$this->paginate_method['forum']}($this->seo_ext['forum']);
+			$this->url = $this->seo_url['forum'][$this->get_vars['f']] . $this->start;
+			unset($this->get_vars['f']);
+			return;
+		} else if (!empty($this->get_vars['f'])) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['forum']);
+			$this->{$this->paginate_method['forum']}($this->seo_ext['forum']);
+			$this->url = $this->seo_static['forum'] . $this->get_vars['f'] . $this->start;
+			unset($this->get_vars['f']);
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_url'];
+		return;
+	}
+	/**
+	* URL rewritting for memberlist.php
+	* with nicknames and group name injection
+	* @access private
+	*/
+	function memberlist() {
+		global $phpbb_root_path;
+		$this->path = $this->seo_path['phpbb_urlR'];
+		if ( @$this->get_vars['mode'] === 'viewprofile' && !@empty($this->seo_url['user'][$this->get_vars['u']]) ) {
+			$this->url = $this->seo_url['user'][$this->get_vars['u']] . $this->seo_ext['user'];
+			unset($this->get_vars['mode'], $this->get_vars['u']);
+			return;
+		} elseif ( @$this->get_vars['mode'] === 'group' && !@empty($this->seo_url['group'][$this->get_vars['g']]) ) {
+			$this->{$this->paginate_method['group']}($this->seo_ext['group']);
+			$this->url =  $this->seo_url['group'][$this->get_vars['g']] . $this->start;
+			unset($this->get_vars['mode'], $this->get_vars['g']);
+			return;
+		} elseif (@$this->get_vars['mode'] === 'leaders') {
+			$this->url =  $this->seo_static['leaders'] . $this->seo_ext['leaders'];
+			unset($this->get_vars['mode']);
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_url'];
+		return;
+	}
+	/**
+	* URL rewritting for search.php
+	* @access private
+	*/
+	function search() {
+		global $phpbb_root_path;
+		if (isset($this->get_vars['fid'])) {
+			$this->get_vars = array();
+			$this->url = $this->url_in;
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_urlR'];
+		$user_id = !empty($this->get_vars['author_id']) ? $this->get_vars['author_id'] : ( isset($this->seo_url['username'][rawurldecode(@$this->get_vars['author'])]) ? $this->seo_url['username'][rawurldecode(@$this->get_vars['author'])] : 0);
+		if ( $user_id && isset($this->seo_url['user'][$user_id]) ) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['search']);
+			$this->{$this->paginate_method['user']}($this->seo_ext['user']);
+			$sr = (@$this->get_vars['sr'] == 'topics' ) ? 'topics' : 'posts';
+			$this->url = $this->seo_url['user'][$user_id] . $this->seo_delim['sr'] . $sr . $this->start;
+			unset($this->get_vars['author_id'], $this->get_vars['author'], $this->get_vars['sr']);
+			return;
+		} elseif ( $this->seo_opt['profile_noids'] && !empty($this->get_vars['author']) ) {
+			// Filter default params
+			$this->filter_get_var($this->phpbb_filter['search']);
+			$this->rewrite_pagination_page();
+			$sr = (@$this->get_vars['sr'] == 'topics' ) ? '/topics' : '/posts';
+			$this->url = $this->seo_static['user'] . '/' . $this->seo_url_encode($this->get_vars['author']) . $sr . $this->start;
+			unset($this->get_vars['author'], $this->get_vars['author_id'], $this->get_vars['sr']);
+			return;
+		} elseif (!empty($this->get_vars['search_id'])) {
+			switch ($this->get_vars['search_id']) {
+				case 'active_topics':
+					$this->filter_get_var($this->phpbb_filter['search']);
+					$this->{$this->paginate_method['atopic']}($this->seo_ext['atopic']);
+					$this->url = $this->seo_static['atopic'] . $this->start;
+					unset($this->get_vars['search_id'], $this->get_vars['sr']);
+					if (@$this->get_vars['st'] == 7) {
+						unset($this->get_vars['st']);
+					}
+					return;
+				case 'unanswered':
+					$this->filter_get_var($this->phpbb_filter['search']);
+					$this->{$this->paginate_method['utopic']}($this->seo_ext['utopic']);
+					$this->url = $this->seo_static['utopic'] . $this->start;
+					unset($this->get_vars['search_id']);
+					if (@$this->get_vars['sr'] == 'topics') {
+						unset($this->get_vars['sr']);
+					}
+					return;
+				case 'egosearch':
+					global $user;
+					$this->set_user_url($user->data['username'], $user->data['user_id']);
+					$this->url = $this->seo_url['user'][$user->data['user_id']] . $this->seo_delim['sr'] . 'topics' . $this->seo_ext['user'];
+					unset($this->get_vars['search_id']);
+					return;
+				case 'newposts':
+					$this->filter_get_var($this->phpbb_filter['search']);
+					$this->{$this->paginate_method['npost']}($this->seo_ext['npost']);
+					$this->url = $this->seo_static['npost'] . $this->start;
+					unset($this->get_vars['search_id']);
+					if (@$this->get_vars['sr'] == 'topics') {
+						unset($this->get_vars['sr']);
+					}
+					return;
+				case 'unreadposts':
+					$this->filter_get_var($this->phpbb_filter['search']);
+					$this->{$this->paginate_method['urpost']}($this->seo_ext['urpost']);
+					$this->url = $this->seo_static['urpost'] . $this->start;
+					unset($this->get_vars['search_id']);
+					if (@$this->get_vars['sr'] == 'topics') {
+						unset($this->get_vars['sr']);
+					}
+					return;
+			}
+		}
+		$this->path = $this->seo_path['phpbb_url'];
+		return;
+	}
+	/**
+	* URL rewritting for download/file.php
+	* @access private
+	*/
+	function phpbb_files() {
+		$this->filter_url($this->seo_stop_vars);
+		$this->path = $this->seo_path['phpbb_filesR'];
+		if (isset($this->get_vars['id']) && !empty($this->seo_url['file'][$this->get_vars['id']])) {
+			$this->url = $this->seo_url['file'][$this->get_vars['id']];
+			if (!empty($this->get_vars['t'])) {
+				$this->url .= $this->seo_delim['file'] . $this->seo_static['thumb'];
+			} /*else if (@$this->get_vars['mode'] == 'view') {
+				$this->url .= $this->seo_delim['file'] . 'view';
+			}*/
+			$this->url .= $this->seo_delim['file'] . $this->get_vars['id'];
+			unset($this->get_vars['id'], $this->get_vars['t'], $this->get_vars['mode']);
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_files'];
+		return;
+	}
+	/**
+	* URL rewritting for index.php
+	* @access private
+	*/
+	function index() {
+		$this->path = $this->seo_path['phpbb_urlR'];
+		if ($this->filter_url($this->seo_stop_vars)) {
+			$this->url = $this->seo_static['index'] . $this->seo_ext['index'];
+			return;
+		}
+		$this->path = $this->seo_path['phpbb_url'];
+		return;
+	}
+	/**
+	* Returns true if the user can edit urls
+	* @access public
+	*/
+	function url_can_edit($forum_id = 0) {
+		global $user, $auth;
+		if (empty($this->seo_opt['sql_rewrite']) || empty($user->data['is_registered'])) {
+			return false;
+		}
+		if ($auth->acl_get('a_')) {
+			return true;
+		}
+		// un comment to grant url edit perm to moderators in at least a forums
+		/*if ($auth->acl_getf_global('m_')) {
+			return true;
+		}*/
+		$forum_id = max(0, (int) $forum_id);
+		if ($forum_id && $auth->acl_get('m_', $forum_id)) {
+			return true;
+		}
+		return false;
+	}
+	/**
+	* Will break if a $filter pattern is foundin $url.
+	* Example $filter = array("view=", "mark=");
+	* @access private
+	*/
+	function filter_url($filter = array()) {
+		foreach ($filter as $patern ) {
+			if ( strpos($this->url_in, $patern) !== false ) {
+				$this->get_vars = array();
+				$this->url = $this->url_in;
+				return false;
+			}
+		}
+		return true;
+	}
+	/**
+	* Will unset all default var stored in $filter array.
+	* Example $filter = array('st' => 0, 'sk' => 't', 'sd' => 'a', 'hilit' => '');
+	* @access private
+	*/
+	function filter_get_var($filter = array()) {
+		if ( !empty($this->get_vars) ) {
+			foreach ($this->get_vars as $paramkey => $paramval) {
+				if ( isset($filter[$paramkey]) ) {
+					if ( $filter[$paramkey] ==  $this->get_vars[$paramkey] || !isset($this->get_vars[$paramkey])) {
+						unset($this->get_vars[$paramkey]);
+					}
+				}
+			}
+		}
+		return;
+	}
+	/**
+	* Appends the GET vars in the query string
+	* @access public
+	*/
+	function query_string($get_vars = array(), $amp_delim = '&amp;', $url_delim = '?') {
+		if(empty($get_vars)) {
+			return '';
+		}
+		$params = array();
+		foreach($get_vars as $key => $value) {
+			if (is_array($value)) {
+				foreach($value as $k => $v) {
+					$params[] = $key . '[' . $k . ']=' . $v;
+				}
+			} else {
+				$params[] = $key . (!trim($value) ? '' : '=' . $value);
+			}
+		}
+		return $url_delim . implode($amp_delim , $params);
+	}
+	/**
+	* rewrite pagination, simple
+	* -xx.html
+	*/
+	function rewrite_pagination($suffix) {
+		$this->start = $this->seo_start( @$this->get_vars['start'] ) . $suffix;
+		unset($this->get_vars['start']);
+	}
+	/**
+	* rewrite pagination, virtual folder
+	* /pagexx.html
+	*/
+	function rewrite_pagination_page() {
+		$this->start = '/' . $this->seo_start_page( @$this->get_vars['start'] );
+		unset($this->get_vars['start']);
+	}
+	/**
+	* Returns usable start param
+	* -xx
+	*/
+	function seo_start($start) {
+		return ($start >= 1 ) ? $this->seo_delim['start'] . (int) $start : '';
+	}
+	/**
+	* Returns usable start param
+	* pagexx.html
+	* Only used in virtual folder mode
+	*/
+	function seo_start_page($start) {
+		return ($start >=1 ) ? $this->seo_static['pagination'] . (int) $start . $this->seo_ext['pagination'] : '';
+	}
+	/**
+	* Returns the full REQUEST_URI
+	*/
+	function seo_req_uri() {
+		if ( !empty($_SERVER['HTTP_X_REWRITE_URL']) ) { // IIS  isapi_rewrite
+			$this->seo_path['uri'] = ltrim($_SERVER['HTTP_X_REWRITE_URL'], '/');
+		} elseif ( !empty($_SERVER['REQUEST_URI']) ) { // Apache mod_rewrite
+			$this->seo_path['uri'] = ltrim($_SERVER['REQUEST_URI'], '/');
+		} else { // no mod rewrite
+			$this->seo_path['uri'] =  ltrim($_SERVER['SCRIPT_NAME'], '/') . ( ( !empty($_SERVER['QUERY_STRING']) ) ? '?'.$_SERVER['QUERY_STRING'] : '' );
+		}
+		$this->seo_path['uri'] = str_replace( '%26', '&', rawurldecode($this->seo_path['uri']));
+		// workaround for FF default iso encoding
+		if (!$this->is_utf8($this->seo_path['uri'])) {
+			$this->seo_path['uri'] = utf8_normalize_nfc(utf8_recode($this->seo_path['uri'], 'iso-8859-1'));
+		}
+		$this->seo_path['uri'] = $this->seo_path['root_url'] . $this->seo_path['uri'];
+		return $this->seo_path['uri'];
+	}
+	/**
+	* seo_end() : The last touch function
+	* Note : This mod is going to help your site a lot in Search Engines
+	* We request that you keep this copyright notice as specified in the licence.
+	* If You really cannot put this link, you should at least provide us with one visible
+	* (can be small but visible) link on your home page or your forum Index using this code for example :
+	* <a href="http://www.phpbb-seo.com/" title="Search Engine Optimization">phpBB SEO</a>
+	*/
+	function seo_end($return = false) {
+		global $user, $config;
+		if (empty($this->seo_opt['copyrights']['title'])) {
+			$this->seo_opt['copyrights']['title'] = strpos($config['default_lang'], 'fr') !== false  ?  'Optimisation du R&eacute;f&eacute;rencement' : 'Search Engine Optimization';
+		}
+		if (empty($this->seo_opt['copyrights']['txt'])) {
+			$this->seo_opt['copyrights']['txt'] = 'phpBB SEO';
+		}
+		if ($this->seo_opt['copyrights']['img']) {
+			$output = '<br /><a href="http://www.phpbb-seo.com/" title="' . $this->seo_opt['copyrights']['title'] . '"><img src="' . $this->seo_path['phpbb_url'] . 'images/phpbb-seo.png" alt="' . $this->seo_opt['copyrights']['txt'] . '"/></a>';
+		} else {
+			$output = '<br /><a href="http://www.phpbb-seo.com/" title="' . $this->seo_opt['copyrights']['title'] . '">' . $this->seo_opt['copyrights']['txt'] . '</a>';
+		}
+		if ($return) {
+			return $output;
+		} else {
+			$user->lang['TRANSLATION_INFO'] .= $output;
+		}
+		return;
+	}
+	// -> Cache functions
+	/**
+	* forum_id(&$forum_id, $forum_uri = '')
+	* will tell the forum id from the uri or the forum_uri GET var by checking the cache.
+	*/
+	function get_forum_id(&$forum_id, $forum_uri = '') {
+		if (empty($forum_uri)) {
+			$forum_uri = request_var('forum_uri', '');
+			unset($_GET['forum_uri'], $_REQUEST['forum_uri']);
+		}
+		if (empty($forum_uri) || $forum_uri == $this->seo_static['global_announce']) {
+			return 0;
+		}
+		if ($id = @array_search($forum_uri, $this->cache_config['forum']) ) {
+			$forum_id = max(0, (int) $id);
+		} elseif ( $id = $this->get_url_info('forum', $forum_uri, 'id')) {
+			$forum_id = max(0, (int) $id);
+		}
+		return $forum_id;
+	}
+	/**
+	* check_cache() will tell if the required file exists.
+	* @access private
+	*/
+	function check_cache( $type = 'forum', $from_bkp = false ) {
+		$file = SEO_CACHE_PATH . @$this->cache_config['files'][$type];
+		if( !$this->cache_config['cache_enable'] || !isset($this->cache_config['files'][$type]) || !file_exists($file) ) {
+			$this->cache_config['cached'] = false;
+			return false;
+		}
+		include($file);
+		if (is_array($this->cache_config[$type]) ) {
+			$this->cache_config['cached'] = true;
+			return true;
+		} else {
+			if ( !$from_bkp ) {
+				// Try the current backup
+				@copy($file . '.current', $file);
+				$this->check_cache( $type, true );
+			}
+			$this->cache_config['cached'] = false;
+			return false;
+		}
+	}
+	/**
+	* sslify($url, $ssl = true,  $proto_check = true)
+	* properly set http protocol (eg http or https)
+	* if no protocol is specified, will return false with $proto_check set to true
+	*/
+	function sslify($url, $ssl = true, $proto_check = true) {
+		static $mask = '`^https?://`i';
+		$url = trim($url);
+		if ($url && preg_match($mask, $url)) {
+			$replace = $ssl ? 'https://' : 'http://';
+			return preg_replace($mask, $replace, $url);
+		}
+		return $proto_check ? false : $url;
+	}
+	/**
+	* is_utf8($string)
+	* Borrowed from php.net : http://www.php.net/mb_detect_encoding (detectUTF8)
+	*/
+	function is_utf8($string) {
+		// non-overlong 2-byte|excluding overlongs|straight 3-byte|excluding surrogates|planes 1-3|planes 4-15|plane 16
+		return preg_match('%(?:[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF] |\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})+%xs', $string);
+	}
+	/**
+	* stripslashes($value)
+	* Borrowed from php.net : http://www.php.net/stripslashes
+	*/
+	function stripslashes($value) {
+		return is_array($value) ? array_map(array(&$this, 'stripslashes'), $value) : stripslashes($value);
+	}
+	// --> Add on Functions <--
+	// --> Gen stats
+	/**
+	* Returns usable microtime
+	* Borrowed from php.net
+	*/
+	function microtime_float() {
+		return array_sum(explode(' ',microtime()));
+	}
+} // End of the phpbb_seo class
+?>
\ No newline at end of file
Index: phpbb_seo/phpbb_seo_install.php
===================================================================
--- phpbb_seo/phpbb_seo_install.php	(phpBB 3.0.8)
+++ phpbb_seo/phpbb_seo_install.php	(Premod 3.0.8)
@@ -0,0 +1,776 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: phpbb_seo_install.php 222 2010-02-27 13:08:48Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+/*
+ * Based on the phpBB3 install package / www.phpBB.com
+ */
+define('IN_PHPBB', true);
+define('IN_INSTALL', true);
+$phpbb_root_path = (defined('PHPBB_ROOT_PATH')) ? PHPBB_ROOT_PATH : './../';
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+// Try to override some limits - maybe it helps some...
+@set_time_limit(0);
+$mem_limit = @ini_get('memory_limit');
+if (!empty($mem_limit)) {
+	$unit = strtolower(substr($mem_limit, -1, 1));
+	$mem_limit = (int) $mem_limit;
+	if ($unit == 'k') {
+		$mem_limit = floor($mem_limit / 1024);
+	} else if ($unit == 'g') {
+		$mem_limit *= 1024;
+	} else if (is_numeric($unit)) {
+		$mem_limit = floor((int) ($mem_limit . $unit) / 1048576);
+	}
+	$mem_limit = max(128, $mem_limit) . 'M';
+} else {
+	$mem_limit = '128M';
+}
+@ini_set('memory_limit', $mem_limit);
+include($phpbb_root_path . 'common.' . $phpEx);
+// Include essential scripts
+require($phpbb_root_path . 'includes/functions_install.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('mods/acp_phpbb_seo');
+// Security check
+// Circumvent a potential phpbb bug with paths
+$redirect = append_sid(generate_board_url() . "/phpbb_seo/phpbb_seo_install.$phpEx");
+if (!$user->data['is_registered']) {
+	login_box($redirect, $user->lang['SEO_LOGIN'],'', false, false);
+}
+if (!$auth->acl_get('a_')) {
+	$user->session_kill(true);
+	login_box($redirect, $user->lang['SEO_LOGIN_ADMIN'],'', false, false);
+}
+if ($user->data['user_type'] != USER_FOUNDER) {
+	login_box($redirect, $user->lang['SEO_LOGIN_FOUNDER'],'', false, false);
+}
+$user->add_lang(array('acp/common', 'acp/board', 'install', 'posting', 'acp/modules'));
+$mode = request_var('mode', 'overview');
+$sub = request_var('sub', '');
+// Set some standard variables we want to force
+$config['load_tplcompile']	= '1';
+$template->set_custom_template('../adm/style', '../admin');
+$template->assign_var('T_TEMPLATE_PATH', '../adm/style');
+// the acp template is never stored in the database
+$user->theme['template_storedb'] = false;
+// Start the installer
+$install = new module();
+$install->create('install', "phpbb_seo_install.$phpEx", $mode, $sub);
+$install->load();
+// Generate the page
+$install->page_header();
+$install->generate_navigation();
+$template->set_filenames(array(
+	'body' => $install->get_tpl_name())
+);
+$install->page_footer();
+/**
+* @package install
+*/
+class module {
+	var $id = 0;
+	var $type = 'install';
+	var $module_ary = array();
+	var $filename;
+	var $module_url = '';
+	var $tpl_name = '';
+	var $mode;
+	var $sub;
+	/**
+	* Private methods, should not be overwritten
+	*/
+	function create($module_type, $module_url, $selected_mod = false, $selected_submod = false) {
+		global $db, $config, $phpEx, $phpbb_root_path, $user;
+		$module = array(
+			array(
+				'module_type'		=> 'install',
+				'module_title'		=> 'OVERVIEW',
+				'module_filename'	=> 'overview_phpbb_seo',
+				'module_order'		=> 0,
+				'module_subs'		=> array('INTRO', 'LICENSE', 'SUPPORT'),
+				'module_stages'		=> '',
+				'module_reqs'		=> ''
+			),
+			array(
+				'module_type'		=> 'install',
+				'module_title'		=> 'INSTALL_PHPBB_SEO',
+				'module_filename'	=> 'install_phpbb_seo',
+				'module_order'		=> 1,
+				'module_subs'		=> '',
+				'module_stages'		=> array('INTRO', 'FINAL'),
+				'module_reqs'		=> ''
+			),
+			array(
+				'module_type'		=> 'uninstall',
+				'module_title'		=> 'UNINSTALL_PHPBB_SEO',
+				'module_filename'	=> 'install_phpbb_seo',
+				'module_order'		=> 2,
+				'module_subs'		=> '',
+				'module_stages'		=> array('INTRO', 'FINAL'),
+				'module_reqs'		=> ''
+			),
+		);
+		// Order to use and count further if modules get assigned to the same position or not having an order
+		$max_module_order = 1000;
+		foreach ($module as $row) {
+			// Module order not specified or module already assigned at this position?
+			if (!isset($row['module_order']) || isset($this->module_ary[$row['module_order']])) {
+				$row['module_order'] = $max_module_order;
+				$max_module_order++;
+			}
+			$this->module_ary[$row['module_order']]['name'] = $row['module_title'];
+			$this->module_ary[$row['module_order']]['filename'] = $row['module_filename'];
+			$this->module_ary[$row['module_order']]['subs'] = $row['module_subs'];
+			$this->module_ary[$row['module_order']]['stages'] = $row['module_stages'];
+			if (strtolower($selected_mod) == strtolower($row['module_title'])) {
+				$this->id = (int) $row['module_order'];
+				$this->filename = (string) $row['module_filename'];
+				$this->module_url = (string) $module_url;
+				$this->mode = (string) $selected_mod;
+				// Check that the sub-mode specified is valid or set a default if not
+				if (is_array($row['module_subs'])) {
+					$this->sub = strtolower((in_array(strtoupper($selected_submod), $row['module_subs'])) ? $selected_submod : $row['module_subs'][0]);
+				} else if (is_array($row['module_stages'])) {
+					$this->sub = strtolower((in_array(strtoupper($selected_submod), $row['module_stages'])) ? $selected_submod : $row['module_stages'][0]);
+				} else {
+					$this->sub = '';
+				}
+			}
+		} // END foreach
+	} // END create
+	/**
+	* Load and run the relevant module if applicable
+	*/
+	function load($mode = false, $run = true) {
+		global $phpbb_root_path, $phpEx;
+		if ($run) {
+			if (!empty($mode)) {
+				$this->mode = $mode;
+			}
+			$module = $this->filename;
+			if (!class_exists($module)) {
+				$this->error('Module "' . htmlspecialchars($module) . '" not accessible.', __LINE__, __FILE__);
+			}
+			$this->module = new $module($this);
+			if (method_exists($this->module, 'main')) {
+				$this->module->main($this->mode, $this->sub);
+			}
+		}
+	}
+	/**
+	* Output the standard page header
+	*/
+	function page_header() {
+		if (defined('HEADER_INC')) {
+			return;
+		}
+		define('HEADER_INC', true);
+		global $template, $user, $stage, $phpbb_root_path;
+		$template->assign_vars(array(
+			'L_INSTALL_PANEL'	=> $user->lang['SEO_INSTALL_PANEL'],
+			'L_SKIP'		=> $user->lang['SKIP'],
+			'PAGE_TITLE'		=> $this->get_page_title(),
+			'T_IMAGE_PATH'		=> $phpbb_root_path . 'adm/images/',
+			'S_CONTENT_DIRECTION' 	=> $user->lang['DIRECTION'],
+			'S_CONTENT_ENCODING' 	=> 'UTF-8',
+			'S_USER_LANG'		=> $user->lang['USER_LANG'],
+			)
+		);
+		header('Content-type: text/html; charset=UTF-8');
+		header('Cache-Control: private, no-cache="set-cookie"');
+		header('Expires: 0');
+		header('Pragma: no-cache');
+		return;
+	}
+	/**
+	* Output the standard page footer
+	*/
+	function page_footer() {
+		global $db, $template, $phpbb_seo;
+		$template->display('body');
+		// Close our DB connection.
+		if (!empty($db) && is_object($db)) {
+			$db->sql_close();
+		}
+		exit;
+	}
+	/**
+	* Returns desired template name
+	*/
+	function get_tpl_name() {
+		return $this->module->tpl_name . '.html';
+	}
+	/**
+	* Returns the desired page title
+	*/
+	function get_page_title() {
+		global $user;
+		if (!isset($this->module->page_title)) {
+			return '';
+		}
+		return (isset($user->lang[$this->module->page_title])) ? $user->lang[$this->module->page_title] : $this->module->page_title;
+	}
+	/**
+	* Generate an HTTP/1.1 header to redirect the user to another page
+	* This is used during the installation when we do not have a database available to call the normal redirect function
+	* @param string $page The page to redirect to relative to the installer root path
+	*/
+	function redirect($page) {
+		$server_name = (!empty($_SERVER['SERVER_NAME'])) ? $_SERVER['SERVER_NAME'] : getenv('SERVER_NAME');
+		$server_port = (!empty($_SERVER['SERVER_PORT'])) ? (int) $_SERVER['SERVER_PORT'] : (int) getenv('SERVER_PORT');
+		$secure = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 1 : 0;
+
+		$script_name = (!empty($_SERVER['PHP_SELF'])) ? $_SERVER['PHP_SELF'] : getenv('PHP_SELF');
+		if (!$script_name) {
+			$script_name = (!empty($_SERVER['REQUEST_URI'])) ? $_SERVER['REQUEST_URI'] : getenv('REQUEST_URI');
+		}
+		// Replace backslashes and doubled slashes (could happen on some proxy setups)
+		$script_name = str_replace(array('\\', '//'), '/', $script_name);
+		$script_path = trim(dirname($script_name));
+		$url = (($secure) ? 'https://' : 'http://') . $server_name;
+		if ($server_port && (($secure && $server_port <> 443) || (!$secure && $server_port <> 80))) {
+			$url .= ':' . $server_port;
+		}
+		$url .= $script_path . '/' . $page;
+		header('Location: ' . $url);
+		exit;
+	}
+	/**
+	* Generate the navigation tabs
+	*/
+	function generate_navigation() {
+		global $user, $template, $phpEx;
+		if (is_array($this->module_ary)) {
+			@ksort($this->module_ary);
+			foreach ($this->module_ary as $cat_ary) {
+				$cat = $cat_ary['name'];
+				$l_cat = (!empty($user->lang['CAT_' . $cat])) ? $user->lang['CAT_' . $cat] : preg_replace('#_#', ' ', $cat);
+				$cat = strtolower($cat);
+				$url = $this->module_url . "?mode=$cat";
+				if ($this->mode == $cat) {
+					$template->assign_block_vars('t_block1', array(
+						'L_TITLE'		=> $l_cat,
+						'S_SELECTED'	=> true,
+						'U_TITLE'		=> $url,
+					));
+					if (is_array($this->module_ary[$this->id]['subs'])) {
+						$subs = $this->module_ary[$this->id]['subs'];
+						foreach ($subs as $option) {
+							$l_option = (!empty($user->lang['SUB_' . $option])) ? $user->lang['SUB_' . $option] : preg_replace('#_#', ' ', $option);
+							$option = strtolower($option);
+							$url = $this->module_url . '?mode=' . $this->mode . "&amp;sub=$option";
+							$template->assign_block_vars('l_block1', array(
+								'L_TITLE'		=> $l_option,
+								'S_SELECTED'	=> ($this->sub == $option),
+								'U_TITLE'		=> $url,
+							));
+						}
+					}
+					if (is_array($this->module_ary[$this->id]['stages'])) {
+						$subs = $this->module_ary[$this->id]['stages'];
+						$matched = false;
+						foreach ($subs as $option) {
+							$l_option = (!empty($user->lang['STAGE_' . $option])) ? $user->lang['STAGE_' . $option] : preg_replace('#_#', ' ', $option);
+							$option = strtolower($option);
+							$matched = ($this->sub == $option) ? true : $matched;
+
+							$template->assign_block_vars('l_block2', array(
+								'L_TITLE'		=> $l_option,
+								'S_SELECTED'	=> ($this->sub == $option),
+								'S_COMPLETE'	=> !$matched,
+							));
+						}
+					}
+				} else {
+					$template->assign_block_vars('t_block1', array(
+						'L_TITLE'		=> $l_cat,
+						'S_SELECTED'	=> false,
+						'U_TITLE'		=> $url,
+					));
+				}
+			}
+		}
+	}
+	/**
+	* Output an error message
+	* If skip is true, return and continue execution, else exit
+	*/
+	function error($error, $line = '', $file = '', $skip = false, $title = '') {
+		global $user, $db, $template, $phpbb_seo;
+		$title = !empty($title) ? $title : $user->lang['INST_ERR_FATAL'];
+		$file = !empty($file) ? basename($file) . ' [ ' . $line . ' ]' : '';
+		if ($skip) {
+			$template->assign_block_vars('checks', array(
+				'S_LEGEND'	=> true,
+				'LEGEND'	=> $user->lang['INST_ERR'],
+			));
+			$template->assign_block_vars('checks', array(
+				'TITLE'		=> basename($file) . ' [ ' . $line . ' ]',
+				'RESULT'	=> '<b style="color:red">' . $error . '</b>',
+			));
+			return;
+		}
+		echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">';
+		echo '<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">';
+		echo '<head>';
+		echo '<meta http-equiv="content-type" content="text/html; charset=utf-8" />';
+		echo '<title>' . $title . '</title>';
+		echo '<link href="../adm/style/admin.css" rel="stylesheet" type="text/css" media="screen" />';
+		echo '</head>';
+		echo '<body id="errorpage">';
+		echo '<div id="wrap">';
+		echo '	<div id="page-header">';
+		echo '	</div>';
+		echo '	<div id="page-body">';
+		echo '		<div id="acp">';
+		echo '		<div class="panel">';
+		echo '			<span class="corners-top"><span></span></span>';
+		echo '			<div id="content">';
+		echo '				<h1>' . $title . '</h1>';
+		echo '				<p>' . $file . '</p>' . "\n";
+		echo '				<p><b>' . $error . "</b></p>\n";
+		echo '			</div>';
+		echo '			<span class="corners-bottom"><span></span></span>';
+		echo '		</div>';
+		echo '		</div>';
+		echo '	</div>';
+		echo '	<div id="page-footer">';
+		echo '		Powered by phpBB &copy; 2000, 2002, 2005, 2007 <a href="http://www.phpbb.com/">phpBB Group</a>';
+		echo 		$phpbb_seo->seo_end(true);
+		echo '	</div>';
+		echo '</div>';
+		echo '</body>';
+		echo '</html>';
+		if (!empty($db) && is_object($db)) {
+			$db->sql_close();
+		}
+		exit;
+	}
+	/**
+	* Output an error message for a database related problem
+	* If skip is true, return and continue execution, else exit
+	*/
+	function db_error($error, $sql, $line, $file, $skip = false) {
+		global $user, $db, $template;
+		if ($skip) {
+			$template->assign_block_vars('checks', array(
+				'S_LEGEND'	=> true,
+				'LEGEND'	=> $user->lang['INST_ERR_FATAL'],
+			));
+			$template->assign_block_vars('checks', array(
+				'TITLE'		=> basename($file) . ' [ ' . $line . ' ]',
+				'RESULT'	=> '<b style="color:red">' . $error . '</b><br />&#187; SQL:' . $sql,
+			));
+			return;
+		}
+		$template->set_filenames(array(
+			'body' => 'install_error.html')
+		);
+		$this->page_header();
+		$this->generate_navigation();
+		$template->assign_vars(array(
+			'MESSAGE_TITLE'		=> $user->lang['INST_ERR_FATAL_DB'],
+			'MESSAGE_TEXT'		=> '<p>' . basename($file) . ' [ ' . $line . ' ]</p><p>SQL : ' . $sql . '</p><p><b>' . $error . '</b></p>',
+		));
+		// Rollback if in transaction
+		if ($db->transaction) {
+			$db->sql_transaction('rollback');
+		}
+		$this->page_footer();
+	}
+}
+/**
+* Installation Tabs
+*/
+class install_phpbb_seo extends module {
+	var $errors = array();
+	var $uninst_prefix = '';
+	var $modrtype_lang = array();
+	function install_phpbb_seo(&$p_master) {
+		global $user, $phpbb_seo, $config;
+		$this->modrtype_lang = set_phpbb_seo_links();
+		$this->p_master = &$p_master;
+	}
+	function main($mode, $sub) {
+		global $user, $template, $phpbb_root_path, $phpbb_seo;
+		$this->uninst_prefix = $mode == 'install_phpbb_seo' ? '' : 'UN_';
+		switch ($sub) {
+			case 'intro':
+				$this->page_title = $user->lang['SUB_INTRO'];
+				$template->assign_vars(array(
+					'TITLE'			=> $user->lang[$this->uninst_prefix . 'SEO_INSTALL_INTRO'],
+					'BODY'			=> sprintf($user->lang[$this->uninst_prefix . 'SEO_INSTALL_INTRO_BODY'], $this->modrtype_lang['ulink'], $phpbb_seo->version),
+					'L_SUBMIT'		=> $user->lang[$this->uninst_prefix . 'SEO_INSTALL'],
+					'S_LANG_SELECT'	=> '',
+					'U_ACTION'		=> $this->p_master->module_url . "?mode=$mode&amp;sub=final",
+				));
+			break;
+			case 'final':
+				if ($mode == 'install_phpbb_seo') {
+					$this->add_modules($mode, $sub);
+				} else {
+					$this->remove_modules($mode, $sub);
+				}
+				$this->final_stage($mode, $sub);
+			break;
+		}
+		$this->tpl_name = 'install_install';
+	}
+	/**
+	* Populate the module tables
+	*/
+	function add_modules($mode, $sub) {
+		global $db, $user, $phpbb_root_path, $phpEx;
+		include_once($phpbb_root_path . 'includes/acp/acp_modules.' . $phpEx);
+		$_module = new acp_modules();
+		if ( $this->get_module_id('ACP_MOD_REWRITE')  > 0 ) {
+			$url_mod = !empty($sub) ? '?mode=' . $mode : '';
+			$this->p_master->error(sprintf($user->lang['SEO_ERROR_INSTALLED'], $user->lang['ACP_CAT_PHPBB_SEO'] ) . '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+		}
+		$module_classes = array('acp');
+		// Add categories
+		foreach ($module_classes as $module_class) {
+			$categories = array();
+			// Set the module class
+			$_module->module_class = $module_class;
+			foreach ($this->module_categories[$module_class] as $cat_name => $subs) {
+				$module_data = array(
+					'module_basename'	=> '',
+					'module_enabled'	=> 1,
+					'module_display'	=> 1,
+					'parent_id'		=> 0,
+					'module_class'		=> $module_class,
+					'module_langname'	=> $cat_name,
+					'module_mode'		=> '',
+					'module_auth'		=> '',
+				);
+				if ( $this->get_module_id('ACP_CAT_PHPBB_SEO')  < 1 ) {
+					// Add category
+					$_module->update_module_data($module_data, true);
+				} else {
+					$module_data['module_id'] = $this->check_module_id('ACP_CAT_PHPBB_SEO');
+				}
+				// Check for last sql error happened
+				if ($db->sql_error_triggered) {
+					$error = $db->sql_error($db->sql_error_sql);
+					$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+				}
+				$categories[$cat_name]['id'] = (int) $module_data['module_id'];
+				$categories[$cat_name]['parent_id'] = 0;
+				// Create sub-categories...
+				if (is_array($subs)) {
+					foreach ($subs as $level2_name) {
+						$module_data = array(
+							'module_basename'	=> '',
+							'module_enabled'	=> 1,
+							'module_display'	=> 1,
+							'parent_id'			=> (int) $categories[$cat_name]['id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $level2_name,
+							'module_mode'		=> '',
+							'module_auth'		=> '',
+						);
+						$_module->update_module_data($module_data, true);
+						// Check for last sql error happened
+						if ($db->sql_error_triggered) {
+							$error = $db->sql_error($db->sql_error_sql);
+							$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+						}
+						$categories[$level2_name]['id'] = (int) $module_data['module_id'];
+						$categories[$level2_name]['parent_id'] = (int) $categories[$cat_name]['id'];
+					}
+				}
+			}
+			// Get the modules we want to add... returned sorted by name
+			$module_info = $_module->get_module_infos('phpbb_seo', $module_class);
+			foreach ($module_info as $module_basename => $fileinfo) {
+				foreach ($fileinfo['modes'] as $module_mode => $row) {
+					foreach ($row['cat'] as $cat_name) {
+						if (!isset($categories[$cat_name])) {
+							continue;
+						}
+						$module_data = array(
+							'module_basename'	=> $module_basename,
+							'module_enabled'	=> 1,
+							'module_display'	=> (isset($row['display'])) ? (int) $row['display'] : 1,
+							'parent_id'			=> (int) $categories[$cat_name]['id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $row['title'],
+							'module_mode'		=> $module_mode,
+							'module_auth'		=> $row['auth'],
+						);
+						$_module->update_module_data($module_data, true);
+						// Check for last sql error happened
+						if ($db->sql_error_triggered) {
+							$error = $db->sql_error($db->sql_error_sql);
+							$this->p_master->db_error($error['message'], $db->sql_error_sql, __LINE__, __FILE__);
+						}
+					}
+				}
+			}
+			$_module->remove_cache_file();
+		}
+	}
+	/**
+	* remove_modules
+	*/
+	function remove_modules($mode, $sub) {
+		global $db, $user, $phpbb_root_path, $phpEx;
+		include_once($phpbb_root_path . 'includes/acp/acp_modules.' . $phpEx);
+		$_module = new acp_modules();
+		// Set the module class
+		$module_classes = array_keys($this->module_categories);
+		$_module->u_action = "phpbb_seo_install.$phpEx";
+		$cat_module_data = array();
+		$module_data = array();
+		$delete_module_data = array();
+		foreach ($module_classes as $module_class) {
+			$_module->module_class = $module_class;
+			foreach ($this->module_categories[$module_class] as $cat_name => $subs) {
+				// If the cat is already uninstalled break for now
+				if ( $this->get_module_id($cat_name) < 1 ) {
+					$url_mod = !empty($this->sub) ? '?mode=' . $this->mode : '';
+					$this->p_master->error(sprintf($user->lang['SEO_ERROR_UNINSTALLED'], $user->lang[$cat_name] ). '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+				}
+				$cat_module_data[$cat_name] = array(
+					'module_id'		=> $this->check_module_id($cat_name, ''),
+					'module_basename'	=> '',
+					'module_enabled'	=> 1,
+					'module_display'	=> 1,
+					'parent_id'		=> 0,
+					'module_class'		=> $module_class,
+					'module_langname'	=> $cat_name,
+					'module_mode'		=> '',
+					'module_auth'		=> '',
+				);
+				if (is_array($subs)) {
+					foreach ($subs as $sub_cat) {
+						$sub_cat_module_data[$sub_cat] = array(
+							'module_id'		=> $this->check_module_id($sub_cat),
+							'module_basename'	=> '',
+							'module_enabled'	=> 1,
+							'module_display'	=> 1,
+							'parent_id'		=> (int) $cat_module_data[$cat_name]['module_id'],
+							'module_class'		=> $module_class,
+							'module_langname'	=> $sub_cat,
+							'module_mode'		=> '',
+							'module_auth'		=> '',
+						);
+						$branch = $_module->get_module_branch($sub_cat_module_data[$sub_cat]['module_id'],'children', 'descending', false);
+						if (sizeof($branch)) {
+							foreach ($branch as $module) {
+								$error = $_module->delete_module($module['module_id']);
+								if (!sizeof($error)) {
+									$_module->remove_cache_file();
+									$delete_module_data[$module['module_id']] = $module['module_langname'] . ' - id : ' . $module['module_id'];
+								} else {
+									$this->errors[] = implode(' ', $error);
+								}
+							} // End modules
+						}
+						if (!sizeof($this->errors)) {
+							$error = $_module->delete_module($sub_cat_module_data[$sub_cat]['module_id']);
+							if (!sizeof($error)) {
+								$_module->remove_cache_file();
+								$delete_module_data[$sub_cat_module_data[$sub_cat]['module_id']] = $sub_cat_module_data[$sub_cat]['module_langname'] . ' - id : ' . $sub_cat_module_data[$sub_cat]['module_id'];
+							} else {
+								$this->errors[] = implode(' ', $error);
+							}
+						}
+					}
+				} // End sub categories
+				if (!sizeof($this->errors)) {
+					$branch = $_module->get_module_branch($cat_module_data[$cat_name]['module_id'],'children', 'descending', false);
+					if (empty($branch)) {
+						$error = $_module->delete_module($cat_module_data[$cat_name]['module_id']);
+					}
+					if (!sizeof($error)) {
+						$_module->remove_cache_file();
+						$delete_module_data[$cat_module_data[$cat_name]['module_id']] = $cat_module_data[$cat_name]['module_langname'] . ' - id : ' . $cat_module_data[$cat_name]['module_id'];
+					} else {
+						$this->errors[] = implode(' ', $error);
+					}
+				}
+			} // End categories
+		} // End classes
+		return;
+	}
+	/**
+	* check_module_id by title
+	*/
+	function check_module_id($title) {
+		global $user;
+		if ( $module_id = $this->get_module_id($title)) {
+			return $module_id;
+		} else {
+			$url_mod = !empty($this->sub) ? '?mode=' . $this->mode : '';
+			$this->p_master->error(sprintf($user->lang['SEO_ERROR_ID'], $title ) . '<br /><br />' . sprintf($user->lang['RETURN_PAGE'], '<a href="' . $this->p_master->module_url . $url_mod . '">', '</a>'), '', '', false, $user->lang['SEO_ERROR_INFO']);
+		}
+	}
+	/**
+	* get_module_id by title
+	*/
+	function get_module_id($title) {
+		global $db, $user, $phpEx;
+		$sql = 'SELECT module_id
+			FROM ' . MODULES_TABLE . "
+			WHERE module_langname = '" . $db->sql_escape($title) . "'";
+		$result = $db->sql_query_limit($sql, 1);
+		$row = $db->sql_fetchrow($result);
+		if ($row['module_id'] > 1) {
+			return intval($row['module_id']);
+		}
+		return 0;
+	}
+	/**
+	* Sends an email to the board administrator with their password and some useful links
+	*/
+	function final_stage($mode, $sub) {
+		global $auth, $config, $db, $user, $template, $user, $phpbb_root_path, $phpEx, $phpbb_seo, $cache;
+		if (!sizeof($this->errors) ) {
+			add_log('admin', 'SEO_LOG_' . strtoupper($mode), $phpbb_seo->version );
+		} else {
+			add_log('admin', 'SEO_LOG_' . strtoupper($mode) . '_FAIL', $this->errors);
+			$cache->purge();
+			$this->p_master->error($user->lang['SEO_ERROR_INSTALL'] . '<br/><pre>' . implode('<br/>', $this->errors) . '</pre>', __LINE__, __FILE__);
+		}
+		$this->page_title = $user->lang['STAGE_FINAL'];
+		if (!class_exists('phpbb_db_tools')) {
+			include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+		}
+		$db_tools = new phpbb_db_tools($db);
+		$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+		$drop_index_name = 'topic_last_post_id';
+		$add_index_name = 'topic_lpid';
+		if (  $mode == 'install_phpbb_seo' ) {
+			if (!$db_tools->sql_column_exists(TOPICS_TABLE, 'topic_url')) {
+				$db_tools->sql_column_add(TOPICS_TABLE, 'topic_url', array('VCHAR', ''));
+			}
+			if (in_array($drop_index_name, $indexes)) {
+				$db_tools->sql_index_drop(TOPICS_TABLE, $drop_index_name);
+			}
+			if (!in_array($add_index_name, $indexes)) {
+				$db_tools->sql_create_index(TOPICS_TABLE, $add_index_name, array('topic_last_post_id'));
+			}
+			$submit_action = append_sid($phpbb_root_path . 'adm/index.' . $phpEx . '?sid=' . $user->session_id);
+			$title = $user->lang['SEO_INSTALL_CONGRATS'];
+			$body =  sprintf($user->lang['SEO_INSTALL_CONGRATS_EXPLAIN'], $this->modrtype_lang['ulink'], $phpbb_seo->version);
+		} else {
+			$purge_topic_table = false;
+			if ($purge_topic_table) {
+				if ($db_tools->sql_column_exists(TOPICS_TABLE, 'topic_url')) {
+					$db_tools->sql_column_remove(TOPICS_TABLE, 'topic_url');
+				}
+			}
+			if (in_array($drop_index_name, $indexes)) {
+				$db_tools->sql_index_drop(TOPICS_TABLE, $drop_index_name);
+			}
+			if (in_array($add_index_name, $indexes)) {
+				$db_tools->sql_index_drop(TOPICS_TABLE, $add_index_name);
+			}
+			$submit_action = append_sid($phpbb_root_path . 'index.' . $phpEx);
+			$title = $user->lang['UN_SEO_INSTALL_CONGRATS'];
+			$body = sprintf($user->lang['UN_SEO_INSTALL_CONGRATS_EXPLAIN'], $this->modrtype_lang['ulink'], $phpbb_seo->version);
+		}
+		$cache->purge();
+		$template->assign_vars(array(
+			'TITLE'		=> $title,
+			'BODY'		=> $body,
+			'L_SUBMIT'	=> $user->lang['SEO_FINAL_' . strtoupper($mode)],
+			'U_ACTION'	=> $submit_action,
+		));
+	}
+	var $module_categories = array(
+		'acp'	=> array(
+			'ACP_CAT_PHPBB_SEO'		=> array(
+				'ACP_MOD_REWRITE',
+			),
+		),
+	);
+}
+function set_phpbb_seo_links() {
+	global $user, $phpbb_seo, $config;
+	$modrtype_lang = array();
+	$phpbb_seo->version = htmlspecialchars($phpbb_seo->version);
+	$phpbb_seo->modrtype = intval($phpbb_seo->modrtype);
+	if ($phpbb_seo->modrtype < 1 || $phpbb_seo->modrtype > 3) {
+		$phpbb_seo->modrtype = 1;
+	}
+	$modrtype_lang['titles'] = array( 1 => $user->lang['ACP_SEO_SIMPLE'], 2 =>  $user->lang['ACP_SEO_MIXED'], 3 =>  $user->lang['ACP_SEO_ADVANCED'], 'u' => $user->lang['ACP_ULTIMATE_SEO_URL']);
+	$modrtype_lang['title'] = $modrtype_lang['titles'][$phpbb_seo->modrtype];
+	$modrtype_lang['utitle'] = $modrtype_lang['titles']['u'];
+	$modrtype_lang['types'] = array( 1 => 'SIMPLE', 2 => 'MIXED', 1 => 'SIMPLE', 3 => 'ADVANCED');
+	$modrtype_lang['type'] = $modrtype_lang['types'][$phpbb_seo->modrtype];
+	$modrtype_lang['modrlinks_en'] = array( 1 =>  'http://www.phpbb-seo.com/en/simple-seo-url/simple-phpbb-seo-url-t1566.html', 2 =>  'http://www.phpbb-seo.com/en/mixed-seo-url/mixed-phpbb-seo-url-t1565.html', 3 =>  'http://www.phpbb-seo.com/en/advanced-seo-url/advanced-phpbb-seo-url-t1219.html', 'u' => 'http://www.phpbb-seo.com/en/phpbb-mod-rewrite/ultimate-seo-url-t4608.html' );
+	$modrtype_lang['modrlinks_fr'] = array( 1 =>  'http://www.phpbb-seo.com/fr/reecriture-url-simple/seo-url-phpbb-simple-t1945.html', 2 =>  'http://www.phpbb-seo.com/fr/reecriture-url-intermediaire/seo-url-intermediaire-t1946.html', 3 =>  'http://www.phpbb-seo.com/fr/reecriture-url-avancee/seo-url-phpbb-avance-t1501.html', 'u' => 'http://www.phpbb-seo.com/fr/mod-rewrite-phpbb/ultimate-seo-url-t4489.html' );
+	$modrtype_lang['modrforumlinks_en'] = array( 1 =>  'http://www.phpbb-seo.com/en/simple-seo-url/', 2 =>  'http://www.phpbb-seo.com/en/mixed-seo-url/', 3 =>  'http://www.phpbb-seo.com/en/advanced-seo-url/', 'u' => 'http://www.phpbb-seo.com/en/phpbb-mod-rewrite/' );
+	$modrtype_lang['modrforumlinks_fr'] = array( 1 =>  'http://www.phpbb-seo.com/fr/reecriture-url-simple/', 2 =>  'http://www.phpbb-seo.com/fr/reecriture-url-intermediaire/', 3 =>  'http://www.phpbb-seo.com/fr/reecriture-url-avancee/', 'u' => 'http://www.phpbb-seo.com/fr/mod-rewrite-phpbb/' );
+	if (strpos($config['default_lang'], 'fr') !== false ) {
+		$modrtype_lang['linkurl'] = $modrtype_lang['modrlinks_fr'][$phpbb_seo->modrtype];
+		$modrtype_lang['forumlinkurl'] = $modrtype_lang['modrforumlinks_fr'][$phpbb_seo->modrtype];
+		$modrtype_lang['ulinkurl'] = $modrtype_lang['modrlinks_fr']['u'];
+		$modrtype_lang['uforumlinkurl'] = $modrtype_lang['modrforumlinks_fr']['u'];
+	} else {
+		$modrtype_lang['linkurl'] = $modrtype_lang['modrlinks_en'][$phpbb_seo->modrtype];
+		$modrtype_lang['forumlinkurl'] = $modrtype_lang['modrforumlinks_en'][$phpbb_seo->modrtype];
+		$modrtype_lang['ulinkurl'] = $modrtype_lang['modrlinks_en']['u'];
+		$modrtype_lang['uforumlinkurl'] = $modrtype_lang['modrforumlinks_en']['u'];
+	}
+	$modrtype_lang['link'] = '<a href="' . $modrtype_lang['linkurl'] . '" title="' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' ' . $modrtype_lang['title'] . '" onclick="window.open(this.href); return false;"><b>' . $modrtype_lang['title'] . '</b></a>';
+	$modrtype_lang['forumlink'] = '<a href="' . $modrtype_lang['forumlinkurl'] . '" title="' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '" onclick="window.open(this.href); return false;"><b>' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '</b></a>';
+	$modrtype_lang['ulink'] = '<a href="' . $modrtype_lang['ulinkurl'] . '" title="' . $user->lang['ACP_PHPBB_SEO_VERSION'] . ' ' . $modrtype_lang['utitle'] . '" onclick="window.open(this.href); return false;"><b>' . $modrtype_lang['utitle'] . '</b></a>';
+	$modrtype_lang['uforumlink'] = '<a href="' . $modrtype_lang['uforumlinkurl'] . '" title="' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '" onclick="window.open(this.href); return false;"><b>' . $user->lang['ACP_SEO_SUPPORT_FORUM'] . '</b></a>';
+	return $modrtype_lang;
+}
+/**
+* Main Tab - Overview
+*/
+class overview_phpbb_seo extends module {
+	var $modrtype_lang = array();
+	function overview_phpbb_seo(&$p_master) {
+		$this->modrtype_lang = set_phpbb_seo_links();
+		$this->p_master = &$p_master;
+	}
+	function main($mode, $sub) {
+		global $lang, $template, $language, $user, $phpbb_seo;
+		switch ($sub) {
+			case 'intro' :
+				$title = $user->lang['SEO_OVERVIEW_TITLE'];
+				$body = sprintf($user->lang['SEO_OVERVIEW_BODY'], $this->modrtype_lang['ulink'], $phpbb_seo->version, $this->modrtype_lang['ulinkurl']);
+			break;
+			case 'license' :
+				$title = $user->lang['SEO_LICENCE_TITLE'];
+				$body = '<p>' . $user->lang['SEO_LICENCE_BODY'] . '</p><br/><hr/>' . implode("<br/>\n", file('./docs/COPYING'));
+			break;
+			case 'support' :
+				$title = $user->lang['SEO_SUPPORT_TITLE'];
+				$body = sprintf($user->lang['SEO_SUPPORT_BODY'],$this->modrtype_lang['uforumlinkurl'], $this->modrtype_lang['utitle'], $this->modrtype_lang['ulinkurl'] );
+			break;
+		}
+		$this->tpl_name = 'install_main';
+		$this->page_title = $title;
+		$template->assign_vars(array(
+			'TITLE'		=> $title,
+			'BODY'		=> $body,
+
+			'S_LANG_SELECT'	=> '',
+		));
+	}
+}
+/**
+* Quick fix for using the module class outside ACP.
+*/
+function adm_back_link($u_action) {
+	global $user, $install;
+	$url_mod = !empty($install->sub) ? '?mode=' . $install->mode : '';
+	return '<br /><br /><a href="' . $install->module_url . $url_mod . '">&laquo; ' . $user->lang['BACK_TO_PREV'] . '</a>';
+}
+?>
\ No newline at end of file
Index: phpbb_seo/phpbb_seo_meta.php
===================================================================
--- phpbb_seo/phpbb_seo_meta.php	(phpBB 3.0.8)
+++ phpbb_seo/phpbb_seo_meta.php	(Premod 3.0.8)
@@ -0,0 +1,271 @@
+<?php
+/**
+*
+* @package phpBB SEO Dynamic Meta tags
+* @version $Id: phpbb_seo_meta.php 252 2010-03-12 09:23:51Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/licenses/gpl-license.php GNU Public License v2
+*
+*/
+
+/**
+* @ignore
+*/
+if (!defined('IN_PHPBB')) {
+	exit;
+}
+/**
+* seo_meta Class
+* www.phpBB-SEO.com
+* @package phpBB SEO Dynamic Meta tags
+*/
+class seo_meta {
+	var $meta = array('title' => '', 'description' => '', 'keywords' => '', 'lang' => '', 'category' => '', 'robots' => '', 'distribution' => '', 'resource-type' => '', 'copyright' => '');
+	var $meta_def = array();
+	var $filters = array('description' => 'meta_filter_txt', 'keywords' => 'make_keywords');
+	// here you can comment a tag line to deactivate it
+	var $tpl = array(
+		'lang' => '<meta name="content-language" content="%s" />',
+		'title' => '<meta name="title" content="%s" />',
+		'description' => '<meta name="description" content="%s" />',
+		'keywords' => '<meta name="keywords" content="%s" />',
+		'category' => '<meta name="category" content="%s" />',
+		'robots' => '<meta name="robots" content="%s" />',
+		'distribution' => '<meta name="distribution" content="%s" />',
+		'resource-type' => '<meta name="resource-type" content="%s" />',
+		'copyright' => '<meta name="copyright" content="%s" />',
+	);
+	/**
+	* Some config :
+	*	=> keywordlimit : number of keywords (max) in the keyword tag,
+	*	=> wordlimit : number of words (max) in the desc tag,
+	*	=> wordminlen : only words with more than wordminlen letters will be used, default is 2,
+	*	=> bbcodestrip : | separated list of bbcode to fully delete, tag + content, default is 'img|url|flash',
+	*	=> ellipsis : ellipsis to use if clipping,
+	*	=> topic_sql : Do a SQL to build topic meta keywords or just use the meta desc tag,
+	*	=> check_ignore : Check the search_ignore_words.php list.
+	*		Please note :
+	*			This will require some more work for the server.
+	*			And this is mostly useless if you have re-enabled the search_ignore_words.php list
+	*			filtering in includes/search/fulltest_native.php (and of course use fulltest_native index).
+	*	=> bypass_common : Bypass common words in viewtopic.php.
+	*		Set to true by default because the most interesting keywords are as well among the most common.
+	*		This of course provides with even better results when fulltest_native is used
+	*		and search_ignore_words.php list was re-enabled.
+	*	=> get_filter : Disallow tag based on GET var used : coma separated list, will through a disallow meta tag.
+	*	=> file_filter : Disallow tag based on the physical script file name : coma separated list of file names
+	* Some default values are set bellow in the seo_meta_tags() method,
+	* most are acp configurable when using the Ultimate SEO URL mod :
+	* => http://www.phpbb-seo.com/en/phpbb-mod-rewrite/ultimate-seo-url-t4608.html (en)
+	* => http://www.phpbb-seo.com/fr/mod-rewrite-phpbb/ultimate-seo-url-t4489.html (fr)
+	**/
+	var $mconfig = array('keywordlimit' => 15, 'wordlimit' => 25, 'wordminlen' => 2, 'bbcodestrip' => 'img|url|flash|code', 'ellipsis' => ' ...', 'topic_sql' => true, 'check_ignore' => false, 'bypass_common' => true,
+		// Consider adding ", 'p' => 1" if your forum is no indexed yet or if no post urls are to be redirected
+		// to add a noindex tag on post urls
+		'get_filter' => 'style,hilit,sid',
+		// noindex based on physical script file name
+		'file_filter' => 'ucp',
+	);
+	/**
+	* constructor : Initialize meta tags
+	* All values from here will pass through utf8_htmlspecialchars() later
+	*/
+	function seo_meta() {
+		global $config;
+		// default values, leave empty to only output the corresponding tag if filled
+		$this->meta_def['robots'] = 'index,follow';
+		// global values, if these are empty, the corresponding meta will not show up
+		$this->meta['category'] = 'general';
+		$this->meta['distribution'] = 'global';
+		$this->meta['resource-type'] = 'document';
+		// other settings that may be set through acp in cas the mod is not used standalone
+		if (isset($config['seo_meta_desc_limit'])) {
+			// defaults
+			$this->meta_def['title'] = $config['seo_meta_title'];
+			$this->meta_def['description'] = $config['seo_meta_desc'];
+			$this->meta_def['keywords'] = $config['seo_meta_keywords'];
+			$this->meta_def['robots'] = $config['seo_meta_robots'];
+			// global
+			$this->meta['lang'] = $config['seo_meta_lang'];
+			$this->meta['copyright'] = $config['seo_meta_copy'];
+			// settings
+			$this->mconfig['wordlimit'] = (int) $config['seo_meta_desc_limit'];
+			$this->mconfig['keywordlimit'] = (int) $config['seo_meta_keywords_limit'];
+			$this->mconfig['wordminlen'] = (int) $config['seo_meta_min_len'];
+			$this->mconfig['check_ignore'] = (int) $config['seo_meta_check_ignore'];
+			$this->mconfig['file_filter'] = preg_replace('`[\s]+`', '', trim($config['seo_meta_file_filter'], ', '));
+			$this->mconfig['get_filter'] = preg_replace('`[\s]+`', '', trim($config['seo_meta_get_filter'], ', '));
+			$this->mconfig['bbcodestrip'] = str_replace(',', '|', preg_replace('`[\s]+`', '', trim($config['seo_meta_bbcode_filter'], ', ')));
+		} else {
+			// default values, leave empty to only output the corresponding tag if filled
+			$this->meta_def['title'] = $config['sitename'];
+			$this->meta_def['description'] = $config['site_desc'];
+			$this->meta_def['keywords'] = $config['site_desc'];
+			// global values, if these are empty, the corresponding meta will not show up
+			$this->meta['lang'] = $config['default_lang'];
+			$this->meta['copyright'] = $config['sitename'];
+		}
+		$this->mconfig['get_filter'] = !empty($this->mconfig['get_filter']) ? @explode(',', $this->mconfig['get_filter']) : array();
+		$this->mconfig['topic_sql'] = $config['search_type'] == 'fulltext_native' ? $this->mconfig['topic_sql'] : false;
+		return;
+	}
+	/**
+	* assign / retrun meta tag code
+	*/
+	function build_meta( $page_title = '', $return = false) {
+		global $phpEx, $user, $phpbb_seo, $template, $config;
+		// If meta robots was not manually set
+		if (empty($this->meta['robots'])) {
+			// If url Rewriting is on, we shall be more strict on noindex (since we can :p)
+			if (!empty($phpbb_seo->seo_opt['url_rewrite'])) {
+				// If url Rewriting is on, we can deny indexing for any rewritten url with ?
+				if (preg_match('`(\.html?|/)\?[^\?]*$`i', $phpbb_seo->seo_path['uri'])) {
+					$this->meta['robots'] = 'noindex,follow';
+				} else {
+					// lets still add some more specific ones
+					$this->mconfig['get_filter'] = array_merge($this->mconfig['get_filter'], array('st','sk','sd','ch'));
+				}
+			}
+			// Do we allow indexing based on physical script file name
+			if (empty($this->meta['robots'])) {
+				if (strpos($this->mconfig['file_filter'], str_replace(".$phpEx", '', $user->page['page_name'])) !== false) {
+					$this->meta['robots'] = 'noindex,follow';
+				}
+			}
+			// Do we allow indexing based on get variable
+			if (empty($this->meta['robots'])) {
+				foreach ( $this->mconfig['get_filter'] as $get ) {
+					if (isset($_GET[$get])) {
+						$this->meta['robots'] = 'noindex,follow';
+						break;
+					}
+				}
+			}
+			// fallback to default if necessary
+			if (empty($this->meta['robots'])) {
+				$this->meta['robots'] = $this->meta_def['robots'];
+			}
+		}
+		if (!empty($config['seo_meta_noarchive'])) {
+			$forum_id = isset($_GET['f']) ? max(0, (int) request_var('f', 0)) : 0;
+			if ($forum_id) {
+				$forum_ids = @explode(',', preg_replace('`[\s]+`', '', trim($config['seo_meta_noarchive'], ', ')));
+				if (in_array($forum_id, $forum_ids)) {
+					$this->meta['robots'] .= (!empty($this->meta['robots']) ? ',' : '') . 'noarchive';
+				}
+			}
+		}
+		// deal with titles, assign the tag if a default is set
+		if (empty($this->meta['title']) && !empty($this->meta_def['title'])) {
+			$this->meta['title'] = $page_title;
+		}
+		$meta_code = '';
+		foreach ($this->tpl as $key => $value) {
+			if (isset($this->meta[$key])) {
+				// do like this so we can deactivate one particular tag on a given page,
+				// by just setting the meta to an empty string
+				if (trim($this->meta[$key])) {
+					$this->meta[$key] = isset($this->filters[$key]) ? $this->{$this->filters[$key]}($this->meta[$key]) : $this->meta[$key];
+			       }
+			} else if (!empty($this->meta_def[$key])) {
+				$this->meta[$key] = isset($this->filters[$key]) ? $this->{$this->filters[$key]}($this->meta_def[$key]) : $this->meta_def[$key];
+			}
+			if (trim($this->meta[$key])) {
+				$meta_code .= sprintf($value, utf8_htmlspecialchars($this->meta[$key])) . "\n";
+			}
+		}
+		if (!$return) {
+			$template->assign_var('META_TAG', $meta_code);
+		} else {
+			return $meta_code;
+		}
+	}
+	/**
+	* Returns a coma separated keyword list
+	*/
+	function make_keywords($text, $decode_entities = false) {
+		static $filter = array('`&(amp;)?[^;]+;`i', '`[[:punct:]]+`', '`[0-9]+`',  '`[\s]+`');
+		$keywords = '';
+		$num = 0;
+		$text = $decode_entities ? html_entity_decode(strip_tags($text), ENT_COMPAT, 'UTF-8') : strip_tags($text);
+		$text = utf8_strtolower(trim(preg_replace($filter, ' ', $text)));
+		if (!$text) {
+			return '';
+		}
+		$text = explode(' ', trim($text));
+		if ($this->mconfig['check_ignore']) {
+			global $phpbb_root_path, $user, $phpEx;
+			// add stop words to $user to allow reuse
+			if (empty($user->stop_words)) {
+				$words = array();
+				if (file_exists("{$user->lang_path}{$user->lang_name}/search_ignore_words.$phpEx")) {
+					// include the file containing ignore words
+					include("{$user->lang_path}{$user->lang_name}/search_ignore_words.$phpEx");
+				}
+				$user->stop_words = & $words;
+			}
+			$text = array_diff($text, $user->stop_words);
+		}
+		if (empty($text)) {
+			return '';
+		}
+		// We take the most used words first
+		$text = array_count_values($text);
+		arsort($text);
+		foreach ($text as $word => $count) {
+			if ( utf8_strlen($word) > $this->mconfig['wordminlen'] ) {
+				$keywords .= ', ' . $word;
+				$num++;
+				if ( $num >= $this->mconfig['keywordlimit'] ) {
+					break;
+				}
+			}
+		}
+		return trim($keywords, ', ');
+	}
+	/**
+	* Filter php/html tags and white spaces and string with limit in words
+	*/
+	function meta_filter_txt($text, $bbcode = true) {
+		if ($bbcode) {
+			static $RegEx = array();
+			static $replace = array();
+			if (empty($RegEx)) {
+				$RegEx = array('`&(amp;)?[^;]+;`i', // HTML entitites
+					'`<[^>]*>(.*<[^>]*>)?`Usi', // HTML code
+				);
+				$replace = array(' ', ' ');
+				if (!empty($this->mconfig['bbcodestrip'])) {
+					$RegEx[] = '`\[(' . $this->mconfig['bbcodestrip'] . ')[^\[\]]*\].*\[/\1[^\[\]]*\]`Usi'; // bbcode to strip
+					$replace[] = ' ';
+				}
+				$RegEx[] = '`\[\/?[a-z0-9\*\+\-]+(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})\]`'; // Strip all bbcode tags
+				$replace[] = '';
+				$RegEx[] = '`[\s]+`'; // Multiple spaces
+				$replace[] = ' ';
+			}
+			return $this->word_limit(preg_replace($RegEx, $replace, $text));
+		}
+		return $this->word_limit(preg_replace(array('`<[^>]*>(.*<[^>]*>)?`Usi', '`\[\/?[a-z0-9\*\+\-]+(?:=(?:&quot;.*&quot;|[^\]]*))?(?::[a-z])?(\:[0-9a-z]{5,})\]`', '`[\s]+`'), ' ', $text));
+	}
+	/**
+	* Cut the text according to the number of words.
+	* Borrowed from www.php.net http://www.php.net/preg_replace
+	*/
+	function word_limit($string) {
+		return count($words = preg_split('/\s+/', ltrim($string), $this->mconfig['wordlimit'] + 1)) > $this->mconfig['wordlimit'] ? rtrim(utf8_substr($string, 0, utf8_strlen($string) - utf8_strlen(end($words)))) . $this->mconfig['ellipsis'] : $string;
+	}
+	/**
+	* add meta tag
+	* $content : if empty, the called tag will show up
+	* do not call to fall back to default
+	*/
+	function collect($type, $content = '', $combine = false) {
+		if ($combine) {
+			$this->meta[$type] = (isset($this->meta[$type]) ? $this->meta[$type] . ' ' : '') . (string) $content;
+		} else {
+			$this->meta[$type] = (string) $content;
+		}
+	}
+}
+?>
\ No newline at end of file
Index: phpbb_seo/phpbb_seo_related_install.php
===================================================================
--- phpbb_seo/phpbb_seo_related_install.php	(phpBB 3.0.8)
+++ phpbb_seo/phpbb_seo_related_install.php	(Premod 3.0.8)
@@ -0,0 +1,193 @@
+<?php
+/**
+*
+* @package phpBB SEO Related topics
+* @version $Id: phpbb_seo_related_install.php 222 2010-02-27 13:08:48Z dcz $
+* @copyright (c) 2006 - 2010 www.phpbb-seo.com
+* @license http://opensource.org/licenses/gpl-license.php GNU Public License v2
+*
+*/
+
+/*
+ * Based on the phpBB3 install package / www.phpBB.com
+ */
+define('IN_PHPBB', true);
+define('IN_INSTALL', true);
+$phpbb_root_path = (defined('PHPBB_ROOT_PATH')) ? PHPBB_ROOT_PATH : './../';
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+// Try to override some limits - maybe it helps some...
+@set_time_limit(0);
+$mem_limit = @ini_get('memory_limit');
+if (!empty($mem_limit)) {
+	$unit = strtolower(substr($mem_limit, -1, 1));
+	$mem_limit = (int) $mem_limit;
+	if ($unit == 'k') {
+		$mem_limit = floor($mem_limit / 1024);
+	} else if ($unit == 'g') {
+		$mem_limit *= 1024;
+	} else if (is_numeric($unit)) {
+		$mem_limit = floor((int) ($mem_limit . $unit) / 1048576);
+	}
+	$mem_limit = max(128, $mem_limit) . 'M';
+} else {
+	$mem_limit = '128M';
+}
+@ini_set('memory_limit', $mem_limit);
+include($phpbb_root_path . 'common.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('mods/phpbb_seo_related_install');
+// Security check
+// Circumvent a potential phpbb bug with paths
+$redirect = append_sid(generate_board_url() . "/phpbb_seo/phpbb_seo_related_install.$phpEx");
+if (!$user->data['is_registered']) {
+	login_box($redirect, $user->lang['SEO_LOGIN'],'', false, false);
+}
+if (!$auth->acl_get('a_')) {
+	$user->session_kill(true);
+	login_box($redirect, $user->lang['SEO_LOGIN_ADMIN'],'', false, false);
+}
+if ($user->data['user_type'] != USER_FOUNDER) {
+	login_box($redirect, $user->lang['SEO_LOGIN_FOUNDER'],'', false, false);
+}
+$mode = request_var('mode', 'start');
+
+/**
+* seo_related_install Class
+* www.phpBB-SEO.com
+* @package phpBB SEO Related topics
+*/
+class seo_related_install {
+	var $force_check = 0;
+	var $mode = 'install';
+	var $silent = false;
+	var $config_names = array('seo_related', 'seo_related_fulltext', 'seo_related_check_ignore', 'seo_related_limit', 'seo_related_allforums');
+	/**
+	* constructor
+	*/
+	function seo_related_install($mode, $force_check = 0, $silent = false) {
+		$this->force_check = $force_check ? $force_check : max(0, request_var('force_check', 0));
+		$this->mode = $mode === 'install' ? 'install' : ($mode === 'uninstall' ? 'uninstall' : 'start');
+		$this->silent = $silent ? true : false;
+		$this->{$this->mode}();
+	}
+	/**
+	* start
+	*/
+	function start() {
+		global $phpbb_root_path, $phpEx, $msg_title, $user;
+		$install_url = append_sid($phpbb_root_path . "phpbb_seo/phpbb_seo_related_install.$phpEx?mode=install");
+		$install_force_url = append_sid($phpbb_root_path . "phpbb_seo/phpbb_seo_related_install.$phpEx?mode=install&amp;force_check=1");
+		$uninstall_url = append_sid($phpbb_root_path . "phpbb_seo/phpbb_seo_related_install.$phpEx?mode=uninstall");
+		$msg_title = $user->lang['INSTALLATION'];
+		$msg = sprintf($user->lang['INSTALLATION_START'], $install_url, $install_force_url, $uninstall_url);
+		trigger_error($msg);
+	}
+	/**
+	* install
+	*/
+	function install() {
+		global $db, $config, $user;
+		$fulltext = $already_installed = 0;
+		$no_error = 1;
+		$errno = E_USER_NOTICE;
+		$msg = $user->lang['INSTALLED'];
+		if (!isset($config['seo_related']) || $this->force_check) {
+			if ($db->sql_layer == 'mysql4' || $db->sql_layer == 'mysqli') {
+				// we can proceed with trying to add fulltext
+				global $phpbb_root_path, $phpEx;
+				if (!class_exists('phpbb_db_tools')) {
+					include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+				}
+				$db_tools = new phpbb_db_tools($db);
+				$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+				if (!in_array('topic_tft', $indexes)) {
+					$sql = 'ALTER TABLE ' . TOPICS_TABLE . '
+						ADD FULLTEXT topic_tft (topic_title)';
+					$db->sql_return_on_error(true);
+					$db->sql_query($sql);
+					if ($db->sql_error_triggered) {
+						$no_error = 0;
+						$errno = E_USER_WARNING;
+						$msg = $user->lang['INSTALLATION'];
+						$msg .= '<br/>' . sprintf($user->lang['SQL_REQUIRED'], $db->sql_error_sql);
+					}
+					$db->sql_return_on_error(false);
+				}
+				// make *sure* we have the index !
+				$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+				$fulltext = in_array('topic_tft', $indexes) ? 1 : 0;
+			}
+		} else {
+			$msg = $user->lang['ALREADY_INSTALLED'];
+			$already_installed = 1;
+		}
+		if ($no_error) {
+			if (!$already_installed) {
+				set_config('seo_related_fulltext', $fulltext);
+				$msg .= '<br/>' . ($fulltext ? $user->lang['FULLTEXT_INSTALLED'] : $user->lang['FULLTEXT_NOT_INSTALLED']);
+			}
+			set_config('seo_related', 1);
+		}
+		// Log this since it could help some to understand
+		add_log('admin', $msg);
+		if (!$this->silent) {
+			trigger_error($msg, $errno);
+		} else {
+			return $no_error ? true : false;
+		}
+	}
+	/**
+	* uninstall
+	*/
+	function uninstall() {
+		global $db, $config, $cache, $phpbb_root_path, $phpEx, $user;
+		$no_error = 1;
+		$errno = E_USER_NOTICE;
+		$msg = $user->lang['UNINSTALLED'];
+		// use db_tools to check the index
+		if (!class_exists('phpbb_db_tools')) {
+			include($phpbb_root_path . 'includes/db/db_tools.' . $phpEx);
+		}
+		$db_tools = new phpbb_db_tools($db);
+		$indexes = $db_tools->sql_list_index(TOPICS_TABLE);
+		if (in_array('topic_tft', $indexes)) {
+			$sql = 'ALTER TABLE ' . TOPICS_TABLE . '
+				DROP INDEX topic_tft';
+			$db->sql_return_on_error(true);
+			$db->sql_query($sql);
+			if ($db->sql_error_triggered) {
+				$msg = $user->lang['UNINSTALLATION'];
+				$msg .= '<br/>' . sprintf($user->lang['SQL_REQUIRED'], $db->sql_error_sql);
+				$no_error = 0;
+				$errno = E_USER_WARNING;
+			}
+			$db->sql_return_on_error(false);
+		}
+		$did_something = false;
+		foreach ($this->config_names as $config_name) {
+			if (isset($config[$config_name])) {
+				$sql = 'DELETE FROM ' . CONFIG_TABLE . "
+					WHERE config_name = '" . $db->sql_escape($config_name) . "'";
+				$db->sql_query($sql);
+				unset($config[$config_name]);
+				$did_something = true;
+			}
+		}
+		if ($did_something) {
+			$cache->destroy('config');
+		} else {
+			$msg = $user->lang['ALREADY_UNINSTALLED'];
+		}
+		// Log this since it could help some to understand
+		add_log('admin', $msg);
+		if (!$this->silent) {
+			trigger_error($msg, $errno);
+		} else {
+			return $no_error ? true : false;
+		}
+	}
+}
+$seo_related_install = new seo_related_install($mode);
+?>
\ No newline at end of file
Index: install/install_install.php
===================================================================
--- install/install_install.php	(revision 1)
+++ install/install_install.php	(Premod 3.0.8)
@@ -105,7 +105,15 @@
 				$this->add_language($mode, $sub);
 				$this->add_bots($mode, $sub);
 				$this->email_admin($mode, $sub);
-
+				// SEO premod
+				global $db, $phpEx;
+				if (!class_exists('phpbb_db_tools')) {
+					include('./../includes/db/db_tools.' . $phpEx);
+				}
+				$db_tools = new phpbb_db_tools($db);
+				$db_tools->sql_column_add(TOPICS_TABLE, 'topic_url', array('VCHAR', ''));
+				$db_tools->sql_create_index(TOPICS_TABLE, 'topic_lpid', array('topic_last_post_id'));
+				set_config('seo_premod_version', '3.0.8');
 				// Remove the lock file
 				@unlink($phpbb_root_path . 'cache/install_lock');
 
@@ -424,9 +432,9 @@
 			'LEGEND'			=> $lang['FILES_REQUIRED'],
 			'LEGEND_EXPLAIN'	=> $lang['FILES_REQUIRED_EXPLAIN'],
 		));
+		// SEO premod
+		$directories = array('cache/', 'files/', 'store/', 'phpbb_seo/cache/', 'gym_sitemaps/cache/');
 
-		$directories = array('cache/', 'files/', 'store/');
-
 		umask(0);
 
 		$passed['files'] = true;
@@ -2202,6 +2210,10 @@
 				'ACP_MODULE_MANAGEMENT',
 			),
 			'ACP_CAT_DOT_MODS'		=> null,
+			// SEO premod
+			'ACP_CAT_PHPBB_SEO'		=> array(
+				'ACP_MOD_REWRITE',
+			),
 		),
 		'mcp'	=> array(
 			'MCP_MAIN'		=> null,
Index: install/docs/COPYING
===================================================================
--- install/docs/COPYING	(phpBB 3.0.8)
+++ install/docs/COPYING	(Premod 3.0.8)
@@ -0,0 +1,620 @@
+
+RECIPROCAL PUBLIC LICENSE
+
+Version 1.1, November 1, 2002
+
+Copyright (C) 2001-2002
+
+Technical Pursuit Inc.,
+
+All Rights Reserved.
+
+PREAMBLE
+
+This Preamble is intended to describe, in plain English, the nature,
+intent, and scope of this License. However, this Preamble is not a part
+of this License. The legal effect of this License is dependent only upon
+the terms of the License and not this Preamble.
+
+This License is based on the concept of reciprocity. In exchange for
+being granted certain rights under the terms of this License to
+Licensor's Software, whose Source Code You have access to, You are
+required to reciprocate by providing equal access and rights to all
+third parties to the Source Code of any Modifications, Derivative Works,
+and Required Components for execution of same (collectively defined as
+Extensions) that You Deploy by Deploying Your Extensions under the terms
+of this License. In this fashion the available Source Code related to
+the original Licensed Software is enlarged for the benefit of everyone.
+
+Under the terms of this License You may:
+
+a. Distribute the Licensed Software exactly as You received it under the
+terms of this License either alone or as a component of an aggregate
+software distribution containing programs from several different
+sources without payment of a royalty or other fee.
+
+b. Use the Licensed Software for any purpose consistent with the rights
+granted by this License, but the Licensor is not providing You any
+warranty whatsoever, nor is the Licensor accepting any liability in
+the event that the Licensed Software doesn't work properly or causes
+You any injury or damages.
+
+c. Create Extensions to the Licensed Software consistent with the rights
+granted by this License, provided that You make the Source Code to
+any Extensions You Deploy available to all third parties under the
+terms of this License, document Your Modifications clearly, and title
+all Extensions distinctly from the Licensed Software.
+
+d. Charge a fee for warranty or support, or for accepting indemnity or
+liability obligations for Your customers.
+
+Under the terms of this License You may not:
+
+a. Charge for the Source Code to the Licensed Software, or Your
+Extensions, other than a nominal fee not to exceed Your cost for
+reproduction and distribution where such reproduction and
+distribution involve physical media.
+
+b. Modify or delete any pre-existing copyright notices, change notices,
+or License text in the Licensed Software.
+
+c. Assert any patent claims against the Licensor or Contributors, or
+which would in any way restrict the ability of any third party to use
+the Licensed Software or portions thereof in any form under the terms
+of this License, or Your rights to the Licensed Software under this
+License automatically terminate.
+
+d. Represent either expressly or by implication, appearance, or
+otherwise that You represent Licensor or Contributors in any capacity
+or that You have any form of legal association by virtue of this
+License.
+
+Under the terms of this License You must:
+
+a. Document any Modifications You make to the Licensed Software
+including the nature of the change, the authors of the change, and
+the date of the change. This documentation must appear both in the
+Source Code and in a text file titled "CHANGES" distributed with the
+Licensed Software and Your Extensions.
+
+b. Make the Source Code for any Extensions You Deploy available in a
+timely fashion via an Electronic Distribution Mechanism such as FTP
+or HTTP download.
+
+c. Notify the Licensor of the availability of Source Code to Your
+Extensions in a timely fashion and include in such notice a brief
+description of the Extensions, the distinctive title used, and
+instructions on how to acquire the Source Code and future updates.
+
+d. Grant Licensor and all third parties a world-wide, non-exclusive,
+royalty-free license under any intellectual property rights owned or
+controlled by You to use, reproduce, display, perform, modify,
+sublicense, and distribute Your Extensions, in any form, under the
+terms of this License.
+
+LICENSE TERMS
+
+1.0 General; Applicability & Definitions. This Reciprocal Public License
+Version 1.1 ("License") applies to any programs or other works as well
+as any and all updates or maintenance releases of said programs or works
+("Software") not already covered by this License which the Software
+copyright holder ("Licensor") makes publicly available containing a
+Notice (hereinafter defined) from the Licensor specifying or allowing
+use or distribution under the terms of this License. As used in this
+License and Preamble:
+
+1.1 "Contributor" means any person or entity who created or contributed
+to the creation of an Extension.
+
+1.2 "Deploy" means to use, Serve, sublicense or distribute Licensed
+Software other than for Your internal Research and/or Personal Use, and
+includes without limitation, any and all internal use or distribution of
+Licensed Software within Your business or organization other than for
+Research and/or Personal Use, as well as direct or indirect sublicensing
+or distribution of Licensed Software by You to any third party in any
+form or manner.
+
+1.3 "Derivative Works" as used in this License is defined under U.S.
+copyright law.
+
+1.4 "Electronic Distribution Mechanism" means a mechanism generally
+accepted in the software development community for the electronic
+transfer of data such as download from an FTP or web site, where such
+mechanism is publicly accessible.
+
+1.5 "Extensions" means any Modifications, Derivative Works, or Required
+Components as those terms are defined in this License.
+
+1.6 "License" means this Reciprocal Public License.
+
+1.7 "Licensed Software" means any Software licensed pursuant to this
+License. Licensed Software also includes all previous Extensions from
+any Contributor that You receive.
+
+1.8 "Licensor" means the copyright holder of any Software previously
+uncovered by this License who releases the Software under the terms of
+this License.
+
+1.9 "Modifications" means any additions to or deletions from the
+substance or structure of (i) a file or other storage containing
+Licensed Software, or (ii) any new file or storage that contains any
+part of Licensed Software, or (iii) any file or storage which replaces
+or otherwise alters the original functionality of Licensed Software at
+runtime.
+
+1.10 "Notice" means the notice contained in EXHIBIT A.
+
+1.11 "Personal Use" means use of Licensed Software by an individual
+solely for his or her personal, private and non-commercial purposes. An
+individual's use of Licensed Software in his or her capacity as an
+officer, employee, member, independent contractor or agent of a
+corporation, business or organization (commercial or non-commercial)
+does not qualify as Personal Use.
+
+1.12 "Required Components" means any text, programs, scripts, schema,
+interface definitions, control files, or other works created by You
+which are required by a third party of average skill to successfully
+install and run Licensed Software containing Your Modifications, or to
+install and run Your Derivative Works.
+
+1.13 "Research" means investigation or experimentation for the purpose
+of understanding the nature and limits of the Licensed Software and its
+potential uses.
+
+1.14 "Serve" means to deliver Licensed Software and/or Your Extensions
+by means of a computer network to one or more computers for purposes of
+execution of Licensed Software and/or Your Extensions.
+
+1.15 "Software" means any computer programs or other works as well as
+any updates or maintenance releases of those programs or works which are
+distributed publicly by Licensor.
+
+1.16 "Source Code" means the preferred form for making modifications to
+the Licensed Software and/or Your Extensions, including all modules
+contained therein, plus any associated text, interface definition files,
+scripts used to control compilation and installation of an executable
+program or other components required by a third party of average skill
+to build a running version of the Licensed Software or Your Extensions.
+
+1.17 "You" or "Your" means an individual or a legal entity exercising
+rights under this License. For legal entities, "You" or "Your" includes
+any entity which controls, is controlled by, or is under common control
+with, You, where "control" means (a) the power, direct or indirect, to
+cause the direction or management of such entity, whether by contract
+or otherwise, or (b) ownership of fifty percent (50%) or more of the
+outstanding shares or beneficial ownership of such entity.
+
+2.0 Acceptance Of License. You are not required to accept this License
+since you have not signed it, however nothing else grants you permission
+to use, copy, distribute, modify, or create derivatives of either the
+Software or any Extensions created by a Contributor. These actions are
+prohibited by law if you do not accept this License. Therefore, by
+performing any of these actions You indicate Your acceptance of this
+License and Your agreement to be bound by all its terms and conditions.
+IF YOU DO NOT AGREE WITH ALL THE TERMS AND CONDITIONS OF THIS LICENSE DO
+NOT USE, MODIFY, CREATE DERIVATIVES, OR DISTRIBUTE THE SOFTWARE. IF IT
+IS IMPOSSIBLE FOR YOU TO COMPLY WITH ALL THE TERMS AND CONDITIONS OF
+THIS LICENSE THEN YOU CAN NOT USE, MODIFY, CREATE DERIVATIVES, OR
+DISTRIBUTE THE SOFTWARE.
+
+3.0 Grant of License From Licensor. Subject to the terms and conditions
+of this License, Licensor hereby grants You a world-wide, royalty-free,
+non-exclusive license, subject to Licensor's intellectual property
+rights, and any third party intellectual property claims derived from
+the Licensed Software under this License, to do the following:
+
+3.1 Use, reproduce, modify, display, perform, sublicense and distribute
+Licensed Software and Your Extensions in both Source Code form or as an
+executable program.
+
+3.2 Create Derivative Works (as that term is defined under U.S.
+copyright law) of Licensed Software by adding to or deleting from the
+substance or structure of said Licensed Software.
+
+3.3 Under claims of patents now or hereafter owned or controlled by
+Licensor, to make, use, have made, and/or otherwise dispose of Licensed
+Software or portions thereof, but solely to the extent that any such
+claim is necessary to enable You to make, use, have made, and/or
+otherwise dispose of Licensed Software or portions thereof.
+
+3.4 Licensor reserves the right to release new versions of the Software
+with different features, specifications, capabilities, functions,
+licensing terms, general availability or other characteristics. Title,
+ownership rights, and intellectual property rights in and to the
+Licensed Software shall remain in Licensor and/or its Contributors.
+
+4.0 Grant of License From Contributor. By application of the provisions
+in Section 6 below, each Contributor hereby grants You a world-wide,
+royalty-free, non-exclusive license, subject to said Contributor's
+intellectual property rights, and any third party intellectual property
+claims derived from the Licensed Software under this License, to do the
+following:
+
+4.1 Use, reproduce, modify, display, perform, sublicense and distribute
+any Extensions Deployed by such Contributor or portions thereof, in both
+Source Code form or as an executable program, either on an unmodified
+basis or as part of Derivative Works.
+
+4.2 Under claims of patents now or hereafter owned or controlled by
+Contributor, to make, use, have made, and/or otherwise dispose of
+Extensions or portions thereof, but solely to the extent that any such
+claim is necessary to enable You to make, use, have made, and/or
+otherwise dispose of Contributor's Extensions or portions thereof.
+
+5.0 Exclusions From License Grant. Nothing in this License shall be
+deemed to grant any rights to trademarks, copyrights, patents, trade
+secrets or any other intellectual property of Licensor or any
+Contributor except as expressly stated herein. Except as expressly
+stated in Sections 3 and 4, no other patent rights, express or implied,
+are granted herein. Your Extensions may require additional patent
+licenses from Licensor or Contributors which each may grant in its sole
+discretion. No right is granted to the trademarks of Licensor or any
+Contributor even if such marks are included in the Licensed Software.
+Nothing in this License shall be interpreted to prohibit Licensor from
+licensing under different terms from this License any code that Licensor
+otherwise would have a right to license.
+
+5.1 You expressly acknowledge and agree that although Licensor and each
+Contributor grants the licenses to their respective portions of the
+Licensed Software set forth herein, no assurances are provided by
+Licensor or any Contributor that the Licensed Software does not infringe
+the patent or other intellectual property rights of any other entity.
+Licensor and each Contributor disclaim any liability to You for claims
+brought by any other entity based on infringement of intellectual
+property rights or otherwise. As a condition to exercising the rights
+and licenses granted hereunder, You hereby assume sole responsibility to
+secure any other intellectual property rights needed, if any. For
+example, if a third party patent license is required to allow You to
+distribute the Licensed Software, it is Your responsibility to acquire
+that license before distributing the Licensed Software.
+
+6.0 Your Obligations And Grants. In consideration of, and as an express
+condition to, the licenses granted to You under this License You hereby
+agree that any Modifications, Derivative Works, or Required Components
+(collectively Extensions) that You create or to which You contribute are
+governed by the terms of this License including, without limitation,
+Section 4. Any Extensions that You create or to which You contribute
+must be Deployed under the terms of this License or a future version
+of this License released under Section 7. You hereby grant to Licensor
+and all third parties a world-wide, non-exclusive, royalty-free license
+under those intellectual property rights You own or control to use,
+reproduce, display, perform, modify, create derivatives, sublicense, and
+distribute Your Extensions, in any form. Any Extensions You make and
+Deploy must have a distinct title so as to readily tell any subsequent
+user or Contributor that the Extensions are by You. You must include a
+copy of this License with every copy of the Extensions You distribute.
+You agree not to offer or impose any terms on any Source Code or
+executable version of the Licensed Software, or its Extensions that
+alter or restrict the applicable version of this License or the
+recipients' rights hereunder.
+
+6.1 Availability of Source Code. You must make available, under the
+terms of this License, the Source Code of the Licensed Software and any
+Extensions that You Deploy, either on the same media as You distribute
+any executable or other form of the Licensed Software, or via an
+Electronic Distribution Mechanism. The Source Code for any version of
+Licensed Software, or its Extensions that You Deploy must be made
+available at the time of Deployment and must remain available for as
+long as You Deploy the Extensions or at least twelve (12) months after
+the date You Deploy, whichever is longer. You are responsible for
+ensuring that the Source Code version remains available even if the
+Electronic Distribution Mechanism is maintained by a third party. You
+may not charge a fee for the Source Code distributed under this Section
+in excess of Your actual cost of duplication and distribution where such
+duplication and distribution involve physical media.
+
+6.2 Description of Modifications. You must cause any Modifications that
+You create or to which You contribute, to update the file titled
+"CHANGES" distributed with Licensed Software documenting the additions,
+changes or deletions You made, the authors of such Modifications, and
+the dates of any such additions, changes or deletions. You must also
+cause a cross-reference to appear in the Source Code at the location of
+each change. You must include a prominent statement that the
+Modifications are derived, directly or indirectly, from the Licensed
+Software and include the names of the Licensor and any Contributor to
+the Licensed Software in (i) the Source Code and (ii) in any notice
+displayed by the Licensed Software You distribute or in related
+documentation in which You describe the origin or ownership of the
+Licensed Software. You may not modify or delete any pre-existing
+copyright notices, change notices or License text in the Licensed
+Software.
+
+6.3 Intellectual Property Matters.
+
+a. Third Party Claims. If You have knowledge that a license to a third
+party's intellectual property right is required to exercise the
+rights granted by this License, You must include a text file with the
+Source Code distribution titled "LEGAL" that describes the claim and
+the party making the claim in sufficient detail that a recipient will
+know whom to contact. If You obtain such knowledge after You make any
+Extensions available as described in Section 6.1, You shall promptly
+modify the LEGAL file in all copies You make available thereafter and
+shall take other steps (such as notifying appropriate mailing lists
+or newsgroups) reasonably calculated to inform those who received the
+Licensed Software from You that new knowledge has been obtained.
+
+b. Contributor APIs. If Your Extensions include an application
+programming interface ("API") and You have knowledge of patent
+licenses that are reasonably necessary to implement that API, You
+must also include this information in the LEGAL file.
+
+c. Representations. You represent that, except as disclosed pursuant to
+6.3(a) above, You believe that any Extensions You distribute are Your
+original creations and that You have sufficient rights to grant the
+rights conveyed by this License.
+
+6.4 Required Notices.
+
+a. License Text. You must duplicate this License in any documentation
+You provide along with the Source Code of any Extensions You create
+or to which You contribute, wherever You describe recipients' rights
+relating to Licensed Software. You must duplicate the notice
+contained in EXHIBIT A (the "Notice") in each file of the Source Code
+of any copy You distribute of the Licensed Software and Your
+Extensions. If You create an Extension, You may add Your name as a
+Contributor to the text file titled "CONTRIB" distributed with the
+Licensed Software along with a description of the contribution. If it
+is not possible to put the Notice in a particular Source Code file
+due to its structure, then You must include such Notice in a location
+(such as a relevant directory file) where a user would be likely to
+look for such a notice.
+
+b. Source Code Availability. You must notify Licensor within one (1)
+month of the date You initially Deploy of the availability of Source
+Code to Your Extensions and include in such notification the name
+under which you Deployed Your Extensions, a description of the
+Extensions, and instructions on how to acquire the Source Code,
+including instructions on how to acquire updates over time. Should
+such instructions change you must provide Licensor with revised
+instructions within one (1) month of the date of change. Should you
+be unable to notify Licensor directly, you must provide notification
+by posting to appropriate news groups, mailing lists, or web sites
+where a search engine would reasonably be expected to index them.
+
+6.5 Additional Terms. You may choose to offer, and charge a fee for,
+warranty, support, indemnity or liability obligations to one or more
+recipients of Licensed Software. However, You may do so only on Your
+own behalf, and not on behalf of the Licensor or any Contributor. You
+must make it clear that any such warranty, support, indemnity or
+liability obligation is offered by You alone, and You hereby agree to
+indemnify the Licensor and every Contributor for any liability plus
+attorney fees, costs, and related expenses due to any such action or
+claim incurred by the Licensor or such Contributor as a result of
+warranty, support, indemnity or liability terms You offer.
+
+6.6 Conflicts With Other Licenses. Where any portion of Your Extensions,
+by virtue of being Derivative Works of another product or similar
+circumstance, fall under the terms of another license, the terms of that
+license should be honored however You must also make Your Extensions
+available under this License. If the terms of this License continue to
+conflict with the terms of the other license you may write the Licensor
+for permission to resolve the conflict in a fashion that remains
+consistent with the intent of this License. Such permission will be
+granted at the sole discretion of the Licensor.
+
+7.0 Versions of This License. Licensor may publish from time to time
+revised and/or new versions of the License. Once Licensed Software has
+been published under a particular version of the License, You may always
+continue to use it under the terms of that version. You may also choose
+to use such Licensed Software under the terms of any subsequent version
+of the License published by Licensor. No one other than Licensor has the
+right to modify the terms applicable to Licensed Software created under
+this License.
+
+7.1 If You create or use a modified version of this License, which You
+may do only in order to apply it to software that is not already
+Licensed Software under this License, You must rename Your license so
+that it is not confusingly similar to this License, and must make it
+clear that Your license contains terms that differ from this License. In
+so naming Your license, You may not use any trademark of Licensor or of
+any Contributor. Should Your modifications to this License be limited to
+alteration of EXHIBIT A purely for purposes of adjusting the Notice You
+require of licensees, You may continue to refer to Your License as the
+Reciprocal Public License or simply the RPL.
+
+8.0 Disclaimer of Warranty. LICENSED SOFTWARE IS PROVIDED UNDER THIS
+LICENSE ON AN "AS IS" BASIS, WITHOUT WARRANTY OF ANY KIND, EITHER
+EXPRESS OR IMPLIED, INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT THE
+LICENSED SOFTWARE IS FREE OF DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR
+PURPOSE OR NON-INFRINGING. FURTHER THERE IS NO WARRANTY MADE AND ALL
+IMPLIED WARRANTIES ARE DISCLAIMED THAT THE LICENSED SOFTWARE MEETS OR
+COMPLIES WITH ANY DESCRIPTION OF PERFORMANCE OR OPERATION, SAID
+COMPATIBILITY AND SUITABILITY BEING YOUR RESPONSIBILITY. LICENSOR
+DISCLAIMS ANY WARRANTY, IMPLIED OR EXPRESSED, THAT ANY CONTRIBUTOR'S
+EXTENSIONS MEET ANY STANDARD OF COMPATIBILITY OR DESCRIPTION OF
+PERFORMANCE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE
+LICENSED SOFTWARE IS WITH YOU. SHOULD LICENSED SOFTWARE PROVE DEFECTIVE
+IN ANY RESPECT, YOU (AND NOT THE LICENSOR OR ANY OTHER CONTRIBUTOR)
+ASSUME THE COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. UNDER
+THE TERMS OF THIS LICENSOR WILL NOT SUPPORT THIS SOFTWARE AND IS UNDER
+NO OBLIGATION TO ISSUE UPDATES TO THIS SOFTWARE. LICENSOR HAS NO
+KNOWLEDGE OF ERRANT CODE OR VIRUS IN THIS SOFTWARE, BUT DOES NOT WARRANT
+THAT THE SOFTWARE IS FREE FROM SUCH ERRORS OR VIRUSES. THIS DISCLAIMER
+OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF
+LICENSED SOFTWARE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS DISCLAIMER.
+
+9.0 Limitation of Liability. UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL
+THEORY, WHETHER TORT (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE,
+SHALL THE LICENSOR, ANY CONTRIBUTOR, OR ANY DISTRIBUTOR OF LICENSED
+SOFTWARE, OR ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY
+PERSON FOR ANY INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
+OF ANY CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF
+GOODWILL, WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL
+OTHER COMMERCIAL DAMAGES OR LOSSES, EVEN IF SUCH PARTY SHALL HAVE BEEN
+INFORMED OF THE POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF
+LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY
+RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT APPLICABLE LAW
+PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION
+OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THIS EXCLUSION
+AND LIMITATION MAY NOT APPLY TO YOU.
+
+10.0 High Risk Activities. THE LICENSED SOFTWARE IS NOT FAULT-TOLERANT
+AND IS NOT DESIGNED, MANUFACTURED, OR INTENDED FOR USE OR DISTRIBUTION
+AS ON-LINE CONTROL EQUIPMENT IN HAZARDOUS ENVIRONMENTS REQUIRING
+FAIL-SAFE PERFORMANCE, SUCH AS IN THE OPERATION OF NUCLEAR FACILITIES,
+AIRCRAFT NAVIGATION OR COMMUNICATIONS SYSTEMS, AIR TRAFFIC CONTROL,
+DIRECT LIFE SUPPORT MACHINES, OR WEAPONS SYSTEMS, IN WHICH THE FAILURE
+OF THE LICENSED SOFTWARE COULD LEAD DIRECTLY TO DEATH, PERSONAL INJURY,
+OR SEVERE PHYSICAL OR ENVIRONMENTAL DAMAGE ("HIGH RISK ACTIVITIES").
+LICENSOR AND CONTRIBUTORS SPECIFICALLY DISCLAIM ANY EXPRESS OR IMPLIED
+WARRANTY OF FITNESS FOR HIGH RISK ACTIVITIES.
+
+11.0 Responsibility for Claims. As between Licensor and Contributors,
+each party is responsible for claims and damages arising, directly or
+indirectly, out of its utilization of rights under this License which
+specifically disclaims warranties and limits any liability of the
+Licensor. This paragraph is to be used in conjunction with and
+controlled by the Disclaimer Of Warranties of Section 8, the Limitation
+Of Damages in Section 9, and the disclaimer against use for High Risk
+Activities in Section 10. The Licensor has thereby disclaimed all
+warranties and limited any damages that it is or may be liable for. You
+agree to work with Licensor and Contributors to distribute such
+responsibility on an equitable basis consistent with the terms of this
+License including Sections 8, 9, and 10. Nothing herein is intended or
+shall be deemed to constitute any admission of liability.
+
+12.0 Termination. This License and all rights granted hereunder will
+terminate immediately in the event of the circumstances described in
+Section 13.6 or if applicable law prohibits or restricts You from
+fully and or specifically complying with Sections 3, 4 and/or 6, or
+prevents the enforceability of any of those Sections, and You must
+immediately discontinue any use of Licensed Software.
+
+12.1 Automatic Termination Upon Breach. This License and the rights
+granted hereunder will terminate automatically if You fail to comply
+with the terms herein and fail to cure such breach within thirty (30)
+days of becoming aware of the breach. All sublicenses to the Licensed
+Software that are properly granted shall survive any termination of this
+License. Provisions that, by their nature, must remain in effect beyond
+the termination of this License, shall survive.
+
+12.2 Termination Upon Assertion of Patent Infringement. If You initiate
+litigation by asserting a patent infringement claim (excluding
+declaratory judgment actions) against Licensor or a Contributor
+(Licensor or Contributor against whom You file such an action is
+referred to herein as "Respondent") alleging that Licensed Software
+directly or indirectly infringes any patent, then any and all rights
+granted by such Respondent to You under Sections 3 or 4 of this License
+shall terminate prospectively upon sixty (60) days notice from
+Respondent (the "Notice Period") unless within that Notice Period You
+either agree in writing (i) to pay Respondent a mutually agreeable
+reasonably royalty for Your past or future use of Licensed Software made
+by such Respondent, or (ii) withdraw Your litigation claim with respect
+to Licensed Software against such Respondent. If within said Notice
+Period a reasonable royalty and payment arrangement are not mutually
+agreed upon in writing by the parties or the litigation claim is not
+withdrawn, the rights granted by Licensor to You under Sections 3 and 4
+automatically terminate at the expiration of said Notice Period.
+
+12.3 Reasonable Value of This License. If You assert a patent
+infringement claim against Respondent alleging that Licensed Software
+directly or indirectly infringes any patent where such claim is resolved
+(such as by license or settlement) prior to the initiation of patent
+infringement litigation, then the reasonable value of the licenses
+granted by said Respondent under Sections 3 and 4 shall be taken into
+account in determining the amount or value of any payment or license.
+
+12.4 No Retroactive Effect of Termination. In the event of termination
+under this Section all end user license agreements (excluding licenses
+to distributors and resellers) that have been validly granted by You or
+any distributor hereunder prior to termination shall survive
+termination.
+
+13.0 Miscellaneous.
+
+13.1 U.S. Government End Users. The Licensed Software is a "commercial
+item," as that term is defined in 48 C.F.R. 2.101 (Oct. 1995),
+consisting of "commercial computer software" and "commercial computer
+software documentation," as such terms are used in 48 C.F.R. 12.212
+(Sept. 1995). Consistent with 48 C.F.R. 12.212 and 48 C.F.R. 227.7202-1
+through 227.7202-4 (June 1995), all U.S. Government End Users acquire
+Licensed Software with only those rights set forth herein.
+
+13.2 Relationship of Parties. This License will not be construed as
+creating an agency, partnership, joint venture, or any other form of
+legal association between or among You, Licensor, or any Contributor,
+and You will not represent to the contrary, whether expressly, by
+implication, appearance, or otherwise.
+
+13.3 Independent Development. Nothing in this License will impair
+Licensor's right to acquire, license, develop, subcontract, market, or
+distribute technology or products that perform the same or similar
+functions as, or otherwise compete with, Extensions that You may
+develop, produce, market, or distribute.
+
+13.4 Consent To Breach Not Waiver. Failure by Licensor or Contributor to
+enforce any provision of this License will not be deemed a waiver of
+future enforcement of that or any other provision.
+
+13.5 Severability. This License represents the complete agreement
+concerning the subject matter hereof. If any provision of this License
+is held to be unenforceable, such provision shall be reformed only to
+the extent necessary to make it enforceable.
+
+13.6 Inability to Comply Due to Statute or Regulation. If it is
+impossible for You to comply with any of the terms of this License with
+respect to some or all of the Licensed Software due to statute, judicial
+order, or regulation, then You cannot use, modify, or distribute the
+software.
+
+13.7 Export Restrictions. You may be restricted with respect to
+downloading or otherwise acquiring, exporting, or reexporting the
+Licensed Software or any underlying information or technology by United
+States and other applicable laws and regulations. By downloading or by
+otherwise obtaining the Licensed Software, You are agreeing to be
+responsible for compliance with all applicable laws and regulations.
+
+13.8 Arbitration, Jurisdiction & Venue. This License shall be governed
+by Colorado law provisions (except to the extent applicable law, if any,
+provides otherwise), excluding its conflict-of-law provisions. You
+expressly agree that any dispute relating to this License shall be
+submitted to binding arbitration under the rules then prevailing of the
+American Arbitration Association. You further agree that Adams County,
+Colorado USA is proper venue and grant such arbitration proceeding
+jurisdiction as may be appropriate for purposes of resolving any dispute
+under this License. Judgement upon any award made in arbitration may be
+entered and enforced in any court of competent jurisdiction. The
+arbitrator shall award attorney's fees and costs of arbitration to the
+prevailing party. Should either party find it necessary to enforce its
+arbitration award or seek specific performance of such award in a civil
+court of competent jurisdiction, the prevailing party shall be entitled
+to reasonable attorney's fees and costs. The application of the United
+Nations Convention on Contracts for the International Sale of Goods is
+expressly excluded. You and Licensor expressly waive any rights to a
+jury trial in any litigation concerning Licensed Software or this
+License. Any law or regulation that provides that the language of a
+contract shall be construed against the drafter shall not apply to this
+License.
+
+13.9 Entire Agreement. This License constitutes the entire agreement
+between the parties with respect to the subject matter hereof.
+
+EXHIBIT A
+
+The Notice below must appear in each file of the Source Code of any copy
+You distribute of the Licensed Software or any Extensions thereto,
+except as may be modified as allowed under the terms of Section 7.1
+
+    Copyright (C) 1999-2002 Technical Pursuit Inc., All Rights
+    Reserved. Patent Pending, Technical Pursuit Inc.
+
+    Unless explicitly acquired and licensed from Licensor under the
+    Technical Pursuit License ("TPL") Version 1.0 or greater, the
+    contents of this file are subject to the Reciprocal Public License
+    ("RPL") Version 1.1, or subsequent versions as allowed by the RPL,
+    and You may not copy or use this file in either source code or
+    executable form, except in compliance with the terms and conditions
+    of the RPL.
+
+    You may obtain a copy of both the TPL and the RPL (the "Licenses")
+    from Technical Pursuit Inc. at http://www.technicalpursuit.com.
+
+    All software distributed under the Licenses is provided strictly on
+    an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR
+    IMPLIED, AND TECHNICAL PURSUIT INC. HEREBY DISCLAIMS ALL SUCH
+    WARRANTIES, INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF
+    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT,
+    OR NON-INFRINGEMENT. See the Licenses for specific language
+    governing rights and limitations under the Licenses. 
+
+
Index: install/database_update.php
===================================================================
--- install/database_update.php	(revision 1)
+++ install/database_update.php	(Premod 3.0.8)
@@ -421,6 +421,8 @@
 		SET config_value = '$updates_to_version'
 		WHERE config_name = 'version'";
 	_sql($sql, $errored, $error_ary);
+	// SEO premod
+	set_config('seo_premod_version', '3.0.8');
 }
 
 // Reset permissions
@@ -868,12 +870,21 @@
 				FORUMS_TABLE		=> array(
 					'forum_options'			=> array('UINT:20', 0),
 				),
+				// SEO premod, add this here to properly print the query to eventually use later
+				TOPICS_TABLE		=> array(
+					'topic_url'			=> array('VCHAR:255', '')
+				),
 			),
 			'change_columns'		=> array(
 				USERS_TABLE				=> array(
 					'user_options'		=> array('UINT:11', 230271),
 				),
 			),
+			// SEO premod, add this here to properly print the query to eventually use later
+			// Make sure that the index name is correct for the no dupe
+			'drop_keys'		=> array(
+				TOPICS_TABLE			=> array('topic_last_post_id'),
+			),
 			'add_index'		=> array(
 				REPORTS_TABLE		=> array(
 					'post_id'		=> array('post_id'),
@@ -882,6 +893,10 @@
 				POSTS_TABLE			=> array(
 					'post_username'		=> array('post_username:255'),
 				),
+				// SEO premod, add this here to properly print the query to eventually use later
+				TOPICS_TABLE			=> array(
+					'topic_lpid'		=> array('topic_last_post_id'),
+				),
 			),
 		),
 
@@ -1360,6 +1375,14 @@
 					'auth'		=> 'aclf_m_report',
 					'cat'		=> 'MCP_REPORTS'
 				),
+				// SEO premod, add the new extended settings panel
+				'extended'		=> array(
+					'base'		=> 'phpbb_seo',
+					'class'		=> 'acp',
+					'title'		=> 'ACP_SEO_EXTENDED',
+					'auth'		=> 'acl_a_board',
+					'cat'		=> 'ACP_MOD_REWRITE'
+				),
 			);
 
 			_add_modules($modules_to_install);
@@ -3803,4 +3826,4 @@
 	}
 }
 
-?>
+?>
\ No newline at end of file
Index: install/index.php
===================================================================
--- install/index.php	(revision 1)
+++ install/index.php	(Premod 3.0.8)
@@ -231,6 +231,7 @@
 include($phpbb_root_path . 'language/' . $language . '/common.' . $phpEx);
 include($phpbb_root_path . 'language/' . $language . '/acp/common.' . $phpEx);
 include($phpbb_root_path . 'language/' . $language . '/acp/board.' . $phpEx);
+include($phpbb_root_path . 'language/' . $language . '/mods/acp_phpbb_seo.' . $phpEx);
 include($phpbb_root_path . 'language/' . $language . '/install.' . $phpEx);
 include($phpbb_root_path . 'language/' . $language . '/posting.' . $phpEx);
 
@@ -242,7 +243,7 @@
 define('CHMOD_WRITE', 2);
 define('CHMOD_EXECUTE', 1);
 
-$mode = request_var('mode', 'overview');
+$mode = request_var('mode', 'seo_premod');
 $sub = request_var('sub', '');
 
 // Set PHP error handler to ours
Index: install/install_phpbb_seo.php
===================================================================
--- install/install_phpbb_seo.php	(phpBB 3.0.8)
+++ install/install_phpbb_seo.php	(Premod 3.0.8)
@@ -0,0 +1,69 @@
+<?php
+/**
+*
+* @package Ultimate SEO URL phpBB SEO
+* @version $Id: install_phpbb_seo.php 158 2009-11-18 08:50:19Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://www.opensource.org/licenses/rpl1.5.txt Reciprocal Public License 1.5
+*
+*/
+
+/**
+*/
+
+if ( !defined('IN_INSTALL') )
+{
+	// Someone has tried to access the file direct. This is not a good idea, so exit
+	exit;
+}
+
+if (!empty($setmodules))
+{
+	$module[] = array(
+		'module_type'		=> 'install',
+		'module_title'		=> 'SEO_PREMOD',
+		'module_filename'	=> substr(basename(__FILE__), 0, -strlen($phpEx)-1),
+		'module_order'		=> -1,
+		'module_subs'		=> array('INTRO', 'LICENSE', 'SUPPORT'),
+		'module_stages'		=> '',
+		'module_reqs'		=> ''
+	);
+}
+
+/**
+* Main Tab - Installation
+* @package install
+*/
+class install_phpbb_seo extends module {
+	function install_phpbb_seo(&$p_master) {
+		$this->p_master = &$p_master;
+	}
+	function main($mode, $sub) {
+		global $lang, $template, $language;
+
+		switch ($sub) {
+			case 'intro' :
+				$title = $lang['SEO_PREMOD_TITLE'];
+				$body = $lang['SEO_PREMOD_BODY'];
+			break;
+			case 'license' :
+				$title = $lang['SEO_LICENCE_TITLE'];
+				$body = '<p>' . $lang['SEO_PREMOD_LICENCE'] . '</p><br/><hr/>' . implode("<br/>\n", file('./docs/COPYING'));
+			break;
+			case 'support' :
+				$title = $lang['SEO_SUPPORT_TITLE'];
+				$body = $lang['SEO_PREMOD_SUPPORT_BODY'];
+			break;
+		}
+		$this->tpl_name = 'install_main';
+		$this->page_title = $title;
+		$template->assign_vars(array(
+			'TITLE'		=> $title,
+			'BODY'		=> $body,
+
+			'S_LANG_SELECT'	=> '<select id="language" name="language">' . $this->p_master->inst_language_select($language) . '</select>',
+		));
+	}
+}
+
+?>
Index: gymrss.php
===================================================================
--- gymrss.php	(phpBB 3.0.8)
+++ gymrss.php	(Premod 3.0.8)
@@ -0,0 +1,23 @@
+<?php
+/**
+*
+* @package phpBB SEO GYM Sitemaps
+* @version $Id: gymrss.php 112 2009-09-30 17:21:34Z dcz $
+* @copyright (c) 2006 - 2009 www.phpbb-seo.com
+* @license http://opensource.org/osi3.0/licenses/lgpl-license.php GNU Lesser General Public License
+*
+*/
+define('IN_PHPBB', true);
+$phpEx = substr(strrchr(__FILE__, '.'), 1);
+$phpbb_root_path = './';
+include($phpbb_root_path . 'common.' . $phpEx);
+// Start session management
+$user->session_begin();
+$auth->acl($user->data);
+$user->setup('gym_sitemaps/gym_common');
+// Start the process
+require($phpbb_root_path . 'gym_sitemaps/includes/gym_rss.' . $phpEx);
+
+$gym_rss  = new gym_rss();
+exit;
+?>
\ No newline at end of file
